function sourceFn(){"use strict";(self.webpackChunkvkwidgets=self.webpackChunkvkwidgets||[]).push([[6550],{100226:(e,t,s)=>{s.d(t,{drawAlbumPartRow:()=>a});var o=s(225590);function a(e){return`<div class="audio_album_part_row">${(0,o.getLang)("audio_album_part").replace("{part}",e)}</div>`}},517403:(e,t,s)=>{s.d(t,{getAlbumParts:()=>a});var o=s(342443);function a(e){if(e&&e.getAudiosCount()&&e.isFullyLoadable()&&!e.hasMore()){const t=e.getAudiosList(),s=e.getAudiosCount(),a=[];let l=0;for(let e=0;e<s;e++){const s=t[e][o.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART];s>l&&(l=s,a.push({number:s,offset:e}))}if(a.length>1)return a}return!1}},277614:(e,t,s)=>{s.d(t,{showAudioAlbum:()=>r});var o=s(747528),a=s(712341),l=s(569995);function r(e,t){return cur.viewAsBox?cur.viewAsBox():(t=a.AudioUtils.audioTupleToAudioObject(t),layers.fullhide&&layers.fullhide(),(0,l.onAdditionalEvent)(e,t,{type:o.TYPE_SHOW_ALBUM}),a.AudioUtils.showAudioPlaylist(t.album[0],t.album[1],t.album[2]))}},881006:(e,t,s)=>{s.d(t,{followArtist:()=>d});var o=s(817715),a=s(712341),l=s(225590),r=s(743694),n=s(422798);function d(e,t,s,d){(0,o.lockButton)(d),ajax.post("al_artist.php",{act:"follow",artist_id:e,ref:t,hash:s},{onFail:()=>(0,o.unlockButton)(d),onDone:s=>{(0,o.unlockButton)(d),r.FlatButton.setLabel(d,(0,l.getLang)("audio_following_artist_button")),d.classList.add("MusicAuthor__follow_btn__followed"),(0,n.showDoneBoxFull)("",{},{text:(0,l.getLang)("audio_follow_artist_success_notification_text"),title:(0,l.getLang)("audio_follow_artist_success_notification_title")}),d.onclick=o=>{o.preventDefault(),a.AudioUtils.unfollowArtist(e,t,s,d)}}})}},766122:(e,t,s)=>{function o(e,t){ajax.post("al_artist.php",{act:"track_to_official",hash:e,url:t},{onFail:()=>!0})}s.d(t,{trackArtistToOfficial:()=>o})},461113:(e,t,s)=>{s.d(t,{unfollowArtist:()=>d});var o=s(817715),a=s(712341),l=s(225590),r=s(178009),n=s(743694);function d(e,t,s,d){(0,o.lockButton)(d),ajax.post("al_artist.php",{act:"unfollow",artist_id:e,ref:t,hash:s},{onFail:()=>(0,o.unlockButton)(d),onDone:s=>{if(d){(0,o.unlockButton)(d);(0,r.hasClass)(d,"MusicAuthor__follow_btn__can_follow")?(n.FlatButton.setLabel(d,(0,l.getLang)("audio_follow_artist_button")),d.classList.remove("MusicAuthor__follow_btn__followed"),d.onclick=o=>{o.preventDefault(),a.AudioUtils.followArtist(e,t,s,d)}):(0,r.re)(d)}}})}},767211:(e,t,s)=>{s.d(t,{getRowActionName:()=>_});var o=s(225590),a=s(712341),l=s(412203),r=s(56522),n=s(415086),d=s(607690);function _(e,t,s){const _=r.AudioPageProxy.ensure(),u=(0,l.ensureAudioPageService)(),c=u.$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState()[t.fullId]?.state?.text,h=t.fullId in u.$deletedFromMyMusicAudiosIdentitiesMap.getState(),p=n.Ranges.isGroupId(_.ownerId)&&_.ownerId===t.ownerId&&(0,d.getGroupAudioFullId)(t,_.ownerId)in u.$deletedFromGroupAudiosIdentitiesMap.getState(),A=t.fullId in u.$myMusicIdentitiesMap.getState();let y;switch(e){case"current_delete":y=(0,o.getLang)("audio_delete_from_current");break;case"recoms_delete":y=(0,o.getLang)("audio_dont_show");break;case"listened_delete":y=(0,o.getLang)("audio_remove_from_list");break;case"delete":y=a.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_delete_episode"):window.AudioPage&&window.AudioPage.isInRecentPlayed(s)?(0,o.getLang)("audio_remove_from_list"):c||(0,o.getLang)("global_delete_audio");break;case"restore_recoms":y=(0,o.getLang)("audio_restore_audio");break;case"more":y=(0,o.getLang)("global_media_selector_more");break;case"add":if(a.AudioUtils.isPodcast(t))y=(0,o.getLang)("audio_podcast_restore_episode");else if(h||p)y=(0,o.getLang)("audio_restore_audio");else if(A)y=(0,o.getLang)("global_delete_audio");else{let e=!1;window.AudioPage&&(e=currentAudioPage(s)),!e&&window.cur.audioPage&&(e=window.cur.audioPage),y=e&&e.getOwnerId()<0&&e.canAddToGroup()&&e.getOwnerId()!==t.ownerId?(0,o.getLang)("audio_add_to_group"):(0,o.getLang)("audio_add_to_audio")}break;case"edit":y=a.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_edit_episode"):(0,o.getLang)("audio_edit_audio");break;case"next":y=(0,o.getLang)("audio_set_next_audio");break;case"recoms":y=(0,o.getLang)("audio_show_recommendations");break;case"fave":y=a.AudioUtils.isPodcast(t)?(0,o.getLang)("audio_podcast_listen_later"):"";break;case"lyrics":y=(0,o.getLang)("audio_show_lyrics");break;case"snippet":y=(0,o.getLang)("audio_longtap_tooltip_text");break;default:y=""}return y}},276535:(e,t,s)=>{s.d(t,{hasAudioHQBodyClass:()=>a});var o=s(342443);function a(){return document.body.classList.contains(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS)}},667789:(e,t,s)=>{s.d(t,{renderAudioDiag:()=>r});var o=s(178009),a=s(451306),l=s(342443);function r(){let e=(0,o.ge)("audio_diag_log"),t=ls.get(l.AUDIO_PLAYER_ENUMS.LOG_LS_KEY)||[];e&&(0,a.each)(t,(function(t,s){let a=new Date(s.shift()).toUTCString();s=s.join(", "),e.appendChild((0,o.se)('<div class="audio_diag_log_row"><span class="audio_diag_log_time">'+a+"</span>"+s+"</div>"))}))}},476637:(e,t,s)=>{s.d(t,{toggleAudioHQBodyClass:()=>a});var o=s(342443);function a(){let e=AudioPlayer.showHQLabel();document.body.classList.toggle(o.AUDIO_PLAYER_ENUMS.AUDIO_HQ_LABEL_CLS,e)}},298473:(e,t,s)=>{s.d(t,{updateQueueReceivedPost:()=>l});var o=s(178009),a=s(451306);function l(e){e&&(0,a.each)((0,o.geByClass)("_audio_row",e),(function(){(0,o.domData)(this,"new-post","groups"==cur.module?"wall":"feed")}))}},863473:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AudioPlaylist:()=>AudioPlaylist});var _swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(434518),_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(763812),_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(326107),_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(48711),_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(422798),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(451306),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(547214),_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(712341),_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(635589),_web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(461306),_web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(708025),_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(892542),_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(351118),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(996061),_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(342443);const TRUE_PLAYLIST_TYPES=["playlist","album"];var _lastPlayedAudioIdentity=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_lastPlayedAudioIdentity"),_audioListSource=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_11__._)("_audioListSource");class AudioPlaylist{static splitId(e){let[t,s,...o]=e.split("_");return o=o.join("_"),[t,s,o]}static getFullIdFromData(e){const t=e||{},{ownerId:s,id:o,albumId:a,accessHash:l}=t;return`${s||vk.id}_${o||a||0}${l?"_"+l:""}`}get lastPlayedAudio(){const e=this.getSelf();return(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]&&e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e._list)&&"playlist"===e.getType()?e._list.find((e=>e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].ownerId&&e[_shared_audio_enums__WEBPACK_IMPORTED_MODULE_10__.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]===(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity].id)):null}get originalIdentity(){return this.getSelf()._original_identity}get followedIdentity(){return this.getSelf()._followed_identity}isTruePlaylistType(){const e=this.getSelf();return!this.getIsFakeId()&&TRUE_PLAYLIST_TYPES.includes(e.getType())}updatePlaylist(e){const t=this.getSelf();let s=!1;return t&&e?(t._title!==e.title&&(t._title=e.title,s=!0),t._titleLang!==e.titleLang&&(t._titleLang=e.titleLang,s=!0),s):s}_ensureIndex(e){const t=this.getSelf();if(t._index)return void(e&&e());const s=t.getAudiosList();if(!s)return;const o=(e,t)=>{const s=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(t);return s>=33&&s<48?String.fromCharCode(s):e};t._index=new _web_indexer_indexer__WEBPACK_IMPORTED_MODULE_6__.vkIndexer(s,(e=>(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]+" "+e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/\&\#(\d+);?/gi,o)),e)}cleanIndex(){this.getSelf()._index=null}search(e,t){let s=this.getSelf();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)||(e={q:e}),this._ensureIndex((()=>{let o=s._index?s._index.search(e.q):[];return o=o.filter((function(t){return!e.lyrics||""!==t[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_LYRICS]})),t(o)}))}setNextOffset(e){this._nextOffset=e}getNextOffset(){let e=this.getSelf();return e._forceReload?0:""===e._nextOffset?e._nextOffset:e._nextOffset||this.getAudiosCount()}getIsFakeId(){return this.getSelf()._isFakeId}setIsFakeId(e){this.getSelf()._isFakeId=e}getId(){return this.getType()+"_"+this.getOwnerId()+"_"+this.getAlbumId()}getFullId(){return this.getOwnerId()+"_"+this.getAlbumId()+(this.getAccessHash()?"_"+this.getAccessHash():"")}isReference(){return!!this._ref}getSelf(){return this._ref&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(this._ref)?this._ref:this}getType(){return this.getSelf()._type}getExpire(){return this.getSelf()._expire}getOwnerId(){return+this.getSelf()._ownerId}getAlbumId(){return this.getSelf()._albumId}getPlaylistId(){return this.getSelf()._albumId}getIsExplicit(){return this.getSelf()._isExplicit}getNoConsecutivePlay(){return this.getSelf()._noConsecutivePlay}getOriginalPlaylistRawId(){return this.getSelf()._originalPlaylistRawId}getFollowHash(){return this.getSelf()._followHash}getContext(){return this.getSelf()._context}setContext(e){this.getSelf()._context=e}getTrackCodeRef(){return this.getBlockId()||this.getContext()}getRef(){return this.getSelf()._ref}getRawId(){return this.getSelf()._implPlay_rawId}getGridCovers(){return this.getSelf()._gridCovers||""}getTitle(){return this.getSelf()._title||""}getTitleLang(){return null==this.getSelf()._titleLang?null:this.getSelf()._titleLang}getSubtitle(){return this.getSelf()._subTitle||""}getDescription(){return this.getSelf()._description||""}getRawDescription(){return this.getSelf()._rawDescription||""}getAccessHash(){return this.getSelf()._accessHash||""}getFromId(){return this.getSelf()._fromId||0}setFromId(e){this.getSelf()._fromId=e}getAuthorLine(){return this.getSelf()._authorLine||""}getAuthorHref(){return this.getSelf()._authorHref||""}getAuthorName(){return this.getSelf()._authorName||""}getInfoLine1(){return this.getSelf()._infoLine1||""}getInfoLine2(){return this.getSelf()._infoLine2||""}getListens(){return this.getSelf()._listens||0}getAddClasses(){return this.getSelf()._addClasses||""}getLastUpdated(){return this.getSelf()._lastUpdated||""}getEditHash(){return this.getSelf()._editHash||""}getDeleteHash(){return this.getSelf()._deleteHash||""}getReplaceHash(){return this.getSelf()._replaceHash||""}getCoverUrl(){return this.getSelf()._coverUrl||""}getBlocks(){return this.getSelf()._blocks||{}}getSearchParams(){return this.getSelf()._searchParams||null}getSearchQid(){return this.getSelf()._searchQid||null}getLocalFoundCount(){return this.getSelf()._localFoundTotal||0}getTotalCount(){return this.getSelf()._totalCount}getTotalCountHash(){return this.getSelf()._totalCountHash}getFriendId(){return this.getSelf()._friend}getNoDiscover(){return this.getSelf()._noDiscover}getAudiosList(){return this.getSelf()._list}getPostId(){return this.getSelf()._postId}getWallQuery(){return this.getSelf()._wallQuery}getWallType(){return this.getSelf()._wallType}getCommunititesBlock(){return this.getSelf()._communitiesBlock}getArtistsBlock(){return this.getSelf()._artistsBlock}getPlaylistsBlock(){return this.getSelf()._playlistsBlock}getLiveInfo(){let e=this.getSelf()._live;return!!e&&(e=e.split(","),{hostId:e[0],audioId:e[1],hash:e[2]})}getAudiosCount(){let e=this.getSelf();return Array.isArray(e._list)?e._list.length:0}getTotalDuration(){let e=this.getAudiosList(),t=0;return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(e,(function(e,s){t+=s[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_DURATION]})),t}getAudio(e){if(!e)return null;let t=this.getSelf();"string"==typeof e&&(e=e.split("_"));for(let s=0,o=t._list.length;s<o;s++)if(e[0]==t._list[s][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&e[1]==t._list[s][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return t._list[s];return null}getAudioAt(e){let t=this.getSelf();return e<t._list.length?t._list[e]:null}setLocalFoundCount(e){this.getSelf()._localFoundTotal=e}setAdsAllowed(e){return this.getSelf()._isAdsAllowed=e}setFollowed(e){let t=this.getAddClasses()||"";return t=t.replace("audio_playlist__followed",""),e&&(t+=" audio_playlist__followed"),this.getSelf()._addClasses=t,this.getSelf()._isFollowed=e}isBlocked(){return!!this.getSelf()._isBlocked}hasMore(){return!!this.getSelf()._hasMore}isOfficial(){return!!this.getSelf()._isOfficial}isFollowed(){return this.getSelf()._isFollowed}isAdsAllowed(){return!!this.getSelf()._isAdsAllowed}getForceReload(){return this.getSelf()._forceReload}isInfinite(){return this.getSelf()._isInfinite}isFullyLoaded(){return this._isFullyLoaded}isFullyLoadable(){return this.getType()===AudioPlaylist.TYPE_PLAYLIST}isLive(){return!!this.getLiveInfo()}isLoadable(){return this.getSelf()._isLoadable}getFeedOffset(){return this._feedOffset}getFeedFrom(){return this._feedFrom}_unref(){let e=this._ref;if(!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e))return;let t={};for(let s in e)if(e.hasOwnProperty(s)&&!(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e[s])&&0===s.indexOf("_")){let o=e[s];t[s.substr(1)]=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(o)?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(o):o}t.hasMore=!1,delete this._ref,this._type=AudioPlaylist.TYPE_TEMP,this._albumId=t.albumId,this._list=[],this._fetchService=t.fetchService,this.mergeWith(t)}equals(e){return this.getSelf()===e.getSelf()}serialize(){return JSON.stringify(this.asObject())}indexOfAudio(e){if(!e)return-1;let t=[];(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isString)(e)?t=e.split("_"):(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?t=[e.ownerId,e.id]:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(t=[e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID]]);const s=this.getAudiosList();if(!s)return-1;for(let e=0,o=s.length;e<o;e++)if(s[e]&&t[0]==s[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==s[e][_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_ID])return e;return-1}asObject(){let e={};return e.type=this.getType()||AudioPlaylist.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=this.getNextOffset(),e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)()._getPlayingContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=this.getExpire?this.getExpire():null,e.blockId=this.getBlockId(),this.getType()===AudioPlaylist.TYPE_PLAYLIST&&this.getAlbumId()>0&&(e.originalPlaylistRawId=this.getOwnerId()+"_"+this.getAlbumId()+"_"+this.getAccessHash()),this.getType()===AudioPlaylist.TYPE_RADIO&&(e.list=this.getAudiosList()),e}asPlaylistData(){return{type:this.getType(),ownerId:this.getOwnerId(),id:this.getId(),title:this.getTitle(),hasMore:this.hasMore(),list:this.getAudiosList(),nextOffset:this.getNextOffset(),subtitle:this.getSubtitle(),totalCount:this.getTotalCount(),blockId:this.getBlockId()}}toString(){return this.getId()}clean(e){e||this._unref();let t=this.getSelf();t._hasMore=!0,t._list=[],t._feedOffset=t._feedFrom=0,t._nextOffset=0}initSortedList(e){return this.getSelf()._list=e||[]}setForceReload(e){let t=this.getSelf();return e&&(t._hasMore=!0),t._forceReload=e}getBlockId(){return this.getSelf()._blockId}async getAudioIds(e){const t={playlist_id:this.getFullId(),block_id:this.getBlockId(),trackType:e,context:this.getContext(),ref:this.getTrackCodeRef()},{audioIds:s,lastPlayedAudioRawId:o=null}=await this.getSelf()._fetchService.getAudioIdsBySource(t,{audioListId:this.getFullId(),audioListSource:(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_audioListSource)[_audioListSource],ref:this.getTrackCodeRef()});return o&&((0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_14__.mapAPIRawIdToAudioIdentity)(o)),s}loadAll(e,t="",s=null){if(!this.isFullyLoadable())return e&&e(this);this.load(0,e,!0,"default",t,s)}loadByBlockId(e,t,s,o="default"){const a=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)(),l=(e,t=null)=>{const s=this._onDoneLoading;delete this._onDoneLoading,delete this._loadingAll,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(s||[],((e,s)=>{s&&s(this,t)}))},r=this.getNextOffset();if(this.getAudiosCount()&&(!e||e!==r))return t&&t(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(t),this._loadingAll)return;if(s)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,l);const n=a.getPlaylistByBlockId(this._blockId);n&&a.notify(_shared_audio_AudioPlayerEvents__WEBPACK_IMPORTED_MODULE_1__.events.PLAYLIST_START_LOADING,n.getPlaylistId(),n.getBlockId()),ajax.post("al_audio.php?act=load_block_playlist",{block_id:this._blockId,start_from:r},{onDone:e=>{this._blockId=e.blockId,a.mergePlaylistData(this,e),l(),a.saveStateCurrentPlaylist(),""===this.getNextOffset()&&(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1)}})}load(offset,onDone,needAll,trackType="default",viewType=null,onFail=null){const audioPlayer=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)();(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(offset)?(onDone=offset,offset=0):offset=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(offset),this.getSelf().isExpired()&&(this.getSelf()._hasMore=!0,this.getSelf().setForceReload(!0));const searchParams=this.getSearchParams();let wasPreload=!1,countAvailable=this.getType()===this.getAudiosCount(),isGoingToLoadAll=this.isFullyLoadable()&&needAll&&this.hasMore(),callOnDones=(e,t,s)=>{let o=this._onDoneLoading;s||(delete this._onDoneLoading,delete this._loadingAll);(!wasPreload||wasPreload&&cur.audioChooseBox&&(0,_web_lib_box_utils__WEBPACK_IMPORTED_MODULE_2__.curBox)())&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(o||[],((s,o)=>{o&&o(e,t)})),s&&(wasPreload=!0)},params;if(this.getSelf().getForceReload()&&(offset<countAvailable&&!isGoingToLoadAll||""===this.getNextOffset()||!this.hasMore()||searchParams&&this.getType()===AudioPlaylist.TYPE_SEARCH&&!searchParams.globalQuery))return onDone&&onDone(this);if(this._onDoneLoading=this._onDoneLoading||[],this._onDoneLoading.push(onDone),this._loadingAll)return onDone&&onDone(this);if(needAll)return this._loadingAll=!0,void(0,_playlist_loadAllPlaylistAudios__WEBPACK_IMPORTED_MODULE_5__.loadAllPlaylistAudios)(this,callOnDones,viewType);offset=this.getNextOffset(),offset===this.getLocalFoundCount()&&(offset-=this.getLocalFoundCount()),offset||clearTimeout(this._sendSearchStatsTimeout),this.getSelf().getForceReload()&&this.getSelf().setForceReload(!1);let isCatalog=!1;if(this._blockId)params={act:"load_block_playlist",block_id:this._blockId,start_from:this.getNextOffset()},isCatalog=!0;else{const e=cur.audioPage&&this.getType()===AudioPlaylist.TYPE_SEARCH?cur.audioPage.getOwnerId():this.getOwnerId();params={act:"load_section",type:this.getType(),owner_id:e,playlist_id:this.getPlaylistId(),offset:offset,context:this.getContext(),access_hash:this.getAccessHash(),search_q:searchParams?searchParams.globalQuery:null,search_performer:searchParams?searchParams.performer:null,search_lyrics:searchParams?searchParams.lyrics:null,search_sort:searchParams?searchParams.sort:null,search_history:searchParams?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(searchParams.fromHistory):null,search_qid:this.getSearchQid(),feed_from:this.getFeedFrom(),feed_offset:this.getFeedOffset(),post_id:this.getPostId(),wall_query:this.getWallQuery(),wall_type:this.getWallType(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(nav.objLoc.claim),track_type:trackType,ref:this.getTrackCodeRef()}}return ajax.post("al_audio.php",params,{onDone:(loadedPlaylist,tpl,langs,templatesScript,data)=>{if(!loadedPlaylist)return this.getSelf().setNextOffset(""),void(isCatalog?onDone&&onDone(loadedPlaylist):callOnDones(loadedPlaylist));(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),this._loadingAll&&!needAll||(audioPlayer.mergePlaylistData(this,loadedPlaylist),isCatalog?onDone&&onDone(loadedPlaylist.list):callOnDones(loadedPlaylist),audioPlayer.saveStateCurrentPlaylist(),offset&&""!==loadedPlaylist.nextOffset||(clearTimeout(this._sendSearchStatsTimeout),this._sendSearchStatsTimeout=setTimeout(this.sendSearchStats.bind(this,"search_view"),3e3),this._searchPlayStatsSent=!1))},onFail:e=>(onFail?.(e),!0),cache:this.getType()===AudioPlaylist.TYPE_SEARCH?1:0,loader:!0})}isExpired(){const e=this.getExpire();return!!e&&new Date(1e3*e).getTime()<(new Date).getTime()}mergeInfo(e){this._albumId=e.id||this._albumId;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.each)(["accessHash","addClasses","artistsBlock","authorLine","authorHref","authorName","communitiesBlock","coverUrl","description","gridCovers","editHash","feedFrom","feedOffset","followHash","hasMore","infoLine1","infoLine2","isAdsAllowed","isFollowed","original_identity","followed_identity","isOfficial","isBlocked","lastUpdated","listens","live","nextOffset","noConsecutivePlay","originalList","ownerId","playlistsBlock","postId","rawId","rawDescription","searchQid","searchParams","subTitle","title","titleLang","noDiscover","totalCount","totalCountHash","type","wallQuery","wallType","expire","is_explicit"],((t,s)=>{void 0!==e[s]&&(this["_"+s]=e[s])}))}mergeWith(e){let t=e.list;this.isExpired()&&(this.getSelf()._list=[]),t&&t.length&&(this.getType()===AudioPlaylist.TYPE_RADIO?this.pushAudio(t,0):this.pushAudio(t)),this.mergeInfo(e)}pushAudio(e,t){this._unref();const s=void 0===t,o=e=>{const o=this.getAudiosList(),a=[];for(let l=0;l<e.length;l++){const r=e[l],n=this.indexOfAudio(r);n<0?a.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(r)):s||(a.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clone)(r)),o.splice(n,1),n<t&&t--)}for(const e of a)e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_TITLE]).replace(/(<em>|<\/em>)/g,"")),e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.clean)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.replaceEntities)(e[_utils__WEBPACK_IMPORTED_MODULE_4__.AudioUtils.AUDIO_ITEM_INDEX_PERFORMER]).replace(/(<em>|<\/em>)/g,""));s?o.push(...a):o.splice(t,0,...a),this._index&&a.forEach((e=>this._index.add(e)))};(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e)&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isArray)(e[0])?o(e):e&&e.length&&o([e])}moveAudio(e,t){this._unref();let s=this._list.splice(e,1);e<t&&(t-=1),this._list.splice(t,0,s[0])}removeAudio(e){let t=this.indexOfAudio(e);if(t>=0){this._unref();let e=this._list.splice(t,1);this._index?.remove(e[0]);return(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().saveStateCurrentPlaylist(),t}return-1}sendSearchStats(e){if("search_play"===e){if(this._searchPlayStatsSent)return;this._searchPlayStatsSent=!0}ajax.post("al_audio.php?act=search_stats",{event_type:e,search_type:this.getSearchQid()?"external":"internal",search_params:JSON.stringify(this.getSearchParams()),results_count:this.getTotalCount()})}fetchNextAudio(...e){return this.getSelf()._fetchNextAudio(...e)}fetchNextLiveAudio(e){let t=this.getLiveInfo();ajax.post("al_audio.php",{act:"a_get_audio_status",host_id:t.hostId,hash:t.hash},{onDone:t=>e&&e(t),onFail:()=>!0})}constructor(e,t,s){Object.defineProperty(this,_audioListSource,{get:get_audioListSource,set:void 0}),Object.defineProperty(this,_lastPlayedAudioIdentity,{writable:!0,value:void 0}),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_12__._)(this,_lastPlayedAudioIdentity)[_lastPlayedAudioIdentity]=null;let o={};if(e&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isFunction)(e.getId))return e.isReference()?((0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this),e):(this._ref=e,void(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this));(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_0__.isObject)(e)?o=e:(o.ownerId=t,o.type=e,o.albumId=s||++AudioPlaylist.plIndex),this._type=o.type,this._ownerId=o.ownerId||vk.id,this._albumId=o.albumId||0,this._fromId=o.fromId||0,this._list=[],this._context=o.context||"",this._blockId=o.blockId,this._isFakeId=!1,this._expire=o.expire||null,this._isExplicit=o.is_explicit||!1,this._noDiscover=o.hasOwnProperty("noDiscover")?o.noDiscover:null,this._nextOffset=o.nextOffset,this._forceReload=!1,this._fetchService=new _web_audio_FetchService__WEBPACK_IMPORTED_MODULE_7__.FetchService,this._noConsecutivePlay=!1,this._isLoadable=o.loadable||!1,this._isFullyLoaded=o.fullyLoaded,this._isInfinite=o.infinite||!1,this._fetchNextAudio=o.fetchNextAudio||null,this._original_identity=o.originalIdentity||null,this._followed_identity=o.followedIdentity||null,this.mergeWith(o),(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_13__.getAudioPlayer)().addPlaylist(this)}}function get_audioListSource(){return"playlist"===this.getType()&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getOwnerId())&&(0,_vkontakte_vkjs__WEBPACK_IMPORTED_MODULE_9__.isNumber)(this.getAlbumId())?"playlist":null}AudioPlaylist.plIndex=0,AudioPlaylist.TYPE_CURRENT="current",AudioPlaylist.TYPE_PLAYLIST="playlist",AudioPlaylist.TYPE_MY="my",AudioPlaylist.TYPE_ALBUM="album",AudioPlaylist.TYPE_TEMP="temp",AudioPlaylist.TYPE_RECOM="recoms",AudioPlaylist.TYPE_SEARCH="search",AudioPlaylist.TYPE_LIVE="live",AudioPlaylist.TYPE_WALL="wall",AudioPlaylist.TYPE_RECENT="recent",AudioPlaylist.TYPE_RADIO="radio",AudioPlaylist.TYPE_ARTICLE_TTS="article_tts",AudioPlaylist.TYPE_VKMIX=_shared_audio_AudioPlaylist__WEBPACK_IMPORTED_MODULE_8__.PLAYLIST_TYPE_VKMIX,AudioPlaylist.DEFAULT_PLAYLIST_ID=-1,AudioPlaylist.RADIO_PLAYLIST_ID=-110},631251:(e,t,s)=>{s.d(t,{WebPlayerAdapter:()=>_});var o=s(827217),a=s(451306),l=s(712341),r=s(178009),n=s(618290),d=s(853727);class _ extends o.AudioStatsPlayerAdapter{getPausedBy(e){const{pausedByVideo:t,pausedByStories:s,pausedByAudio:o,pausedByQueue:a}=this.player;return t&&e<t||window.Videoview&&Videoview.isLayerShown()?"video":s&&e<s||window.cur&&cur.storyLayer?"stories":o&&e<o?"audio":a&&e<a?"queue":null}getState(){let e=super.getState();const t=this.getAudioId();if(t){const e=(0,r.geByClass)("_audio_row_"+t+" audio_row__current",(0,r.ge)("page_layout"));if(e&&e.length)return o.FULL_SCREEN_STATE}return e}getAudio(){return(0,n.audioTupleToAudioObject)(this.player.getCurrentAudio())}getProgress(){return this.player.getCurrentProgress()}getProgressInSeconds(){const e=this.player.getCurrentAudio();return e?Math.round(this.player.getCurrentProgress()*e[l.AudioUtils.AUDIO_ITEM_INDEX_DURATION]):0}getVolume(){return Math.round(100*(0,d.unLogF)(this.player.getVolume()))}getAudioId(){const e=this.player.getCurrentAudio();if(e)return e[l.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[l.AudioUtils.AUDIO_ITEM_INDEX_ID]}getAudioTrackCode(){const e=this.player.getCurrentAudio();if(e)return e[l.AudioUtils.AUDIO_ITEM_INDEX_TRACK_CODE]}getPrevAudioId(){const e=this.player._prevAudio;if(e)return e[l.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+e[l.AudioUtils.AUDIO_ITEM_INDEX_ID]}getPrevPlaylistId(){const e=this.player._prevPlaylist;return e&&!e.getIsFakeId()?e.getFullId():null}getPlaylistId(){const e=this.player.getCurrentPlaylist();return e&&!e.getIsFakeId()?e.getFullId():null}getContext(){return this.player._getPlayingContext()}getSequence(){return this.player._seq}getType(){if(this.player._impl)return this.player._impl.type}getSearchParams(){const e=this.player.getCurrentPlaylist();if(e)return e.getSearchParams()}isShuffledPlaylist(){const e=this.player.getPlaylistQueue();if(e)return e.shuffled}isRealPlaylist(){const e=this.player.getCurrentPlaylist();return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isRealPrevPlaylist(){const e=this.player._prevPlaylist;return!!e&&e.getType()===AudioPlaylist.TYPE_PLAYLIST}isPodcast(){const e=this.player.getCurrentAudio();return l.AudioUtils.isPodcast(e)}isExternalStream(){const e=this.player.getCurrentAudio();return l.AudioUtils.isExternalStream(e)}isRadio(){const e=this.player.getCurrentAudio();return l.AudioUtils.isRadio(e)}isMarusiaTrack(){const e=this.player.getCurrentAudio();return l.AudioUtils.isMarusiaTrack(e)}isLastTrack(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();if(!e)return!1;if(e&&!t)return!0;return t.indexOfAudio(e)+1===t.getAudiosCount()}getTrackPosition(){const e=this.player.getCurrentAudio(),t=this.player.getCurrentPlaylist();return e?e&&!t?0:t.indexOfAudio(e):null}hasPlaylist(){return Boolean(this.player.getCurrentPlaylist())}hasSearchParams(){return this.getContext()===AudioPlaylist.TYPE_SEARCH}isDebug(){return Boolean(ls.get(AudioPlayer.LS_PREFIX+"stats_debug"))}sendListenedData(e){let t=e&&e.hash;const s=(0,a.extend)({act:"listened_data",impl:this.getType(),hash:t,v:5,loc:nav.strLoc},e);ajax.post("al_audio.php",s,{onDone:e=>{this.player.setAdsConfig&&this.player.setAdsConfig(e)},onFail:()=>!0})}getPlaylistQueue(){this.player.getPlaylistQueue()}}},768400:(e,t,s)=>{s.d(t,{followCurator:()=>_});var o=s(817715),a=s(712341),l=s(225590),r=s(743694),n=s(547214),d=s(48711);function _(e,t,s){(0,o.lockButton)(s),ajax.post("al_curator.php",{act:"follow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(s),onDone:t=>{(0,n.getAudioPlayer)().notify(d.events.CURATOR_FOLLOW),(0,o.unlockButton)(s),r.FlatButton.setLabel(s,(0,l.getLang)("audio_following_artist_button")),s.classList.add("MusicAuthor__follow_btn__followed"),s.onclick=o=>{o.preventDefault(),a.AudioUtils.unfollowCurator(e,t,s)}}})}},518093:(e,t,s)=>{s.d(t,{unfollowCurator:()=>_});var o=s(817715),a=s(712341),l=s(225590),r=s(743694),n=s(547214),d=s(48711);function _(e,t,s){(0,o.lockButton)(s),ajax.post("al_curator.php",{act:"unfollow",curator_id:e,hash:t},{onFail:()=>(0,o.unlockButton)(s),onDone:t=>{(0,n.getAudioPlayer)().notify(d.events.CURATOR_UNFOLLOW),(0,o.unlockButton)(s),r.FlatButton.setLabel(s,(0,l.getLang)("audio_follow_artist_button")),s.classList.remove("MusicAuthor__follow_btn__followed"),s.onclick=o=>{o.preventDefault(),a.AudioUtils.followCurator(e,t,s)}}})}},499262:(e,t,s)=>{s.d(t,{addToGroupBox:()=>n});var o=s(178009),a=s(225590),l=s(917128),r=s(422798);function n(e,t,s){const n=e+"_"+t,d=(0,l.showBox)("al_audio.php",{act:"add_to_groups_box",playlist_id:n,access_hash:s}).setButtons((0,a.getLang)("Save"),(()=>{let e=[];for(let t in cur.wdd.follow_playlist_wwd.selected)e.push(cur.wdd.follow_playlist_wwd.selected[t][0]);e.length&&((0,o.ge)("add_playlist_to_group_fail").innerHTML="",ajax.post("al_audio.php",{act:"add_to_group",group_ids:e,hash:(0,o.ge)("add_playlist_to_group_hash").value,playlist_id:n},{onDone(e){d.hide(),(0,r.showDoneBox)(e)},onFail(e){return(0,o.ge)("add_playlist_to_group_fail").innerHTML=e,!0}}))}))}},121251:(e,t,s)=>{s.d(t,{removeFromGroup:()=>d});var o=s(178009),a=s(225590),l=s(917128),r=s(422798),n=s(9327);function d(e,t,s,d=null){const _=e+"_"+t;let u=null;const c=cur.audioPage&&cur.audioPage._ownerId;if(n.Ranges.isGroupId(c))u=-c;else{const e=cur.group_id;n.Ranges.isGroupId(-e)&&(u=e)}if(u){let e=(0,l.showBox)("al_audio.php",{act:"delete_from_group_box",playlist_id:_,group_id:u}).setButtons((0,a.getLang)("global_yes"),(()=>{ajax.post("al_audio.php",{act:"delete_from_group",group_id:u,hash:s,playlist_id:_},{onDone(t){if(e.hide(),(0,r.showDoneBox)(t),d){const e=(0,o.gpeByClass)("audio_pl_snippet2",d);e&&e.classList.remove("audio_pl__can_remove_from_club")}},onFail(t){return e.hide(),(0,r.showDoneBox)(t),!0}})}),(0,a.getLang)("global_cancel"),(()=>e.hide())).show()}}},470755:(e,t,s)=>{s.d(t,{addToPlaylistsBoxInit:()=>h});var o=s(178009),a=s(956905),l=s(451306),r=s(422798),n=s(817715),d=s(225590),_=s(450653),u=s(344588),c=s(834608);function h(e,t,s,p,A){if("undefined"==typeof AutoList)return window.stManager.add(window.jsc("web/auto_list.js"),(()=>{h(e,t,s,p,A)}));let y=(0,r.curBox)(),g=(0,o.geByClass1)("_audio_atp_content",y.bodyNode),P=(0,o.geByClass1)("_audio_atp_list",y.bodyNode),E=(0,o.ge)("audio_atp_search"),f=(0,o.geByClass1)("_audio_atp_empty"),w=(0,o.getSize)(g)[1];(0,o.setStyle)(P,{height:w-(0,o.getSize)(E)[1]});let I,m="";function C(){I&&I.destroy(),P.innerHTML="";let e=[];e=m?p.filter((e=>e[2].toLowerCase().indexOf(m)>=0)):p,(0,o.toggle)(P,0!=e.length),(0,o.toggle)(f,0==e.length),I=new AutoList(P,{onNeedRows:(t,s)=>{let o=[],a=s,l=Math.min(e.length,s+30);for(let t=a;t<l;t++){let s=e[t];if(s){let e=s[4]?"ape_selected":"";let t=`<div class="ape_check" data-testid="MyMusicPlaylistListTrackOwningModal_MusicPlaylistRow_ToggleOwning">\n              <div class="ape_check--unchecked">${(0,u.getIcon24CheckCircleOff)().icon}</div>\n              <div class="ape_check--checked">${(0,c.getIcon24CheckCircleOn)().icon}</div>\n            </div>`,a=`<div class="ape_pl_item _ape_pl_item ${e}" data-id="${s[1]}">${t}<div class="ape_pl_item_inner"><span class="ape_pl_title">${s[2]}</span> <span class="ape_pl_size">${s[3]}</span></div></div>`;o.push(a)}}t(o)}})}C(),cur.addToPlaylistSearch=(0,_.debounce)((function(e){m=(0,l.trim)(e).toLowerCase(),C()}),200);let T={},v={};(0,a.addEvent)(P,"click",(e=>{let t=(0,o.domClosest)("_ape_pl_item",e.target),s=(0,o.domData)(t,"id");(0,o.toggleClass)(t,"ape_selected")?(v[s]=!0,delete T[s]):(T[s]=!0,delete v[s])})),y.removeButtons(),y.addButton((0,d.getLang)("global_save"),(o=>{let a=Object.keys(v),l=Object.keys(T);ajax.post("al_audio.php",{act:"save_audio_in_playlists",add_pl_ids:a.join(","),remove_pl_ids:l.join(","),owner_id:e,audio_owner_id:t,audio_id:s,hash:A},{showProgress:()=>(0,n.lockButton)(o),hideProgress:()=>(0,n.unlockButton)(o),onDone:()=>{y.hide()},onFail:()=>(y.hide(),!0)})}),"ok",!0),y.addButton((0,d.getLang)("global_cancel"),y.hide.bind(this),"no",!0)}},340565:(e,t,s)=>{s.d(t,{claimPlaylist:()=>a});var o=s(422798);function a(e,t,s){const a=nav.objLoc.claim;if(!a)return;const l={act:s?"a_unclaim_playlist":"a_claim_playlist",claim:a,type:"audio",owner_id:e,playlist_id:t};ajax.post("al_claims.php",l,{onDone:e=>{(0,o.showDoneBox)(e)}})}},799476:(e,t,s)=>{s.d(t,{copyPlaylistLink:()=>_});var o=s(520915),a=s(225590),l=s(419299),r=s(422798),n=s(388695),d=s(810722);function _(e,t,s){(0,l.statlogsValueEvent)("audio_copy_link",vk.id),(0,d.logSearchPlaylistClickOut)(d.SearchClickActionMap.COPY_LINK_OUT),(0,o.copyToClipboard)((0,n.getPlaylistUrl)(e,t,s,!0)),(0,r.showDoneBox)((0,a.getLang)("audio_playlist_link_copied"))}},853821:(e,t,s)=>{function o(e,t,s,o){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/auto_list.js")],(function(){ajax.post("al_audio.php?act=playlists_edit_data",{owner_id:e,playlist_id:t},{onDone:function(a){a.audio_playlist_cover_upload_options&&(cur.audioCoverUploadOptions=cur.audioCoverUploadOptions||{},cur.audioCoverUploadOptions[e]=a.audio_playlist_cover_upload_options),a.editorial_playlists_params&&(cur.editorialPlaylistsParams=a.editorial_playlists_params),AudioPage.editPlaylist(e,t,s,o)},onFail:()=>!0})}))}s.d(t,{editPlaylist:()=>o})},311884:(e,t,s)=>{s.d(t,{followPlaylist:()=>g,setMusicPlaylistFollowingState:()=>P});var o=s(178009),a=s(547214),l=s(9467),r=s(225590),n=s(326107),d=s(422798),_=s(451306),u=s(917128),c=s(48711),h=s(810722),p=s(837075),A=s(452200);let y=[];async function g(e,t,s,_,A=!1,y=""){if(vk&&vk.widget&&!vk.id&&window.Widgets)return Widgets.oauth(),!1;let g=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,t,s),E=(0,o.gpeByClass)("_audio_pl",e),f=!E.classList.contains("audio_pl__followed");if((0,h.logSearchPlaylistClickOut)(f?h.SearchClickActionMap.ADD_TO_ME_OUT:h.SearchClickActionMap.REMOVE_FROM_ME_OUT),P(e,E,f),(0,l.partConfigEnabled)("web_music_playlist_following_api")){const e=new p.MusicPlaylistFollowing(g);await e.toggle()}else ajax.post("al_audio.php",{act:"follow_playlist",playlist_owner_id:t,playlist_id:s,hash:_,showcase:A,block_id:y},{onDone(e){(0,n.isObject)(e)&&f&&(0,a.getAudioPlayer)().notify(c.events.MUSIC_PLAYLISTS_ADD,e)},onFail(t){return new u.MessageBox({title:(0,r.getLang)("global_error")}).content(t).setButtons((0,r.getLang)("audio_ok"),(function(){(0,d.curBox)().hide()})).show(),P(e,E,!f),!0}})}function P(e,t,s){const l=t.getAttribute("data-raw-id");if(!l)return;const{id:r,ownerId:n}=(0,A.parseRawId)(l),d=(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,n,r);s!==t.classList.contains("audio_pl__followed")&&(s?t.classList.add("audio_pl__followed"):t.classList.remove("audio_pl__followed"),function(t){const s=(0,o.domData)(e,"text-followed"),a=(0,o.domData)(e,"text-follow"),l=t?s:a;(0,o.domData)(e,"tooltip-text",l),((0,o.geByClass1)("audio_pl_snippet__action_btn_add_text",e)||e).innerHTML=l,d.setFollowed(t);let u=d.getAddClasses()||"";u=u.replace("audio_pl__followed",""),t&&(u+=" audio_pl__followed"),d.mergeWith({addClasses:u}),(0,_.each)((0,o.geByClass)(`_audio_pl_${n}_${r}`),((s,a)=>{(0,o.toggleClass)(a,"audio_pl__followed",t);const l=a.querySelectorAll(".audio_pl_snippet__action_btn_add")[0];l&&(l.innerHTML=e.innerHTML)}))}(s),function(e){if(cur.audioPage&&cur.audioPage._data.playlists&&cur.audioPage.getOwnerId()===vk.id){if(e){let e=null;y=y.filter((t=>{const s=t.playlistId===r&&t.playlistOwnerId===n;return s&&(e=t.pl),!s})),e&&cur.audioPage._data.playlists.unshift(e)}else cur.audioPage._data.playlists=cur.audioPage._data.playlists.filter((e=>{const t=e.id===r&&e.owner_id===n;return t&&y.push({id:r,ownerId:n,pl:e}),!t}));cur.audioPage.updatePlaylistsCounter(vk.id)}}(s))}},825802:(e,t,s)=>{s.d(t,{getContextPlaylist:()=>d});var o=s(178009),a=s(712341),l=s(547214),r=s(451306),n=s(9467);function d(e,t){let s=(0,l.getAudioPlayer)(),d=a.AudioUtils.getAudioFromEl(e,!0);if(!d)return{};function _(e){return[].slice.call(e)}let u=null,c=[],h=(0,o.domData)(e,"new-post"),p=!1,A=null,y=AudioPlaylist.TYPE_TEMP,g=vk.id,P=null,E={},f=window.AudioPage&&currentAudioPage(e);if((0,o.traverseParent)(e,(e=>p=(0,o.domData)(e,"audio-context"))),p=d.context||p,p=p||("audio"==cur.module?cur.submodule:cur.module),t||"autoplay"===p)return{context:p};let[w,I]=a.AudioUtils.contextSplit(p),m=(0,o.gpeByClass)("_audio_pl",e),C=!1;if(m){const e=(0,o.domData)(m,"playlist-id");A=s.getPlaylistByBlockId(e),A||(A=(0,n.partConfigEnabled)("feed_attachment_onmedia_audios_list")&&e.startsWith("AttachmentAudioList")?s.getPlaylistById(e):s.getPlaylist(...AudioPlaylist.splitId(e||"")));const t=(0,o.domData)(m,"no-consecutive-play");t&&A.mergeWith({noConsecutivePlay:t});let a=(0,o.domData)(m,"title")||"";a&&A.mergeWith({title:(0,r.clean)(a)});let l=(0,o.domData)(m,"access-hash")||"";l&&A.mergeWith({accessHash:l})}else if(f&&f.getPageCurrentPlaylist())A=f.getPageCurrentPlaylist();else if("module"==w){let e=I;A=s.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e||cur.oid||vk.id,AudioPlaylist.DEFAULT_PLAYLIST_ID),c=[u]}else if(0===d.context.indexOf("admin"))A=s.getPlaylist(AudioPlaylist.TYPE_PLAYLIST,d.ownerId,0,d.accessKey),A.getAudiosCount()||A.setForceReload(!0);else if(0===d.context.indexOf("im"))u=(0,o.gpeByClass)("_im_peer_history",e),u=u||(0,o.gpeByClass)("_fc_tab_log_msgs",e),P="im"+(cur.peer||"");else if(0===d.context.indexOf("board"))C=!0,P=d.context,c=_((0,o.geByClass)("_wall_audio_rows",u));else if(0===d.context.indexOf("widget"))C=!0,P=d.context;else if(0===d.context.indexOf("wiki"))C=!0,P="wiki";else if(0===d.context.indexOf("post")){y=AudioPlaylist.TYPE_WALL,P=d.context,C=!0;let e=d.context.replace("post","").split("_");g=e[0],E={postId:e[1]}}else if(0===d.context.indexOf("choose"))P=d.context;else if("feed"==h||0===d.context.indexOf("feed")||0===d.context.indexOf("feedsearch"))P="feed",C=!0,c=_((0,o.geByClass)("wall_text",u));else if("group_wall"==w||"user_wall"==w||0===d.context.indexOf("reply")||"wall"==h){y=AudioPlaylist.TYPE_WALL,g=cur.oid;let t=(I||"").split("_")[1],s=cur.wallQuery||"",a=(0,o.ge)("wall_search"),l=(0,r.inArray)(cur.wallType,["own","full_own"])?"own":"all";P=hashCode(l+"_"+s),C=!0,"wall"==cur.module&&(0,o.val)(a)&&(s=(0,o.val)(a)),t&&(E={postId:t,wallQuery:s,wallType:l}),0===d.context.indexOf("reply")&&(c=_([(0,o.gpeByClass)("_replies_list",e)]),P="reply"+P,C=!0);const n=(0,o.gpeByClass)("wide_column",e);if(n){const e=(0,o.geByClass)("wall_text",n);c=Array.isArray(e)&&e.length>0?c.concat(e):c.concat(_([u]))}else c=c.concat(_([u]))}else"article"==w&&(A=cur.articlePlaylist);return u||(u=(0,o.domPN)(e)),c=c.filter((function(e){return!!e})),c&&0!=c.length||(c=[u]),A=A||s.getPlaylist(y,g,P),"function"==typeof A.setIsFakeId&&A.setIsFakeId(C),A=A.getAudiosCount()?A:a.AudioUtils.initDomPlaylist(A,c),A.mergeWith(E||{}),-1==A.indexOfAudio(d)&&(A=a.AudioUtils.initDomPlaylist(A,[(0,o.domPN)(e)])),0===d.context.indexOf("im")&&A.setContext(`im:${cur.peer||""}`),{playlist:A,context:p}}},744734:(e,t,s)=>{function o(){return window.playlistAddRestoreInfo||(window.playlistAddRestoreInfo={}),window.playlistAddRestoreInfo}s.d(t,{getPlaylistAddRestoreInfo:()=>o})},809734:(e,t,s)=>{s.d(t,{hidePlaylistFromRecoms:()=>r});var o=s(879075),a=s(225590),l=s(422798);function r(e,t,s){ajax.post("al_audio.php?act=hide_playlist_from_recoms",{owner_id:e,playlist_id:t,access_hash:s},{onDone(){(0,l.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_hidden"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,a.getLang)("audio_playlist_recoms_show"),o.setAttribute("onclick","AudioUtils.showPlaylistInRecoms("+e+", "+t+", '"+s+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},583951:(e,t,s)=>{s.d(t,{initDomPlaylist:()=>l});var o=s(451306),a=s(361761);function l(e,t){let s=[];return(0,o.each)(t,(function(e,t){t&&[...t.querySelectorAll("._audio_row")].forEach((e=>{s.push((0,a.getAudioFromEl)(e))}))})),e.pushAudio(s),e}},825773:(e,t,s)=>{s.d(t,{initRowPlaylistsChooser:()=>a});var o=s(712341);function a(e,t,s,a){let l,r=o.AudioUtils.audioTupleToAudioObject(e);l=cur.audioPage&&cur.audioPage.getOwnerId()<0&&cur.audioPage.canEditGroup()?cur.audioPage.getOwnerId():vk.id,o.AudioUtils.playlistsByAudioDataCache=o.AudioUtils.playlistsByAudioDataCache||{};let n=o.AudioUtils.playlistsByAudioDataCache,d=l+"_"+r.ownerId+"_"+r.id;n[d]?o.AudioUtils._showPlaylistsChooser(s,t,n[d],l,r,e):ajax.post("al_audio.php",{act:"playlists_by_audio",owner_id:l,audio_owner_id:r.ownerId,audio_id:r.id},{onDone:(_,u,c)=>{let h=n[d]={playlists:_,morePlaylists:u,newPlaylistHash:c};o.AudioUtils._showPlaylistsChooser(s,t,h,l,r,e,a)},onFail:()=>!0})}},635589:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{loadAllPlaylistAudios:()=>loadAllPlaylistAudios});var _web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(451306),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(547214);const AUDIO_LOAD_CHUNK_SIZE=1e3;let chunks,isDeleted,isAttach,onDone,playlist,preloadedCount,totalCount;function loadAllPlaylistAudios(e,t,s=!1){if(e.getForceReload())e.list=[];else if(!e.hasMore()||!e.isFullyLoadable())return onDone&&onDone();e.setForceReload(!1),chunks=[],isAttach="attach"===s,onDone=t,playlist=e,preloadedCount=0,totalCount=e.getTotalCount(),loadChunk(0,(()=>{isDeleted?onAllLoaded():(isAttach&&onAllLoaded(),loadAllChunks(onAllLoaded,1))}))}function onAllLoaded(){if(isDeleted)return onDone&&onDone(null,isDeleted);let e=[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(chunks,(function(t,s){s&&(e=e.concat(s))}));if((0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().getPlaylists().forEach((t=>{t.getId()===playlist.getId()&&(t._list=e)})),(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,{hasMore:!1}),onDone){onDone(playlist,!1,isAttach&&totalCount>preloadedCount)}}function loadAllChunks(e,t){t=t||0;let s=Math.max(0,Math.ceil((totalCount-preloadedCount)/AUDIO_LOAD_CHUNK_SIZE));if(isAttach&&t&&totalCount>preloadedCount&&s===t&&s++,s-t<=0)e();else{const o=new CallHub(e,s-t);for(let e=t;e<s;e++)loadChunk(e,(()=>{o.done()}))}}function loadChunk(chunkIndex,callback){const isPreload=isAttach&&!chunkIndex?1:0;let offset=chunkIndex*AUDIO_LOAD_CHUNK_SIZE;preloadedCount&&(offset=Math.abs(AUDIO_LOAD_CHUNK_SIZE-preloadedCount-chunkIndex*AUDIO_LOAD_CHUNK_SIZE)),ajax.post("al_audio.php?act=load_section",{type:playlist.getType(),owner_id:playlist.getOwnerId(),playlist_id:playlist.getPlaylistId(),access_hash:playlist.getAccessHash(),from_id:playlist.getFromId(),offset:offset,is_loading_all:1,is_preload:isPreload,context:playlist.getContext(),claim:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.intval)(nav.objLoc.claim),ref:playlist.getTrackCodeRef()},{onDone:function(data,tpl,langs,templatesScript){if(0===chunkIndex){if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.addTemplates)({audio_playlist_snippet:tpl}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.extend)(cur.lang,langs),templatesScript&&eval(templatesScript),!data)return isDeleted=!0,callback();isDeleted=!1,totalCount=data.totalCount,preloadedCount=data.list.length,(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_1__.getAudioPlayer)().mergePlaylistData(playlist,data)}chunks[chunkIndex]=data.list,callback()},onFail:()=>!0})}},625653:(e,t,s)=>{s.d(t,{onAudioAddedToPlaylist:()=>r});var o=s(178009),a=s(547214),l=s(451306);function r(e,t,s,r){(0,a.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t).pushAudio(r,0),(0,l.each)((0,o.geByClass)(`_audio_pl_${e}_${t}`),((e,t)=>{(0,o.domReplaceEl)(t,(0,o.se)(s))}))}},853461:(e,t,s)=>{function o(e,t){let s=t.getAccessHash();cur.chooseMedia("audio_playlist",t.getOwnerId()+"_"+t.getPlaylistId()+(s?":"+s:""),{id:t.getPlaylistId(),ownerId:t.getOwnerId(),coverUrl:t.getCoverUrl(),gridCovers:t.getGridCovers(),title:t.getTitle(),authorName:t.getAuthorName(),authorHref:t.getAuthorHref(),accessHash:t.getAccessHash()})}s.d(t,{onPlaylistChoose:()=>o})},97104:(e,t,s)=>{s.d(t,{showAudioPlaylist:()=>O});var o=s(948307),a=s(228909),l=s(351118),r=s(178009),n=s(712341),d=s(538484),_=s(547214),u=s(225590),c=s(422798),h=s(451306),p=s(956905),A=s(917128),y=s(16790),g=s(388695),P=s(425767),E=s(9467),f=s(930084),w=s(56522),I=s(520365),m=s(529656),C=s(654391),T=s(490455);const v="audio_pl_snippet",b=`${v}2`,L=`${v}__button_play`;function O(e,t,s,l,v,O){if(cur.apLayer)return(0,p.cancelEvent)(v);if(vk.widget)return!0;if(v&&(v.metaKey&&d.browser.mac||v.ctrlKey))return;const M=new a.OwnedIdentity({id:t,ownerId:e,accessKey:s});if((0,E.partConfigEnabled)("web_spa_router_music_playlist")){const e=w.AudioPageProxy.ensure();return(0,f.showMusicPlaylistModal)({accessRawId:M.accessRawId,playlistRef:l||null,targetOwnerId:e.ownerId}),(0,p.cancelEvent)(v)}let S=null;return window.Photoview&&window.cur&&cur.pvShown&&(S=(0,h.clone)(nav.objLoc),Photoview.hide(!0)),(0,c.boxRefreshCoords)(boxLoader),(0,r.show)(boxLoader),(0,r.show)(boxLayerWrap),window.stManager.add([window.jsc("web/auto_list.js"),"audio.css"],(function(){const a=(0,I.ensureDIRootWebContainer)(),d=a.resolve(T.EmitterFactory),f=a.resolve(m.MusicPlaylistStatsCollector),w=new o.AudioNavScreenProvider,v=(0,_.getAudioPlayer)().getPlaylist(AudioPlaylist.TYPE_PLAYLIST,e,t,s);let R,U,k;function B(e){boxQueue.hideAll(),cur.apLayerAutoList&&(cur.apLayerAutoList.destroy(),cur.apLayerAutoList=null),layers.wraphide(window.audioPlaylistLayerWrap),layers.fullhide=!1,U&&(0,p.removeEvent)(window.audioPlaylistLayerWrap,"click",U),k&&(0,p.removeEvent)(document.body,"keydown",k),delete cur.apLayer,delete cur.apLayerPlaylistId,(0,r.removeClass)(layerBG,"ap_layer_bg_dark"),S?nav.change(S):nav.change({z:!1}),layerQueue.pop(),w.popModal(R)}function x({playlistIdentity:e,trackIdentity:t}){f.logPlay({playlistIdentity:e,trackIdentity:t})}function N({playlistIdentity:e,trackIdentity:t,trackPosition:s}){f.logPlayTrack({playlistIdentity:e,trackIdentity:t,trackPosition:s})}v.setContext(l),v.setForceReload(!0),v.setFromId(cur.oid),v.loadAll((function(a,I){if((0,r.hide)(boxLoader),(0,r.hide)(boxLayerWrap),I){let e=(0,u.getLang)("audio_error_deleted_playlist_box").split("/");return new A.MessageBox({title:e[0]}).content(e[1]).setButtons((0,u.getLang)("global_close"),(function(){(0,c.curBox)().hide(),S&&nav.change(S)})).show(),void nav.setLoc((0,h.extend)(nav.objLoc,{z:!1}))}let m=(0,h.extend)(nav.objLoc,{z:"audio_playlist"+e+"_"+t+(s?"/"+s:"")});nav.setLoc(m),window.audioPlaylistLayerWrap||(window.audioPlaylistLayerWrap=(0,r.se)('<div id="ap_layer_wrap" class="ap_layer_wrap" role="dialog" aria-modal="true"></div>'),document.body.appendChild(window.audioPlaylistLayerWrap));window.audioPlaylistLayerWrap.innerHTML="";const T=a&&a.getAudiosList?a.getAudiosList().length:0,v=a.isBlocked&&a.isBlocked();let W=(0,g.getPlaylistUrl)(a.getOwnerId(),a.getPlaylistId(),a.getAccessHash()),K=(0,h.getTemplate)("audio_playlist_snippet",{title:a.getTitle(),subTitle:a.getSubtitle(),description:a.getDescription(),coverStyle:a.getCoverUrl()?"background-image:url('"+a.getCoverUrl()+"'); background-size: cover;":"",authorLine:a.getAuthorLine(),infoLine1:a.getInfoLine1(),infoLine2:a.getInfoLine2(),id:a.getPlaylistId(),ownerId:a.getOwnerId(),href:W,addCls:a.getAddClasses(),followHash:a.getFollowHash(),accessHash:a.getAccessHash(),editHash:a.getEditHash(),deleteHash:a.getDeleteHash(),replaceHash:a.getReplaceHash(),gridCovers:a.getGridCovers(),type:a.getType(),context:l,followButtonText:a.isFollowed()?(0,u.getLang)("audio_playlist_btn_added"):(0,u.getLang)("audio_playlist_btn_add"),legalNoticeIcon:a.getIsExplicit()&&(0,E.partConfigEnabled)("audio_legal_notice_in_item")?D("AudioLegalNoticeIcon",{legalNoticesType:2},"audio_pl__title_icon"):""});if(cur.apLayer=(0,r.se)(`\n        <div class="ap_layer">\n          <div class="ap_layer__content">\n            ${K}\n          </div>\n          <div class="ap_layer__close _ap_layer__close"></div>\n        </div>\n      `),v){(0,r.geByClass1)("audio_pl_snippet__body",cur.apLayer).innerHTML=(0,h.getTemplate)("playlist_snippet_stub")}window.audioPlaylistLayerWrap.appendChild(cur.apLayer),(0,p.addEvent)(window.audioPlaylistLayerWrap,"click",U=function(e){e.target!=window.audioPlaylistLayerWrap&&e.target!=(0,r.geByClass1)("_ap_layer__close",cur.apLayer)||layers&&layers.fullhide&&layers.fullhide()}),(0,p.addEvent)(document.body,"keydown",k=function(e){if(27==e.keyCode)return layers&&layers.fullhide&&layers.fullhide(),(0,p.cancelEvent)(e)}),layerQueue.push(),layerQueue.hide(),boxQueue.hideAll(),layers.wrapshow(window.audioPlaylistLayerWrap,.7),(0,r.addClass)(layerBG,"ap_layer_bg_dark"),R=a.isOfficial()?o.AudioNavScreenModalType.Album:o.AudioNavScreenModalType.Playlist,w.pushModal(R);const F=(0,r.geByClass1)("_audio_pl_snippet__list",cur.apLayer),j=n.AudioUtils.getAlbumParts(a);let Y=0;T&&!v&&(cur.apLayerAutoList=new y.default(F,{scrollNode:window.audioPlaylistLayerWrap,onNeedRows:function(e,t){let s=[],o=a.getAudiosList();for(let e=t-=Y;e<t+30;e++){const t=o[e];if(!t)break;if(j&&j.length&&j[0].offset===e){const e=j.shift();Y++,s.push(n.AudioUtils.drawAlbumPartRow(e.number))}s.push(n.AudioUtils.drawAudio(t))}e(s)}}));(0,c.boxRefreshCoords)(cur.apLayer),(0,_.getAudioPlayer)().updateCurrentPlaying(),layers.fullhide=B,cur.apLayerPlaylistId=[e,t],(0,P.setFocusIsNeed)(window.audioPlaylistLayerWrap);const H=document.querySelector(`.${b}`),V=a.getAudiosList()??[],G=cur.apLayerAutoList?.getListEl?.()?.children??[],$=Array.from(G),Q=new C.MusicPlaylistLayerListener({emitterFactory:d,playlistIdentity:M,trackTuples:V,trackRows:$,container:H,playButtonClassName:L});Q.events.on("play",x),Q.events.on("playTrack",N),f.logOpen({playlistIdentity:M}),O&&O()}))})),!1}function D(e,t,s){const o=(0,l.escape)(JSON.stringify({[`${e}/init`]:t}));return`<div class="${(0,l.classNames)(`${e}__root`,s)}" data-exec="${o}"></div>`}},914692:(e,t,s)=>{s.d(t,{showPlaylistInRecoms:()=>r});var o=s(879075),a=s(225590),l=s(422798);function r(e,t,s){ajax.post("al_audio.php?act=show_playlist_in_recoms",{owner_id:e,playlist_id:t,access_hash:s},{onDone(){(0,l.showDoneBox)((0,a.getLang)("audio_playlist_recoms_was_showed"));let o=document.getElementsByClassName("ui_actions_menu_item playlist_recoms_hide_or_show")[0];o.innerHTML=(0,a.getLang)("audio_playlist_recoms_hide"),o.setAttribute("onclick","AudioUtils.hidePlaylistFromRecoms("+e+", "+t+", '"+s+"');");for(let e of["audio_search","audio_search_layer"]){let t=document.getElementById(e);if(t){window.currentAudioPage(t).catalogController.currentSection.reloadBlock("recommended_playlists")}}},onFail(e){(0,o.showErrorBox)(e||(0,a.getLang)("global_unknown_error"))}})}},621518:(e,t,s)=>{s.d(t,{showPlaylistsChooser:()=>c});var o=s(178009),a=s(712341),l=s(225590),r=s(917128),n=s(451306),d=s(747528),_=s(569995),u=s(810722);function c(e,t,s,c,h,p,A){let y=s.playlists,g=s.newPlaylistHash,P=s.morePlaylists;a.AudioUtils.copiedToPlaylistAudios=a.AudioUtils.copiedToPlaylistAudios||{},a.AudioUtils.copiedToPlaylistAudiosHashes=a.AudioUtils.copiedToPlaylistAudiosHashes||{};let E=t,f=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_new",0,(0,l.getLang)("audio_add_to_new_pl"),"audio_row__action_playlist"]));if((0,o.domInsertAfter)(f,E),E=f,f.addEventListener("click",(()=>{a.AudioUtils.editPlaylist(c,!1,"edit",{addAudio:p,newPlaylistHash:g})})),(0,n.each)(y,((e,t)=>{let s=!0,l=t[0]+"_"+t[1]+"_"+h.fullId,r=a.AudioUtils.copiedToPlaylistAudios[l],c="audio_row__action_playlist";(t[3]||r)&&(s=!1,c+=" audio_row__more_playlist_added");let p=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_"+t[0]+"_"+t[1],0,t[2],c]));(0,o.domInsertAfter)(p,E),E=p;let y=!1;p.addEventListener("click",(()=>{if(y)return;y=!0;let e=h.ownerId,r=h.id,c=a.AudioUtils.copiedToPlaylistAudios[l];c&&(c=c.split("_"),e=c[0],r=c[1]),s&&(a.AudioUtils.copiedToPlaylistAudiosHashes[l]=t[4]),ajax.post("al_audio.php",{act:"add_audio_to_playlist",hash:t[4],playlist_id:t[1],playlist_owner_id:t[0],audio_owner_id:e,audio_id:r,do_add:(0,n.intval)(s)},{onDone:(e,o,r)=>{(0,_.onAdditionalEvent)(A,h,{type:s?d.TYPE_ADDED:d.TYPE_REMOVED,subtype:d.SUBTYPE_PLAYLIST}),a.AudioUtils.copiedToPlaylistAudios[l]=!!s&&r,t[4]=s?e:a.AudioUtils.copiedToPlaylistAudiosHashes[l],s=!s,y=!1},onFail:()=>!0}),(0,u.logSearchAudioClick)(u.SearchClickActionMap.ADD_TO_PLAYLIST,h?.trackCode),(0,o.toggleClass)(p,"audio_row__more_playlist_added",s)}))})),P){let e=(0,o.se)((0,o.rs)(a.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,["pl_more",0,(0,l.getLang)("audio_row_show_all_playlists"),"audio_row__action_playlist"]));e.addEventListener("click",(()=>{(0,r.showBox)("al_audio.php?act=more_playlists_add",{owner_id:c,audio_owner_id:h.ownerId,audio_id:h.id},{params:{bodyStyle:"padding: 0px",width:560}})})),(0,o.domInsertAfter)(e,E),E=e}e.updatePosition()}},578949:(e,t,s)=>{s.d(t,{turnPlaylistDiscover:()=>a});var o=s(422798);function a(e,t){const s={act:"turn_playlist_discover",owner_id:e,playlist_id:t};ajax.post("al_audio.php",s,{onDone:e=>{(0,o.showDoneBox)(e)}})}},986379:(e,t,s)=>{s.d(t,{deleteEpisode:()=>a});var o=s(566335);function a(e,t){(0,o.isPodcast)(t)&&s.e(6827).then(s.bind(s,336267)).then((function(e){e.default.deleteEpisode(t.fullId,t.deleteHash)}))}},932126:(e,t,s)=>{s.d(t,{editEpisode:()=>a});var o=s(566335);function a(e,t){(0,o.isPodcast)(t)&&(cur.podcastEditData={audioId:t.fullId},s.e(6827).then(s.bind(s,336267)).then((function(e){e.default.edit(t.fullId)})))}},523378:(e,t,s)=>{s.d(t,{faveEpisode:()=>r});var o=s(566335),a=s(512347),l=s(519635);function r(e,t){if(!e||!(0,o.isPodcast)(t))return;const s=(0,a.getAudioExtra)(t).faveHash;(0,l.bookmarkPodcast)(e.querySelector(".audio_row__action_fave"),t.fullId,s)}},431938:(e,t,s)=>{s.d(t,{isPrivatePodcast:()=>l});var o=s(566335),a=s(512347);function l(e){return!(!(0,o.isPodcast)(e)||!(0,a.getAudioExtra)(e).private)}},582802:(e,t,s)=>{s.d(t,{openEpisode:()=>r});var o=s(519635),a=s(618290),l=s(566335);function r(e,t){t=(0,a.audioTupleToAudioObject)(t),(0,l.isPodcast)(t)&&(0,o.showPodcast)(e,t.fullId,null,"audio")}},985517:(e,t,s)=>{s.r(t),s.d(t,{ACTION_HEARTBEAT:()=>n,ACTION_PAUSE:()=>l,ACTION_PLAY:()=>a,ACTION_SEEK:()=>r,ACTION_TIME_MARKER:()=>d,log:()=>_});var o=s(566335);const a="play",l="pause",r="seek",n="heartbeat",d="time_marker";function _(e,t){const a=t.audio;(0,o.isPodcast)(a)&&s.e(6827).then(s.bind(s,336267)).then((function(s){s.default.log(e,t)}))}},501972:(e,t,s)=>{s.d(t,{restoreEpisode:()=>a});var o=s(566335);function a(e,t){(0,o.isPodcast)(t)&&s.e(6827).then(s.bind(s,336267)).then((function(e){e.default.restoreEpisode(t.fullId,t.editHash)}))}},561698:(e,t,s)=>{function o(e,t){cur.audioPage&&cur.audioPage.showRecoms(!1,t.fullId)}s.d(t,{showRecoms:()=>o})},5061:(e,t,s)=>{s.d(t,{audioSearchPerformer:()=>a});var o=s(326107);function a(e,t,s){let a=!!window.AudioPage&&currentAudioPage(e),l=window.AudioPage&&currentAudioPage(e)||cur.audioPage;layers.fullhide&&layers.fullhide(!0),setTimeout((function(){a&&l?(t=(0,o.unclean)(t).replace(/<em>|<\/em>/g,""),nav.change({q:t,performer:1},s,{searchPerformer:!0,nav:!0,isLayer:a.isLayer()})):nav.go(e,s)}),50)}},569995:(e,t,s)=>{s.d(t,{onAdditionalEvent:()=>c});var o=s(747528),a=s(520365),l=s(490455),r=s(631251),n=s(547214),d=s(986679),_=s(825802),u=s(618290);function c(e,t,s={}){const c=new o.AudioStats(new r.WebPlayerAdapter((0,n.getAudioPlayer)(),(0,a.ensureDIRootWebContainer)().resolve(l.EmitterFactory))),h=t&&t.context||e&&(0,d.getContext)(e)||"",p=(0,n.getAudioPlayer)();let A,y=p.getCurrentAudio()?(0,u.audioTupleToAudioObject)(p.getCurrentAudio()):null;A=y&&t.fullId===y.fullId?p.getCurrentPlaylist():(0,_.getContextPlaylist)(e).playlist;const g=A?A.getFullId():"",P={...t,context:h,playlistId:g,...s};c.sendCurrentAudioEvent({type:P.type,subtype:s.subtype||P.subtype||c.getPlaySubtype(),ownerId:P.ownerId,audioId:P.id,trackCode:P.trackCode,state:c.playerAdapter.getState(),ref:window.cur&&vk.widget?String(cur.widgetReferrer||"").substring(0,20):"",context:P.context,playlistId:P.playlistId})}},649977:(e,t,s)=>{s.d(t,{addAudioToOwner:()=>a});var o=s(956905);function a(e,t){return window.onAudioPageLoaded=function(){return this.uploadAudio({})},nav.go("audios"+e),(0,o.cancelEvent)(t)}},395902:(e,t,s)=>{s.d(t,{cancelReplacement:()=>a});var o=s(178009);function a(e,t,s){ajax.post("al_audio.php",{act:"cancel_replacement",hash:t,audio_id:e},{onFail:()=>!0}),(0,o.re)(s)}},846548:(e,t,s)=>{s.d(t,{chooseAudioBox:()=>l});var o=s(178009),a=s(956905);function l(e,t,s){if(void 0!==e.selected)cur.lastAddMedia.unchooseMedia(e.selected),e.selected=void 0,(0,o.removeClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.add;else{let s=cur.attachCount&&cur.attachCount()||0;cur.chooseMedia("audio",t.owner_id+"_"+t.id,t.info),(!cur.attachCount||cur.attachCount()>s)&&cur.lastAddMedia&&(e.selected=cur.lastAddMedia.chosenMedias.length-1,(0,o.addClass)((0,o.domPN)(e),"audio_selected"),e.innerHTML=t.labels.cancel)}return(0,a.cancelEvent)(s)}},589452:(e,t,s)=>{s.d(t,{claim:()=>r});var o=s(178009),a=s(186489),l=s(618290);function r(e,t,s){(0,o.addClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,l.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_claim",claim:s,type:"audio",id:e.id,owner_id:e.ownerId})}},12099:(e,t,s)=>{s.d(t,{deleteAudio:()=>a});var o=s(412203);function a(e,t){const s=(0,o.ensureAudioPageService)();s.setUserId(window.vk.id),s.deleteAudioLegacyFx({audioEl:e,audio:t})}},846468:(e,t,s)=>{s.d(t,{deleteCurrentAudio:()=>l});var o=s(178009),a=s(547214);function l(e,t){window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(e);const s=(0,a.getAudioPlayer)(),l=s.getPlaylistQueue();l&&(l.removeAudio(t.fullId),s.saveStateCurrentPlaylist()),(0,o.re)(e)}},645291:(e,t,s)=>{s.d(t,{deleteDeletedAudios:()=>l});var o=s(547214),a=s(412203);function l(){const e=(0,a.ensureAudioPageService)().$deletedFromMyMusicAudiosIdentitiesMap.getState();Object.keys(e).forEach((e=>{(0,o.getAudioPlayer)().deleteAudioFromAllPlaylists(e)}))}},518004:(e,t,s)=>{s.d(t,{drawAudio:()=>A,getDurationMod:()=>p});var o=s(351118),a=s(618290),l=s(712341),r=s(168288),n=s(451306),d=s(175721),_=s(347096);const u=600,c=3600,h=36e3;function p(e){return e<u?"s":e<c?"m":e<h?"l":"n"}function A(e,t){let s=JSON.parse((0,n.getTemplate)("audio_bits_to_cls")),u=e[l.AudioUtils.AUDIO_ITEM_INDEX_FLAGS],c=[];for(let e=0;e<32;e++){let t=1<<e;u&t&&c.push(s[t])}const h=(0,a.audioTupleToAudioObject)(e),{legalNoticesType:A}=h;A&&(c=c.filter((e=>"audio_explicit"!==e)),c.push("audio_with_legal_notice"));const y=l.AudioUtils.isPodcast(e);y&&(c.push("audio_podcast"),l.AudioUtils.isPrivatePodcast(e)&&c.push("audio_podcast_private")),t&&c.push(t);const g=e[l.AudioUtils.AUDIO_ITEM_INDEX_COVER_URL],P=g?.split(/(,(?!\d))/g).filter((e=>","!==e)),[E=""]=P??[];let f,w=l.AudioUtils.getAudioPerformers(e),I=e[l.AudioUtils.AUDIO_ITEM_INDEX_DURATION],m=(0,d.formatTime)(I),C=(0,n.clean)(JSON.stringify(e));try{const t=(0,n.getTemplate)("podcast_row",e);f=y&&t?t:(0,n.getTemplate)("audio_row",e)}catch(e){return""}let T="";return h.hasTrackPage&&(c.push("audio_has_track_page"),T=`/audio${h.trackPageId}`),(0,_.isRadio)(h)&&c.push("audio_row--radio"),f=f.replace(/%cls%/,(()=>c.join(" "))),f=f.replace(/%duration%/,(()=>m)),f=f.replace(/%serialized%/,(()=>C)),f=f.replace(/%cover_image%/,(()=>function(e,t){let s="";if(e)s=`<img class='audio_row__cover' alt='${t}' src='${e}' loading='lazy' decoding='async' width='40' height='40' />`;else{const{icon:e}=(0,r.getIcon24Song)();s=`<div class='audio_row__cover audio_row__without_cover'>${e}</div>`}return s}(E,h.title))),f=f.replace(/%performers%/,(()=>w)),f=f.replaceAll(/%track_url%/g,(()=>T)),f=f.replace(/%duration_mod%/,(()=>p(I))),f=f.replace(/%chart_info_position%/,(()=>{return(t=e[l.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[l.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].position)?`<div class="audio_row__position">${t}</div>`:"";var t})),f=f.replace(/%chart_info_state%/,(()=>function(e){let t="";switch(e){case 0:t="audio_row__state-new_release";break;case 1:t="audio_row__state-no_changes";break;case 2:t="audio_row__state-moved_up";break;case 3:t="audio_row__state-moved_down";break;case 4:t="audio_row__state-crown";break;default:t=""}return t?`<div class="audio_row__state ${t}"></div>`:""}(e[l.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX]&&e[l.AudioUtils.AUDIO_ITEM_CHART_INFO_INDEX].state))),f=f.replace(/%legal_notice_icon_html%/,(()=>A&&"number"==typeof A?function(e,t,s){const a=(0,o.escape)(JSON.stringify({[`${e}/init`]:t}));return`<div class="${(0,o.classNames)(`${e}__root`,s)}" data-exec="${a}"></div>`}("AudioLegalNoticeIcon",{legalNoticesType:A},"audio_row__legal_notice_icon"):"")),f}},432838:(e,t,s)=>{s.d(t,{editAudio:()=>a});var o=s(917128);function a(e,t,s){(0,o.showBox)("al_audio.php",{act:"edit_audio_box",aid:t.fullId,force_edit_hash:s},{params:{width:"456px",bodyStyle:"padding: 20px;",hideButtons:1},dark:1})}},672679:(e,t,s)=>{s.d(t,{getActionIcon:()=>g});var o=s(562939),a=s(345678),l=s(88060),r=s(855442),n=s(738380),d=s(600958),_=s(392453),u=s(937025),c=s(686605),h=s(751746),p=s(2599),A=s(223897);const y={current_delete:(0,o.getIcon20Cancel)(),recoms_delete:(0,o.getIcon20Cancel)(),listened_delete:(0,o.getIcon20Cancel)(),delete:(0,o.getIcon20Cancel)(),restore_recoms:(0,a.getIcon20Add)(),more:(0,l.getIcon20More)(),edit:(0,r.getIcon20WriteOutline)(),recoms:(0,n.getIcon20Stars)(),lyrics:(0,d.getIcon20TextTtOutline)(),snippet:(0,_.getIcon20FlashOutline)()};function g(e){const t=y[e];let s="";if(t)s=P(t);else switch(e){case"add":s=P((0,u.getIcon20Check)())+P((0,a.getIcon20Add)());break;case"next":s=`<div class="audio_row__icon--horizontal">${P((0,c.getIcon20ListPlayOutline)())+P((0,h.getIcon20ListAddOutline)())}</div>`;break;case"fave":s=P((0,p.getIcon24FavoriteOutline)())+P((0,A.getIcon24Favorite)())}return s}function P(e){return`<div class="audio_row__icon audio_row__icon_${e.name}">${e.icon}</div>`}},361761:(e,t,s)=>{s.d(t,{getAudioFromEl:()=>l});var o=s(178009),a=s(712341);function l(e,t){e=(0,o.domClosest)("_audio_row",e);let s=(0,o.data)(e,"audio")||JSON.parse((0,o.domData)(e,"audio"));if(!s)return null;if(t){s=a.AudioUtils.audioTupleToAudioObject(s),s.isDeleted=(0,o.hasClass)(e,"audio_row__deleted"),s.isCurrent=(0,o.hasClass)(e,a.AudioUtils.AUDIO_CURRENT_CLS),s.isPlaying=(0,o.hasClass)(e,a.AudioUtils.AUDIO_PLAYING_CLS),s.isFromCurrentPlaylist=!!(0,o.gpeByClass)("_audio_section__current",e),s.isFromAutoplay=!!(0,o.gpeByClass)("Autoplay--container",e),s.isNumeric=!!(0,o.gpeByClass)("audio_numeric",e),s.isWithCovers=!!(0,o.gpeByClass)("audio_w_covers",e),s.withInlinePlayer=!s.isWithCovers&&!(0,o.gpeByClass)("audio_no_inline_player",e),s.isInSnippet=!!(0,o.gpeByClass)("_audio_pl_snippet__list",e),s.isInEditBox=!!(0,o.gpeByClass)("_audio_pl_edit_box",e),s.isInRecomsBlock=!!(0,o.gpeByClass)("_audio_recoms_blocks",e),s.isInFastChat=!!(0,o.gpeByClass)("fc_tab",e),s.isInAttach=!!(0,o.gpeByClass)("media_preview",e),s.isSetClaimed=(0,o.hasClass)(e,"audio_moder_claimed"),s.isPodcastListSnippet=(0,o.hasClass)(e,"podcast_list_snippet");const t=(0,o.gpeByClass)("_audio_pl",e);s.isCurrentAlbumSnippet=!!s.album&&!!t&&t.dataset.playlistId===`playlist_${s.album[0]}_${s.album[1]}`}return s}},975920:(e,t,s)=>{s.d(t,{onAudioChoose:()=>n});var o=s(451306),a=s(225590),l=s(178009),r=s(956905);function n(e,t,s,n){if((0,o.isUndefined)(t.selected)){let e=cur.attachCount&&cur.attachCount()||0;const o=s.fullId+(s.accessKey?"_"+s.accessKey:"");if(cur.chooseMedia("audio",o,n),(!cur.attachCount||cur.attachCount()>e)&&cur.lastAddMedia){t.selected=cur.lastAddMedia.chosenMedias.length-1,(0,l.addClass)((0,l.domPN)(t),"audio_selected");let e=(0,l.getSize)(t)[0];(0,l.setStyle)(t,"width",e),t.innerHTML=(0,a.getLang)("global_cancel")}}else cur.lastAddMedia.unchooseMedia(t.selected),t.selected=void 0,(0,l.removeClass)((0,l.domPN)(t),"audio_selected"),t.innerHTML=(0,a.getLang)("global_add_media");return(0,r.cancelEvent)(e)}},425192:(e,t,s)=>{s.d(t,{onRowLeave:()=>r});var o=s(178009),a=s(327898),l=s(9467);function r(e){if(!((0,l.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,l.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return void n(e);const t=a.AudioRowMoreTooltipController.ensure();t.isShown?t.events.once(a.AudioRowMoreTooltipControllerEventType.Closed,(()=>{window.tooltips?.hideAll?.(e),n(e)})):n(e)}function n(e){(0,o.data)(e,"leaved",!0);let t=(0,o.data)(e,"tt");if(t&&t.isShown())return;if(clearTimeout(window.audioRowHoverTO),!(0,o.data)(e,"actions"))return;let s=(0,o.geByClass1)("_audio_row__actions",e),a=(0,o.geByClass1)("_audio_row__duration",e);(0,o.re)(s),(0,o.setStyle)(a,"visibility","visible"),(0,o.data)(e,"actions",0)}},186489:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{onRowOver:()=>onRowOver});var _web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(178009),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(712341),_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(547214),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(225590),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(956905),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(451306),_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(672679),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9467),_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(939386),_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(327898),_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(701837),_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(56522),_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(810722),_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(243862),_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(412203),_web_audio_adapters_services_MyMusicServiceAdapter__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(625718);function onRowOver(audioEl,event,forceRedraw,audioLinkPathname,audioAccessKey){const copyLinkEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),showMoreTooltipRedesignEnabled=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled");if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_list_snippet")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"podcast_snippet__controls"))return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"leaved",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions")&&!forceRedraw)return;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"no_extra"))return;clearTimeout(window.audioRowHoverTO);const ap=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__.getAudioPlayer)();window.audioRowHoverTO=setTimeout((()=>{window.tooltips&&"function"==typeof window.tooltips.hideAll&&window.tooltips.hideAll(audioEl);let audio=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl),audioObject=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioFromEl(audioEl,!0);showMoreTooltipRedesignEnabled&&unmountRowMoreTooltip();const playerUI=(0,_web_audioplayer_getAudioPlayer__WEBPACK_IMPORTED_MODULE_14__.getAudioPlayerUI)();let actions=[],moreActions=[],context=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getContextPlaylist(audioEl,!0),[sectionContext,blockContext]=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.contextSplit(context),extra=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject);const copyAudioLink=()=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.COPY_LINK,audio?.trackCode),audioLinkPathname?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLink.call(null,audioLinkPathname):_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.copyAudioLinkByIdentity.call(null,audioObject,audioAccessKey));if(context=sectionContext,audioObject.isDeleted)if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.restoreEpisode,"",'onmouseover="audioShowActionTooltip(this)"']);else if("recoms_recoms"===context)actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);else{const e=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__.ensureAudioPageService)().$deleteAudiosFromMyMusicForLastWeekDataIdentitiesMap.getState(),t=audioObject.fullId in e;t&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"']),actions.push(["add",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"'])}else{let actionsList=["add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];if(extra.claim&&nav.objLoc.claim||audioObject.isReplaceable)actionsList=[];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject))actionsList=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(audioEl,"audio_podcast_no_actions")?[]:["fave","edit","delete","open_episode","share"];else if(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isExternalStream(audioObject))actionsList=[];else if(audioObject.isFromCurrentPlaylist)actionsList=["recoms","add",!audioObject.isCurrent&&"delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInSnippet)actionsList=["snippet","recoms","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else if(audioObject.isInEditBox)actionsList=[];else if(audioObject.isInFastChat)actionsList=["add"];else if(vk.widget)actionsList=["add"];else if(context)if("my_audios_block"===blockContext)actionsList=["recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];else switch(context){case"search_results":"search_owned_audios"===blockContext&&(actionsList=["recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),actionsList.unshift("snippet");break;case"catalog":actionsList=["snippet","recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"album_page":actionsList=["snippet","recoms","edit","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"];break;case"my":case"module":case"user_list":case"group_list":actionsList=["snippet",playerUI.lyrics.enabled&&"lyrics","recoms","edit","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"my_audios_short":actionsList=[playerUI.lyrics.enabled&&"lyrics","recoms","edit","next","add","delete",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"].filter(Boolean);break;case"edit_playlist":actionsList=["add","edit"];break;case"attach":case"attach_preview":case"podcast":actionsList=[];break;case"apps_edit":actionsList=["apps_edit_delete"];break;case"clips":case"clip_effect_list":audioObject.isOriginalSound&&(actionsList=[]);break;default:audioObject.isCurrent&&audioObject.withInlinePlayer&&(actionsList=["recoms","add",copyLinkEnabled&&"copy_link","share","open_album","add_to_playlist"]),actionsList.unshift("snippet")}("moderation_video"===context||window.AdminVideoCatalogue)&&(actionsList=["link_to_clip"]),actionsList.push("uma"),audioObject.isReplaceable&&actionsList.push("replace"),extra.moder_actions&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.each)(extra.moder_actions,((i,act)=>{moreActions.push(["moder_"+i,(audioEl,audio)=>{eval(act[1])},act[2]])})),audioObject.isCurrentAlbumSnippet&&(actionsList=actionsList.filter((e=>"open_album"!==e))),vk.id||(actionsList=actionsList.filter((e=>"open_album"===e)));const addDeleteAction=()=>{audioObject.isFromCurrentPlaylist?audioObject.isFromAutoplay||audioObject.isCurrent||actions.push(["current_delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteCurrentAudio,"",'onmouseover="audioShowActionTooltip(this)"']):audioObject.canDelete&&!vk.widget&&actions.push(["delete",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.deleteAudio,"",'onmouseover="audioShowActionTooltip(this)"'])},currentAudioPage=window.currentAudioPage&&window.currentAudioPage(audioEl),isInLayer=currentAudioPage&&currentAudioPage.isLayer(),shouldShowEdit=!isInLayer&&audioObject.canEdit&&!vk.widget;actionsList.forEach((e=>{switch(e){case"next":audioObject.isCurrent||audioObject.isClaimed||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)||actions.push(["next",ap.setNext.bind(ap),"",'onmouseover="audioShowActionTooltip(this)"']);break;case"restore_recoms":actions.push(["restore_recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"add":let e=vk.id;cur.audioPage&&cur.audioPage.canAddToGroup()&&cur.audioPage.getOwnerId()!==audioObject.ownerId&&(e=cur.audioPage.getOwnerId()),!audioObject.isClaimed&&audioObject.canAdd&&audioObject.ownerId!=e&&actions.push(["add",(...e)=>{const t=(0,_web_audio_adapters_services_MyMusicServiceAdapter__WEBPACK_IMPORTED_MODULE_13__.ensureMyMusicService)().$identitiesMap.getState();return(0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)((0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in t?_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.REMOVE_FROM_ME:_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.ADD_TO_ME,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.toggleAddAudio(...e)},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"recoms":!audioObject.isClaimed&&cur.audioPage&&actions.push(["recoms",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showRecoms,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"uma":audioObject.isUMA&&actions.push(["uma",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getUMAInfo,"UMA"]);break;case"replace":audioObject.isReplaceable&&actions.push(["replace",()=>{showAudioClaimWarning(audioObject,extra.claim,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.replaceWithOriginal.bind(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils,audioEl,audioObject))},(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("global_audio_replace")]);break;case"edit":shouldShowEdit&&actions.push(["edit",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)?_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editEpisode:_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.editAudio,"",'onmouseover="audioShowActionTooltip(this)"']);break;case"delete":addDeleteAction();break;case"apps_edit_delete":actions.push(["delete",window.AppsEdit.removeAudio,"",'onmouseover="AppsEdit.showRemoveAudioTooltip(this)"']);break;case"fave":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&actions.push(["fave",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.faveEpisode,"",'onmouseover="audioShowActionTooltip(this)"',_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getAudioExtra(audioObject).fave?" activated":""]);break;case"copy_link":copyLinkEnabled&&!audioObject.isClaimed&&moreActions.push(["copy_link",copyAudioLink,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_copy_audio_link")]);break;case"share":audioObject.isClaimed||moreActions.push(["share",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.SHARE,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.shareAudio(...e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_share_audio")]);break;case"add_to_playlist":audioObject.isClaimed||cur.viewAsBox||moreActions.push(["add_to_playlist","",(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_add_to_playlist")]);break;case"open_album":!audioObject.isClaimed&&audioObject.album&&moreActions.push(["open_album",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.OPEN_ALBUM,audioObject?.trackCode),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioAlbum(...e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_open_album")]);break;case"open_episode":_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.isPodcast(audioObject)&&moreActions.push(["open_episode",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.openEpisode,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_podcast_open_episode")]);break;case"lyrics":audioObject.hasLyrics&&actions.push(["lyrics",()=>{playerUI.lyrics.open({audio:audio,playlist:context.playlist,context:audioObject.context||context.context})},"",'onmouseover="audioShowActionTooltip(this)"']);break;case"snippet":actions.push(["snippet",()=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.SHOW_SNIPPET,audioObject?.trackCode),(0,_web_audio_components_AudioLongtap_showAudioLongtapModalEffector__WEBPACK_IMPORTED_MODULE_7__.showAudioLongtapModalEffector)(audioObject,audioEl)),"",'onmouseover="audioShowActionTooltip(this)"']),moreActions.push(["next",(...e)=>((0,_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.logSearchAudioClick)(_web_search_stats_collectClick__WEBPACK_IMPORTED_MODULE_11__.SearchClickActionMap.LISTEN_NEXT,audioObject?.trackCode),ap.setNext.apply(ap,e)),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_2__.getLang)("audio_set_next_audio")])}})),extra.claim&&nav.objLoc.claim&&(audioObject.isSetClaimed?actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.unclaim.bind(this,audio,audioEl,extra.claim),"Unclaim"]):actions.push(["claim_btn",_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.claim.bind(this,audio,audioEl,extra.claim),"Claim"]))}if(moreActions.length&&actions.push(["more"]),actions.length){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__actions audio_row__actions"></div>');actions.forEach((t=>{let s=_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.getRowActionName(t[0],audioObject,audioEl),o=(0,_web_audio_player_track_getActionIcon__WEBPACK_IMPORTED_MODULE_5__.getActionIcon)(t[0]),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)(`<button\naria-label="${s}"\ndata-action="${t[0]}"\ndata-testid="audio_row_action_${t[0]}"\nclass="audio_row__action audio_row__action_${t[0]} _audio_row__action_${t[0]}${t[4]?" "+t[4]:""}" ${t[3]||""}>\n${t[2]||o}\n</button>`);t[1]&&a.addEventListener("click",(e=>(t[1]&&t[1].call(window,audioEl,audioObject),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)))),e.appendChild(a)}));const t=(0,_web_audio_services_AudioPage__WEBPACK_IMPORTED_MODULE_12__.ensureAudioPageService)().$myMusicIdentitiesMap.getState(),s=(0,_vkontakte_internal_shared__WEBPACK_IMPORTED_MODULE_15__.getAudioFullId)(audioObject)in t;let o=!1;audioEl&&(audioEl.closest(".CatalogBlock__my_audios_block")||audioEl.closest(".CatalogBlock__my_audios"))&&(o=!0),s&&!o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(audioEl,"audio_row__added");let a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__info",audioEl),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__duration",audioEl),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__actions",audioEl);if(!a)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.re)(r),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(l,"visibility","hidden"),a.appendChild(e);let n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_audio_row__action_more",e);moreActions.length&&n&&(showMoreTooltipRedesignEnabled?mountRowMoreTooltip(n,{audioEl:audioEl,audioTuple:audio,audio:audioObject,audioLinkPathname:audioLinkPathname,audioAccessKey:audioAccessKey}):setMoreAction(audioEl,audio,audioObject,moreActions,n)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(audioEl,"actions",1)}audioObject.showInfo&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.showAudioInfo(audioEl,audioObject,!1)}),forceRedraw?0:10)}function setMoreAction(e,t,s,o,a){const l=_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__.AudioPageProxy.ensure().emitter,r=(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_tooltip_copy_link_web"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("im-page_classic",e),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history_w",e),_=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_peer_history",e),u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("_im_chat_body_abs",e),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)('<div class="_audio_row__more_actions audio_row__more_actions"></div>'),h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("wk_history_audio_content",e),p=e.closest(".CatalogBlock"),A={};_?(A.getWrapEl=()=>n?null:u,A.appendTo=_):h?A.appendTo=h:p?A.appendTo=p:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("post",e)?A.appendTo=document.body:A.appendToParent=!0;const y=new ElementTooltip(a,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_4__.extend)({cls:"_audio_row__tt",defaultSide:"bottom",rightShift:20,content:c,bottomGap:n&&d?parseInt((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(d,"border-bottom-width"))+30+150:150,preventSideChange:!0,autoShow:!0,onFirstTimeShow:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(t,"nodrag",1),setTimeout(function(){this.getOptions().bottomGap=0}.bind(this))},onHide:()=>{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"leaved")&&_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.onRowLeave(e)}},A));o.forEach((o=>{const a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.rs)(_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.AUDIO_ROW_ACTION_ROW_ITEM,o));switch(a?.setAttribute("data-testid",`audio_row_more_action_${o[0]}`),o[0]){case"add_to_playlist":let n,d;a.addEventListener("mouseenter",n=()=>{clearTimeout(d),d=setTimeout((()=>{a.removeEventListener("mouseenter",n),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,a,y,e)}),150)}),a.addEventListener("click",(()=>{d||_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_1__.AudioUtils.initRowPlaylistsChooser(t,a,y,e)})),a.addEventListener("mouseleave",(()=>{clearTimeout(d)}));break;case"copy_link":if(!r)break;a.addEventListener("click",(t=>(o[1].call(window,e,s).then((()=>{l.emit(_web_audio_AudioPageProxy__WEBPACK_IMPORTED_MODULE_10__.AudioPageEventType.AudioLinkCopied)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))));break;default:a.addEventListener("click",(t=>(o[1].call(window,e,s),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(t))))}c.appendChild(a)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.addEvent)(a,"click",(e=>{y.isShown()||y.show(),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_3__.cancelEvent)(e)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"tt",y)}function mountRowMoreTooltip(e,t){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const s=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.AudioRowMoreTooltipController.ensure(),o=(0,_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.ensureAudioRowMoreTooltipService)(),a=e?.closest?.(`.${_web_audioplayer_audio_layer__WEBPACK_IMPORTED_MODULE_9__.AUDIO_LAYER_CONTAINER_CLASS_NAME}`);e.addEventListener("mouseenter",(()=>{s.checkIsMounted(e)||(s.checkIsMounted()&&unmountRowMoreTooltip(),Boolean(t?.audioEl)&&window.tooltips?.hideAll?.(t.audioEl),o.init(t),s.mount(e,a||void 0))})),e.addEventListener("click",(e=>{e?.preventDefault(),e?.stopPropagation()}))}function unmountRowMoreTooltip(){if(!((0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("audio_row_show_more_tooltip_web_enabled")||(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_6__.partConfigEnabled)("redesign_audio_player_tooltip_dislikes_web_enabled")))return;const e=_web_audio_ui_AudioRowMoreTooltip__WEBPACK_IMPORTED_MODULE_8__.AudioRowMoreTooltipController.ensure();e.isMounted&&e.unmount()}},262343:(e,t,s)=>{s.d(t,{replaceWithOriginal:()=>d});var o=s(178009),a=s(547214),l=s(342443),r=s(518004),n=s(618290);function d(e,t,s){(t=t||(0,a.getAudioPlayer)().getCurrentAudio())&&(t=(0,n.audioTupleToAudioObject)(t),ajax.post("al_audio.php",{act:"replace_with_original",hash:t.replaceHash,audio_id:t.fullId},{onDone:function(a){let n=JSON.parse(t.extra).claim.original;n[l.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=a,n[l.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t.ownerId;let d=(0,o.se)((0,r.drawAudio)(n));e.parentElement.insertBefore(d,e),e.parentElement.removeChild(e),s&&s()},onFail:()=>(s(),!0)}))}},360349:(e,t,s)=>{s.d(t,{shareAudio:()=>u});var o=s(747528),a=s(547214),l=s(917128),r=s(422798),n=s(569995),d=s(566335),_=s(618290);function u(e,t){if(cur.viewAsBox)return cur.viewAsBox();if(!(t=t||(0,a.getAudioPlayer)().getCurrentAudio()))return;t=(0,_.audioTupleToAudioObject)(t);const s=(0,d.isPodcast)(t)?"podcast":"audio";return(0,n.onAdditionalEvent)(e,t,{type:o.TYPE_SHARE_AUDIO}),!(0,l.showBox)("like.php",{act:"publish_box",object:s+t.fullId,list:t.actionHash,to:"mail"},{stat:[window.jsc("web/page.js"),"page.css",window.jsc("web/wide_dd.js"),"wide_dd.css",window.jsc("web/sharebox.js")],onFail:function(e){return(0,r.showDoneBox)(e),!0},params:{shareButtonElement:e}})}},525423:(e,t,s)=>{s.d(t,{showAudioRestriction:()=>f});var o=s(618290),a=s(225590),l=s(422798),r=s(451306),n=s(518004),d=s(342443),_=s(178009),u=s(519692),c=s(547214),h=s(917128),p=s(419299),A=s(326107),y=s(743694),g=s(798991),P=s(378177);function E(e){const t=y.FlatButton.render({children:(0,a.getLang)("global_close"),appearance:y.FlatButtonAppearance.PRIMARY,size:y.FlatButtonSize.M,restAttrs:{onclick:"curBox().hide()"}});(0,h.showFastBox)({hideButtons:!0,title:!1,containerClass:"audio_restriction_box",onHide:()=>{(0,p.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},`\n    <button class="audio_restriction_box__close" onclick="curBox().hide()" aria-label="${(0,a.getLang)("global_close")}">\n      ${(0,g.getIcon24Cancel)().icon}\n    </button>\n    <div class="audio_restriction_box__icon">${(0,P.getIcon56PensiveFace)().icon}</div>\n    <div class="audio_restriction_box__title">${(0,a.getLang)("audio_restriction_title_claim")}</div>\n    <div class="audio_restriction_box__controls">\n      ${t}\n    </div>\n  `)}function f(e,t={}){if(!e)return!1;if((e=(0,o.audioTupleToAudioObject)(e)).restrictionStatus){if(e.actionHash){(0,p.statlogsValueEvent)("audio_restriction_popup","show",e.restrictionStatus);const s=(0,h.showBox)("al_audio.php",{act:"restriction_box",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{params:{hideButtons:!0,onShow:function(){let s=(0,l.curBox)();(0,A.isFunction)(t.onShow)&&t.onShow(),s&&s.once("click:ok",(()=>{(0,p.statlogsValueEvent)("audio_restriction_popup","click",e.restrictionStatus)}))},onHide:s=>{(0,A.isFunction)(t.onHide)&&t.onHide(),s||(0,p.statlogsValueEvent)("audio_restriction_popup","hide",e.restrictionStatus)}},containerClass:"audio_restriction_box audio_restriction_box_type_"+e.restrictionStatus,onDone:(t,s)=>{if(s&&s.play){t.hide();const a=function(e){const t=(0,_.geByClass)("_audio_row_"+e.fullId);if(!t||!t.length)return!1;const s=(0,u.parseJSON)((0,_.domData)(t[0],"audio"));if(!s)return!1;const o=(0,u.parseJSON)(s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]);o&&delete o.claim,s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]&=~d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CLAIMED_BIT,s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(o);const a=(0,c.getAudioPlayer)().getCurrentPlaylist(),l=(0,_.se)((0,n.drawAudio)(s,"no_extra"));if(a){const e=s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]+"_"+s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID],t=a.getAudio(e);t&&(t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION],t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS],t[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=s[d.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA])}return(0,r.each)(t,((e,t)=>{const o=e>0?(0,_.se)((0,n.drawAudio)(s,"no_extra")):l;t.parentElement.insertBefore(o,t),t.parentElement.removeChild(t)})),l}(s.audio?(0,o.audioTupleToAudioObject)(s.audio):e),l=(0,c.getAudioPlayer)();a&&l.toggleAudio(a,{target:a})}},onFail:()=>(s&&s.hide(),E(e),!0)})}else E(e);return!0}return!1}},387601:(e,t,s)=>{s.d(t,{unclaim:()=>r});var o=s(178009),a=s(186489),l=s(618290);function r(e,t,s){(0,o.removeClass)(t,"audio_moder_claimed"),(0,a.onRowOver)(t,!1,!0),e=(0,l.audioTupleToAudioObject)(e),window.ajax.post("al_claims.php",{act:"a_unclaim",claim:s,type:"audio",id:e.id,owner_id:e.ownerId,hash:e.actionHash})}},662896:(e,t,s)=>{s.d(t,{initUpload:()=>p});var o=s(178009),a=s(712341),l=s(538484),r=s(855634),n=s(225590),d=s(422798),_=s(451306),u=s(928363),c=s(9467),h=s(419299);function p(e,t,s,p,A,y,g,P,E,f,w,I){cur.loadAudioDone=function(t,s){if(cur.audioPage){if(cur.boxClose&&cur.audioPage.onAudioAllUploaded(),cur.audioPage.onAudioUploaded(t,s),cur.boxClose){delete cur.boxClose;let t=cur.audiosLoaded>1?(0,n.getLang)("audio_success_msg_multiple"):(0,n.getLang)("audio_success_msg");e.setOptions({title:(0,n.getLang)("audio_uploading_over"),bodyStyle:"padding: 16px 23px;"}),e.content(t),(0,o.hide)(e.progress),setTimeout((function(){e.hide(200)}),2e3),delete cur.audiosLoaded,_tbLink&&_tbLink.loc&&(cur.__phinputs=cur.__phinputs||[],(0,r.globalHistoryDestroy)(_tbLink.loc))}}else cur.boxClose&&nav.go("/audios"+s[a.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID],!1,{onDone(){cur.__phinputs=cur.__phinputs||[],(0,r.globalHistoryDestroy)(nav.objLoc[0])}})},cur.loadAudioFailed=function(s,a){(0,o.hide)(e.progress),Upload.embed(s);let l=(0,o.ge)("audio_new_error"),r=l&&(0,o.domFC)(l),d=a.split("|");if(!r)return;a=d[0],d=d[1];let u=(0,_.intval)(a);(0,c.partConfigEnabled)("audio_show_upload_real_error_code")&&(u=a),(0,h.statlogsValueEvent)("load_audio_failed_code",u),r.innerHTML=d||(t[a]||(0,n.getLang)("audio_loading_error").replace("{code}",u)),(0,o.show)(l)},Upload.init("audio_add_upload_btn",s,p,{file_name:"file",file_size_limit:A,file_types_description:"Audio files (*.mp3)",file_types:"*.mp3;*.MP3",accept:"audio/mpeg",lang:y,onUploadStart:function(t,s){"form"===Upload.types[t]&&(0,o.show)(e.progress),"form"!==Upload.types[t]&&"fileApi"!==Upload.types[t]||((0,o.geByClass1)("file",(0,o.ge)("audio_add_upload_btn")).disabled=!0),(0,d.curBox)().changed=!0},onUploadProgress:function(e,t,s){if(!(0,o.ge)("form"+e+"_progress")){let t=Upload.obj[e],s=(0,o.getSize)(t)[1]/2+10,a=t.firstChild;for(;a;)1===a.nodeType&&(a.id==="uploader"+e&&l.browser.msie?(0,o.setStyle)(a,{position:"relative",left:"-5000px"}):(0,o.setStyle)(a,{visibility:"hidden"})),a=a.nextSibling;t.appendChild((0,o.ce)("div",{innerHTML:'<div class="audio_progress_wrap"><div id="form'+e+'_progress" class="audio_progress" style="width: 0%;"></div></div></div>'},{height:s+"px",marginTop:-s+"px"}))}let a=(0,_.intval)(t/s*100);(0,o.setStyle)((0,o.ge)("form"+e+"_progress"),{width:a+"%"})},onUploadComplete:function(e,t){let s;this.use_go_uploader||(t=t.replace(/\+/g," "));try{s=JSON.parse(t)}catch(e){s=(0,u.fromQueryString)(t)}let o={};this.use_go_uploader?o={act:"done_add",upldr:1,go_uploader_response:t}:(s.title=decodeURIComponent(s.title),s.artist=decodeURIComponent(s.artist),o={...s,act:"done_add",upldr:1}),s.code?cur.loadAudioFailed(e,s.code):ajax.post("al_audio.php",o,{onDone:function(t){cur.loadAudioDone(e,t)},onFail:function(t){return cur.loadAudioFailed(e,t),!0}})},onUploadCompleteAll:function(e,t){cur.boxClose=!0},onUploadError:cur.loadAudioFailed,clear:1,multiple:1,force_max_files:!0,max_files:g,max_files_hide_last:1,type:"audio",max_attempts:3,reverse_files:1,server:P,error:E,error_hash:f,dropbox:"choose_audio_dropbox",use_go_uploader:I}),e.setControlsText(w)}},190925:(e,t,s)=>{s.d(t,{getUMAInfo:()=>a});var o=s(917128);function a(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions",id:t.id,owner_id:t.owner_id,hash:t.actionHash},{params:{width:1e3}})}},276018:(e,t,s)=>{s.d(t,{getUMAInfoAlbum:()=>a});var o=s(917128);function a(e,t){t.isInEditBox||(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e},{params:{width:750}})}},712341:(e,t,s)=>{s.d(t,{AudioUtils:()=>Ye});var o=s(342443),a=s(5061),l=s(767211),r=s(186489),n=s(425192),d=s(625653),_=s(621518),u=s(825773),c=s(470755),h=s(561698),p=s(360349),A=s(277614),y=s(582802),g=s(262343),P=s(432838),E=s(932126),f=s(846468),w=s(12099),I=s(986379),m=s(501972),C=s(645291),T=s(523378),v=s(582761),b=s(97104),L=s(351945),O=s(975920),D=s(853461),M=s(853821),S=s(311884),R=s(270582),U=s(235295),k=s(506377),B=s(593441),x=s(408129),N=s(577925),W=s(298473),K=s(476637),F=s(276535),j=s(744734),Y=s(892633),H=s(649977),V=s(846548),G=s(441064),$=s(925882),Q=s(518004),X=s(328962),q=s(361761),z=s(552589),J=s(618290),Z=s(583951),ee=s(825802),te=s(193723),ie=s(667789),se=s(589452),oe=s(387601),ae=s(190925),le=s(276018),re=s(91007),ne=s(395902),de=s(121251),_e=s(499262),ue=s(566335),ce=s(306224),he=s(242286),pe=s(969117),Ae=s(431938),ye=s(985517),ge=s(799476),Pe=s(525423),Ee=s(517403),fe=s(100226),we=s(881006),Ie=s(461113),me=s(768400),Ce=s(518093),Te=s(123928),ve=s(791969),be=s(766122),Le=s(340565),Oe=s(662896),De=s(578949),Me=s(809734),Se=s(914692),Re=s(810912),Ue=s(266640),ke=s(785518),Be=s(698113),xe=s(512347),Ne=s(956439),We=s(347096),Ke=s(12664),Fe=s(362106),je=s(212849);const Ye={...o.AUDIO_PLAYER_ENUMS,audioSearchPerformer:a.audioSearchPerformer,getRowActionName:l.getRowActionName,initRowPlaylistsChooser:u.initRowPlaylistsChooser,addToPlaylistsBoxInit:c.addToPlaylistsBoxInit,showRecoms:h.showRecoms,shareAudio:p.shareAudio,showAudioAlbum:A.showAudioAlbum,openEpisode:y.openEpisode,replaceWithOriginal:g.replaceWithOriginal,editAudio:P.editAudio,editEpisode:E.editEpisode,deleteCurrentAudio:f.deleteCurrentAudio,deleteAudio:w.deleteAudio,deleteEpisode:I.deleteEpisode,restoreEpisode:m.restoreEpisode,deleteDeletedAudios:C.deleteDeletedAudios,faveEpisode:T.faveEpisode,contextSplit:v.contextSplit,showAudioPlaylist:b.showAudioPlaylist,setAudioLastListRefCookieDebounced:L.setAudioLastListRefCookieDebounced,editPlaylist:M.editPlaylist,followPlaylist:S.followPlaylist,setMusicPlaylistFollowingState:S.setMusicPlaylistFollowingState,openPlaylistOwner:R.openPlaylistOwner,onPlayNextPlaylist:U.onPlayNextPlaylist,onPlayPlaylistShuffled:k.onPlayPlaylistShuffled,onSharePlaylistClick:B.onSharePlaylistClick,getAudioTrackCodeFromPlaylist:x.getAudioTrackCodeFromPlaylist,getLayer:N.getLayer,updateQueueReceivedPost:W.updateQueueReceivedPost,toggleAudioHQBodyClass:K.toggleAudioHQBodyClass,hasAudioHQBodyClass:F.hasAudioHQBodyClass,getPlaylistAddRestoreInfo:j.getPlaylistAddRestoreInfo,toggleAddAudio:Y.toggleAddAudio,addAudioToOwner:H.addAudioToOwner,chooseAudioBox:V.chooseAudioBox,getAudioArtistsString:G.getAudioArtistsString,getAudioPerformers:$.getAudioPerformers,drawAudio:Q.drawAudio,isClaimedAudio:X.isClaimedAudio,getDurationMod:Q.getDurationMod,getAudioExtra:xe.getAudioExtra,mergeAudioExtra:Ne.mergeAudioExtra,getAudioFromEl:q.getAudioFromEl,getAudioFullId:z.getAudioFullId,audioTupleToAudioObject:J.audioTupleToAudioObject,initDomPlaylist:Z.initDomPlaylist,getContextPlaylist:ee.getContextPlaylist,renderAudioDiag:ie.renderAudioDiag,claim:se.claim,unclaim:oe.unclaim,getUMAInfo:ae.getUMAInfo,getUMAInfoAlbum:le.getUMAInfoAlbum,showAudioInfo:re.showAudioInfo,cancelReplacement:ne.cancelReplacement,removeFromGroup:de.removeFromGroup,addToGroupBox:_e.addToGroupBox,showAudioRestriction:Pe.showAudioRestriction,isPodcast:ue.isPodcast,isArticleTts:ce.isArticleTts,isRadio:We.isRadio,isExternalStream:Ke.isExternalStream,isMarusiaTrack:he.isMarusiaTrack,isMarusiaTale:pe.isMarusiaTale,isPrivatePodcast:Ae.isPrivatePodcast,followArtist:we.followArtist,unfollowArtist:Ie.unfollowArtist,followCurator:me.followCurator,unfollowCurator:Ce.unfollowCurator,followOwner:Te.followOwner,unfollowOwner:ve.unfollowOwner,trackArtistToOfficial:be.trackArtistToOfficial,PodcastsLogs:ye,copyAudioLink:je.copyAudioLink,copyAudioLinkByIdentity:Fe.copyAudioLinkByIdentity,copyPlaylistLink:ge.copyPlaylistLink,getAlbumParts:Ee.getAlbumParts,drawAlbumPartRow:fe.drawAlbumPartRow,onRowOver:r.onRowOver,onRowLeave:n.onRowLeave,onAudioAddedToPlaylist:d.onAudioAddedToPlaylist,onAudioChoose:O.onAudioChoose,onPlaylistChoose:D.onPlaylistChoose,claimPlaylist:Le.claimPlaylist,initUpload:Oe.initUpload,turnPlaylistDiscover:De.turnPlaylistDiscover,hidePlaylistFromRecoms:Me.hidePlaylistFromRecoms,showPlaylistInRecoms:Se.showPlaylistInRecoms,hideCatalogBlock:Re.hideCatalogBlock,mergeAudioTupleWithoutContext:Ue.mergeAudioTupleWithoutContext,followRadiostation:ke.followRadiostation,unfollowRadiostation:Be.unfollowRadiostation,_showPlaylistsChooser:_.showPlaylistsChooser,debugLog:te.debugLog}},261944:(e,t,s)=>{s.d(t,{connectListenQueue:()=>g});var o=s(873832),a=s(712341),l=s(547214),r=s(917128),n=s(597760),d=s(9467);const _=3e4;let u=null,c=null,h=!1,p=0;const A=new o.WebQueueListener((function(e){if(e.failed)return void g(!0);const t=(0,l.getAudioPlayer)(),s=t.isPlaying(),o=t.getCurrentAudio(),n=a.AudioUtils.isPodcast(o);for(let o=0;o<e.events.length;o++){let a=e.events[o].data;if("start"===a.type&&AudioPlayer.getDeviceId()!==a.uuid&&!c&&!n&&s){t.pausedByQueue=Date.now(),t.pause(),c=(0,r.showBox)("al_audio.php",{act:"start_playback_box",uuid:a.uuid,device_name:a.device_name},{params:{hideButtons:!0,onHide:()=>{c=!1}},containerClass:"audio_playback_box"});break}}})),y=new o.WebQueueListener((function(e){e.events.length&&e.events.forEach((e=>{1===e.data.product_id&&(vk.audioAdsConfig.enabled=!e.data.active)}))}));function g(e){if(!window.Notifier||!vk.id)return;let t=window.ap&&(0,l.getAudioPlayer)(),s=t&&t.getCurrentAudio(),o=window.Notifier&&!vk.widget,r=!h&&s?A.listenQueueKey:y.listenQueueKey,c=a.AudioUtils.isPodcast(s);(e||o&&!c&&!r)&&(s||(0,d.partConfigEnabled)("audio_subscription_update"))&&(s=s?a.AudioUtils.audioTupleToAudioObject(s):{},function(e={},t=()=>{},s=()=>!0){ajax.post("al_audio.php",{act:"queue_params",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash},{onDone:t,onFail:s})}(s,(e=>{const t=function(e){const t=(0,n.unpackQueues)(e);t.audio&&A.connect(t.audio);t.subscription&&y.connect(t.subscription);return t}(e);h=!s||!t.audio,(t.audio||t.subscription)&&(u&&clearTimeout(u),u=window.setTimeout((()=>g(!0)),_))}),(()=>(p++,p<3&&g(!0),!0))))}},582761:(e,t,s)=>{s.d(t,{contextSplit:()=>a});var o=s(326107);function a(e){return(0,o.isObject)(e)&&(e=e.context),(e||"").split(":")}},193723:(e,t,s)=>{function o(){}s.d(t,{debugLog:()=>o})},986679:(e,t,s)=>{s.d(t,{getContext:()=>l});var o=s(825802),a=s(582761);function l(e){const t=window.currentAudioPage&&window.currentAudioPage(e),s=t&&t.getPageCurrentPlaylist();let l,r=(0,o.getContextPlaylist)(e,!0);return r&&(r=(0,a.contextSplit)(r),Array.isArray(r)&&r.length>0&&(l=r[0])),("search"===l&&s&&s.getSearchQid()||"search"===window.cur.module&&window.cur.qid)&&(l="search:external"),l}},577925:(e,t,s)=>{function o(){let e=window.audioLayer;return e||(window.audioLayer=e=new AudioLayer),e}s.d(t,{getLayer:()=>o})},388695:(e,t,s)=>{s.d(t,{getPlaylistUrl:()=>a});var o=s(9327);function a(e,t,s,a=!1){const l=`/music/${o.Ranges.isOfficialPlaylist(e)?"album":"playlist"}/${e}_${t}${s?`_${s}`:""}`;return a?`${location.protocol}//${location.host}${l}`:l}},91007:(e,t,s)=>{s.d(t,{showAudioInfo:()=>l});var o=s(351118),a=s(422798);function l(e,t,s){if(!t.showInfo)return;if(e.dataset.showedInfo)return;e.dataset.showedInfo=!0;const l=t.performer.split("], "),r=l.length>1?l[1]:l[0],n=encodeURI(r+" - "+t.title),d=`<a href="/search?c[section]=audio&c[q]=${n}" target="_blank">Найти VK</a>`,_=`<a href="${t.adminUrl}?act=audio&raw_id=${t.fullId}" target="_blank">Admin</a>`,u=`<a href="${t.adminUrl}?act=matched_segments_visualization&full_id=${t.fullId}" target="_blank">M4</a>`,c=`<a href="/away.php?to=${encodeURIComponent(t.umaQueryUrl+"?query="+n)}" target="_blank">Найти UMA</a>`,h=document.createElement("div");h.classList.add("AudioInfo__container"),h.innerHTML=" • "+c+" • "+d+" • "+_+" • "+u,h.style.fontSize="x-small",s&&h.classList.add("AudioInfo__container--secondary");const p=document.createElement("span");p.innerText="ID: "+t.fullId,p.classList.add("AudioInfo__copyLink"),p.onclick=e=>{(0,o.copyTextToClipboard)(t.fullId).then((()=>{(0,a.showDoneBox)("ID аудиозаписи скопирован в буфер обмена")}))},e.parentElement.insertBefore(h,e.nextSibling),h.prepend(p)}},701837:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AUDIO_LAYER_CONTAINER_CLASS_NAME:()=>AUDIO_LAYER_CONTAINER_CLASS_NAME});var _swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(434518),_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(763812),_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(405546),_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(847292),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(178009),_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(576707),_spa_web_widgets_audio_aggregated_TopAudioPlayer_TopAudioEventBus__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(970085),_shared_user_user_env__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9467);const AUDIO_LAYER_CONTAINER_CLASS_NAME="audio_layer_container";var _topAudioEventBus=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_5__._)("_topAudioEventBus"),_handleToggleListenner=(0,_swc_helpers_class_private_field_loose_key__WEBPACK_IMPORTED_MODULE_5__._)("_handleToggleListenner");class AudioLayer{static prepare(e){window.stManager.add([window.jsc("web/audio.js"),"audio.css",window.jsc("web/suggester.js"),window.jsc("web/auto_list.js"),window.jsc("web/indexer.js")],(()=>{e&&e()}))}toggle(e,t){this._initTooltip();let s=this._els.tooltip,o=void 0!==e?e:!s.isShown();o&&this.initPage(),o?(s.show(),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_topAudioEventBus)[_topAudioEventBus].emit("showed"),(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__.cancelStackPush)("top_audio",(()=>{this.toggle(!1,!0)}),!0)):(t||(0,_web_lib_cancel_stack__WEBPACK_IMPORTED_MODULE_7__.cancelStackPop)(),s.hide(),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_topAudioEventBus)[_topAudioEventBus].emit("hided")),(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_4__.partConfigEnabled)("web_audio_player_header_react")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(this._els.topNotaBtn,"TopNavBtn--active",o)}hide(){this._els.tooltip.hide()}isShown(){return this._els.tooltip&&this._els.tooltip.isShown()}updatePosition(){return this._els.tooltip&&this._els.tooltip.updatePosition()}_layerPosition(){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.layerPlace),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)("ts_wrap"),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(document.querySelector(".HeaderNav__item--acts")),o=t[0]?t[0]-e[0]-1:s[0]-e[0]-661,a=0;if(!(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_4__.partConfigEnabled)("web_audio_player_header_react"))if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(this._els.topNotaBtnGroup)){a=-o+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topNotaBtn)[0]-e[0])+15}else{a=-o+((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getXY)(this._els.topPlayBtn)[0]-e[0])+3}return{left:o,top:-1,arrowPosition:a}}getPageInstance(){return this._page}getTemplate(){return`\n      <div class="${AUDIO_LAYER_CONTAINER_CLASS_NAME}">\n        <div class="top_audio_loading">\n          ${(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.rs)(vk.pr_tpl,{id:"",cls:"pr_big"})}\n        </div>\n      </div>\n    `}_initTooltip(){this._els.tooltip||(this._els.container=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.se)(this.getTemplate()),this._els.tooltip=new ElementTooltip(this._els.layerPlace,{id:"audio_layer_tt",content:this._els.container,width:660,offset:[22,5],autoShow:!1,customShow:!0,setPos:this._layerPosition.bind(this),forceSide:"bottom",onHide:()=>{this._page&&this._page.onLayerHide()},onShow:()=>{this._page&&this._page.onLayerShow(this._initSection)}}))}initPage(){this._page||((0,_shared_audio_stores_autoplay__WEBPACK_IMPORTED_MODULE_2__.ensureAutoplayService)().init(),ajax.post("al_audio.php",{act:"layer",is_layer:1,section:window.ap.getCurrentPlaylist()?"current":"all"},{onDone:(html,data,templatesScript)=>{if(this._els.tooltip.isShown()){try{eval(templatesScript)}catch(e){(0,_lib_debug_tools__WEBPACK_IMPORTED_MODULE_0__.logEvalError)(e,templatesScript)}this._els.container.innerHTML=html,this._page=new AudioPage((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_audio_page_layout",this._els.container),data),this._initSection=data.initSection||void 0,this._page.onLayerShow(this._initSection)}},onFail:()=>!0}))}constructor(){Object.defineProperty(this,_topAudioEventBus,{writable:!0,value:void 0}),Object.defineProperty(this,_handleToggleListenner,{writable:!0,value:void 0}),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_topAudioEventBus)[_topAudioEventBus]=_spa_web_widgets_audio_aggregated_TopAudioPlayer_TopAudioEventBus__WEBPACK_IMPORTED_MODULE_3__.TopAudioEventBus.ensure(),(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_handleToggleListenner)[_handleToggleListenner]=()=>{this.toggle()},(0,_shared_user_user_env__WEBPACK_IMPORTED_MODULE_4__.partConfigEnabled)("web_audio_player_header_react")?this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_layer_place")}:this._els={layerPlace:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_layer_place"),topPlayBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_top_audio_player_play"),topNotaBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("TopNavBtn__audio"),topNotaBtnGroup:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.ge)("top_audio_btn_group")},(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_topAudioEventBus)[_topAudioEventBus].topAudioPlayerEventsAggregator.on("toggled",(0,_swc_helpers_class_private_field_loose_base__WEBPACK_IMPORTED_MODULE_6__._)(this,_handleToggleListenner)[_handleToggleListenner])}}},201018:(e,t,s)=>{s.d(t,{AudioPlayer:()=>ve});var o=s(434518),a=s(763812),l=s(93593),r=s(415086),n=s(520365),d=s(414618),_=s(43199),u=s(823295),c=s(490455),h=s(16913),p=s(333235),A=s(441878),y=s(712341),g=s(538484),P=s(56749),E=s(519635),f=s(225590),w=s(405546),I=s(326107),m=s(917128),C=s(956905),T=s(805402),v=s(422798),b=s(451306),L=s(863473),O=s(180310),D=s(178009),M=s(631251),S=s(169448),R=s(747528),U=s(290139),k=s(913566),B=s(379535),x=s(48711),N=s(418562),W=s(364804),K=s(34119),F=s(618290),j=s(155838),Y=s(843165),H=s(558863),V=s(261944),G=s(801415),$=s(511579),Q=s(266640),X=s(552589),q=s(9467),z=s(870329),J=s(48544),Z=s(18639),ee=s(225036),te=s(708025),ie=s(342443),se=s(352351),oe=s(347096),ae=s(990766),le=s(898726),re=s(222631),ne=s(306224),de=s(340704),_e=s(378192),ue=s(813818),ce=s(810722),he=s(270920),pe=s(953372),Ae=s(623238),ye=s(547214),ge=s(488761),Pe=s(117511),Ee=s(335825);let fe={};const we=(0,G.throttledPromise)((()=>{}),1500,!0);var Ie=(0,a._)("_isStateInitialized"),me=(0,a._)("_finishStateInitialization"),Ce=(0,a._)("_handleUnauthorizedError"),Te=(0,a._)("_updateAudioStateInQueue");class ve{static getVersion(){return 15}static _sendLCNotification(){const e=window.Notifier;e&&e.lcSend("audio_start");try{window.Videoview&&Videoview.togglePlay(!1)}catch(e){}}static showHQLabel(e){return void 0===e?!!ve._lsGet(ve.LS_SHOW_HQ_LABEL):(e=!!e,ve._lsSet(ve.LS_SHOW_HQ_LABEL,e),y.AudioUtils.toggleAudioHQBodyClass(),e)}static getAudioElementsByAudioId(e,t){return(0,D.geByClass)(`_audio_row_${e}`,t)}static getDeviceId(){let e=ve._lsGet(ve.LS_UUID);return e||(e=(0,N.default)(),ve._lsSet(ve.LS_UUID,e)),e}static showSubscriptionPopup(){(0,m.showBox)("/al_audio.php",{act:"subscription_box"},{params:{containerClass:"audio_subscription_popup",grey:!0,width:520}})}static getDurationType(){return ve._lsGet(ve.LS_DURATION_TYPE)}static _setTabIcon(e){(0,P.setFavIcon)(ve.tabIcons[e])}static _getLsFullKey(e){return`${ve.LS_PREFIX}${e}_${vk.id}`}static _lsGet(e){return ls.get(ve._getLsFullKey(e))}static _lsSet(e,t){return ls.set(ve._getLsFullKey(e),t)}static _lsRemove(e){return ls.remove(ve._getLsFullKey(e))}static _podcastGetStates(){return(ve._lsGet(ve.LS_PODCASTS)||fe).states||{}}static _podcastSetStates(e){const t=ve._lsGet(ve.LS_PODCASTS)||fe;t.states=e,ve._lsSet(ve.LS_PODCASTS,t),fe=t}static podcastToggleFave(e,t){if(!t)return;t=y.AudioUtils.audioTupleToAudioObject(t);const s=y.AudioUtils.getAudioExtra(t).faveHash;s&&window.bookmarkPodcast(e,t.fullId,s)}static podcastGetPlaybackRate(){return(ve._lsGet(ve.LS_PODCASTS)||fe).rate||1}static getLang(e){const t=(0,ye.getAudioPlayer)();return t&&t.langs?t.langs[e]:e}static clearDeprecatedCacheKeys(){ve._iterateCacheKeys((e=>e===ve.LS_VER))}static clearOutdatedCacheKeys(){(ve._lsGet(ve.LS_SAVED)||0)<(0,I.vkNow)()-72e5&&ve._iterateCacheKeys(((e,t)=>!(0,b.inArray)(t,[ve.LS_PL,ve.LS_TRACK,ve.LS_PROGRESS])))}getCurrentAudioLs(){return ap.getCurrentAudio()||ve._lsGet(ve.LS_TRACK)||null}static clearAllCacheKeys(){ve._iterateCacheKeys((()=>!1))}static _iterateCacheKeys(e){Y.vkLocalStorage.getPrefixedKeys(`${ve.LS_KEY_PREFIX}_`).forEach((t=>{const[,s,o]=t.split("_");e(s,o)||Y.vkLocalStorage.removeItem(o)}))}get isStateInitialized(){return(0,o._)(this,Ie)[Ie]}preventRestoreAudio(){this.isRestoreAudioPrevented=!0}_initImpl(){this._impl&&this._impl.destroy();let e=0,t=!1;const s=t=>{if(-1===e)return;if(t&&(e++,this.implTaskManager.delay(200),e>3)){e=-1;const t=new window.MessageBox({title:(0,f.getLang)("global_error")}).content((0,f.getLang)("audio_error_loading")).setButtons("Ok",(function(){e=0,(0,v.curBox)().hide()}));return t.show(),(0,k.setWorkerTimeout)((function(){e=0,t.hide()}),3e3),this.notify(x.events.ENDED),void this.notify(x.events.FAILED)}const s=this.getCurrentAudio(),o=this.getCurrentAudioData();if(y.AudioUtils.isPodcast(s))this.setIsPlaying(!1),this.notify(x.events.PAUSE),this.notify(x.events.ENDED),this.stop();else if(this._repeatCurrent)this._autoNext=!0,this.notify(x.events.ENDED),this.notify(x.events.PROGRESS,0),this.implTaskManager.seekImmediate(0),(0,k.setWorkerTimeout)((()=>{this._impl&&this._impl.clearAudioNode&&(o&&this.emitter.emit("stopAudio",{reason:t?pe.AudioPlayerStopAudioEventReason.Error:pe.AudioPlayerStopAudioEventReason.Repeat,audio:o,progressTime:this.getCurrentProgressTime()}),this._impl.stop(),o&&this.emitter.emit("playAudio",{reason:pe.AudioPlayerPlayAudioEventReason.Repeat,audio:o,progressTime:0}),this._implSetUrl(s)),this._implPlay()}));else{if(this.setIsPlaying(!1),o){let e;e=t?pe.AudioPlayerStopAudioEventReason.Error:this.ads.isActive?pe.AudioPlayerStopAudioEventReason.Adv:pe.AudioPlayerStopAudioEventReason.QueueContinuation,this.emitter.emit("stopAudio",{reason:e,audio:o,progressTime:this.getCurrentProgressTime()})}this.notify(x.events.ENDED),this._playNextMarked({auto:!0,reason:t?pe.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError:pe.AudioPlayerPlayAudioEventReason.QueueContinuation})}},o={onPause:()=>{this.setIsPlaying(!1),this.setIsPaused(!0),this.notify(x.events.PAUSE),t=!1,this.switchConnection.emit("pause")},onPlay:()=>{this.setIsPaused(!1),this.setIsPlaying(!0),this.setVolume(this.getVolume()),this.notify(x.events.PLAY),t=!1,this.switchConnection.emit("play")},onBufferUpdate:e=>{this.notify(x.events.BUFFERED,e)},onEnd:s,onFail:()=>{this._sendPlayerErrorStats(this._impl),s(!0)},onCanPlay:()=>this.notify(x.events.CAN_PLAY),onProgressUpdate:(e,s)=>{const o=this.getCurrentAudio();if(this._muteProgressEvents||!o)return;const a=this._impl.getDuration()||o[y.AudioUtils.AUDIO_ITEM_INDEX_DURATION];this.notify(x.events.PROGRESS,e,a,s),!vk.id&&a-s<ve.UNAUTH_FADE_TIME&&!t&&(t=!0,this.fadeOut(1e3*ve.UNAUTH_FADE_TIME))},onFrequency:e=>{this.notify(x.events.FREQ_UPDATE,e)},defaultVolume:this._userVolume};this._impl=new U.AudioPlayerHTML5(o),this.implTaskManager=new H.AudioTaskManager(this._impl),this.implTaskManager.setVolume(0)}get nextEvents(){return this.emitter.listenable}get events(){return this.nextEvents}fadeIn(e=300){this.implTaskManager.setVolume(this.getVolume(),!0,e)}fadeOut(e=300){this.implTaskManager.setVolume(0,!0,e)}onMediaKeyPressedEvent(e){if(this.getCurrentAudio())switch(e.keyCode){case 179:this.isPlaying()?this.pauseByButton():this.playByButton();break;case 178:this._stopAudio({reason:pe.AudioPlayerStopAudioEventReason.Unknown}),this._seek({amount:0});break;case 177:this.playPrevByButton();break;case 176:this.playNextByButton()}}setAdsConfig(e){this.ads&&this.ads.setAdsConfig(e)}deletePlaylist(e){for(let t=0;t<this._playlists.length;t++)this._playlists[t]===e&&this._playlists.splice(t,1)}mergePlaylistData(e,t){this._playlists.forEach((s=>{s.getId()===e.getId()&&s.getOwnerId()===e.getOwnerId()&&(s.hasMore()?s.mergeWith(t):s.mergeInfo(t))}))}deleteCurrentPlaylist(){this.stop(pe.AudioPlayerStopAudioEventReason.Clear),this.getPlaylistQueue().toggleShuffle(!1),this.setCurrentAudio(null),this.setCurrentPlaylist(null),this.notify(x.events.UPDATE),this.notify(x.events.PLAYLIST_CHANGED),this.updateCurrentPlaying()}updateCurrentPlaying(e){e=!!e;const t=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());let s=[];if(t){const e=(0,D.geByClass)("_audio_row_"+t.fullId);s=s.concat([].slice.call(e))}const o=document.querySelectorAll(".AudioRadiostationItem"),a=(0,oe.isRadio)(t)&&this.isPlaying();Array.from(o).forEach((e=>{e.classList.toggle("AudioRadiostationItem--playing",a&&parseInt(e.dataset.id)===t.id)}));for(let t=0,o=this._currentPlayingRows.length;t<o;t++){const o=this._currentPlayingRows[t];o&&!(0,b.inArray)(o,s)&&this.toggleCurrentAudioRow(o,!1,e)}if(t)for(let t=0,o=s.length;t<o;t++){const o=s[t];if(o){if((0,D.gpeByClass)("article_editor_canvas",o))continue;this.toggleCurrentAudioRow(o,!0,e)}}this._currentPlayingRows=s;try{(0,b.each)((0,D.geByClass)("_audio_pl"),((e,t)=>(0,D.removeClass)(t,"audio_pl__playing")));const e=this.getCurrentPlaylist();if(this.isPlaying()&&e){const t=(0,Ee.getAudioListSnippetSelector)(e),s=document.querySelectorAll(t);s.length>0&&(0,b.each)(s,((e,t)=>(0,D.addClass)(t,"audio_pl__playing")))}}catch(e){(0,A.logError)(e)}}scrollToCurrentPlaying(e,t){const s=ve.getAudioElementsByAudioId(e);window.AudioPage&&s.forEach((e=>{const s=window.currentAudioPage(e);if(s&&s._scroll){const e=s.getCurrentSectionEl()||s.getPageContainer();ve.getAudioElementsByAudioId(t,e).length||s.drawMore(),s.scrollIntoView(ve.getAudioElementsByAudioId(t,e)[0],150)}}))}toggleCurrentAudioRow(e,t,s){const o=y.AudioUtils.getAudioFromEl(e,!0);(0,D.addClass)(e,y.AudioUtils.AUDIO_CURRENT_CLS),o.withInlinePlayer&&(0,D.toggleClass)(e,"audio_row__player_transition",s),(s=!!o.withInlinePlayer&&s)?setTimeout((()=>this._updateAudioEl(t,e,o,s)),0):this._updateAudioEl(t,e,o,s)}_updateAudioEl(e,t,s,o){const a=(0,D.geByClass1)("_audio_row__play_btn",t),l=(0,D.geByClass1)("_audio_row__title",t),r=(0,D.geByClass1)("_audio_row__duration",t);let n=y.AudioUtils.getDurationMod(e?s.duration:s.duration*this.getCurrentProgress());e&&t&&!1===this.isPlaying()&&((0,D.removeClass)(t,"audio_row__playing"),a&&(0,D.attr)(a,"aria-label",(0,f.getLang)("global_audio_play")),l&&(0,D.attr)(l,"role",""));let d=(e,t="")=>{if(r){let s=y.AudioUtils.getDurationMod(e);r.innerHTML=t+(0,T.formatTime)(e),s!==n&&((0,D.replaceClass)(r,y.AudioUtils.AUDIO_DURATION_CLS+"-"+n,y.AudioUtils.AUDIO_DURATION_CLS+"-"+s),n=s)}};if(s.withInlinePlayer&&(e?this._addRowPlayer(t):this._removeRowPlayer(t)),e){this.on(t,[x.events.PLAY,x.events.PLAY_REQUESTED],(e=>{y.AudioUtils.audioTupleToAudioObject(e).fullId===s.fullId&&((0,D.addClass)(t,y.AudioUtils.AUDIO_PLAYING_CLS),a&&(0,D.attr)(a,"aria-label",(0,f.getLang)("global_audio_pause")),l&&(0,D.attr)(l,"role","heading"))})),this.on(t,x.events.PROGRESS,((e,t,o)=>{if(!s.withInlinePlayer&&this.ads.isActive)return void d(s.duration);o=parseInt(o);let a=0,l="";ve.getDurationType()?(a=Math.round(o-t*o),l="-"):a=Math.round(t*o),d(a,l)}));let e=(0,D.data)(t,"bars");if(!e&&(s.isWithCovers||s.isNumeric||s.isPodcastListSnippet)){if(e=(0,D.se)('<canvas class="audio_row__sound_bars"></canvas>'),s.isPodcastListSnippet?(0,D.geByClass1)("podcast_list_snippet__cover",t).appendChild(e):t.appendChild(e),e.width=y.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,I.isRetina)()?2:1),e.height=y.AudioUtils.AUDIO_ROW_COVER_SIZE*((0,I.isRetina)()?2:1),e.style.width=y.AudioUtils.AUDIO_ROW_COVER_SIZE,e.style.height=y.AudioUtils.AUDIO_ROW_COVER_SIZE,(0,I.isRetina)()){e.getContext("2d").scale(2,2)}const o=getComputedStyle(e).color;this.on(t,x.events.FREQ_UPDATE,((t,s)=>De(e,s,o))),De(e,[0,0,0,0],o),(0,D.data)(t,"bars",e)}(0,D.toggleClass)(t,y.AudioUtils.AUDIO_PLAYING_CLS,this.isPlaying())}else{this.off(t),(0,D.removeClass)(t,y.AudioUtils.AUDIO_PLAYING_CLS),(0,D.removeClass)(t,y.AudioUtils.AUDIO_CURRENT_CLS),d(s.duration),a&&(0,D.attr)(a,"aria-label",(0,f.getLang)("global_audio_play")),l&&(0,D.attr)(l,"role","");let e=(0,D.data)(t,"bars");e&&((0,D.re)(e),(0,D.data)(t,"bars",null))}o?setTimeout((()=>{const e=y.AudioUtils.getAudioFromEl(t,!0);(0,D.toggleClass)(t,y.AudioUtils.AUDIO_CURRENT_CLS,!!e.isCurrent)}),0):(0,D.toggleClass)(t,y.AudioUtils.AUDIO_CURRENT_CLS,e)}_removeRowPlayer(e){(0,D.removeClass)(e,y.AudioUtils.AUDIO_CURRENT_CLS);const t=(0,D.data)(e,"player_inited");if(!t)return;setTimeout((()=>(0,D.re)((0,D.geByClass1)("_audio_inline_player",e))),200);const s=(0,D.geByClass1)("_audio_duration",e);s&&(s.innerHTML=(0,T.formatTime)(y.AudioUtils.getAudioFromEl(e,!0).duration)),this.off(e),(0,b.each)(t.sliders,((e,t)=>t.destroy())),(0,D.data)(e,"player_inited",!1);const o=(0,D.geByClass1)("has_audio_player",e);o&&(0,D.removeClass)(o,"has_audio_player")}_addRowPlayer(e){if((0,D.geByClass1)("_audio_inline_player",e)||(0,D.hasClass)(e,"podcast_list_snippet")||(0,D.hasClass)(e,"podcast_snippet__controls")||(0,D.hasClass)(e,"PodcastWidget__player"))return;const t=(0,D.se)(vk.audioInlinePlayerTpl||(0,b.getTemplate)("audio_inline_player")),s=(0,D.geByClass1)("_audio_player__place",e);s.appendChild(t),(0,D.addClass)(s,"has_audio_player");const o=new window.Slider((0,D.geByClass1)("audio_inline_player_volume",t),{value:this.getVolume(),backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,log:!0,formatHint:e=>Math.round(100*e)+"%",onChange:e=>this.setVolume(e)}),a=new window.Slider((0,D.geByClass1)("audio_inline_player_progress",t),{value:0,backValue:0,size:1,hintClass:"audio_player_hint",withBackLine:!0,formatHint:e=>(0,T.formatTime)(Math.round(e*this._impl.getDuration())),onEndDragging:e=>{const s=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());s&&y.AudioUtils.isPodcast(s)&&this.podcastSetActionRef(s,y.AudioUtils.PodcastsLogs.ACTION_SEEK,"",t),this.seekBySlider(e)}});this.ads.isActive&&a.toggleAdState(!0),vk.id||a.setBlocked(!0),this.on(e,x.events.AD_DEINITED,(()=>{})),this.on(e,x.events.AD_READY,(()=>{})),this.on(e,x.events.AD_STARTED,(()=>{a.toggleAdState(!0),a.setBackValue(0)})),this.on(e,x.events.AD_COMPLETED,(()=>a.toggleAdState(!1))),this.on(e,x.events.START_LOADING,(()=>a.toggleLoading(!0))),this.on(e,x.events.CAN_PLAY,(()=>a.toggleLoading(!1))),this.on(e,x.events.BUFFERED,((e,t)=>a.setBackValue(t))),this.on(e,x.events.PROGRESS,((e,t)=>{a.toggleLoading(!1),a.setValue(t)})),this.on(e,x.events.VOLUME,((e,t)=>{o.setValue(t,!0)})),(0,D.data)(e,"player_inited",{sliders:[o,a]})}hasStatusExport(){for(let e in this._statusExport)if(this._statusExport.hasOwnProperty(e)&&this._statusExport[e])return!0;return!1}getStatusExportInfo(){return this._statusExport}setStatusExportInfo(e,t=!1){this._statusExport=e,t&&this.setStatusExportInfoStorage(e)}setStatusExportInfoStorage(e){ve._lsSet(ve.LS_STATUS_EXPORT,e)}deleteAudioFromAllPlaylists(e){e=(0,I.isObject)(e)||(0,I.isArray)(e)?y.AudioUtils.audioTupleToAudioObject(e).fullId:e,(0,b.each)(this._playlists,((t,s)=>s.removeAudio(e))),this.getPlaylistQueue().removeAudio(e),this.saveStateCurrentPlaylist()}updateAudio(e,t){let s="";return(0,I.isString)(e)?s=e:(0,I.isArray)(e)&&(s=y.AudioUtils.audioTupleToAudioObject(e).fullId),t||(t=e),(0,b.each)(this._playlists,((o,a)=>{const l=a.getAudiosList();for(let o=0,a=l.length;o<a;o++)y.AudioUtils.getAudioFullId(l[o])===s&&(l[o]=(0,Q.mergeAudioTupleWithoutContext)(e,t))})),this._currentAudio&&y.AudioUtils.getAudioFullId(this._currentAudio)===s&&(this.setCurrentAudio((0,Q.mergeAudioTupleWithoutContext)(e,t)),this.notify(x.events.CURRENT_CHANGED)),this.notify(x.events.UPDATE),e}_triggerTNSPixel(){const e=ve._lsGet("tns_triggered_time_v3")||0,t=(0,I.vkNow)();t-e<864e5||(ve._lsSet("tns_triggered_time_v3",t),(0,I.vkImage)().src=`https://www.tns-counter.ru/V13a****mail_ru/ru/CP1251/tmsec=mail_audiostart/${(0,I.irand)(1,1e9)}`)}_restoreVolumeState(){ve.clearDeprecatedCacheKeys(),ve.clearOutdatedCacheKeys();const e=ve._lsGet(ve.LS_VOLUME);this._userVolume=null==e||!1===e?W.DEFAULT_VOLUME:e}async restoreState(){let e=!1,t=null,s=!1;if(vk.widget)return void(0,o._)(this,me)[me]();ve.clearDeprecatedCacheKeys(),ve.clearOutdatedCacheKeys(),await function(){if("complete"===document.readyState)return Promise.resolve();return new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();let a=ve._lsGet(ve.LS_PL);if(a){a=JSON.parse(a);const e=this.hasPlaylist(a.type,a.ownerId,a.albumId);a.type===L.AudioPlaylist.TYPE_RADIO&&e?this.setCurrentPlaylist(e):(this.setCurrentPlaylist(new L.AudioPlaylist(a)),a.originalPlaylistRawId&&(this._currentPlaylist._originalPlaylistRawId=a.originalPlaylistRawId)),this.getPlaylistQueue().setSortedQueue(a.list,a.source),this._initPlayingContext(this._currentPlaylist.getContext())}t=ve._lsGet(ve.LS_TRACK),t&&(e=!0,this.setCurrentAudio(t)),this._currentPlaylist&&this._currentAudio?this.notify(x.events.STATE_RESTORED,this._currentPlaylist,this._currentAudio):(this.setCurrentPlaylist(null),e||this.setCurrentAudio(null));const l=this._currentAudio?.[y.AudioUtils.AUDIO_ITEM_INDEX_DURATION];let r=0;if(y.AudioUtils.isPodcast(this._currentAudio)){const e=ve._podcastGetStates(),t=`${this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_OWNER_ID]}_${this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_ID]}`;r=((e[t]||{}).position||0)/l}else r=ve._lsGet(ve.LS_PROGRESS)||0;s=this._currentAudio&&this._impl,s&&this._implSetUrl(this._currentAudio,!0).then((()=>r&&r<1?this.implTaskManager.seek(r):this.implTaskManager.setVolume(0))).then((()=>{const e=(0,j.toTrackedAudioData)(this._currentAudio);e&&this.emitter.emit("stateRestore",{audio:e,progressTime:r*l*1e3})})).catch((()=>{this.deleteCurrentPlaylist()})).finally((()=>{this.isRestoreAudioPrevented||this.notify(x.events.CURRENT_CHANGED),(0,o._)(this,me)[me]()})),this._updatePlaybackRate(),this._currentAudio?this.mediaFocusChannel.start():this.mediaFocusChannel.stop(),s||(0,o._)(this,me)[me]()}_implPlay(){const e=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());return this.implTaskManager.play().then((()=>{if(this._muteProgressEvents=!1,this._allowPrefetchNext=!g.browser.safari,e.actionHash&&((0,V.connectListenQueue)(),ajax.post("al_audio.php",{act:"start_playback",audio_id:e.id,owner_id:e.owner_id,hash:e.actionHash,uuid:ve.getDeviceId()},{onFail:()=>!0})),y.AudioUtils.isPodcast(e)){const t=this._podcastRestoreState();this._podcastUpdateState(e,t,0,y.AudioUtils.PodcastsLogs.ACTION_PLAY)}this.notify(x.events.IMPL_PLAY)}))}_implSetUrl(e,t){this.implTaskManager.clearTask(H.TaskName.URL),t||this.notify(x.events.START_LOADING);const s=(0,F.audioTupleToAudioObject)(e);return this._ensureHasURL(s).then((e=>{if(e.url)return this.implTaskManager.setUrl(e.url).catch((()=>{this.implTaskManager.clearAllTasks(),this.notify(x.events.FAILED),this.isPlaying()&&this._playNextMarked({auto:!0,reason:pe.AudioPlayerPlayAudioEventReason.QueueContinuationAfterError})}));throw new Error}))}toggleDurationType(){const e=ve._lsGet(ve.LS_DURATION_TYPE);ve._lsSet(ve.LS_DURATION_TYPE,!e),this.notify(x.events.UPDATE,this.getCurrentProgress())}getCurrentProgress(){return this._impl?this._impl.getCurrentProgress():0}getCurrentBuffered(){return this._impl?this._impl.getCurrentBuffered():0}getCurrentProgressTime(){const e=this.getCurrentAudioData();if(e&&e.type===l.AudioType.Radio)return 1e3*this.getListenedTime();const t=this.getCurrentAudio(),s=this._impl.getDuration()??t?.[y.AudioUtils.AUDIO_ITEM_INDEX_DURATION]??0;return this.getCurrentProgress()*s*1e3}_initEvents(){(0,Ae.onModuleReady)("notifier",(()=>{this._connectNotifierEvents()})),new re.RadiostationEventsHandling}_connectNotifierEvents(){const e=window.Notifier;e&&(e.addRecvClbk("audio_start","audio",(()=>{this.audioPlayersSwitch.pause(),(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel()),this.pausedByVideo=null})),e.addRecvClbk(ue.PreviewAudioPlayerNotification.start,"audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByPreview=Date.now())})),e.addRecvClbk(ue.PreviewAudioPlayerNotification.stop,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk(ue.PreviewAudioPlayerNotification.pause,"audio",(()=>{!this.isPlaying()&&this.pausedByPreview&&(Date.now()-this.pausedByPreview<18e4&&this.resumeChannel(),this.pausedByPreview=null)})),e.addRecvClbk("on_media_attachment_player_start","audio",(()=>{this.isPlaying()&&!this.ads.isActive&&this.pauseByChangeChannel()})),e.addRecvClbk("video_start","audio",(()=>{(this.isPlaying()||this.ads.isActive)&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","audio",(()=>{!this.isPlaying()&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.resumeChannel(),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","audio",(()=>{cur.loggingOff=!0,ve.clearAllCacheKeys(),this.stop()})),e.addRecvClbk("stories_video_start","audio",(()=>{this.isPlaying()&&(this.ads.isActive||this.pauseByChangeChannel(),this.pausedByStories=(0,I.vkNow)())})),e.addRecvClbk("stories_video_end","audio",(()=>{!this.isPlaying()&&this.pausedByStories&&((0,I.vkNow)()-this.pausedByStories<18e4&&this.resumeChannel(),this.pausedByStories=null)})))}addPlaylist(e){const t=this.hasPlaylist(e.getId());t?(t.mergeWith(e.asObject()),t.getType()===L.AudioPlaylist.TYPE_RADIO&&this._currentPlaylist===t&&this.getPlaylistQueue().setSortedQueue(t.getAudiosList())):this._playlists.push(e)}_cleanUpPlaylists(){let e=0,t=-1;for(let s=this._playlists.length-1;s>=0;s--){const o=this._playlists[s];if(!o.isReference()&&(e+=o.getAudiosCount(),e>4e3)){t=s;break}}if(-1===t)return;t+=1;const s=this._playlists.slice(0,t),o=this.getCurrentPlaylist(),a=[];for(let e=0;e<s.length;e++){let l=s[e];if(o===l&&(l=!1),l&&!l.isReference())for(let e=t;e<this._playlists.length;e++){const t=this._playlists[e];t.isReference()&&t.getSelf()===l&&(l=!1)}l&&a.push(e)}for(let e=0;e<a.length;e++){const t=a[e];this._playlists.splice(t,1)}a.length&&(0,w.debugLog)("AudioPlayer - "+a.length+" playlists removed")}hasPlaylist(e,t,s,o){let a;if(o)return this._playlists.find((e=>e.getBlockId()===o||e.getAlbumId()===o))||!1;a=void 0!==t&&void 0!==s?`${e}_${t}_${s}`:e;for(let e=0;e<this._playlists.length;e++){let t=this._playlists[e];if(!t.isReference()&&t.getId()===a)return t}return!1}getPlaylistByBlockId(e){return this.hasPlaylist(null,null,null,e)||null}getPlaylistsByType(e){return this._playlists.filter((t=>t.getType()===e))||null}getPlaylistById(e){return this._playlists.filter((t=>t.getId()===e))||null}getPlaylist(e,t,s,o=void 0,a="",l=""){!e||t||s||([e,t,s]=L.AudioPlaylist.splitId(e));const r=this.hasPlaylist(e,t,s,a);if(r)return r.mergeWith({accessHash:o}),r;return new L.AudioPlaylist({type:e,ownerId:t,albumId:s,hasMore:e!==L.AudioPlaylist.TYPE_TEMP,accessHash:o,blockId:a})}getPlaylistQueue(){return this._playlistQueue}isFromNextSequence(){return 1===this._seq}isFromPrevSequence(){return-1===this._seq}isAutoPlayed(){return!!this._autoNext}hasPrevAudio(){return!(!this._prevAudio||y.AudioUtils.getAudioFullId(this._currentAudio)===y.AudioUtils.getAudioFullId(this._prevAudio))}hasPrevPlaylist(){return!!this._prevPlaylist}toggleRepeatCurrentAudio(){this._repeatCurrent=!this._repeatCurrent,this._repeatAll=!1}setRepeatCurrentAudio(e){this._repeatCurrent=e,this._repeatAll=!1}isRepeatCurrentAudio(){return!!this._repeatCurrent}toggleRepeatAll(){this._repeatAll=!this._repeatAll,this._repeatCurrent=!1}setRepeatAll(e){this._repeatAll=e,this._repeatCurrent=!1}isRepeatAll(){return!!this._repeatAll}setNext(e,t){if(vk&&vk.widget&&!vk.id&&window.Widgets)return window.Widgets.oauth(),!1;const s="audio_row__added_next";if(!(0,D.hasClass)(e,s)){(0,D.addClass)(e,s);const o=this.getCurrentPlaylist(),a=this.getPlaylistQueue();if(o){const e=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(e&&t.fullId===e.fullId)return;const s=a.indexOfAudio(e);if(-1===s)return;this.notify(x.events.PLAY_NEXT,e.fullId,t.fullId);const o=this.getPlaylistQueue(),l=a.indexOfAudio(t);-1!==l?o.moveAudio(l,s+1):(o.addAudio((0,$.serializeAudio)(t),s+1),this.getCurrentPlaylist().pushAudio((0,$.serializeAudio)(t),s+1)),this.saveStateCurrentPlaylist()}else{const s=y.AudioUtils.getContextPlaylist(e);this._play(t,s.playlist,s.context)}const l=window.AudioPage&&window.currentAudioPage(e);if(l){const e=l.getPageCurrentPlaylist();e&&l.onUserAction(t,e)}}}on(e,t,s){(0,I.isArray)(t)||(t=[t]);const o=(...e)=>s(...e);for(const s of t)this.subscribers.push({context:e,et:s,cb:o});return()=>{this.subscribers=this.subscribers.filter((e=>e.cb!==o))}}off(e){this.subscribers=this.subscribers.filter((t=>t.context!==e))}connectEvents(){this.eventBus.precheck=e=>!!this._impl&&!(!this.ads.isActive&&this._muteProgressEvents&&(0,b.inArray)(e,[x.events.BUFFERED,x.events.PROGRESS])),this.eventBus.onAnyCallBack=(e,...t)=>this.onEvent(e,...t),this.subscribe(x.events.VOLUME,(()=>ve._lsSet(ve.LS_VOLUME,this._userVolume))),this.subscribe(x.events.PLAY_REQUESTED,(()=>{this.updateCurrentPlaying(!0),this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio(),ve._setTabIcon("play")})),this.subscribe(x.events.IMPL_PLAY,(()=>{this._sendStatusExport()})),this.subscribe(x.events.PLAY,(()=>{this.updateCurrentPlaying(!0),ve._setTabIcon("play")})),this.subscribe(x.events.PLAYLIST_CHANGED,(()=>{this.saveStateCurrentPlaylist(),this._saveStateCurrentAudio()})),this.subscribe(x.events.PROGRESS,(async(e,t,s)=>{const o=this.getCurrentAudio(),a=(0,F.audioTupleToAudioObject)(o);if(this._listenedTime=s,y.AudioUtils.isPodcast(a))e&&s&&this._podcastUpdateState(a,e,s,y.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT);else if(!this.ads.isActive){let e=this._impl.getCurrentProgress();if(vk.widget||ve._lsSet(ve.LS_PROGRESS,e),!vk.widget&&this._allowPrefetchNext&&e>=.8){const e=await this.getNextAudio();e&&this._impl.isFullyLoaded()&&(this._allowPrefetchNext=!1,this._prefetchAudio(e))}}})),this.subscribe(x.events.PAUSE,(()=>{this.updateCurrentPlaying(!0);const e=this.getCurrentAudio(),t=(0,F.audioTupleToAudioObject)(e);y.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),y.AudioUtils.PodcastsLogs.ACTION_PAUSE),ve._setTabIcon("pause")})),this.subscribe(x.events.SEEK,(e=>{const t=this.getCurrentAudio(),s=(0,F.audioTupleToAudioObject)(t);e.reason&&this.emitter.emit("seek",{...e,progressTime:this.getCurrentProgressTime()}),y.AudioUtils.isPodcast(s)&&this._podcastUpdateState(s,this.getCurrentProgress(),this._impl.getPlayedTime(),y.AudioUtils.PodcastsLogs.ACTION_SEEK)})),this.subscribe(x.events.ENDED,(()=>{const e=this.getCurrentAudio(),t=(0,F.audioTupleToAudioObject)(e);y.AudioUtils.isPodcast(t)&&this._podcastUpdateState(t,this.getCurrentProgress(),this._impl.getPlayedTime(),y.AudioUtils.PodcastsLogs.ACTION_HEARTBEAT),window.vk&&!window.vk.widget&&!window.vk.id&&(0,q.partConfigEnabled)("audio_unauth_preview_box")&&(this.stop(),J.Unauthorized.showMoreBox(null,0,z.UnauthorizedSourceType.AUDIO))})),this.subscribe(x.events.AD_STARTED,(()=>{const e=this.ads.getCurrentAd()?.id;e?this.emitter.emit("playAdv",{reason:pe.AudioPlayerPlayAudioEventReason.Unknown,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")})),this.subscribe(x.events.RADIOSTATION_FOLLOW,(e=>(0,le.updateFaveStatusAfterFollow)(e,!0))),this.subscribe(x.events.RADIOSTATION_UNFOLLOW,(e=>(0,le.updateFaveStatusAfterFollow)(e,!1)))}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}onEvent(e,t,s,o){(0,b.inArray)(e,[x.events.PLAY,x.events.PLAY_REQUESTED,x.events.PAUSE])&&(this.subscribers=this.subscribers.filter((e=>!(e.context instanceof Element)||bodyNode.contains(e.context))));for(const a of this.subscribers)try{a.et===e&&a.cb(this.getCurrentAudio(),t,s,o)}finally{continue}}notify(e,...t){this.eventBus.emit(e,...t)}addWithReplacePlaylists(e){const t=e.reduce(((e,t)=>(e[L.AudioPlaylist.getFullIdFromData(t)]=t,e)),{}),s={};this._playlists.forEach(((e,o)=>{const a=e.getFullId();if(t[a]){this._playlists.slice(o,1);const e=t[a];new L.AudioPlaylist(e),s[a]=!0}})),Object.keys(t).forEach((e=>{s[e]||new L.AudioPlaylist(t[e])}))}_sendPlayerErrorStats(e){const t=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!t)return;const{full_id:s}=t,o=(0,b.extend)({audio:s,progress:this.getCurrentProgress(),buffered:this.getCurrentBuffered()},e.getErrorData());ajax.post("al_audio.php?act=player_error_stats",o)}playLive(e,t){const s=this.getPlaylist(L.AudioPlaylist.TYPE_LIVE,vk.id,D.data[0]),o=this.getPlaylistQueue();s.mergeWith({live:e,hasMore:!1}),e=s.getLiveInfo(),ajax.post("al_audio.php",{act:"a_play_audio_status",audio_id:e.audioId,host_id:e.hostId,hash:e.hash},(0,b.extend)(t,{onDone:(e,t,a)=>{s.mergeWith({title:t&&t.title,list:[e]}),o.addAudio(e),this.playByButton({audio:e,livePlaylist:s,context:a})},onFail:()=>!0}))}_listenStatusExport(){window.addEventListener("storage",(e=>{if(e.key===ve.LS_PREFIX+ve.LS_STATUS_EXPORT){const e=ve._lsGet(ve.LS_STATUS_EXPORT);this.setStatusExportInfo(e),cur.audioPage&&cur.audioPage.updateStatusExportControls()}}))}_sendStatusExport(){const e=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!e||!r.Ranges.isUserId(window.vk.id))return;const t=this.statusSent?this.statusSent.split(","):[!1,0],s=(0,I.vkNow)()-parseInt(t[1]),o=e.accessKey,a=Boolean(this.isRepeatCurrentAudio())||Boolean(this.isRepeatAll())&&1===this.getPlaylistQueue()?.length;if(this.hasStatusExport()&&!y.AudioUtils.isPodcast(e)&&(a||e.id!=t[0]||s>3e5)){const t=this.getCurrentPlaylist(),s=t?t.playbackParams:null;setTimeout(ajax.post.pbind("al_audio.php",{act:"audio_status",full_id:e.fullId,hash:vk.statusExportHash,top:s&&(s.top_audio||s.top)?1:0,access_key:o},{onFail:()=>!0}),0),this.statusSent=e.id+","+(0,I.vkNow)()}}saveStateCurrentPlaylist(){const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();if(vk.widget||!e||!t||(0,ne.isArticleTts)(this._currentAudio))return;const s=this._getPreparePlayQueueForSaving(e,t);ve._lsSet(ve.LS_PL,s),ve._lsSet(ve.LS_SAVED,(0,I.vkNow)())}_getPreparePlayQueueForSaving(e,t){const s=e.asObject();s.type&&(s.type=L.AudioPlaylist.TYPE_TEMP);let o=this.getCurrentAudio(),a=Math.max(0,t.indexOfAudio(o));const l={...s,list:(0,b.clone)(t.list.slice(Math.max(0,a-100),a+300),!0),source:t.source};return(0,b.each)(l.list,(function(e,t){(0,oe.isRadio)(t)||(t[y.AudioUtils.AUDIO_ITEM_INDEX_URL]="")})),JSON.stringify(l)}_saveStateCurrentAudio(){if(vk.widget)return;const e=this.getCurrentAudio();if(!e||(0,ne.isArticleTts)(e))ve._lsSet(ve.LS_TRACK,null);else{const t=(0,b.clone)(e);(0,oe.isRadio)(e)||(t[y.AudioUtils.AUDIO_ITEM_INDEX_URL]=""),ve._lsSet(ve.LS_TRACK,t)}}getListenedTime(){return this._listenedTime}seekCurrentAudio(e,t){if(this.ads.isActive)return!1;const s=(t=t||10)/y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio()).duration;let o=this.getCurrentProgress()+(e?s:-s);o=Math.max(0,Math.min(1,o)),this.seekByButton(o)}setVolume(e,t=!1){const s=Math.min(1,Math.max(0,e));this._userVolume!==s&&(this._userVolume=s,this.notify(x.events.VOLUME,s)),this.implTaskManager.setVolume(s,t),this.ads.updateVolume()}getVolume(){return void 0===this._userVolume?.8:this._userVolume}seekByButton(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?pe.AudioPlayerSeekEventReason.TapBack:pe.AudioPlayerSeekEventReason.TapForward})}seekBySlider(e){const t=e-this.getCurrentProgress();return this._seek({amount:e,reason:t<0?pe.AudioPlayerSeekEventReason.SliderBack:pe.AudioPlayerSeekEventReason.SliderForward})}seek(e){return this._seek({amount:e,reason:pe.AudioPlayerSeekEventReason.Unknown})}_seek({amount:e,reason:t}){const s=this.getCurrentAudioData(),o=this.getCurrentProgressTime();this.implTaskManager.seek(e),this.notify(x.events.SEEK,{reason:t,audio:s,fromTime:o})}seekToTimeByButton(e,t){const s=this._seekTimeToAmount(e),o=s-this.getCurrentProgress();return this._seekToTime({amount:s,ref:t,reason:o<0?pe.AudioPlayerSeekEventReason.TapBack:pe.AudioPlayerSeekEventReason.TapForward})}seekToTime(e,t){return this._seekToTime({amount:this._seekTimeToAmount(e),ref:t,reason:pe.AudioPlayerSeekEventReason.Unknown})}_seekToTime({amount:e,ref:t,reason:s}){const o=this.getCurrentAudio();if(!o)return 0;if(this._seek({amount:e,reason:s}),y.AudioUtils.isPodcast(o)){let e="";const s=y.AudioUtils.audioTupleToAudioObject(o);t&&(e=y.AudioUtils.PodcastsLogs.ACTION_TIME_MARKER,this.podcastSetActionRef(s,y.AudioUtils.PodcastsLogs.ACTION_SEEK,t)),this._podcastUpdateState(s,progress,0,e)}return progress}_seekTimeToAmount(e){const t=this.getCurrentAudio();if(!t)return 0;let s=e/t[y.AudioUtils.AUDIO_ITEM_INDEX_DURATION];return s=Math.max(0,s),s=Math.min(s,1),s}_ensureHasURL(e){this._currentUrlEnsure=this._currentUrlEnsure||{};const t=[];if(!e)return Promise.reject();if(e.url)return Promise.resolve(e);const s=this.getPlaylistQueue(),o=s.indexOfAudio(e);return o>=0?s.getAudioAt(o).then((e=>y.AudioUtils.audioTupleToAudioObject(e))):(this._currentUrlEnsure[e.fullId]||t.push(e.fullId+"_"+e.actionHash+"_"+e.urlHash),(()=>{let s;return!t.length&&this.currentEnsureUrlPromise?s=this.currentEnsureUrlPromise:(s=new Promise(((e,s)=>{this.ensureUrlReject&&this.ensureUrlReject(),this.ensureUrlReject=s,we().then((()=>this.fetchAudioUrls(t))).then((t=>{this.ensureUrlReject=null,e(t)})).catch((o=>{switch(o){case"bad_hash":this.ensureUrlReject=null,this.fetchAudios(t).then((e=>this.fetchAudioUrls(e))).then(e).catch((()=>!0));break;case"no_audios":this.ensureUrlReject=null,s()}return!0}))})),this.currentEnsureUrlPromise=s),s.then((t=>(Array.isArray(t)&&t.forEach((t=>{if(e.fullId===(0,X.getAudioFullId)(t)){const s=(0,F.audioTupleToAudioObject)(t);e.url=s.url,e.ads=s.ads,e.flags=s.flags,e.extra=s.extra}})),e)))})())}fetchAudioUrls(e){return new Promise(((t,s)=>{ajax.post("al_audio.php?act=reload_audio",{ids:e.join(",")},{onDone:(e,s,o)=>{this.setStatusExportInfo(s),o&&this._podcastSaveData(o),(0,b.each)(e,((e,t)=>{t=y.AudioUtils.audioTupleToAudioObject(t);let s={};s[y.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,s[y.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,s[y.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,s[y.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra,this.updateAudio(t.fullId,s),this._currentAudio&&(0,X.getAudioFullId)(this._currentAudio)===t.fullId&&(this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_URL]=t.url,this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_ADS]=t.ads,this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_FLAGS]=t.flags,this._currentAudio[y.AudioUtils.AUDIO_ITEM_INDEX_EXTRA]=t.extra),delete this._currentUrlEnsure[t.fullId]})),t(e)},onFail:e=>(s(e),!0)})}))}fetchAudios(e){return e?new Promise(((t,s)=>{ajax.post("al_audio.php?act=reload_audios",{audio_ids:e.join(",")},{onDone:e=>{const o=[],a=this.getCurrentPlaylist().getAudiosList();if(!Array.isArray(e))return void s();const l=e.reduce(((e,t)=>(e[(0,X.getAudioFullId)(t)]=t,e)),{});for(let e=0;e<a.length;e++){const t=(0,X.getAudioFullId)(a[e]);if(l[t]){a[e]=l[t];const s=(0,F.audioTupleToAudioObject)(l[t]);o.push(`${s.fullId}_${s.actionHash}_${s.urlHash}`)}}t(o)}})})):Promise.resolve([])}toggleAudio(e,t){if(vk&&vk.widget&&window.Widgets&&!vk.widgetPodcast&&!vk.id&&!(0,q.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;if((0,D.domClosest)("_audio_row__tt",t.target))return(0,C.cancelEvent)(t);const s=(0,D.domClosest)("_audio_row",e),o=y.AudioUtils.getAudioFromEl(s,!0);if(window.getSelection&&window.getSelection().rangeCount){const e=window.getSelection().getRangeAt(0);if(e){const{commonAncestorContainer:t}=e;if(t&&(0,D.domClosest)("_audio_row",t)===s&&e.startOffset!==e.endOffset)return!1}}if(t&&(0,D.hasClass)(t.target,"mem_link"))return nav.go((0,D.attr)(t.target,"href"),t,{navigateToUploader:!0}),(0,C.cancelEvent)(t);if((0,D.hasClass)(t.target,"_audio_row__title_inner")){if(y.AudioUtils.isPodcast(o))return(0,E.showPodcast)(s,o.fullId),(0,C.cancelEvent)(t);if(o.hasTrackPage&&!o.isClaimed)return;(0,C.cancelEvent)(t)}if((0,D.hasClass)(t.target.parentNode,"audio_row__performers")){if((0,C.checkEvent)(t)||vk.widget)return!0;if(!(0,D.gpeByClass)("_ape_audio_item",t.target)){const e=(0,D.domData)(t.target,"performer");if(e)return y.AudioUtils.audioSearchPerformer(t.target,e,t),(0,C.cancelEvent)(t)}return!0}let a=cur.cancelClick||t&&((0,D.hasClass)(t.target,"audio_lyrics")||(0,D.domClosest)("_audio_duration_wrap",t.target)||(0,D.domClosest)("_audio_inline_player",t.target)||(0,D.domClosest)("audio_performer",t.target));const l=(0,D.hasClass)(t.target,"slider")||(0,D.domClosest)("slider",t.target),r=cur._sliderMouseUpNowEl&&(cur._sliderMouseUpNowEl===(0,D.geByClass1)("audio_inline_player_progress",s)||cur._sliderMouseUpNowEl===(0,D.geByClass1)("audio_inline_player_volume",s));if((l||r)&&(a=!0),delete cur.cancelClick,delete cur._sliderMouseUpNowEl,a)return!0;if(y.AudioUtils.isClaimedAudio(o)||o.isReplaceable){const e=y.AudioUtils.getAudioExtra(o).claim;if(e)return void((0,D.hasClass)(s,"no_actions")||o.isInEditBox||window.showAudioClaimWarning(o,e,y.AudioUtils.replaceWithOriginal.bind(y.AudioUtils,s,o)))}if(this.podcastSetActionRef(o,o.isPlaying?y.AudioUtils.PodcastsLogs.ACTION_PAUSE:y.AudioUtils.PodcastsLogs.ACTION_PLAY,"",s),o.isPlaying)this.pauseByButton(),(0,ce.logSearchAudioClick)(ce.SearchClickActionMap.PAUSE,o?.trackCode);else{const e=y.AudioUtils.getContextPlaylist(s),t=this.getPlaylistQueue();if((0,ce.logSearchAudioClick)(ce.SearchClickActionMap.PLAY,o?.trackCode),t.isAutoplaySupported&&"autoplay"===e.context?this.playAudioItem({audio:o.fullId,playlist:null,context:o.context}):(this.playAudioItem({audio:o.fullId,playlist:e.playlist,context:o.context||e.context}),cur.audioPage&&cur.audioPage.onUserAction(o,e.playlist)),this._specialProjectController){const e=(0,ae.getSpecialProjectId)(o);e&&this._specialProjectController.tryModal(e,o.trackCode)}}y.AudioUtils.onRowOver(s,!1,!0)}playNextPlaylist(e,t,s){const o=this.getPlaylist(L.AudioPlaylist.TYPE_PLAYLIST,e,t,s);o.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue();e?(e.pushAudio(o.getAudiosList()),t.addPlaylist(o)):(t.addPlaylist(o),this.setCurrentPlaylist(new L.AudioPlaylist(o)),t.getAudioAt(0).then((e=>{e&&(this.setCurrentAudio(e),this.notify(x.events.UPDATE),this.notify(x.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),this.isPlaying()||this.playList({audio:e.fullId,playlist:o}))}))),boxQueue&&boxQueue.hideAll(),layers&&layers.fullhide&&layers.fullhide()}))}setNextPlaylist(e,t,s){const o=this.getPlaylist(L.AudioPlaylist.TYPE_PLAYLIST,e,t,s);o.loadAll((()=>{const e=this.getCurrentPlaylist(),t=this.getPlaylistQueue(),s=o.getAudiosList(),a=this._currentAudio?t.indexOfAudio(this._currentAudio):-1,l=this._currentAudio?e?.indexOfAudio(this._currentAudio)??-1:-1;t.addAudio(s,a+1),e?e.pushAudio(s,l+1):(this.setCurrentPlaylist(new L.AudioPlaylist(o)),t.getAudioAt(0).then((e=>{if(e&&(this.setCurrentAudio(e),this.notify(x.events.UPDATE),this.notify(x.events.PLAYLIST_CHANGED),this.updateCurrentPlaying(),!this.isPlaying())){const[t,s]=e,o=`${s}_${t}`;this._play(o,this._currentPlaylist)}})))}))}playPlaylist(e,t,s,o,a){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,q.partConfigEnabled)("audio_unauth_preview"))return window.Widgets.oauth(),!1;this.playNextInPlaylist(e,t,s,o,{isNewListStart:!0,shuffled:a})}async playPreparedPlaylist({playlist:e,context:t}){if(vk&&vk.widget&&!vk.id&&window.Widgets&&!(0,q.partConfigEnabled)("audio_unauth_preview"))return void window.Widgets.oauth();const s=this.getCurrentPlaylist(),o=this.getPlaylistQueue();if(e.setContext(t),s&&s.getId()===e.getId()&&this.isPlaying())return void this.pauseByButton();this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),o.setSortedQueue(e.getAudiosList());const a=await o.getFirstAudio();if(a){if(this._specialProjectController){const e=(0,ae.getSpecialProjectId)(a);e&&await this._specialProjectController.tryModal(e,a.trackCode)}await this.playList({audio:a,playlist:e,context:t,isNewListStart:!0,isPreparedPlaylist:!0})}}playBlock(e,t,s,o,a,l="default",r={}){const{blockId:n="",shuffled:d=!1}=r;this.playNextInPlaylist(e,t,s,o,{shuffled:d,blockId:n,type:a,trackType:l,isNewListStart:!0})}playNextInPlaylist(e,t,s,o,a={}){const{isNewListStart:l=!1,blockId:r=""}=a,n=this.getCurrentPlaylist(),d=this.getPlaylist(a.type||L.AudioPlaylist.TYPE_PLAYLIST,e,t,s,r,o),_=this.getPlaylistQueue();if(d.setContext(o),a.shuffled&&this.toggleShuffle(!0),n&&n.getId()===d.getId()&&this.isPlaying()&&!a.shuffled)this.pauseByButton();else{let e=!1;const t=async()=>{if(e)return;await _.clean(),await _.addPlaylist(d),e=!0;const t=await _.getFirstAudio();if(t){if(this._specialProjectController){const e=(0,ae.getSpecialProjectId)(t);e&&this._specialProjectController.tryModal(e,t.trackCode)}this.playList({audio:t,playlist:d,context:o,isNewListStart:l,isPreparedPlaylist:!0})}};if(d.getAudiosCount()&&!d.isExpired())return void t(d);this._impl&&this._impl.preparePlay&&!this.ads.isActive&&this._impl.preparePlay(),this.notify(x.events.PLAYLIST_START_LOADING,d.getOwnerId(),d.getPlaylistId()),d.load(0,t,null,a.trackType)}}_initPlayingContext(e){this._playingContext=e}_getPlayingContext(){return this._playingContext||""}_getPlayingContextSection(){return this._getPlayingContext().split(":")[0]}resume({reason:e}={}){this.isPaused()&&this._playMarked({reason:e})}async playByButton({audio:e,playlist:t,context:s}={}){return this._playMarked({audio:e,playlist:t,context:s,reason:pe.AudioPlayerPlayAudioEventReason.PlayButton})}async playAudioItem({audio:e,playlist:t,context:s}={}){return this._playMarked({audio:e,playlist:t,context:s,reason:pe.AudioPlayerPlayAudioEventReason.AudioButton})}async playList({audio:e,playlist:t,context:s,isNewListStart:o=!1,isPreparedPlaylist:a=!1}={}){return this._playMarked({audio:e,playlist:t,context:s,reason:pe.AudioPlayerPlayAudioEventReason.ListButton,playbackStartMode:o?"resumeLast":"normal",isPreparedPlaylist:a})}async playShuffledList({audio:e,playlist:t,context:s}={}){return this._playMarked({audio:e,playlist:t,context:s,reason:pe.AudioPlayerPlayAudioEventReason.MixAndPlayButton})}async resumeChannel({audio:e,playlist:t,context:s}={}){return this._playMarked({audio:e,playlist:t,context:s,reason:pe.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}async _playMarked({audio:e,playlist:t,context:s,seq:o,autoNext:a,reason:l,playbackStartMode:r,isPreparedPlaylist:n}){return this._play(e,t,s,o,a,l,{playbackStartMode:r,isPreparedPlaylist:n})}async play(e,t,s,o,a,l){return this._play(e,t,s,o,a,l)}async _play(e,t,s,o,a,l,r={}){const{playbackStartMode:n="normal",isPreparedPlaylist:d=!1}=r;if(l=l??pe.AudioPlayerPlayAudioEventReason.Unknown,cur.loggingOff)return;if(!this._impl)return;let _;this._seq=o,this._autoNext=a,this._prevAudio=this._currentAudio,((0,I.isObject)(e)||(0,I.isArray)(e))&&(_=e,(e=y.AudioUtils.audioTupleToAudioObject(e))&&(e=e.fullId));const u=this.getPlaylistQueue(),{isAutoplaySupported:c,isAutoplayEnabled:h}=u;let p=y.AudioUtils.audioTupleToAudioObject(this._currentAudio),A=this.getCurrentPlaylist();!e&&p&&(e=p.fullId);let g=!1,P=e&&p&&e==p.fullId;const E=async s=>{if(this.mediaFocusChannel.start(),!P){const e=h&&t&&t.getNoConsecutivePlay();if(s&&t&&!d&&(e?await u.addNoConsecutivePlaylist(t,s):await u.addPlaylist(t,s)),!g&&!e&&"resumeLast"===n){const e=t.lastPlayedAudio;e&&(s=e)}t&&!e&&u.list.length<t.getAudiosCount()&&u.addAudio(t.getAudiosList()),t&&t.getType()===L.AudioPlaylist.TYPE_SEARCH&&t.indexOfAudio(s)>=t.getLocalFoundCount()&&t.sendSearchStats("search_play"),p&&y.AudioUtils.isPodcast(p)&&this.isPlaying()&&this._podcastUpdateState(p,this.getCurrentProgress(),this._impl.getPlayedTime(),y.AudioUtils.PodcastsLogs.ACTION_PAUSE,{needResetListen:!0}),this.ads.isActive||this.ads.deinit()}if(ve._sendLCNotification(),P)if(this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:l,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")}else this.isPlaying()||(u.autoplayQueue?.source||u.setAutoplaySourceFromPlaylist(t),this.setIsPlaying(!0),this.implTaskManager.clearAllTasks(),this.emitter.emit("playAudio",{reason:l,audio:(0,j.toTrackedAudioData)(p),progressTime:this.getCurrentProgressTime()}),this._implSetUrl(p).then((()=>{this._implPlay(),this._updatePlaybackRate(),this.implTaskManager.setVolume(this.getVolume(),!!this._impl.getCurrentProgress()),y.AudioUtils.isPodcast(s)&&this._podcastUpdateState(y.AudioUtils.audioTupleToAudioObject(s),this.getCurrentProgress(),this._impl.getPlayedTime())})).catch((()=>{})));else if(e&&s){const t=this.getCurrentAudioData(),r=(0,pe.getStopReasonForPlayReason)(l);if(t&&r&&!P&&this.emitter.emit("stopAudio",{reason:r,audio:t,progressTime:this.getCurrentProgressTime()}),!a&&p&&this._impl.setUrl(W.SILENCE),this.setCurrentAudio(s),this.setIsPlaying(!0),this.ads.isActive){const e=this.ads.getCurrentAd()?.id;this.ads.resume(),e?this.emitter.emit("playAdv",{reason:l,advId:e,progressTime:this.getCurrentProgressTime()}):Me("playAdv")}else this.notify(x.events.PLAY_REQUESTED,!0,parseInt(o),a),this._muteProgressEvents=!0,this.implTaskManager.clearAllTasks(),this._impl.preparePlay&&this._impl.preparePlay(),this.ads.startPlay(y.AudioUtils.audioTupleToAudioObject(s),(()=>this.playAfterAd(l))),this.notify(x.events.PROGRESS,0);this.updateCurrentPlaying(!0),p&&this.scrollToCurrentPlaying(p.fullId,e)}};if(c&&"autoplay"===s||(0,I.isArray)(_)&&"autoplay"===_[y.AudioUtils.AUDIO_ITEM_INDEX_CONTEXT]){const t=u.autoplayQueue.getAudioById(e);if(t)return this.eventBus.emit(x.AudioPlayerEventType.PLAY_TRACK_FROM_AUTOPLAY,t),E(t)}if(t?A&&(g=P?t.getFullId()===A.getSelf().getFullId():t===A.getSelf()||t===A):(t=A,g=!0),g||s||(0,w.debugLog)("New playlist play init without context"),s&&(this._prevContext=this._playingContext,this._initPlayingContext(s)),!g){if(this._cleanUpPlaylists(),this._currentPlaylist&&!d)if(this._prevPlaylist=this._currentPlaylist,this._prevAudio=this._currentAudio,h&&t.getNoConsecutivePlay()){t.getAudio(e);const s=Array.isArray(_)?_:t.getAudio(e);await u.addNoConsecutivePlaylist(t,s)}else await u.setSortedQueueByPlaylist(t,_);this.setCurrentPlaylist(new L.AudioPlaylist(t)),this.notify(x.events.PLAYLIST_CHANGED)}if(!(u.indexOfAudio(e)>=0)){let s=t?.getAudio(e);!s&&_&&(s=_),u.addAudio(s)}E(await u.getAudio(e))}playAfterAd(e){this.notify(x.events.CURRENT_CHANGED);const t=this.getCurrentAudio();t&&(this.emitter.emit("playAudio",{reason:e,audio:(0,j.toTrackedAudioData)(t),progressTime:this.getCurrentProgressTime()}),this.notify(x.events.UPDATE),this._implSetUrl(t).then((()=>{this._implPlay(),this._updatePlaybackRate(),vk.id?this.implTaskManager.setVolume(this.getVolume()):this.fadeIn(1e3*ve.UNAUTH_FADE_TIME),this._triggerTNSPixel()})).catch((()=>(this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.Unknown}),!0))))}_prefetchAudio(e){(e=y.AudioUtils.audioTupleToAudioObject(e))&&e.url&&this._impl.prefetch(e.url)}getCurrentPlaylist(){const e=this._currentPlaylist;return e?e.getRef?.()??e._ref??e:null}setCurrentPlaylist(e){this._currentPlaylist=e}getPlaylists(){return(0,b.clone)(this._playlists)}pauseByButton(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.PauseButton})}pauseByMediaSession(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.MediaSession})}pauseByChangeChannel(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.ChannelAutoPause})}pause(){return this._pauseAudio({reason:pe.AudioPlayerPauseAudioEventReason.Unknown})}_pauseAudio({reason:e}){const t=this.getCurrentAudioData(),s=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){const t=this.ads.getCurrentAd()?.id;this.ads.resume(),t?this.emitter.emit("pauseAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Me("pauseAdv")}else this.emitter.emit("pauseAudio",{reason:e,audio:t,progressTime:s})}_stopCurrentAudio({reason:e}){const t=this.getCurrentAudioData(),s=this.getCurrentProgressTime(),o=this.ads.isActive;if(o&&setTimeout((()=>this.ads.pause()),100),this.implTaskManager.setVolume(0,!0),this.implTaskManager.pause(),o){const t=this.ads.getCurrentAd()?.id;t?this.emitter.emit("stopAdv",{reason:e,advId:t,progressTime:this.getCurrentProgressTime()}):Me("stopAdv")}else this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:s})}stop(e){const t=this.isPaused();if(this.setIsPlaying(!1),this.ads.isActive){const s=this.ads.getCurrentAd()?.id;this.ads.stop(),e&&(s?this.emitter.emit("stopAdv",{reason:e,advId:s,progressTime:this.getCurrentProgressTime(),wasPaused:t}):Me("stopAdv"))}else{const t=this.getCurrentAudioData();t&&e&&this.emitter.emit("stopAudio",{reason:e,audio:t,progressTime:this.getCurrentProgressTime()}),this._impl.stop()}this.notify(x.events.STOP),this.switchConnection.emit("stop"),this.mediaFocusChannel.stop()}toggleShuffle(e){const t=this.getPlaylistQueue();t&&t.toggleShuffle(e)}isPlaying(){return this._isPlaying}setIsPlaying(e){this._isPlaying=e,this.notify(x.events.PLAYER_IS_PLAYING_CHANGED,e)}isPaused(){return this._isPaused}setIsPaused(e){this._isPaused=e}getCurrentAudio(){if(this._currentAudio&&!this._currentAudio[ie.EAudioTupleIndex.CONTEXT]){const e=this._getPlayingContext();e&&(this._currentAudio[ie.EAudioTupleIndex.CONTEXT]=e)}return this._currentAudio}setCurrentAudio(e){this._currentAudio=e,this.notify(x.events.CURRENT_AUDIO_CHANGED,e)}getCurrentAudioData(){return(0,j.toTrackedAudioData)(this.getCurrentAudio())||null}getPreviousAudio(){return this._prevAudio}playNextByButton(e){this._playNextMarked({auto:e,reason:pe.AudioPlayerPlayAudioEventReason.NextButton})}playNextByMediaSession(e){this._playNextMarked({auto:e,reason:pe.AudioPlayerPlayAudioEventReason.NextMediaSession})}playPrevByButton(){this._playPrevMarked({reason:pe.AudioPlayerPlayAudioEventReason.PrevButton})}playPrevByMediaSession(){this._playPrevMarked({reason:pe.AudioPlayerPlayAudioEventReason.PrevMediaSession})}_playNextMarked({auto:e,reason:t}){this.playNext(e,t)}_playPrevMarked({reason:e}){this.playPrev(e)}playNext(e,t){this._playNext(1,e,t)}playPrev(e){this._playNext(-1,void 0,e)}_playNext(e,t,s){let a;if(this.ads.isActive)return;const l=this.getCurrentAudio(),r=this.getCurrentPlaylist(),n=this.getPlaylistQueue(),d=(e,o)=>{y.AudioUtils.isClaimedAudio(e)||this._playMarked({audio:e,playlist:r,context:!1,seq:o,autoNext:t,reason:s})};if(l&&r)if(e>0)n.getNextAudio(l,{ignoreClaimed:!0,repeat:this.isRepeatAll()&&!r.isInfinite()}).then((async e=>{if(e)d(e,1);else if(r.isLive())this._muteProgressEvents=!0,r.fetchNextLiveAudio((e=>{if(e){const t=this.getPlaylistQueue(),s=t.indexOfAudio(e);s>=0?t.moveAudio(s,t.length-1):t.addAudio(e)}d(e)}));else if(r.isLoadable()){try{a=await r.fetchNextAudio()}catch(e){return(0,ge.isAudioError)(e)&&e.type===Pe.AudioErrorType.Unauthorized?((0,o._)(this,Ce)[Ce](),!1):((0,A.logError)(e),this.stop(pe.AudioPlayerStopAudioEventReason.Error),!1)}if(a){if(!r.isFullyLoaded()||r.isInfinite()){this.getPlaylistQueue().addAudio(a)}r.isInfinite()&&this.getCurrentPlaylist().pushAudio(a)}d(a)}else n.getFirstAudio(!0).then((t=>{if(t){if(e=t,!this.isRepeatAll()){if(n.indexOfAudio(l)+1===n.length)return this.implTaskManager.seekImmediate(0),this.stop(s),void(y.AudioUtils.isClaimedAudio(e)||(this.setCurrentAudio(e),this._implSetUrl(this._currentAudio),this.updateCurrentPlaying(!0),this.notify(x.events.CURRENT_CHANGED),this.notify(x.events.UPDATE)))}d(e,1)}}))}));else{n.indexOfAudio(this._currentAudio)<1||this._impl.getCurrentTime()>5?this.seekByButton(0):n.getPrevAudio(l,{ignoreClaimed:!0}).then((e=>{e?d(e,-1):this.seekByButton(0)}))}}async getPrevAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getPrevAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getLastAudio(!0)}async getNextAudio(){const e=this.getPlaylistQueue(),t=this.getCurrentAudio();return t?e.getNextAudio(t,{ignoreClaimed:!0,repeat:this.isRepeatAll()}):e.getFirstAudio(!0)}adsGetCurrentProgress(){return this.ads.getCurrentProgress()}_podcastUpdateState(e,t,s,o,a){const l=ve._podcastGetStates(),r=Math.round(e.duration*t);l[e.fullId]={t:(0,I.vkNow)(),position:r},ve._podcastSetStates(l),o&&this._podcastSendLogs(o,e,s,r,a)}_podcastSendLogs(e,t,s,o,a){if(!t||!e||!y.AudioUtils.isPodcast(t)||cur._podcastsActionId&&cur._podcastsActionId[e]&&this._podcastsActionLastId[e]===cur._podcastsActionId[e])return;const l=this._podcastsActionRef[t.fullId]||{},r=l[e]||{};y.AudioUtils.PodcastsLogs.log(e,(0,b.extend)({audio:t,position:o,listen:s},r,a||{})),delete l[e],this._podcastsActionLastId[e]=cur._podcastsActionId?cur._podcastsActionId[e]:null}podcastSetActionRef(e,t,s,o){e=y.AudioUtils.audioTupleToAudioObject(e),t&&y.AudioUtils.isPodcast(e)&&(this._podcastsActionRef[e.fullId]=this._podcastsActionRef[e.fullId]||{},this._podcastsActionRef[e.fullId][t]={ref:s,refEl:o},cur._podcastsActionId=cur._podcastsActionId||{},cur._podcastsActionId[t]=(0,I.irand)(0,1e6))}toggleRadio(e,t){const s=this.getPlaylist(L.AudioPlaylist.TYPE_RADIO,t,L.AudioPlaylist.RADIO_PLAYLIST_ID),o=s.getAudiosList().find((t=>t[ie.EAudioTupleIndex.ID]===e));o&&(this.isPlaying()&&(0,oe.isRadio)(this._currentAudio)&&o[ie.EAudioTupleIndex.ID]===this._currentAudio[ie.EAudioTupleIndex.ID]?this.pauseByButton():this.playAudioItem({audio:o,playlist:s}))}_podcastCleanStates(){const e=ve._podcastGetStates();let t=!1;return(0,b.each)(e,((s,o)=>{Date.now()-o.t>2419200&&(delete e[s],t=!0)})),t&&ve._podcastSetStates(e),e}_podcastSaveData(e){const t=ve._podcastGetStates();(0,b.each)(e,((e,s)=>{const o=s.state;if(!o)return;const a=+o[1];(!t[e]||!t[e][1]||a&&a>t[e][1])&&(t[e]={position:+o[0],t:Date.now()})})),ve._podcastSetStates(t)}_podcastRestoreState(){const e=y.AudioUtils.audioTupleToAudioObject(this.getCurrentAudio());if(!y.AudioUtils.isPodcast(e))return 0;let t=0;if(cur.podcastSeekToTime)t=this._seekToTime({amount:cur.podcastSeekToTime,ref:cur.podcastSeekToTimeRef}),delete cur.podcastSeekToTime,delete cur.podcastSeekToTimeRef;else{t=((ve._podcastGetStates()[e.fullId]||{}).position||0)/e.duration,t&&t<1&&this.implTaskManager.seek(t)}return t&&t<1?(this.updateCurrentPlaying(),t):0}getCurrentFaveStatus(){return!!y.AudioUtils.isPodcast(this._currentAudio)&&y.AudioUtils.getAudioExtra(this._currentAudio).fave}_updatePlaybackRate(){const e=y.AudioUtils.isPodcast(this._currentAudio)||y.AudioUtils.isArticleTts(this._currentAudio),t=!this.ads.isActive&&e?ve.podcastGetPlaybackRate():1;this.implTaskManager.updatePlaybackRate(t)}podcastChangePlaybackRate(e){const t=ve._lsGet(ve.LS_PODCASTS)||fe;let s=t.rate||1;e?s-=ve.PLAYBACK_RATE_STEP:s+=ve.PLAYBACK_RATE_STEP,!e&&s>ve.PLAYBACK_RATE_MAX?s=1:e&&s<1&&(s=ve.PLAYBACK_RATE_MAX),t.rate=s,ve._lsSet(ve.LS_PODCASTS,t),fe=t,this._updatePlaybackRate()}playAudio(e){let t=L.AudioPlaylist.TYPE_TEMP;(0,ne.isArticleTts)(e)&&(t=L.AudioPlaylist.TYPE_ARTICLE_TTS);const s=new L.AudioPlaylist(t);s.mergeWith({list:[e]}),this.playAudioItem({audio:e,playlist:s})}updateAudioDislikeStatus(e,t){const s=this.getCurrentPlaylist()?.getAudiosList()?.find((t=>y.AudioUtils.getAudioFullId(t)===e));if(!s)return;let a={dislike:t};Boolean(s[ie.EAudioTupleIndex.EXTRA])&&(a=y.AudioUtils.mergeAudioExtra(y.AudioUtils.getAudioExtra(s[ie.EAudioTupleIndex.EXTRA]),a)),s[ie.EAudioTupleIndex.EXTRA]=a,Boolean(this._currentAudio)&&y.AudioUtils.getAudioFullId(this._currentAudio)===e&&(this._currentAudio[ie.EAudioTupleIndex.EXTRA]=a,this._saveStateCurrentAudio()),this.saveStateCurrentPlaylist(),(0,o._)(this,Te)[Te](s),this.notify(x.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE)}constructor(){Object.defineProperty(this,me,{value:be}),Object.defineProperty(this,Ce,{value:Le}),Object.defineProperty(this,Te,{value:Oe}),Object.defineProperty(this,Ie,{writable:!0,value:void 0}),this.ensureUrlReject=null,this.statsListener=null,this.myTrackerListener=null,this.mediascopeListener=null,(0,o._)(this,Ie)[Ie]=!1,this.isRestoreAudioPrevented=!1;const e=(0,n.ensureDIRootWebContainer)(),t=e.resolve(d.AudioApi);if(this.mediaFocusChannel=_.MediaFocus.ensure().createChannel("audio",{pause:()=>{this.pauseByChangeChannel()},resume:()=>{this.resume({reason:pe.AudioPlayerPlayAudioEventReason.ChannelAutoResume})}}),this._currentAudio=null,this._isPlaying=!1,this._isPaused=!1,this._prevPlaylist=null,this._currentPlaylist=null,this._playlists=[],this.subscribers=[],this._statusExport={},this._currentPlayingRows=[],this._podcastsActionRef={},this._podcastsActionLastId={},this._allowPrefetchNext=!0,this._specialProjectController=(0,q.partConfigEnabled)("audio_special_project_web")?de.SpecialProjectController.init(_e.showWebSpecialProjectModal,t):null,vk.isBanned)return;y.AudioUtils.debugLog("Player creation"),this.emitter=(0,pe.createAudioPlayerEventEmitter)(e),this.eventBus=new K.EventBus,this.audioPlayersSwitch=u.MediaPlayersSwitch.ensure(e),this.switchConnection=this.audioPlayersSwitch.connect({resume:({reason:e})=>{this.resume({reason:e})},pause:()=>{this.pauseByChangeChannel()},stop:()=>{this.stop()}}),this._playlistQueue=new S.PlaylistQueue(new te.FetchService,this.eventBus);const s=new M.WebPlayerAdapter(this,e.resolve(c.EmitterFactory));(0,q.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new he.AudioPlayerStatsListener(s)),(0,q.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new he.AudioPlayerMyTrackerListener(s,e.resolve(h.MyTracker))),(0,q.partConfigEnabled)("audio_mediascope")&&(this.myTrackerListener=new he.AudioPlayerMediascopeListener(s,e.resolve(p.Mediascope))),this.stats=new R.AudioStats(s),this.lyrics=new se.AudioLyricsProvider,this.ads=new B.AudioAds(this,ve.getVersion()),this.connectEvents(),(0,V.connectListenQueue)(),this._restoreVolumeState(),this._initImpl(),this._initEvents(),this._podcastCleanStates(),this._listenStatusExport(),(0,O.onDomReady)((()=>{const e=()=>{try{this.restoreState()}catch(e){ve._lsRemove(ve.LS_TRACK),ve._lsRemove(ve.LS_PL),(0,o._)(this,me)[me]()}y.AudioUtils.toggleAudioHQBodyClass(),this.updateCurrentPlaying()};window.ap?e():window.addEventListener(ye.AUDIO_PLAYER_INITED_EVENT,e,{once:!0})}));const a=new ee.WebMediaSessionAdapter(this);new Z.AudioMediaSession(a,this.mediaFocusChannel.mediaSession).init()}}function be(){(0,o._)(this,Ie)[Ie]||((0,o._)(this,Ie)[Ie]=!0,this.notify(x.events.STATE_INITIALIZED))}function Le(){this.stop(pe.AudioPlayerStopAudioEventReason.Error),J.Unauthorized.showMoreBox(null,0,z.UnauthorizedSourceType.AUDIO)}function Oe(e){const t=this.getPlaylistQueue(),s=t.indexOfAudio(e);-1!==s&&t.addToList([e],s,!0)}function De(e,t,s){let o=e.getContext("2d");o.clearRect(0,0,e.width,e.height),o.fillStyle=s;for(let e=0;e<4;e++){let s=2+12*t[e];o.fillRect(13+4*e,12-s+14,2,s)}}function Me(e){console.warn(`Missed stat event ${e}`)}ve.UNAUTH_FADE_TIME=.8,ve.LS_VER="v20",ve.LS_KEY_PREFIX="audio",ve.LS_PREFIX=ve.LS_KEY_PREFIX+"_"+ve.LS_VER+"_",ve.LS_STATUS_EXPORT=ve.LS_KEY_PREFIX+"_status_export",ve.LS_VOLUME="vol",ve.LS_PL="pl",ve.LS_TRACK="track",ve.LS_SAVED="saved",ve.LS_PROGRESS="progress",ve.LS_PODCASTS="podcasts",ve.LS_DURATION_TYPE="dur_type",ve.LS_UUID="uuid",ve.LS_ADS_CURRENT_DELAY="ads_current_delay_v4",ve.LS_SHOW_HQ_LABEL="_audio_show_hq_label",ve.PLAYBACK_RATE_STEP=.5,ve.PLAYBACK_RATE_MAX=g.browser.safari?2:3,ve.RADIO_OWNER_ID=100,ve.tabIcons={def:"/images/icons/favicons/fav_logo.ico",play:"/images/icons/favicons/fav_play.ico",pause:"/images/icons/favicons/fav_pause.ico"}},559998:(e,t,s)=>{s.d(t,{PlayableAudioListPlaylistAdapter:()=>B});var o=s(434518),a=s(763812),l=s(331635),r=s(327813),n=s(565752),d=s(116881),_=s(11549),u=s(604100),c=s(256827),h=s(924240),p=s(310047),A=s(950003),y=s(920765),g=s(552589),P=s(646259),E=s(326107),f=s(342443),w=s(708577),I=(0,a._)("_list"),m=(0,a._)("_getOwnerId"),C=(0,a._)("_getPlaylistId"),T=(0,a._)("_getBlockId"),v=(0,a._)("_getTitle"),b=(0,a._)("_getAccessRawId"),L=(0,a._)("_getAccessHash"),O=(0,a._)("_getType"),D=(0,a._)("_getContext"),M=(0,a._)("_getLoadable"),S=(0,a._)("_checkIsFullyLoaded"),R=(0,a._)("_checkIsInfinite"),U=(0,a._)("_ensureMusicTrackWithSaveTrackCode"),k=(0,a._)("_ensureAudio");class B{get list(){const e=(0,o._)(this,I)[I];return X(e)?e.items.map(((t,s)=>{const a=e.audioAt(s);return a?(0,o._)(this,U)[U](t,a):(0,y.createEmptyAudioTuple)({id:t.identity.id,ownerId:t.identity.ownerId,accessKey:t.identity.accessKey,trackCode:t.trackCode})})):e.head.map((e=>(0,o._)(this,k)[k](e)))}get length(){return(0,o._)(this,I)[I].head.length}get lastPlayedAudio(){return null}equals(e){return this.getSelf()===e.getSelf()}mergeWith(){}pushAudio(){}constructor(e){Object.defineProperty(this,m,{value:x}),Object.defineProperty(this,C,{value:N}),Object.defineProperty(this,T,{value:W}),Object.defineProperty(this,v,{value:K}),Object.defineProperty(this,b,{value:F}),Object.defineProperty(this,L,{value:j}),Object.defineProperty(this,O,{value:Y}),Object.defineProperty(this,D,{value:H}),Object.defineProperty(this,M,{value:V}),Object.defineProperty(this,S,{value:G}),Object.defineProperty(this,R,{value:$}),Object.defineProperty(this,k,{value:Q}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,U,{writable:!0,value:void 0}),this.getType=()=>this.type,this.getBlockId=()=>this.blockId,this.getPlaylistId=()=>this.playlistId||"",this.getOwnerId=()=>this.ownerId||"",this.getContext=()=>this.context,this.getFullId=()=>(0,o._)(this,I)[I].identity.fullId.toString()||"",this.getAudio=e=>this.list.filter((t=>e===(0,g.getAudioFullId)(t)))[0],this.getAudioIds=async()=>(0,o._)(this,I)[I].items.map((e=>(0,P.toAudioIds)((0,o._)(this,I)[I],e))),this.getAudios=()=>Promise.resolve(),this.getAudiosList=()=>this.list,this.isLive=()=>!1,this.isLoadable=()=>this.loadable,this.isFullyLoaded=()=>this.fullyLoaded,this.isInfinite=()=>this.infinite,this.getAudiosCount=()=>this.length,this.getNoConsecutivePlay=()=>!0,this.getId=()=>this.playlistId,this.setContext=e=>{this.context=e},this.isExpired=()=>!1,this.isReference=()=>!1,this.getSelf=()=>this,this.getIsFakeId=()=>!1,this.getAlbumId=()=>this.albumId,this.getAccessHash=()=>this.accessHash,this.hasMore=()=>!1,this.getOriginalPlaylistRawId=()=>this.originalPlaylistRawId,this.getTitle=()=>this.title,this.getTitleLang=()=>this.titleLang,this.getAudioAt=e=>{const t=(0,o._)(this,I)[I].audioAt(e);if(t)return(0,o._)(this,k)[k](t)},this.indexOfAudio=e=>{if(!e)return-1;let t=[];(0,E.isString)(e)?t=e.split("_"):!function(e){return(0,E.isObject)(e)}(e)?function(e){return(0,E.isArray)(e)}(e)&&(t=[e[f.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID],e[f.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]]):t=[e.ownerId,e.id];const s=this.getAudiosList();if(!s)return-1;for(let e=0,o=s.length;e<o;e++)if(s[e]&&t[0]==s[e][f.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]&&t[1]==s[e][f.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID])return e;return-1},this.asObject=()=>{let e={};e.type=this.getType()||p.PlaylistType.TYPE_TEMP,e.ownerId=this.getOwnerId(),e.albumId=this.getAlbumId(),e.accessHash=this.getAccessHash(),e.hasMore=this.hasMore(),e.nextOffset=0,e.title=this.getTitle(),e.titleLang=this.getTitleLang(),e.context=this.getContext(),e.originalPlaylistRawId=this.getOriginalPlaylistRawId(),e.expire=null,e.blockId=this.getBlockId();const t=this.getAlbumId();return this.getType()===p.PlaylistType.TYPE_PLAYLIST&&t&&parseInt(t)>0&&(e.originalPlaylistRawId=(0,o._)(this,b)[b]()),this.getType()===p.PlaylistType.TYPE_RADIO&&(e.list=this.getAudiosList()),e},this.fetchNextAudio=async()=>{if(!this.loadable)throw new Error("Cannot fetch next audio without loading the playlist (loadable === false).");let e=this.getAudiosCount();this.isFullyLoaded()&&(e=0);try{const t=await(0,o._)(this,I)[I].ensureAt(e);return(0,o._)(this,k)[k](t)}catch(e){throw n.AudioError.fromUnknownError(e)}},(0,o._)(this,U)[U]=(e,t)=>{const s=t.apiAudio;return(0,o._)(this,k)[k]({...t,apiAudio:{...s,track_code:e.trackCode}})},(0,o._)(this,I)[I]=e,this.playlistId=(0,o._)(this,C)[C](),this.ownerId=(0,o._)(this,m)[m](),this.albumId=this.playlistId,this.blockId=(0,o._)(this,T)[T](),this.type=(0,o._)(this,O)[O](),this.context=(0,o._)(this,D)[D](),this.loadable=(0,o._)(this,M)[M](),this.fullyLoaded=(0,o._)(this,S)[S](),this.infinite=(0,o._)(this,R)[R](),this.accessHash=(0,o._)(this,L)[L](),this.originalPlaylistRawId="",this.title=(0,o._)(this,v)[v](),this.titleLang="ru",(0,r.makeObservable)(this)}}function x(){const{identity:e}=(0,o._)(this,I)[I];return"ownerId"in e?e.ownerId.toString():null}function N(){const{identity:e}=(0,o._)(this,I)[I];return"id"in e?e.id.toString():""}function W(){return(0,d.isSpecificAudioList)((0,o._)(this,I)[I],_.AudioListType.CatalogMusicTrackList)?(0,o._)(this,I)[I].identity.id:""}function K(){const e=(0,o._)(this,I)[I];return"title"in e?e.title:""}function F(){const e=(0,o._)(this,L)[L]();return`${this.getOwnerId()}_${this.getAlbumId()}${e?`_${e}`:""}`}function j(){return X((0,o._)(this,I)[I])?(0,o._)(this,I)[I].identity.accessKey??"":""}function Y(){return(0,u.isSpecificMusicPlaylist)((0,o._)(this,I)[I],_.AudioListType.MusicAlbumPlaylist)?p.PlaylistType.TYPE_ALBUM:X((0,o._)(this,I)[I])?p.PlaylistType.TYPE_PLAYLIST:(0,d.isSpecificAudioList)((0,o._)(this,I)[I],_.AudioListType.Podcast)?p.PlaylistType.TYPE_TEMP:(0,d.isSpecificAudioList)((0,o._)(this,I)[I],_.AudioListType.MusicMix)?p.PlaylistType.TYPE_VKMIX:""}function H(){return(0,d.isSpecificAudioList)((0,o._)(this,I)[I],_.AudioListType.Podcast)?p.PlaylistSourceType.PODCAST:(0,d.isSpecificAudioList)((0,o._)(this,I)[I],_.AudioListType.MusicMix)?p.PlaylistSourceType.VKMIX:X((0,o._)(this,I)[I])?(0,o._)(this,I)[I].context.ref?(0,o._)(this,I)[I].context.ref:(0,u.isSpecificMusicPlaylist)((0,o._)(this,I)[I],_.AudioListType.MusicAlbumPlaylist)?p.PlaylistSourceType.ALBUM:(0,u.isSpecificMusicPlaylist)((0,o._)(this,I)[I],_.AudioListType.MusicUGCGroupPlaylist)&&(0,o._)(this,I)[I].isCurator?p.PlaylistSourceType.CURATOR:p.PlaylistSourceType.PLAYLIST:""}function V(){return(0,d.isSpecificAudioList)((0,o._)(this,I)[I],[_.AudioListType.MusicMix,...c.MusicPlaylistsTypes,_.AudioListType.GroupMusicTrackList])}function G(){return!(!this.isLoadable()||this.isInfinite())&&(!!X((0,o._)(this,I)[I])&&(e=(0,o._)(this,I)[I]).length===e.count);var e}function $(){return this.isLoadable()&&(0,o._)(this,I)[I].infinite}function Q(e){const{identity:t}=e;if(!e.apiAudio)throw new Error(`Audio with fullId ${t.fullId} was included in the audio list without contextual web audioplayer adapter-object`);return e.type===h.AudioType.Radio?(0,w.apiRadioToAudioTuple)(e.apiAudio):(0,A.apiAudioToAudioTuple)(e.apiAudio)}function X(e){return(0,u.isSpecificMusicPlaylist)(e)||(0,d.isSpecificAudioList)(e,_.AudioListType.GroupMusicTrackList)}(0,l.__decorate)([r.computed,(0,l.__metadata)("design:type",Array),(0,l.__metadata)("design:paramtypes",[])],B.prototype,"list",null)},130307:(e,t,s)=>{s.d(t,{PlayableAudioListPlaylistAdapter:()=>o.PlayableAudioListPlaylistAdapter});var o=s(559998)},646259:(e,t,s)=>{s.d(t,{toAudioIds:()=>r});var o=s(116881),a=s(11549),l=s(256827);function r(e,t){return(0,o.isSpecificAudioList)(e,a.AudioListType.CatalogMusicTrackList)?{access_key:"",audio_raw_id:"",track_code:""}:((0,o.isSpecificAudioList)(e,l.MusicPlaylistsTypes)&&function(e){e.identity.accessKey,e.identity.rawId,e.trackCode}(t),function(e){return{access_key:e.identity.accessKey||"",audio_raw_id:e.identity.rawId,track_code:e.context.trackCode}}(t))}},133377:(e,t,s)=>{s.d(t,{sendListenedData:()=>a});var o=s(192757);function a(e){return new Promise((t=>{const s={...e,act:"listened_data",impl:"html5",hash:e.hash,v:5,loc:window.nav?.strLoc};o.ajax.post("al_audio.php",s,{onDone:e=>{t(e)},onFail:()=>{t(null)}})}))}},123928:(e,t,s)=>{s.d(t,{followOwner:()=>l});var o=s(48711),a=s(547214);function l(e,t){window.ajax.post("/al_audio.php?act=follow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,a.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_FOLLOW)}})}},791969:(e,t,s)=>{s.d(t,{unfollowOwner:()=>l});var o=s(48711),a=s(547214);function l(e,t){window.ajax.post("/al_audio.php?act=unfollow_owner",{owner_id:e,hash:t},{onDone:()=>{(0,a.getAudioPlayer)().notify(o.events.MUSIC_OWNERS_UNFOLLOW)}})}},837075:(e,t,s)=>{s.d(t,{MusicPlaylistFollowing:()=>y});var o=s(434518),a=s(763812),l=s(517130),r=s(587423),n=s(228909),d=s(916533),_=s(708831),u=s(520365),c=(0,a._)("_authService"),h=(0,a._)("_followingService"),p=(0,a._)("_ref"),A=(0,a._)("_initFollowingServiceCache");class y{get isFollowed(){return(0,o._)(this,h)[h].isFollowed(this.originalIdentity)}get isPending(){return(0,o._)(this,h)[h].checkPending(this.followedIdentity??this.originalIdentity)}async activate(){await(0,o._)(this,h)[h].follow(this.originalIdentity,{ref:(0,o._)(this,p)[p]})}async deactivate(){const{followedIdentity:e}=this;if(!e)throw new Error("Not followed");await(0,o._)(this,h)[h].unfollow(e)}async toggle(){await this[this.isFollowed?"deactivate":"activate"]()}get identity(){return(0,_.mapPlaylistToMusicPlaylistIdentity)(this.playlist)}get originalIdentity(){const{identity:e,playlistOriginalIdentity:t}=this;return t??(0,o._)(this,h)[h].getOriginalIdentity(e)??e}get followedIdentity(){return(0,o._)(this,h)[h].getFollowedIdentity(this.originalIdentity)??this.playlistFollowedIdentity??null}get playlistOriginalIdentity(){const{identity:e}=this,{originalIdentity:t}=this.playlist;return t?E(t):e}get playlistFollowedIdentity(){return E(this.playlist.followedIdentity)}constructor(e){Object.defineProperty(this,p,{get:g,set:void 0}),Object.defineProperty(this,A,{value:P}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,h,{writable:!0,value:void 0}),this.playlist=e;const t=(0,u.ensureDIRootWebContainer)();(0,o._)(this,c)[c]=t.resolve(d.AuthService),(0,o._)(this,h)[h]=t.resolve(l.MusicService).playlistsFollowing,(0,o._)(this,A)[A]()}}function g(){return this.playlist.getBlockId()??null}function P(){const{identity:e,playlistOriginalIdentity:t,playlistFollowedIdentity:s,originalIdentity:a}=this;this.isFollowed||(0,o._)(this,h)[h].isUnfollowed(a)||(t&&t.fullId!==e.fullId&&e.ownerId===(0,o._)(this,c)[c].userId&&(0,o._)(this,h)[h].setCache(t,e),s&&t&&t.fullId!==s.fullId&&(0,o._)(this,h)[h].setCache(t,s))}function E(e){return e?new n.OwnedIdentity((0,r.toSpecificVersionMusicPlaylistIdentityData)(e)):null}},335825:(e,t,s)=>{function o(e){const t=`_audio_pl_${e?.getOwnerId?.()??""}_${e.getPlaylistId()}`;return`.${CSS.escape(t)}`}s.d(t,{getAudioListSnippetSelector:()=>o})},408129:(e,t,s)=>{async function o(e,t){if(!e)return t.trackCode;const s=await e.getAudioIds();return s?.find((e=>e?.audio_raw_id===t.fullId))?.track_code||t.trackCode}s.d(t,{getAudioTrackCodeFromPlaylist:()=>o})},235295:(e,t,s)=>{s.d(t,{onPlayNextPlaylist:()=>a});var o=s(810722);function a(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.LISTEN_NEXT_OUT)}},506377:(e,t,s)=>{s.d(t,{onPlayPlaylistShuffled:()=>a});var o=s(810722);function a(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.MIX_ALL_OUT)}},593441:(e,t,s)=>{s.d(t,{onSharePlaylistClick:()=>a});var o=s(810722);function a(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.SHARE_OUT)}},270582:(e,t,s)=>{s.d(t,{openPlaylistOwner:()=>a});var o=s(810722);function a(){(0,o.logSearchPlaylistClickOut)(o.SearchClickActionMap.OPEN_OWNER_OUT)}},222631:(e,t,s)=>{s.d(t,{RadiostationEventsHandling:()=>u});var o=s(170180),a=s(547214),l=s(785518),r=s(698113),n=s(127754),d=s(309410),_=s(9467);class u{connectFollowingEvents(){this.tq.setInteractiveHandler("Music/follow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,l.followRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs?.stationId))return;(0,_.partConfigEnabled)("enable_audio_radio_section_actions")?this.updateRadiostationActions(e.dataAttrs.stationId,"Music/unfollow_radiostation"):e.target.dataset.taskClick="Music/unfollow_radiostation";const{sourceInfo:t,navInfo:s,isFollowedRadiostationsBlock:o}=this.getLocationInfo(e.target),a={radioStationId:e?.dataAttrs?.stationId||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:s,sourceInfo:t};s?this.collector.logAddAudioToMyMusic(a):o?this.collector.logAddAudioToMyMusicInFollowed(a):this.collector.logAddAudioToMyMusicInFullList(a)}))}))}connectUnFollowingEvents(){this.tq.setInteractiveHandler("Music/unfollow_radiostation",(({payload:e})=>{e.dataAttrs&&e.dataAttrs.stationId&&e.dataAttrs.hash&&(0,r.unfollowRadiostation)(parseInt(e.dataAttrs.stationId,10),e.dataAttrs.hash).then((()=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs?.stationId))return;(0,_.partConfigEnabled)("enable_audio_radio_section_actions")?this.updateRadiostationActions(e.dataAttrs.stationId,"Music/follow_radiostation"):e.target.dataset.taskClick="Music/follow_radiostation";const{sourceInfo:t,navInfo:s,isFollowedRadiostationsBlock:o}=this.getLocationInfo(e.target),a={radioStationId:e?.dataAttrs?.stationId||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:s,sourceInfo:t};s?this.collector.logDeleteAudioFromMyMusic(a):o?this.collector.logDeleteAudioFromMyMusicInFollowed(a):this.collector.logDeleteAudioFromMyMusicInFullList(a)}))}))}connectPlayToggleEvent(){this.tq.setInteractiveHandler("Music/toggle_radio_play",(({payload:e})=>{if(!(e.target instanceof HTMLElement&&e.dataAttrs))return;const{stationId:t,playlistOwnerId:s}=e.dataAttrs;if(!t||!s)return;const o=(0,a.getAudioPlayer)();if(o&&o.toggleRadio(parseInt(t,10),parseInt(s,10)),!(0,_.partConfigEnabled)("enable_radiostation_play_event"))return;if(o.isPlaying()&&this.currentRadiostationId===t)return;const{sourceInfo:l,navInfo:r}=this.getLocationInfo(e.target),n={radioStationId:t||"0",radioPositionIndex:(0,d.getRadiostationIndexPosition)(e.target),navInfo:r,sourceInfo:l};this.currentRadiostationId=t,r?this.collector.logPlay(n):this.collector.logPlayFromList(n)}))}updateRadiostationActions(e,t){document.querySelectorAll(`.AudioRadiostationItem__actions--follow[data-station-id='${e}']`).forEach((e=>{e.dataset.taskClick=t}))}getLocationInfo(e){const t=e?.closest("[data-type=radiostations]")?.dataset?.id,s=document.querySelector(".ui_tab_sel")?.dataset?.sectionId,o=e?.closest(".CatalogBlock__followed_radiostations");return{sourceInfo:t,navInfo:s,isFollowedRadiostationsBlock:Boolean(o)}}constructor(){this.currentRadiostationId="";try{this.tq=(0,o.tq)(),this.collector=n.RadiostationStatCollector.ensure()}catch(e){return}this.connectFollowingEvents(),this.connectUnFollowingEvents(),this.connectPlayToggleEvent()}}},785518:(e,t,s)=>{s.d(t,{followRadiostation:()=>n});var o=s(708025),a=s(547214),l=s(48711),r=s(56522);function n(e,t){const s=new o.FetchService,n=r.AudioPageProxy.ensure().emitter;return s.followRadiostation(e,t).then((t=>{if(t){const t=(0,a.getAudioPlayer)();t&&t.notify(l.events.RADIOSTATION_FOLLOW,e),n.emit(r.AudioPageEventType.RadioStationFollowed)}}))}},309410:(e,t,s)=>{function o(e){let t=0;const s=e,o=s?.closest(`[data-id="${e.dataset.stationId}"]`),a=o?.closest(".ui_gallery__inner"),l=o?.closest(".CatalogBlock__itemsContainer--radiostations"),r=a?.querySelector(".AudioRadiostationAddButton")||l?.querySelector(".AudioRadiostationAddButton"),n=s?.closest(".ui_gallery__inner > *");return a&&n&&(t=[...a.children].indexOf(n)),l&&o&&(t=[...l.children].indexOf(o)),r&&(t-=1),t+1}s.d(t,{getRadiostationIndexPosition:()=>o})},698113:(e,t,s)=>{s.d(t,{unfollowRadiostation:()=>r});var o=s(708025),a=s(547214),l=s(48711);function r(e,t){return(new o.FetchService).unfollowRadiostation(e,t).then((t=>{if(t){const t=(0,a.getAudioPlayer)();t&&t.notify(l.events.RADIOSTATION_UNFOLLOW,e)}}))}},898726:(e,t,s)=>{s.d(t,{updateFaveStatusAfterFollow:()=>u});var o=s(347096),a=s(342443),l=s(863473),r=s(361761),n=s(512347),d=s(547214),_=s(48711);function u(e,t){const s=(0,d.getAudioPlayer)();s.getPlaylistsByType(l.AudioPlaylist.TYPE_RADIO).forEach((s=>{s.getAudiosList().forEach((s=>{s[a.EAudioTupleIndex.ID]===e&&c(s,t)}))})),Array.from(document.querySelectorAll(".audio_player_radio_station._audio_page_player")).forEach((s=>{const o=(0,r.getAudioFromEl)(s);o&&o[a.EAudioTupleIndex.ID]===e&&(c(o,t),s.dataset.audio=JSON.stringify(o))}));const n=s.getCurrentPlaylist();n&&n.getType()===l.AudioPlaylist.TYPE_RADIO&&s.saveStateCurrentPlaylist();const u=s.getCurrentAudio();(0,o.isRadio)(u)&&(c(u,t),s._saveStateCurrentAudio(),u[a.EAudioTupleIndex.ID]===e&&s.notify(_.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,t))}function c(e,t){const s=(0,n.getAudioExtra)(e);s&&s.fave!==t&&(s.fave=t,e[a.EAudioTupleIndex.EXTRA]=s)}},212849:(e,t,s)=>{s.d(t,{copyAudioLink:()=>a});var o=s(439398);async function a(e){const t=function(e){if(!new RegExp(/^\/?audio\-?\d+\_\-?\d+(\_[A-Za-z\d]+)*$/).test(e))return console.error("Invalid audio URL for audio pathname",e),null;try{return new URL(e,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio pathname",e),null}}(e);if(t)return(0,o.copyToClipboard)(t)}},362106:(e,t,s)=>{s.d(t,{copyAudioLinkByIdentity:()=>l});var o=s(439398),a=s(228785);async function l(e,t){if(!e?.id||!e?.ownerId)return void console.error("Invalid AudioIdentity object",e);const s=function(e){const t=(0,a.getAudioAccessId)(e),s=`audio${t}`;try{return new URL(s,window.location.origin).href}catch(t){return console.error("Invalid audio URL for audio identity",e),null}}({id:e.id,ownerId:e.ownerId,accessKey:e?.accessKey||t||void 0});return s?(0,o.copyToClipboard)(s):void 0}},892633:(e,t,s)=>{s.d(t,{toggleAddAudio:()=>a});var o=s(412203);function a(e,t,s=()=>{},a=""){const l=(0,o.ensureAudioPageService)();l.setUserId(window.vk.id),l.toggleAddAudioFx({audioEl:e,audio:t,onSuccess:s,audioRef:a})}},746232:(e,t,s)=>{s.d(t,{openUmaAudioInfoModal:()=>a});var o=s(917128);function a(e){(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions",id:e.id,owner_id:e.ownerId},{params:{width:1e3}})}},216725:(e,t,s)=>{s.d(t,{openUmaMusicPlaylistInfoModal:()=>a});var o=s(917128);function a(e){(0,o.showBox)("al_audio.php",{act:"get_uma_restrictions_album",playlist_raw_id:e.accessRawId},{params:{width:750}})}},853727:(e,t,s)=>{s.d(t,{unLogF:()=>o});const o=e=>Math.log(1+34*e)/Math.log(35)},885629:(e,t,s)=>{s.d(t,{MusicTrackLegacyService:()=>h});var o=s(434518),a=s(763812),l=s(331635),r=s(198983),n=s(924240),d=s(776114),_=s(292445),u=s(123856),c=(0,a._)("_cache");class h{provide(e){const t=(0,o._)(this,c)[c].get(e);if(t)return t;const s=(0,u.mapAnyAudioToAudioProvideParams)(e);if(!s)return null;if((0,_.isSpecificProvideAudioParams)(s,n.AudioType.MusicTrack)){const t=this.musicTrackLegacyProvider.provide(s);return(0,o._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.musicTrackLegacyProvider=e,(0,o._)(this,c)[c]=new WeakMap}}h=(0,l.__decorate)([r.scope.global(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[void 0===d.MusicTrackLegacyProvider?Object:d.MusicTrackLegacyProvider])],h)},126464:(e,t,s)=>{s.d(t,{PodcastEpisodeLegacyService:()=>h});var o=s(434518),a=s(763812),l=s(331635),r=s(198983),n=s(924240),d=s(597430),_=s(292445),u=s(123856),c=(0,a._)("_cache");class h{provide(e){const t=(0,o._)(this,c)[c].get(e);if(t)return t;const s=(0,u.mapAnyAudioToAudioProvideParams)(e);if(!s)return null;if((0,_.isSpecificProvideAudioParams)(s,n.AudioType.PodcastEpisode)){const t=this.podcastEpisodeLegacyProvider.provide(s);return(0,o._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.podcastEpisodeLegacyProvider=e,(0,o._)(this,c)[c]=new WeakMap}}h=(0,l.__decorate)([r.scope.global(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[void 0===d.PodcastEpisodeLegacyProvider?Object:d.PodcastEpisodeLegacyProvider])],h)},813818:(e,t,s)=>{s.d(t,{PreviewAudioPlayer:()=>v,PreviewAudioPlayerNotification:()=>T});var o=s(327813),a=s(93593),l=s(520365),r=s(823295),n=s(16913),d=s(333235),_=s(270920),u=s(9467),c=s(558863),h=s(290139),p=s(34119),A=s(48711),y=s(364804),g=s(326107),P=s(155838),E=s(953372);let f;const w=1.5,I={from:0,to:0},m={url:"",clip:I},C=e=>e/1e3,T={start:"audio_preview_start",stop:"audio_preview_stop",pause:"audio_preview_pause"};class v{get events(){return this.emitter.listenable}setCurrentPreview(e){this.audioPreviewsState.set(e.identity,e)}getCurrentPreview(e){return this.audioPreviewsState.get(e)||m}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("on_media_attachment_player_start","preview",(()=>{this.playing&&this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause)})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{!this.playing&&this.currentAudio?.url&&this.pausedByVideo&&(Date.now()-this.pausedByVideo<18e4&&this.play(this.currentAudio.identity,this.volume,E.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByVideo=null)})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,g.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{!this.playing&&this.pausedByStories&&this.currentAudio&&((0,g.vkNow)()-this.pausedByStories<18e4&&this.play(this.currentAudio.identity,this.volume,E.AudioPlayerPlayAudioEventReason.ChannelAutoResume),this.pausedByStories=null)}))):console.log("[PreviewAudioPlayer]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return f||(f=new v),f}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(T.start),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime(),o=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:o<0?E.AudioPlayerSeekEventReason.SliderBack:E.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:s,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e){if(null===e)return;let t=e.url||"";const s=this.getCurrentPreview(e.identity),o=s.clip?s.clip.from:I.from;await this.implPlay(t),this.fadeIn(1500),this.seek(o/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){if(this.currentAudio){const e=this.getCurrentPreview(this.currentAudio.identity);if(!e)return 0;if(e.clip){const{clip:t}=e;return C(t.to-t.from)}return 0}return 0}stop(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(T.stop),this.switchConnection.emit("stop"),this.setPlaybackTime(0),this.setStatusPreview(A.events.STOP_PREVIEW),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??E.AudioPlayerStopAudioEventReason.Unknown,progressTime:s})}resume(e){this._paused&&this.currentAudio&&this.currentAudio?.url&&this.play(this.currentAudio.identity,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(T.pause),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??E.AudioPlayerPauseAudioEventReason.Unknown,progressTime:s})}async play(e,t,s){this.setStatusPreview(A.events.PLAY_PREVIEW),this.volume=t||y.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:o,clip:a}=this.getCurrentPreview(e);if(this._timelinePosition=a?.from??0,o){this.seek(0),await this.implPlay(o),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:s??E.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}get progress(){return this._progress}get playbackTime(){return this._playbackTime}get statusPreview(){return this._statusPreview}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,P.toSnippetAudioData)(e);return t?{...t,type:a.AudioType.MusicSnippet}:null}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}setProgress(e){this._progress=e}setPlaybackTime(e){this._playbackTime=e}setPaused(e){this._paused=e}setStatusPreview(e){this._statusPreview=e}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,E.createAudioPlayerEventEmitter)((0,l.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this._progress=0,this._playbackTime=0,this._statusPreview=A.events.PLAY_PREVIEW,this._playbackDuration=0,this._timelinePosition=0,this.failedAudio=null,this.fading=!1,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.audioPreviewsState=new Map,this.switchConnection=r.MediaPlayersSwitch.ensure((0,l.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(E.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(E.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(A.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this.setPaused(!0),this.fading=!1,this.failedAudio||(this.notify(A.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this.setPaused(!0),this.fading=!1,this._playbackDuration=0,this.notify(A.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play"),this.setStatusPreview(A.events.PLAY_PREVIEW)},onBufferUpdate:e=>{e&&this.notify(A.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||(this.notify(A.events.END_PREVIEW,this.currentAudio),this.setStatusPreview(A.events.END_PREVIEW))},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(E.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(E.AudioPlayerStopAudioEventReason.Error),this.fallbackPlay(this.failedAudio)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const s=this.impl.getDuration();let o=I;this.listenedTime=t,this.currentAudio&&(o=this.getCurrentPreview(this.currentAudio.identity).clip??I),this.failedAudio&&(o=this.getCurrentPreview(this.failedAudio.identity).clip??I),s&&s-t<w&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const a=(o.to-o.from)/1e3,l=(r=e,n=s,Math.round(r*n));var r,n,d,_;if(this._playbackDuration=l,this._timelinePosition=(d=C(o.from),_=this._playbackDuration,d+_),this.currentAudio){const s=Math.round(C(o.from)+t);return this.setProgress(e),this.setPlaybackTime(s),void this.notify(A.events.PROGRESS_PREVIEW,e,s)}if(l&&l===this._playbackDuration)return;const u=l?l-o.from/100:0,c=u/a,h=Math.round(t);this.setProgress(e),this.setPlaybackTime(0),this.notify(A.events.PROGRESS_PREVIEW,c,h);u>o.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new p.EventBus,this.impl=new h.AudioPlayerHTML5(e),this.taskManager=new c.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,w),this.initEvents(),(0,u.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new _.AudioPlayerStatsListener(this)),(0,u.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new _.AudioPlayerMyTrackerListener(this,(0,l.ensureDIRootWebContainer)().resolve(n.MyTracker))),(0,u.partConfigEnabled)("audio_mediascope")&&(this.mediascopeListener=new _.AudioPlayerMediascopeListener(this,(0,l.ensureDIRootWebContainer)().resolve(d.Mediascope))),(0,o.makeAutoObservable)(this)}}},727874:(e,t,s)=>{s.d(t,{PreviewAudioPlayerEffector:()=>O});var o=s(93593),a=s(520365),l=s(823295),r=s(16913),n=s(333235),d=s(270920),_=s(9467),u=s(558863),c=s(290139),h=s(34119),p=s(48711),A=s(377103),y=s(364804),g=s(642688),P=s(326107),E=s(155838),f=s(953372);let w;const I=1.5,m={from:0,to:0},C={url:"",clip:m},T=e=>e/1e3,v="audio_preview_start",b="audio_preview_stop",L="audio_preview_pause";class O{get events(){return this.emitter.listenable}getCurrentPreview(e){return A.audioPreviewsService.$audioPreviewEntities.getState()[e]||C}initEvents(){const e=window.Notifier;e?(e.addRecvClbk("audio_start","preview",(()=>{this.playing&&(this.pausedByAudio=Date.now(),this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause)),this.pausedByAudio=null})),e.addRecvClbk("on_media_attachment_player_start","preview",(()=>{this.playing&&this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause)})),e.addRecvClbk("video_start","preview",(()=>{this.playing&&(this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByVideo=Date.now())})),e.addRecvClbk("video_hide","preview",(()=>{if(!this.playing&&this.currentAudio?.url&&this.pausedByVideo){if(Date.now()-this.pausedByVideo<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,f.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByVideo=null}})),e.addRecvClbk("logged_off","preview",(()=>{this.stop(),this.taskManager.clearAllTasks()})),e.addRecvClbk("stories_video_start","preview",(()=>{this.playing&&(this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.pausedByStories=(0,P.vkNow)())})),e.addRecvClbk("stories_video_end","preview",(()=>{if(!this.playing&&this.pausedByStories){if((0,P.vkNow)()-this.pausedByStories<18e4){const{url:e}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(e,this.volume,f.AudioPlayerPlayAudioEventReason.ChannelAutoResume)}this.pausedByStories=null}}))):console.log("[PreviewAudioPlayerEffector]: notifier has not found!")}sendLCNotification(e){const t=window.Notifier;t&&t.lcSend(e)}static ensure(){return w||(w=new O),w}resetFailedAudio(){this.failedAudio=null}setCurrentAudio(e){this._currentAudio=e}async implPlay(e){this.impl.preparePlay(),await this.taskManager.setUrl(e),this.taskManager.clearAllTasks(),await this.taskManager.play(),this.sendLCNotification(v),this._playing=!0}async seek(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime(),o=e-this.getCurrentProgress();await this.taskManager.seek(e),t&&this.emitter.emit("seek",{reason:o<0?f.AudioPlayerSeekEventReason.SliderBack:f.AudioPlayerSeekEventReason.SliderForward,audio:t,fromTime:s,progressTime:this.getCurrentProgressTime()})}async fallbackPlay(e,t){const[s,o]=e.split("_");let a=t||"";if(!a){const t=(0,g.ensureAudiosService)();await t.fetchAudiosFx([{ownerId:+s,id:+o}]);const l=t.$audioEntities.getState()[e];a=l?.url??""}const l=this.getCurrentPreview(`${s}_${o}`).clip.from;await this.implPlay(a),this.fadeIn(1500),this.seek(l/1e3)}fadeIn(e=300){this.taskManager.setVolume(this.volume,!0,e)}fadeOut(e=300){this.taskManager.setVolume(0,!0,e)}get previewLength(){const e=this.currentAudio?.fullId;if(e){const t=this.getCurrentPreview(e);if(!t)return 0;const{clip:s}=t;return T(s.to-s.from)}return 0}get playbackDuration(){return this._playbackDuration}get timelinePosition(){return this._timelinePosition}set timelinePosition(e){this._timelinePosition=e}stop(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime();this._playing=!1,this._currentAudio=null,this.impl.stop(),this.sendLCNotification(b),this.switchConnection.emit("stop"),t&&this.emitter.emit("stopAudio",{audio:t,reason:e??f.AudioPlayerStopAudioEventReason.Unknown,progressTime:s})}resume(e){if(!this._paused||!this.currentAudio?.url)return;const{url:t}=this.getCurrentPreview(this.currentAudio?.url||"");this.play(t,this.volume,e)}async pause(e){const t=this.getPlayingAudio(),s=this.getCurrentProgressTime();await this.taskManager.setVolume(0,!0),await this.taskManager.pause(),this.sendLCNotification(L),t&&this.emitter.emit("pauseAudio",{audio:t,reason:e??f.AudioPlayerPauseAudioEventReason.Unknown,progressTime:s})}async play(e,t,s){this.volume=t||y.DEFAULT_VOLUME,this.taskManager.setVolume(0,!1),this.resetFailedAudio();const{url:o,clip:a}=this.getCurrentPreview(e);if(this._timelinePosition=a?.from??0,o){this.seek(0),await this.implPlay(o),this.fadeIn(1500);const e=this.getPlayingAudio();e&&this.emitter.emit("playAudio",{audio:e,reason:s??f.AudioPlayerPlayAudioEventReason.AudioButton,progressTime:this.getCurrentProgressTime()})}}subscribe(e,t){this.eventBus.subscribe(e,t)}unsubscribe(e,t){this.eventBus.unsubscribe(e,t)}notify(e,...t){this.eventBus.emit(e,...t)}get currentAudio(){return this._currentAudio}get playing(){return this._playing}get paused(){return this._paused}getPlayingAudio(){const{currentAudio:e}=this;if(e&&(this.playing||this.paused)){let t=(0,E.toTrackedAudioData)(e);if(!t)return null;if(t.type!==o.AudioType.MusicTrack)throw new Error(`Invalid preview audio type: ${t.type}`);return{...t,type:o.AudioType.MusicSnippet}}return null}getVolume(){return this.volume}getListenedTime(){return this.listenedTime}isMarusiaTrack(){return!1}isRepeatAll(){return!1}isShuffledPlaylist(){return!1}isRepeatCurrentAudio(){return!1}getCurrentProgressTime(){const e=this.getPlayingAudio()?.duration||0;return this.getCurrentProgress()*e*1e3}getCurrentProgress(){return this.impl.getCurrentProgress()}constructor(){this.emitter=(0,f.createAudioPlayerEventEmitter)((0,a.ensureDIRootWebContainer)()),this._playing=!1,this._paused=!1,this.failedAudio=null,this.fading=!1,this._playbackDuration=0,this._timelinePosition=0,this.pausedByAudio=null,this.pausedByVideo=null,this.pausedByStories=null,this.listenedTime=0,this.switchConnection=l.MediaPlayersSwitch.ensure((0,a.ensureDIRootWebContainer)()).connect({resume:()=>{this.resume(f.AudioPlayerPlayAudioEventReason.ChannelAutoResume)},pause:()=>{this.pause(f.AudioPlayerPauseAudioEventReason.ChannelAutoPause),this.notify(p.events.SNIPPET_PLAYER_CHANGE_SOURCE)},stop:()=>{this.stop()}});const e={onPause:()=>{this._playing=!1,this._paused=!0,this.fading=!1,this.failedAudio||(this.notify(p.events.STOP_PREVIEW,this.currentAudio),this._playbackDuration=0,this._timelinePosition=0,this.switchConnection.emit("pause"))},onPlay:()=>{this._playing=!0,this._paused=!1,this.fading=!1,this._playbackDuration=0,this.notify(p.events.PLAY_PREVIEW,this.currentAudio),this.switchConnection.emit("play")},onBufferUpdate:e=>{e&&this.notify(p.events.PREVIEW_BUFFERED,this.currentAudio)},onEnd:()=>{this.failedAudio||this.notify(p.events.END_PREVIEW,this.currentAudio)},onFail:e=>{if(this.failedAudio)return this.resetFailedAudio(),void this.stop(f.AudioPlayerStopAudioEventReason.Error);this.failedAudio=this.currentAudio;this.currentAudio;this.stop(f.AudioPlayerStopAudioEventReason.Error);let t=this.failedAudio?.fullId??"";this.fallbackPlay(t,this.failedAudio?.url)},onCanPlay:()=>null,onProgressUpdate:(e,t)=>{const s=this.impl.getDuration();let o=m;this.listenedTime=t,this.currentAudio&&(o=this.getCurrentPreview(this.currentAudio.fullId).clip),this.failedAudio&&(o=this.getCurrentPreview(this.failedAudio.fullId).clip),s&&s-t<I&&!this.fading&&(this.fading=!0,this.fadeOut(1500));const a=(o.to-o.from)/1e3,l=(r=e,n=s,Math.round(r*n));var r,n,d,_;if(this._playbackDuration=l,this._timelinePosition=(d=T(o.from),_=this._playbackDuration,d+_),this.currentAudio){const s=Math.round(T(o.from)+t);return void this.notify(p.events.PROGRESS_PREVIEW,e,s)}if(l&&l===this._playbackDuration)return;const u=l?l-o.from/100:0,c=u/a,h=Math.round(t);Math.round(T(o.from)-t);this.notify(p.events.PROGRESS_PREVIEW,c,h);u>o.to/1e3&&(this.resetFailedAudio(),this.stop())},defaultVolume:0};this.eventBus=new h.EventBus,this.impl=new c.AudioPlayerHTML5(e),this.taskManager=new u.AudioTaskManager(this.impl),this.taskManager.setVolume(0,!0,I),this.initEvents(),(0,_.partConfigEnabled)("audio_player_stats_web")&&(this.statsListener=new d.AudioPlayerStatsListener(this)),(0,_.partConfigEnabled)("audio_my_tracker_web")&&(this.myTrackerListener=new d.AudioPlayerMyTrackerListener(this,(0,a.ensureDIRootWebContainer)().resolve(r.MyTracker))),(0,_.partConfigEnabled)("audio_mediascope")&&(this.mediascopeListener=new d.AudioPlayerMediascopeListener(this,(0,a.ensureDIRootWebContainer)().resolve(n.Mediascope)))}}},434484:(e,t,s)=>{s.d(t,{RadiostationLegacyService:()=>h});var o=s(434518),a=s(763812),l=s(331635),r=s(198983),n=s(924240),d=s(985015),_=s(292445),u=s(123856),c=(0,a._)("_cache");class h{provide(e){const t=(0,o._)(this,c)[c].get(e);if(t)return t;const s=(0,u.mapAnyAudioToAudioProvideParams)(e);if(!s)return null;if((0,_.isSpecificProvideAudioParams)(s,n.AudioType.Radio)){const t=this.radiostationLegacyProvider.provide(s);return(0,o._)(this,c)[c].set(e,t),t}return null}constructor(e){Object.defineProperty(this,c,{writable:!0,value:void 0}),this.radiostationLegacyProvider=e,(0,o._)(this,c)[c]=new WeakMap}}h=(0,l.__decorate)([r.scope.global(),(0,l.__metadata)("design:type",Function),(0,l.__metadata)("design:paramtypes",[void 0===d.RadiostationLegacyProvider?Object:d.RadiostationLegacyProvider])],h)},826020:(e,t,s)=>{s.d(t,{LegacyGlobalPlayerRef:()=>d});var o=s(331635),a=s(327813),l=s(198983),r=s(623238),n=s(547214);class d{get isInitialized(){return null!==this.current&&!this.isInitializing}get isInitializing(){return this._isInitializing}get current(){return this.player}getCurrentStrict(){if(!this.current)throw new Error("Player is not initialized");return this.current}init(){if(this.player)return;this.markInitializing();const e=(0,n.getAudioPlayer)();e?(this.setPlayer(e),this.unmarkInitializing()):(0,r.onModuleReady)("audio-player",(()=>{this.init()}))}setPlayer(e){this.player=e}markInitializing(){this._isInitializing=!0}unmarkInitializing(){this._isInitializing=!1}constructor(){this.player=null,this._isInitializing=!1,(0,a.makeAutoObservable)(this),this.init()}}d=(0,o.__decorate)([l.scope.global(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[])],d)},113454:(e,t,s)=>{s.d(t,{WebGlobalAudioPlayerImpl:()=>S});var o=s(331635),a=s(327813),l=s(198983),r=s(116881),n=s(924240),d=s(517130),_=s(604100),u=s(830443),c=s(645189),h=s(45734),p=s(48711),A=s(347096),y=s(566335),g=s(310047),P=s(950003),E=s(61170),f=s(349983),w=s(411004),I=s(931800),m=s(3357),C=s(771186),T=s(373967),v=s(201018),b=s(130307),L=s(885629),O=s(126464),D=s(434484),M=s(826020);class S{get isInitializing(){return this.playerRef.isInitializing}get currentAudio(){return this.state.currentAudio}get prevAudio(){return this.state.prevAudio}get playbackSpeed(){return this.state.playbackSpeed}get negativeDurationTypeEnabled(){return this.state.negativeDurationTypeEnabled}get currentSubChannel(){return this.state.currentSubChannel}get currentAudioIdentity(){return this.state.currentAudioIdentity}get currentListIdentity(){return this.state.currentListIdentity}get isPlaying(){return this.state.isPlaying}get isPaused(){return this.state.isPaused}get isEnded(){return this.state.isEnded}get isPending(){return this.state.isPending}get isShuffled(){return this.state.isShuffled}get progress(){return this.state.progress}get listenedTime(){return this.state.listenedTime}get bufferingProgress(){return this.state.bufferingProgress}get volume(){return this.state.volume}get duration(){return this.state.duration}get frequencyData(){return this.state.frequencyData}get repeat(){return this.state.repeat}isCurrentAudioList(e){return!!this.currentListIdentity&&(0,h.compareIdentities)(e,this.currentListIdentity)}async playAudio(e,t){await R(t);const s=function(e){if(!(0,T.isSpecificPlayableAudio)(e)||!e.apiAudio)throw new Error("Unplayable audio passed",{cause:{audio:e}});const t=(0,P.apiAudioToAudioTuple)(e.apiAudio);if(!t)throw new Error("Audio not exists");return t}(e);let o=this.adaptList(t);this.player.playAudioItem({audio:s,playlist:o,context:o.getContext()??""})}async playAudioList(e){await R(e);let t=this.adaptList(e);this.player.playPreparedPlaylist({playlist:t,context:t.getContext()??""})}updatePlaybackSpeed(){const e=e=>{const t=this.playbackSpeed;t!==e&&(this.player.podcastChangePlaybackRate(1!==e&&e<t),this.setPlaybackSpeed(v.AudioPlayer.podcastGetPlaybackRate()??1))};this.playbackSpeed<v.AudioPlayer.PLAYBACK_RATE_MAX?e(this.playbackSpeed+.5):e(1)}play(){this.player.playByButton()}pause(){this.player.pauseByButton()}resume(){this.player.resume()}stop(){this.player.stop()}playNext(){this.player.playNext()}playPrev(){this.player.playPrev()}toggleShuffle(){this.player.toggleShuffle()}setRepeat(e){this.player.setRepeatCurrentAudio("audio"===e),this.player.setRepeatCurrentAudio("queue"===e)}toggleNegativeDurationType(){this.player.toggleDurationType()}seek(e){this.player.seekByButton(e)}seekBySlider(e){this.player.seekBySlider(e)}updateVolume(e){this.player.setVolume(e)}setNextAudioListInQueue(e){if(!(0,r.isSpecificAudioList)(e))throw new Error("Unplayable audio list passed",{cause:{list:e}});const{identity:t}=e;this.player.playNextPlaylist(t.ownerId,t.id,t.accessKey)}adaptList(e){return this.checkIsCurrentAudioList(e)?this.player.getCurrentPlaylist():function(e){if(!(0,r.isSpecificAudioList)(e,T.PlayableAudioListTypes))throw new Error("Unplayable audio list passed",{cause:{list:e}});return new b.PlayableAudioListPlaylistAdapter(e)}(e)}get player(){return this.playerRef.getCurrentStrict()}init(){!this.initialized&&this.playerRef.current&&(this.initState(),this.connectEvents(),this.initialized=!0)}initState(){const{player:e}=this;this.setCurrentPlayableAudio(e.getCurrentAudioLs()||null),this.setPlaybackSpeed(v.AudioPlayer.podcastGetPlaybackRate()||1),this.setNegativeDurationTypeEnabled(v.AudioPlayer.getDurationType()),this.updateRepeat(),this.setIsPlaying(this.player.isPlaying()||!1),this.setIsPaused(this.player.isPaused()||!1),this.setIsShuffled(this.player.getPlaylistQueue()?.shuffled||!1),this.setProgress(this.player.getCurrentProgress()||0),this.setListenedTime(this.player.getListenedTime()||0),this.setBufferingProgress(this.player.getCurrentBuffered()||0),this.setVolume(this.player.getVolume()||0),this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList())}connectEvents(){const{player:e,musicDislikesService:t}=this;e.subscribe(p.AudioPlayerEventType.PLAYER_IS_PLAYING_CHANGED,(e=>{this.setIsPlaying(e),this.setIsPaused(!e),this.setIsEnded(!e)})),e.subscribe(p.AudioPlayerEventType.VOLUME,(e=>{this.setVolume(e)})),e.subscribe(p.AudioPlayerEventType.PROGRESS,((t,s)=>{this.setIsPending(!1),this.setProgress(e.ads?.isActive?e.ads.getCurrentProgress():t),this.setListenedTime(s),this.setDuration(s)})),e.subscribe(p.AudioPlayerEventType.BUFFERED,(t=>{this.setBufferingProgress(e.ads?.isActive?0:t)})),e.subscribe(p.AudioPlayerEventType.PAUSE,(()=>{this.setIsPlaying(!1),this.setIsPaused(!0)})),e.subscribe(p.AudioPlayerEventType.ENDED,(()=>{this.setIsPaused(!1),this.setIsEnded(!0),this.setIsPlaying(!1)})),e.on(this,p.AudioPlayerEventType.START_LOADING,(()=>{this.setIsPending(!0)})),e.on(this,p.AudioPlayerEventType.CAN_PLAY,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.ENDED,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.FAILED,(()=>{this.setIsPending(!1)})),e.on(this,p.AudioPlayerEventType.PLAYLIST_CLEARED,(()=>{this.updateRepeat(),this.setNegativeDurationTypeEnabled(v.AudioPlayer.getDurationType()),this.setPlaybackSpeed(v.AudioPlayer.podcastGetPlaybackRate()||1)})),e.subscribe(p.AudioPlayerEventType.PLAYBACK_QUEUE_SHUFFLED_UPDATED,(e=>{this.setIsShuffled(e)})),e.on(this,p.AudioPlayerEventType.UPDATE,(()=>{this.setNegativeDurationTypeEnabled(v.AudioPlayer.getDurationType())})),e.on(this,[p.AudioPlayerEventType.PLAY,p.AudioPlayerEventType.PLAY_REQUESTED,p.AudioPlayerEventType.CURRENT_RADIOSTATION_FOLLOW_STATUS_UPDATE,p.AudioPlayerEventType.CURRENT_AUDIO_DISLIKE_STATUS_UPDATE,p.AudioPlayerEventType.PLAYLIST_CLEARED,p.AudioPlayerEventType.CURRENT_CHANGED,p.AudioPlayerEventType.UPDATE],(e=>{this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList()),this.setCurrentPlayableAudio(e)})),e.subscribe(p.AudioPlayerEventType.PLAYLIST_CHANGED,(()=>{this.setCurrentPlayableAudioList(this.getCurrentPlayableAudioList())})),e.subscribe(p.AudioPlayerEventType.FREQ_UPDATE,(([e,t,s,o])=>{const{frequencyData:a}=this,l={};e!==a.amplitude&&(l.amplitude=e),t!==a.pitch&&(l.pitch=t),s!==a.modulation&&(l.modulation=s),o!==a.harmonics&&(l.harmonics=o),this.updateFrequencyData(l)})),t.events.on("activated",(({identity:t})=>{const s=this.currentAudioIdentity;if(!s||!(0,h.compareIdentities)(s,t))return;e.getCurrentAudio()&&s&&this.playNext()}))}getCurrentPlayableAudioList(){const e=this.player.getCurrentPlaylist();return e?e.getSelf():null}setSubChannel(e){this.state.currentSubChannel=e}setNegativeDurationTypeEnabled(e){this.state.negativeDurationTypeEnabled=e}setPlaybackSpeed(e){this.state.playbackSpeed=e}setCurrentAudio(e){this.state.currentAudio=e}setIsPlaying(e){this.state.isPlaying=e}setIsPaused(e){this.state.isPaused=e}setIsEnded(e){this.state.isEnded=e}setIsPending(e){this.state.isPending=e}setIsShuffled(e){this.state.isShuffled=e}setProgress(e){this.state.progress=e}setListenedTime(e){this.state.listenedTime=e}setBufferingProgress(e){this.state.bufferingProgress=e}setVolume(e){this.state.volume=e}setDuration(e){this.state.duration=e}updateFrequencyData(e){this.state.frequencyData={...this.state.frequencyData,...e}}setcurrentListIdentity(e){this.state.currentListIdentity=e}updateRepeat(){const{player:e}=this;return e.isRepeatCurrentAudio()?this.setRepeat("audio"):e.isRepeatAll()?this.setRepeat("queue"):this.setRepeat("none")}setCurrentAudioIdentity(e){this.state.currentAudioIdentity=e}clearCurrentAudios(e){e!==n.AudioType.MusicTrack&&(this.state.currentListIdentity=null)}clearcurrentListIdentity(){this.state.currentListIdentity=null}setCurrentPlayableAudio(e){if(!e)return this.clearCurrentAudios(),void this.setCurrentAudio(null);const{player:t}=this;return(0,y.isPodcast)(e)?(this.setSubChannel(T.GlobalAudioPlayerSubChannelType.Podcast),this.setCurrentAudioIdentity((0,C.mapAudioTupleToPodcastAudioIdentity)(e)),void this.setCurrentAudio(this.podcastEpisodeLegacyService.provide(e))):(0,A.isRadio)(e)?(this.setSubChannel(T.GlobalAudioPlayerSubChannelType.Radio),void this.setCurrentAudio(this.radiostationLegacyService.provide(e))):void(t.ads?.isActive?this.setSubChannel(T.GlobalAudioPlayerSubChannelType.Ads):(this.setCurrentAudio(this.musicTrackLegacyService.provide(e)),this.setSubChannel(T.GlobalAudioPlayerSubChannelType.MusicTrack),this.setCurrentAudioIdentity((0,m.mapAudioTupleToMusicAudioIdentity)(e))))}setCurrentPlayableAudioList(e){if(!e)return void this.clearcurrentListIdentity();let t=m.mapPlaylistToMusicPlaylistIdentity;switch(e.getType()){case g.PlaylistType.TYPE_VKMIX:t=m.mapPlaylistToMusicMixIdentity;break;case g.PlaylistType.TYPE_TEMP:if(e.getContext()===g.PlaylistSourceType.PODCAST){t=C.mapPlaylistToPodcastIdentity;break}if(e.getContext()===g.PlaylistSourceType.MESSAGE){t=E.mapPlaylistWithIdToSingleIdentity;break}default:(0,f.checkCatalogAudioListByPlaylist)(e)?t=w.mapPlaylistToCatalogAudioListIdentity:(0,I.checkAudioListPlaylistIdOnly)(e)&&this.userEnv.partConfigEnabled("feed_attachment_onmedia_audios_list")&&(t=E.mapPlaylistWithIdToSingleIdentity)}try{const s=t(e);s.fullId!==this.state.currentListIdentity?.fullId&&this.setcurrentListIdentity(s)}catch{this.clearcurrentListIdentity()}}checkIsCurrentAudioList(e){return!!this.currentListIdentity&&(0,h.compareIdentities)(e.identity,this.currentListIdentity)}constructor(e,t,s,o,l){this.musicTrackLegacyService=e,this.podcastEpisodeLegacyService=t,this.radiostationLegacyService=s,this.userEnv=l,this.playerRef=new M.LegacyGlobalPlayerRef,this.initialized=!1,this.state={negativeDurationTypeEnabled:!1,playbackSpeed:1,currentAudio:null,prevAudio:null,currentSubChannel:null,repeat:"none",isPlaying:this.playerRef.current?.isPlaying?.()||!1,isPaused:this.playerRef.current?.isPaused?.()||!1,isEnded:!1,isPending:!1,isShuffled:!1,progress:this.playerRef.current?.getCurrentProgress?.()||0,listenedTime:this.playerRef.current?.getListenedTime?.()||0,bufferingProgress:this.playerRef.current?.getCurrentBuffered?.()||0,volume:this.playerRef.current?.getVolume?.()||0,duration:this.playerRef.current?.getVolume?.()||0,currentListIdentity:null,currentAudioIdentity:null,frequencyData:{amplitude:0,pitch:0,modulation:0,harmonics:0}},this.reactionsAggregator=new u.ReactionsAggregator,this.musicDislikesService=o.dislikes,(0,a.makeAutoObservable)(this),this.init(),this.reactionsAggregator.reaction((()=>!this.initialized&&this.playerRef.current),(e=>{e&&this.init()}))}}async function R(e){(0,_.isSpecificMusicPlaylist)(e)&&await e.ensureItems()}S=(0,o.__decorate)([l.scope.global(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[void 0===L.MusicTrackLegacyService?Object:L.MusicTrackLegacyService,void 0===O.PodcastEpisodeLegacyService?Object:O.PodcastEpisodeLegacyService,void 0===D.RadiostationLegacyService?Object:D.RadiostationLegacyService,void 0===d.MusicService?Object:d.MusicService,void 0===c.UserEnv?Object:c.UserEnv])],S)},873832:(e,t,s)=>{s.d(t,{WebQueueListener:()=>a});var o=s(804383);class a extends o.QueueListener{connect(e){e&&this.listenQueueKey!==e.key&&(this.connected=!0,this.listenQueueKey=e.key,window.Notifier.addKey({key:e.key,ts:e.timestamp},((e,t)=>this.queueHandler(t))))}constructor(e){super(e)}}},769605:(e,t,s)=>{s.d(t,{voiceMessagePlayerLoader:()=>o});const o=()=>window.AudioMessagePlayer&&window.AudioMessagePlayer.loaded?Promise.resolve(window.AudioMessagePlayer):Promise.all([s.e(6550),s.e(1713)]).then(s.bind(s,989191)).then((()=>window.AudioMessagePlayer))},866195:(e,t,s)=>{s.r(t);var o=s(503969),a=s(385408),l=s(955542);const r={isSupport(){return!(!window.AudioContext||!(navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))},getAvailableMicrophones(){return o.AudioRecorder.isSupport()?o.AudioRecorder.getAvailableMicrophones():Promise.resolve([])},newRecorder(){return window.Promise||(window.Promise=Promise),new o.AudioRecorder},resample(e,t,s){return(0,a.fastResample)(e,t,s)},createVisualization:l.createVisualization};window.Speech=r},989191:(e,t,s)=>{s.r(t);var o=s(159240),a=s(956905),l=s(178009),r=s(385408),n=s(451306),d=s(591332);const _="audio-msg-track--transcriptToggle",u="audio-msg-track--transcript_on";let c=null;function h(e){let t=(0,l.geByClass)("audio-msg-track--wave-wrapper",e),s=0;for(let e=0;e<t.length;e++){try{s=parseInt(window.getComputedStyle(t[e],null).getPropertyValue("width"))}catch(o){s=parseInt(t[e].currentStyle.width)}if(s>0)break}return s}function p(e,t){t=Math.round(t),e.length!=t&&(e=(0,r.fastResample)(e,t));let s="",o=0;for(let t=0;t<e.length;t++)o=Math.floor(10*Number(e[t])*.95),0==o&&(o=.5),s+="M"+(3*t+1)+","+(10-o)+"v"+2*o+"Z";return`<svg class="audio-msg-track--wave" width="${3*e.length}px"><path d="${s}"></path></svg>`}function A(){let e=(0,l.geByClass)("audio-msg-track");for(let t=0;t<e.length;t++){let s=(0,l.attr)(e[t],"data-wave");(0,l.hasClass)(e[t],"audio-msg-player")&&t>0&&(s=(0,l.attr)(e[t-1],"data-wave"));let o=h(e[t]);if(s&&o){s=s.split(",");let a=(0,l.geByClass)("audio-msg-track--wave",e[t]),r=p(s,o/3);for(let e=0;e<a.length;e++){let t=(0,l.ce)("div",{innerHTML:r}).firstChild;a[e].parentNode.replaceChild(t,a[e])}}}}function y(){if(!c){const e='<div class="audio-msg-player audio-msg-track"><button class="audio-msg-track--btn"></button>'+(0,n.getTemplate)("sImAudioMsgPlayerASRToggle")+'<div class="audio-msg-track--duration"></div><div class="audio-msg-track--wave-wrapper"><div class="audio-msg-track--slider"></div></div></div>',t="audio-msg-track--with-asr-toggle",s="audio-msg-track--shortened";c=new o.VoiceMessagePlayer({onListened:e=>{window.AudioMessagePlayer.events.emit("listened",e)},voiceMessageHTML:e,onInit:(e,o)=>{e.classList.contains(t)&&o.classList.add(t),e.classList.contains(s)&&o.classList.add(s),e.querySelector(`.${_}`)?.classList.contains(u)&&o.querySelector(`.${_}`)?.classList.add(u),window.AudioMessagePlayer.events.emit("initialized",e)},onPlay:e=>{window.AudioMessagePlayer.events.emit("playing",e)},onPause:e=>{window.AudioMessagePlayer.events.emit("paused",e)},onEnd:e=>{window.AudioMessagePlayer.events.emit("finished",e)},onProgress:(e,t)=>{window.AudioMessagePlayer.events.emit("progress",e,t)},fcOnPause:e=>{window.AudioMessagePlayer.events.emit("fc_paused",e)}})}return c}(0,a.addEvent)(window,"orientationchange",(()=>setTimeout(A,500))),window.mail&&window.mail.onMessagesRepainted&&(window.onDOMReady(A),window.mail.onMessagesRepainted(A)),window.AudioMessagePlayer={loaded:!0,events:new d.default,togglePlay:function(e){let t=y(),s=t.attachTo(e);!0===s?t.play():s.then((()=>{t.play()}))},toggle:function(){y().toggle()},seek:function(e){y().seek(e)},detachPlayer:function(e){y().detach(e)},pauseGlobalMedia:function(){o.VoiceMessagePlayer.pauseGlobalMedia()},resumeGlobalMedia:function(){o.VoiceMessagePlayer.resumeGlobalMedia()},redrawWaves:A,getWave:p,toggleTranscript:function(e,t){(0,a.cancelEvent)(t),e.classList.toggle(u),this.events.emit("transcription_toggle",e)}}},225036:(e,t,s)=>{s.d(t,{WebMediaSessionAdapter:()=>o});class o{play(){return this.player.playByButton()}pause(){return this.player.pauseByMediaSession()}isPlaying(){const e=this.player.getCurrentPlaylist();return!!e?.isLive&&e.isLive()||!1}async getPrevAudio(){return this.player.getPrevAudio()}async getNextAudio(){return this.player.getNextAudio()}next(){return this.player.playNextByMediaSession()}prev(){return this.player.playPrevByMediaSession()}seek(e){return this.player.seekByButton(e)}getCurrentPlaylist(){return this.player.getCurrentPlaylist()}subscribe(e,t){return this.player.eventBus?.subscribe(e,t)}unsubscribe(e,t){return this.player.eventBus?.unsubscribe(e,t)}getCurrentAudio(){return this.player.getCurrentAudio()}getCurrentProgress(){return this.player.getCurrentProgress()}constructor(e){this.player=e,this.player.eventBus&&(this.subscriptions=this.player.eventBus.subscriptions),this.ads=this.player.ads}}}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{sourceFn(),window.stManager?.done?.("dist/api/widgets/chunks/audioplayer-lib.cc71be96.js")}catch(e){throw window.stManager?.fail?.("dist/api/widgets/chunks/audioplayer-lib.cc71be96.js",e),e}else sourceFn(),"undefined"!=typeof window&&window.stManager?.done?.("dist/api/widgets/chunks/audioplayer-lib.cc71be96.js");