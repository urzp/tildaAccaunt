function e(){"use strict";(self.webpackChunkvkweb=self.webpackChunkvkweb||[]).push([[14527],{891281:(e,t,n)=>{n.d(t,{FriendsFriendStatusStatusEnumNames:()=>o});const o={NOT_A_FRIEND:0,OUTCOMING_REQUEST:1,INCOMING_REQUEST:2,IS_FRIEND:3}},948179:(e,t,n)=>{n.d(t,{AdsEvents:()=>p});var o=n(957994),i=n(740342),r=n(754866),a=n(120517),s=n(392358),c=n(936241),l=n(983567),d=n(909436),u=n(374339);let g=[];const _=(0,i.debounce)((()=>{if(0===g.length)return;const e=g.splice(0,g.length);(0,o.api)("adsint.registerAdEvents",{events:JSON.stringify(e)}).catch((t=>{for(;e.length;)g.unshift(e.pop())}))}),1e3);const p={register:(e,t)=>{(e=>["like","unlike","share","music_pause","music_play","music_track_to_profile","music_playlist_to_profile","music_track_share","music_playlist_share","music_track_share_to_story","music_playlist_share_to_story","music_play_30s"].includes(e))(e)&&(e=>!!e)(t)&&(g.push({event_type:e,ad_data:t}),_())},handleShareEvent:(e,t,n)=>{const o=e&&(0,u.getAdAttribute)(e,"ad");if(!o||!t)return null;let i="share";0===t.indexOf("audio")&&(window.Wall&&Wall.triggerAdStat(e,"audio_click"),0===t.indexOf("audio_playlist")?i=2==n?"music_playlist_share_to_story":"music_playlist_share":0===t.indexOf("audio")&&(i=2==n?"music_track_share_to_story":"music_track_share")),p.register(i,o)}};(0,a.onDomReady)((()=>{const e="adsEvents",t=(0,l.getAudioPlayer)();if(!t||t.subscribers&&t.subscribers.filter((t=>t.context===e)).length>0)return;const n={[s.AudioPlayerEventType.PLAY]:"music_play",[s.AudioPlayerEventType.PAUSE]:"music_pause",[s.AudioPlayerEventType.MUSIC_AUDIOS_ADD]:"music_track_to_profile",[s.AudioPlayerEventType.MUSIC_PLAYLISTS_ADD]:"music_playlist_to_profile",[s.AudioPlayerEventType.PROGRESS]:"music_play_30s"},o=e=>{if(n[e]){const o=d.AudioUtils.audioTupleToAudioObject(t.getCurrentAudio());let i=o?document.querySelector("._audio_row_"+o.fullId+"."+d.AudioUtils.AUDIO_CURRENT_CLS):null;i||(i=function(e){const t="[data-attach-type='"+(e.album?c.ATTACH_TYPE.PLAYLIST:c.ATTACH_TYPE.AUDIO)+"']",n=e.album?"[data-owner-id='"+e.album[0]+"'][data-playlist-id='"+e.album[1]+"']":"[data-full-id='"+e.fullId+"']";return document.querySelector(".js-SecondaryAttachment"+t+n)}(o));const a=(0,r.domClosest)("post",i);let s=a&&(0,u.getAdAttribute)(a,"ad");s||(s=(e=>{if(!e)return null;const t=0===e.indexOf("feed:")?e.replace("feed:","post"):null,n=t&&document.getElementById(t);return n&&(0,u.getAdAttribute)(n,"ad")})(t._getPlayingContext())),s&&(window.Wall&&Wall.triggerAdStat(a,"audio_click"),p.register(n[e],s))}};let i=!1;t.on(e,s.AudioPlayerEventType.PLAY,(()=>o(s.AudioPlayerEventType.PLAY))),t.on(e,s.AudioPlayerEventType.PAUSE,(()=>o(s.AudioPlayerEventType.PAUSE))),t.on(e,s.AudioPlayerEventType.MUSIC_AUDIOS_ADD,(()=>o(s.AudioPlayerEventType.MUSIC_AUDIOS_ADD))),t.on(e,s.AudioPlayerEventType.MUSIC_PLAYLISTS_ADD,(()=>o(s.AudioPlayerEventType.MUSIC_PLAYLISTS_ADD))),t.on(e,s.AudioPlayerEventType.PROGRESS,(()=>{const e=t.getListenedTime();void 0!==e&&(e<30?i=!1:i||e>=30&&(i=!0,o(s.AudioPlayerEventType.PROGRESS)))}))}))},936241:(e,t,n)=>{n.d(t,{ATTACH_TYPE:()=>i,AttachPlayerEvents:()=>o});var o=function(e){return e.PLAY="attach-player-event-play",e}({}),i=function(e){return e.PLAYLIST="secondary-attach-playlist",e.AUDIO="secondary-attach-audio",e}({})},461506:(e,t,n)=>{n.d(t,{preservePositionBetween:()=>r});var o=n(581197),i=n(351118);function r(e,{scrollByImpl:t=window.scrollBy}={}){let n=e;return{start:(0,i.once)((function(e){e&&(n=e);const r=(0,o.getElementOffset)(n);return(0,i.once)((function(e){if(e&&(n=e),n.isConnected){const e=(0,o.getElementOffset)(n);t(0,e.top-r.top)}}))}))}}},16675:(e,t,n)=>{n.d(t,{makePendingRequestState:()=>o});const o=(e={})=>{const t=Object.create(null);return{cancel:e=>{const n=t[e];n?.abort(),delete t[e]},register:(n,o)=>{const i=t[n],r=(e=>void 0!==t[e]?.throttleTimerId)(n);if(i){if(r)return!1;console.warn(`Reactions pending request for key '${n}' wasn't unregistered, but has to be overwritten.\nPending request should be cancelled through .cancel() explicitly before .register()`),i.abort()}let a;t[n]={abort:o},void 0!==e?.throttleMs&&(a=((e,n)=>{const o=t[e];if(!o)return;o.throttleTimerId&&window.clearTimeout(o.throttleTimerId);const i=window.setTimeout((()=>{const n=t[e];n&&(n.throttleTimerId=void 0)}),n);return o.throttleTimerId=i,i})(n,e.throttleMs));return()=>{t[n]?.abort===o&&delete t[n],window.clearTimeout(a)}}}}},668275:(e,t,n)=>{n.d(t,{isDebugEnabled:()=>r});var o=n(469004);let i;const r=()=>(void 0!==i||(i=!!o.ls.get("reactions.debug_enabled")),i)},295673:(e,t,n)=>{n.d(t,{reactionLogError:()=>r});var o=n(298077);const i="reactions";function r({error:e,reportError:t=!1}){t&&(0,o.logError)(e,{environment:i}),console.error(e)}},673006:(e,t,n)=>{n.d(t,{BADGES_BOX_WIDTH:()=>o,BADGE_COMMENT_SELECTOR:()=>c,BADGE_IMAGE_SIZE_100:()=>d,BADGE_IMAGE_SIZE_20:()=>u,BadgesEventName:()=>a,BadgesEventRef:()=>r,BadgesObjectType:()=>s,DONUT_BADGE_ID:()=>l,LINK_TO_HELP_FOR_AUTHORS:()=>i});const o=640,i="/@authors-badges",r={TAB:"tab",SENDER_LIST:"sender_list",POST_BTN:"post_btn",COLLECTION_BLOCK:"collection_block",COLLECTON_ALL:"collecton_all",NOTIFICATION:"notification",PUSH:"push",PIN:"pin",COMMENT_IMG:"comment_img",COMMENT_LINK:"comment_link",PROFILE_DETAILS:"profile_details"},a={OPEN_BADGE:"open_badge",OPEN_BADGES_ALL:"open_badges_all"};var s=function(e){return e[e.WALL=11]="WALL",e}({});const c="BadgeComment",l=38,d=100,u=20},735786:(e,t,n)=>{n.d(t,{buildBadgesStackHtml:()=>g,buildHtmlAttributesString:()=>d,getBadgeImage:()=>l,getBadgesPlacementInPostActionStatusBarToUpdate:()=>u,openHelpPage:()=>p,updateNewPostHTMLForBadges:()=>_});var o=n(593159),i=n(796099),r=n(19589),a=n(866467),s=n(673006),c=n(897004);function l(e,t,n=!1){const{base_url:i,version:r}=e,a=r?`?${r}`:"";return!n&&(0,o.isRetina)()&&(t*=2),`${i}/${t}.png${a}`}const d=e=>Object.entries(e).reduce(((e,[t,n])=>{if(n){e+=` ${t}="${(0,o.escapeAttr)(String(n))}"`}return e}),""),u=(e,t,n)=>{const o={place:void 0},r=e.querySelector(`._like_wall${t}_${n}`);if(!r)return(0,i.badgesLogger)("Нет кнопки лайка"),o;const a=r.parentNode?.querySelector(".PostActionStatusBar");if(!a)return(0,i.badgesLogger)("Нет .PostActionStatusBar"),o;const s=a.querySelector(".BadgesStatusBar__badgesSendButton"),c=a.querySelector(".BadgesStack");return s||c?s?(o.element=s,o.place="button",o):(o.element=c,o.place="stack",o):((0,i.badgesLogger)('Нет ни стака значков, ни кнопки "Подарить"'),o)},g=({counters:e,badges:t,tqAttributes:n,withContainer:i,withLabel:s})=>{let c=0,l=0,u="";const g=r.colorScheme.isDarkScheme();if((e||[]).forEach((({type:e,badge_id:n,value:i})=>{if("total"===e)c=i;else if("badge"===e&&n&&l<3){l++;const e=t?.find((e=>e.id===n));if(e){const{image:t}=e,n=(0,o.isRetina)()?"stack28_light_2x.png":"stack28_light.png",i=(0,o.isRetina)()?"stack28_dark_2x.png":"stack28_dark.png",r=t.version?`?${t.version}`:"",a=`${t.base_url}/${n}${r}`,s=`${t.base_url}/${i}${r}`,c=d({src:g?s:a,class:"BadgesStackItem BadgesStack__item",alt:e.alt_text||"","data-src-light":a,"data-src-dark":s});u+=`<img ${c}>`}}})),c>0&&u){const e=s?(0,a.getLang)("groups_have_donuts_total",c):(0,a.getLang)("groups_wkview_donuts_total",c);let t=`\n      <div class="BadgesStack__inner" ${n}>\n        <div class="BadgesStack__items">${u}</div>\n        <span class="BadgesStack__counter">${e}</span>\n      </div>\n    `;if(i){t=`\n        <div data-onboarding-tooltip-container="true" id="badges_stack" class="BadgesStack" ${"data-exec='{\"BadgesStack/init\":[]}'"}>\n          ${t}\n        </div>\n      `}return t}return""},_=(e,t,n)=>{const o=n[2],[r,a]=o.split("_"),l=t?.wallTpl?.send_badge,d=function(e){const t=e[16];try{if(""===t)return{};const e=JSON.parse(t);return{donut_miniapp_url:e?.donut_miniapp_url}}catch{return(0,i.badgesLogger)("Event from queue about IS_DISABLED_FOR_OWNER is not json"),{}}}(n);return(0,c.isBadgesEnabled)()&&l&&(e.push(l),Object.assign(d,{badges_object_id:a,badges_object_owner_id:r,badges_object_type:s.BadgesObjectType.WALL,badges_event_ref:s.BadgesEventRef.POST_BTN})),d};const p=()=>{window.open(s.LINK_TO_HELP_FOR_AUTHORS,"_blank")}},796099:(e,t,n)=>{n.d(t,{badgesLogger:()=>i});var o=n(298077);const i=(e,t)=>{window.vk.dev&&console.log(t),(0,o.logError)(new Error(e),{environment:"badges"})}},897004:(e,t,n)=>{n.d(t,{isBadgesEnabled:()=>i,isBadgesRenderingEnabled:()=>r});var o=n(540462);const i=()=>(0,o.partConfigEnabled)("badges"),r=()=>(0,o.partConfigEnabled)("badges_rendering")},40103:(e,t,n)=>{n.d(t,{initOneTimeDonut:()=>c});var o=n(458840),i=n(545537),r=n(270959),a=n(866467);const s=51528700;function c(e){const t=new URL(e),c=new URL(`${t.origin}${t.hash.substring(1)}`).search,l=window.boxLayerBG,d=window.boxLayerWrap;return(0,o.showWiki)({w:`app${s}`,url_hash:c},!1,!1,{noLocChange:1,skipBoxesHide:1,queue:1,onLoaded:()=>{(0,i.addWkViewHideQueue)((function e(){l&&d&&(l.style.visibility="visible",d.style.visibility="visible",d.style.opacity="1"),(0,i.removeWkViewHideQueue)(e)})),l&&d&&(l.style.visibility="hidden",d.style.visibility="hidden",d.style.opacity="0")},onFail:()=>{(0,r.showFastBox)({title:(0,a.getLang)("global_error")},(0,a.getLang)("global_error_generic_reason"),(0,a.getLang)("global_close"))}}),new Promise(((e,t)=>{n._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",e),n._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",t)}))}n._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",window.VKWebAppCustomMessageExternalHandlersResolvePayment||null),n._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",window.VKWebAppCustomMessageExternalHandlersRejectPayment||null),n._dG("VKWebAppCustomMessageExternalHandlers",window.VKWebAppCustomMessageExternalHandlers||{}),window.VKWebAppCustomMessageExternalHandlers.VKWebAppDonutResult=e=>{const t=window.VKWebAppCustomMessageExternalHandlersResolvePayment,o=window.VKWebAppCustomMessageExternalHandlersRejectPayment;if(n._dG("VKWebAppCustomMessageExternalHandlersResolvePayment",null),n._dG("VKWebAppCustomMessageExternalHandlersRejectPayment",null),!t||!o)throw new Error("Payment resolver is undefined.");switch(e.status){case"success":t({requestData:e.request_data,data:e.data});break;case"processing":o();break;default:throw o(),new Error(`unexpected status: ${e.status}`)}}},870465:(e,t,n)=>{n.d(t,{getFeedEventSubtype:()=>r,getFeedInteractionItemType:()=>a});var o=n(317216),i=n(979707);function r(){return(0,i.isWkLayerOpened)()?o.FeedInteractionItemType.POST_MODAL:""}function a(){return(0,i.isWkLayerOpened)()?o.FeedInteractionItemType.POST_MODAL:o.FeedInteractionItemType.WALL_ITEM}},979707:(e,t,n)=>{n.d(t,{isWkLayerOpened:()=>o});const o=()=>Boolean(window.wkcur?.shown)},832677:(e,t,n)=>{n.d(t,{initJoinForm:()=>_});var o=n(683234),i=n(754866),r=n(246429),a=n(749284),s=n(560377),c=n(104522),l=n(314309),d=n(175661),u=n(952661);const g="join_form_sex";function _(e,t){const{from:n,bdateMonths:_,bdateYears:p,proceedAs:m,fbApp:b,fbState:v,fbLocale:w,ref:y,values:S={},onSignInClick:E,onNotNowClick:f}=t,I=window.cur.options||{},k=I.bday||0,A=I.bmonth||0,L=I.byear||0;let R;R="invite"===y?l.EventScreens.REGISTRATION_INVITE_CONFIRM:m?l.EventScreens.START_PROCEED_AS:"box"===y?l.EventScreens.START_BOX:l.EventScreens.START,window.cur.eventScreen=R,d.registrationItemStat.logEvent(l.RegistrationItemEventTypes.SCREEN_PROCEED,l.EventScreens.NOWHERE,R,{force:!0});const P=e.querySelector(".JoinForm__error"),h=e.querySelector('.JoinForm__textInput[name="first_name"]'),C=e.querySelector('.JoinForm__textInput[name="last_name"]'),T=e.querySelector(".JoinForm__birthdateDayInput"),B=e.querySelector(".JoinForm__birthdateMonthInput"),O=e.querySelector(".JoinForm__birthdateYearInput"),F=e.querySelector(".JoinForm__sex"),N=e.querySelectorAll(".JoinForm__sexRadio"),U=e.querySelector(".JoinForm__birthdate"),D=e.querySelector(".JoinForm__submitButton"),V=e.querySelector(".JoinForm__facebookLogin"),x=e.querySelector(".JoinForm__facebookLogin .FacebookLogin__button"),j=e.querySelector(".JoinForm__signIn"),W=e.querySelector(".JoinForm__notNowLink");let M,q,H;if(!h||!C||!D)return;const $=()=>{if(u.FlatButton.isLocked(D))return;const e={fname:h.value.trim(),lname:C.value.trim(),bday:M.val(),bmonth:q.val(),byear:H.val(),from:n,frm:1,event_screen:R};(0,i.isVisible)(F)&&(e.sex=Number((0,o.radioval)(g))||0),window.tooltips&&window.tooltips.hideAll();const t=(e,t)=>{e&&t&&window.Index.showRegTT(e,t)};P&&(P.innerHTML=""),window.ajax.post("join.php?act=start",e,{onDone:(e,n)=>{switch(e){case"first_name":return t(h,n),void(0,o.notaBene)(h);case"last_name":return t(C,n),void(0,o.notaBene)(C);case"sex_row":return(0,i.show)(F),void t(F,n);case"birthdate_row":return void t(U,n)}n&&(0,s.showMsg)(P,n,"error",!0)},showProgress:()=>u.FlatButton.lock(D),hideProgress:()=>u.FlatButton.unlock(D)})},G=()=>{const e=Number(M.val())||0,t=Number(q.val())||0,n=Number(H.val())||0,o=new Date(0);e&&o.setDate(e),t&&o.setMonth(t),n&&o.setFullYear(n),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.BDAY,o.getTime().toString())},J=function(){const e=window.cur;e.isJoinFieldDirty||(d.registrationItemStat.logEvent(l.RegistrationItemEventTypes.START_REG_TAP,e.eventScreen,void 0,{force:!0}),e.isJoinFieldDirty=!0)};if(d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.FIRST_NAME,h.value,!0),h.addEventListener("keyup",(()=>{J(),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.FIRST_NAME,h.value)})),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.LAST_NAME,C.value,!0),C.addEventListener("keyup",(()=>{J(),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.LAST_NAME,C.value)})),[h,C].forEach((e=>{(0,a.placeholderInit)(e),e.addEventListener("keydown",(e=>{10!==e.keyCode&&13!==e.keyCode||$()}))})),"index"!==y&&requestAnimationFrame((()=>(0,i.elfocus)(h))),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.BDAY,"",!0),M=new window.Dropdown(T,(0,c.generateDays)(L,A),{big_text:!0,multiselect:!1,zeroPlaceholder:!0,selectedItems:k,onChange:()=>{J(),G()}}),q=new window.Dropdown(B,_,{big_text:!0,multiselect:!1,zeroPlaceholder:!0,selectedItems:A,onChange:e=>{J(),G(),(0,c.updateDayDropdown)(H.val(),e,M,k)}}),H=new window.Dropdown(O,p,{big_text:!0,multiselect:!1,zeroPlaceholder:!0,selectedItems:L,onChange:e=>{J(),G(),(0,c.updateDayDropdown)(e,q.val(),M,k)}}),window.radioBtns[g]={els:[...N],val:0},d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.SEX,Number((0,o.radioval)(g)).toString(),!0),N.forEach((e=>{e.addEventListener("click",(()=>{const t=Number(e.dataset.sex);(0,o.radiobtn)(e,t,g),J(),d.registrationItemStat.logFieldInteraction(l.RegistrationFieldItemNames.SEX,t.toString())}))})),void 0!==S.sex){const t=S.sex,n=e.querySelector(`.JoinForm__sexRadio[data-sex="${t}"]`);n&&n.click()}if(D.addEventListener("click",(e=>{e.preventDefault(),$()})),b){const e=window.cur;e.fbApp=b,e.fbState=v,e.fbLocale=w,window.Index.fbCheck(b,"",V)}x?.addEventListener("click",(e=>{e.preventDefault(),window.Index.fbJoin("",x)})),j&&E&&j.addEventListener("click",E),W&&f&&W.addEventListener("click",f);const K=(0,r.curBox)();K&&K.setOptions({onClean:()=>{M&&M.destroy(),q&&q.destroy(),H&&H.destroy()}}),window.stManager.add([window.jsc("web/tooltips.js"),"tooltips.css"]).catch((()=>{}))}},753304:(e,t,n)=>{n.d(t,{stripPercentVars:()=>o});const o=e=>e.replace(/%[-\w]+%/g,"")},890332:(e,t,n)=>{function o(e){const t=e.match(/^([a-z_]+)([0-9\-_]+)$/);if(!t)return null;const[,n,o]=t;return{objectType:n,objectId:o}}n.d(t,{getElementLikeButtonCount:()=>c,getElementLikeButtonIcon:()=>l,getElementLikeButtonLabel:()=>d,isObjectTypeIsVideo:()=>a,isObjectTypeIsVideoOrClip:()=>s,likePostObjectId:()=>i,likeReplyObjectId:()=>r,parseLikeObjectId:()=>o});const i=e=>`wall${e}`,r=e=>`wall_reply${e}`,a=e=>["video","video_comment"].includes(e),s=e=>["video","clip"].includes(e),c=e=>e?.querySelector(".like_button_count, ._like_button_count")??void 0,l=e=>e?.querySelector(".like_button_icon, ._like_button_icon")??void 0,d=e=>e.querySelector(".like_button_label, ._like_button_label")??void 0},978265:(e,t,n)=>{n.d(t,{ATTR_USER_REACTION_ID:()=>o});const o="data-reaction-user-reaction-id"},536418:(e,t,n)=>{n.d(t,{getLastOwnReactionChangeTime:()=>A,setDataCurrentId:()=>L,updateReactionButtonContainerForCounts:()=>f,updateReactionButtonCounts:()=>k,updateReactionButtonForCurrentReaction:()=>I});var o=n(535130),i=n(898848),r=(n(581197),n(866467)),a=n(668275),s=n(369296),c=n(754866),l=n(939646),d=n(978265),u=n(525474),g=n(797596),_=n(66663),p=n(540462);const m="data-reaction-last-own-change-time",b="PostButtonReactions__icon--animationActive";const v="post_button";o.LottieManager.observer.ignoreGroup(v);const w=e=>{const t=e.__reactionIconAnimation?.player;t&&(t.destroy(),delete e.__reactionIconAnimation)},y=async(e,t,n,i)=>{if(!(e!==n.__reactionIconAnimation?.animationURL)&&e||(w(n),t.innerHTML="",n.classList.remove(b)),i&&e)try{const i=await o.LottieManager.loadAnimation({group:v,animationUrl:e,containers:[t],loop:!1,autoplay:!0});if(!i)return;i.addEventListener("firstFrame",(()=>{n.classList.add(b)})),i.addEventListener("loopComplete",(()=>{(0,p.partConfigEnabled)("feed_post_reactions_animation_fix")&&n.classList.remove(b),function(){const e=(0,_.getReactionConfig)();return!0===e?.animationShowStaticAfterEnd}()&&((0,p.partConfigEnabled)("feed_post_reactions_animation_fix")||n.classList.remove(b),w(n))})),i.addEventListener("destroy",(()=>{n.classList.remove(b)})),n.__reactionIconAnimation={player:i,animationURL:e}}catch{}},S=(e,t)=>{const n=e.querySelector('[data-section-ref="reactions-button-icon"]');if(!n)return;const{currentOption:o,isUserAction:i}=t;if(o.isReactionSet){const e=o.current,t=e?.imageMenuURL;n.style.backgroundImage=`url('${t}')`,n.setAttribute("aria-label",e?.title)}else{const e=o.default;n.style.backgroundImage="",e?.title&&n.setAttribute("aria-label",e?.title)}n.classList.toggle("PostButtonReactions__icon--custom",o.isReactionSet);{const e=o.isReactionSet?o.current.animationURL:void 0,t=(e=>{let t=e.querySelector(".PostButtonReactions__iconAnimation");return t||(t=(0,c.se)('<div class="PostButtonReactions__iconAnimation" data-section-ref="reactions-button-icon-animation"></div>'),e.appendChild(t),t)})(n);y(e,t,n,i)}},E=(e,t,n)=>{e.classList.toggle("PostButtonReactions--icon-active",t),e.classList.toggle("PostButtonReactions--active",t)},f=(e,t)=>{const n=!t||!(0,s.hasReactionsForCounts)(t);e.classList.toggle("PostBottomAction--empty",n)},I=(e,t,n,o)=>{const i=!(0,s.isReactionIdUnset)(t),c=((e,t)=>{let n,o=(0,s.getDefaultReaction)(e);if((0,s.isReactionIdUnset)(t)){if(o)return{isReactionSet:!1,default:o}}else{if(n=e.itemsById[t],n)return{isReactionSet:!0,current:n};console.error(new Error(`Missing reaction meta for ${t} in set '${e.id}'`))}return{_error:!0}})(n,t);"_error"in c||(S(e,{currentOption:c,isUserAction:o}),((e,t)=>{const{currentOption:n}=t,o=n.isReactionSet?n.current.titleColor:void 0,i=n.isReactionSet?n.current.backgroundColor:void 0,r={...o?{"--reaction-button-title-color-light":o.light,"--reaction-button-title-color-dark":o.dark}:{"--reaction-button-title-color-light":null,"--reaction-button-title-color-dark":null},...i?{"--reaction-button-background-color-light":i.light,"--reaction-button-background-color-dark":i.dark}:{"--reaction-button-background-color-light":null,"--reaction-button-background-color-dark":null}};Object.entries(r).forEach((([t,n])=>{e.style.setProperty(t,n)}))})(e,{currentOption:c}),((e,t)=>{const{currentOption:n}=t;let o="";o=n.isReactionSet?(0,r.langReplace)((0,r.getLang)("reactions_button_unset_reaction_title")||"",{reaction_name:n.current.title||""}):(0,r.langReplace)((0,r.getLang)("reactions_button_set_reaction_with_name")||"",{reaction_name:n.default.title||""})||(0,r.getLang)("reactions_button_title")||"",e.setAttribute("aria-label",o||"")})(e,{currentOption:c}),(0,u.isCounterEnabledForBtn)(e)||((e,t)=>{const n=e.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{currentOption:o}=t,i=o.isReactionSet?o.current.title:o.default.title;i?n.innerText=i:(0,a.isDebugEnabled)()&&console.log("reactions: setReactionNameTitle: missing title",o)})(e,{currentOption:c})),E(e,i),o&&function(e,t){e.setAttribute(m,String(t))}(e,Date.now())},k=(e,t,n,o,i)=>{const c=(0,u.getCounterForTitle)(e,t,o,i);if((0,u.isCounterEnabled)(c)&&(((e,t)=>{const n=e.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{counterForTitle:o}=t;if((0,u.isCounterAvailable)(o)){const e=o.buttonText;(0,l.animateCount)(n,e,{allowZero:o.allowZeroAnimation,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})}else(0,a.isDebugEnabled)()&&console.log("reactions: setReactionTitle: missing title",o)})(e,{counterForTitle:c}),o)){((e,t)=>{const n=(0,g.getClosestLikeBtnContainerElem)(e)?.querySelector('[data-section-ref="reactions-button-screen-reader-counter"]');if(!n)return;const o=(0,r.langNumeric)(t,(0,r.getLang)("reactions_n_reacted","raw")||"%s");n.innerText=o})(e,(0,s.calcCountersSum)(o))}},A=e=>{const t=e.getAttribute(m);if(t&&(0,i.isNumeric)(t))try{return new Date(Number.parseInt(t)).getTime()||void 0}catch(e){return void console.error(e)}};const L=(e,t)=>{e.setAttribute(d.ATTR_USER_REACTION_ID,(0,s.isReactionIdUnset)(t)?"":String(t))}},373502:(e,t,n)=>{n.d(t,{ReactionMenuTitleVariants:()=>r,TITLE_VARIANT_DEFAULT:()=>i,TitleVariantWithLikedUsers:()=>o});const o="WithLikedUsers",i=o,r=[o,"TitleOnly"]},163233:(e,t,n)=>{n.d(t,{ButtonStyleVariant:()=>o});const o={Post:"post",Reply:"reply"}},280720:(e,t,n)=>{n.d(t,{renderPreviewItems:()=>c});var o=n(351118),i=n(369296),r=n(754866),a=n(163233),s=n(66663);const c=(e,t,n,c,l)=>{const d=((e,t,n=!1)=>{let o=[];for(const t of Object.keys(e)){const n=(0,i.parseReactionId)(t);n.isValid&&e[n.value]>0&&o.push(n.value)}return o=o.sort(((t,n)=>(e[n]||0)-(e[t]||0))).slice(0,t),n&&o.reverse(),o})(t,3),u=e.querySelector(".ReactionsPreview__items"),g=(0,s.getReactionSet)(n),_=0===(0,i.calcCountersSum)(t),p='<div class="ReactionsPreviewItem ReactionsPreviewItem--stackOverlay %class%" style="background-image: url(\'%image_url%\');" aria-label="%title%"></div>';u&&g?(u.innerHTML=d.map((e=>{const t=g.itemsById[e];if(!t)return"";const n=(0,o.classNames)({"ReactionsPreviewItem--lite ReactionsPreviewItem--stackOverlayLite":l===a.ButtonStyleVariant.Reply,"ReactionsPreviewItem--post ReactionsPreviewItem--stackOverlayPost":l===a.ButtonStyleVariant.Post});return(0,r.rs)(p,{image_url:t.imagePreviewURL,title:t.title,class:n})})).join(""),e.classList.toggle("ReactionsPreview--empty",_),e.classList.toggle("ReactionsPreview--active",void 0!==c)):console.warn("Unable to render reaction previews",{itemsContainer:u,previewItemTemplate:p,reactionSet:g})}},857461:(e,t,n)=>{n.d(t,{isIntentPreviewHidden:()=>c,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewUseCurrent:()=>l,isVariantHidden:()=>r,isVariantInActionStatusBar:()=>i,parsePreviewVariant:()=>u,previewVisibilityIntentForVariant:()=>d,previewVisibilityUseCurrent:()=>a});var o=n(65150);const i=e=>e===o.PreviewVariantActionStatusBar,r=e=>e===o.PreviewVariantHidden,a={kind:"useCurrent"},s=e=>e.kind===o.PreviewVariantActionStatusBar,c=e=>e.kind===o.PreviewVariantHidden,l=e=>"useCurrent"===e.kind,d=e=>e?{kind:e}:a,u=e=>o.PreviewVariants.includes(e)?e:void 0},65150:(e,t,n)=>{n.d(t,{PreviewVariantActionStatusBar:()=>o,PreviewVariantHidden:()=>i,PreviewVariants:()=>r});const o="action_status_bar",i="hidden",r=[o,i]},865556:(e,t,n)=>{n.d(t,{REACTIONS_COUNTS_RESPONSE_FIELD:()=>c,SIZE_128:()=>s,SIZE_32:()=>i,SIZE_40:()=>r,SIZE_96:()=>a,SUPPORTED_OBJECT_TYPES:()=>o,WK_SECTION_PREFIX_REACTIONS:()=>l});const o={wall:"wall",wall_reply:"wall_reply"},i={width:32,height:32},r={width:40,height:40},a={width:96,height:96},s={width:128,height:128},c="reactions_counts",l="reactions"},101965:(e,t,n)=>{n.d(t,{reactionButtonSetReaction:()=>v,showReactedModal:()=>w,updateReactionsState:()=>b});var o=n(458840),i=n(888065),r=n(865556),a=n(857461),s=n(42858),c=n(349835),l=n(536382),d=n(927350),u=n(284667),g=n(574959),_=n(948179),p=n(153663),m=n(374339);const b=(e,{counts:t,isFromWkLayer:n,isPrimaryLikeButtonClick:o,isUserAction:i=!1,objectRaw:r,previewVisibility:a,reactionId:c,suggestSubscribe:l,isAfterWkLayerClose:d})=>{(0,s.triggerReactionsUpdate)(r,t,{id:c},{isFromWkLayer:n,isPrimaryLikeButtonClick:o,isUserAction:i,previewVisibility:a,suggestSubscribe:l,isAfterWkLayerClose:d})},v=(e,t,n,o,r,s)=>{if((0,d.isDebugEnabled)()&&console.log(`Change reaction for object ${n}: ${e}`),!(0,g.isValidEnvironment)())return;const v=(0,u.reactionsElemPayload)(r),w=v?.counts,y=((e,t,n)=>{const o={...e};return void 0!==t&&(o[t]=(o[t]||0)+1),void 0!==n&&(o[n]=Math.max(0,(o[n]||0)-1)),o})(v?.counts||(0,i.reactionCountsBrandWrap)({}),e,t),S=s?.isPrimaryLikeButtonClick,E=(0,c.isWkLayerWallPostOpen)(),f=(0,a.previewVisibilityIntentForVariant)(v?.previewVariant),I=(0,p.getTrackCodeFromPost)(r);((e,t,n)=>{window.cur&&(window.cur.lastInteractedPostReactionsPayload={counts:e,objectRaw:t,reactionId:n})})(y,n,e),b(r,{counts:y,isFromWkLayer:E,isPrimaryLikeButtonClick:S,isUserAction:!0,objectRaw:n,previewVisibility:f,reactionId:e}),(0,l.requestPostReactionSet)(e,n,o,{trackCode:I}).promise.then((t=>{const o=(0,l.validateLikesChangeResponse)(t),i=o?.userReaction;o&&void 0!==i&&b(r,{counts:o.counts,isFromWkLayer:E,isPrimaryLikeButtonClick:!1,isUserAction:!1,objectRaw:n,previewVisibility:f,reactionId:i.id,suggestSubscribe:o.suggestSubscribe});let a=n.replace("wall","post"),s=document.getElementById(a);if(s){let t=(0,m.getAdAttribute)(s,"ad");if(t){let n=void 0===e?"unlike":"like";_.AdsEvents.register(n,t)}}}),(e=>{e?.isAborted||b(r,{counts:w,isFromWkLayer:E,isPrimaryLikeButtonClick:!1,isUserAction:!1,objectRaw:n,previewVisibility:f,reactionId:t})}))};function w(e,t){!function(e){(0,o.showWiki)({w:e},!1,void 0,{queue:1})}(`${r.WK_SECTION_PREFIX_REACTIONS}_${e}/${t}`)}},536382:(e,t,n)=>{n.d(t,{requestGetReacted:()=>o.requestGetReacted,requestPostReactionSet:()=>i.requestPostReactionSet,validateLikesChangeResponse:()=>i.validateLikesChangeResponse});var o=n(932088),i=n(417363)},932088:(e,t,n)=>{n.d(t,{requestGetReacted:()=>r});var o=n(369296),i=n(761520);const r=e=>{const t={act:"reactions_get_reacted",object:e};return{promise:new Promise(((e,n)=>{i.ajax.post("/like.php",t,{onDone:t=>{const i=function(e){let t;if(!(0,o.isUnknownObject)(e))return t;const{reactedMenuStats:n}=e;n&&(t||(t={}),t={...t,reactedMenuStats:n});return t}(t);if(!i){const e=new Error("requestGetReacted: Invalid response");return console.error(e,t),void n(e)}e(i)},onFail:e=>(n({err:e}),!1)})}))}}},417363:(e,t,n)=>{n.d(t,{requestPostReactionSet:()=>g,validateLikesChangeResponse:()=>_});var o=n(16675),i=n(369296),r=n(761520),a=n(433409),s=n(246429),c=n(865556),l=n(711615),d=n(870465);const u=(0,o.makePendingRequestState)(),g=(e,t,n,o)=>{(o?.abortPendingRequests??!0)&&u.cancel(t);const i={act:"a_set_reaction",object:t,reaction_id:e,hash:n,wall:2,from:window.Likes?._getReference(t),track_code:o?.trackCode,event_subtype:(0,d.getFeedEventSubtype)()},c=new a.AjaxCancellationToken,g=new Promise(((e,t)=>{const n=r.ajax.post("like.php",i,{cancellationToken:c,onDone:n=>{if(n?.unauth_action_box)return l.UnauthActionBox.show(n.unauth_action_box),void t();n?.done_box&&(0,s.showDoneBox)("",{},n.done_box),e(n)},onFail:e=>{const o=(e=>{return"object"==typeof(t=e)&&null!==t&&"readyState"in t&&0===e.readyState;var t})(n);return t({err:e,isAborted:o}),!!o}})})),_=()=>{c.cancel()},p=u.register(t,_);return g.catch((()=>{})).finally((()=>{p&&p()})),{abort:_,promise:g}},_=e=>{if(void 0===e?.reactions_my)return void console.warn("Invalid reaction change response format",e);const t=e?.[c.REACTIONS_COUNTS_RESPONSE_FIELD]??void 0,n=e.reactions_my,o=e.suggest_subscribe;let r;return null===n?r={id:void 0}:(0,i.isValidReactionId)(n)&&(r={id:n}),{counts:t,userReaction:r,suggestSubscribe:o}}},927350:(e,t,n)=>{n.d(t,{ENABLED_IN_POST_REPLY:()=>i,isDebugEnabled:()=>o.isDebugEnabled});var o=n(668275);const i=!1},525474:(e,t,n)=>{n.d(t,{getCounterForTitle:()=>a,isCounterAvailable:()=>c,isCounterEnabled:()=>s,isCounterEnabledForBtn:()=>r});var o=n(369296),i=n(866467);const r=e=>!!e.getAttribute("data-reaction-button-text-is-counter");function a(e,t,n,a){if(!r(e))return{kind:"disabled"};if(!n)return{kind:"error"};const s=0!==(a?(0,o.calcCountersSum)(a):0);if(!(0,o.hasReactionsForCounts)(n))return{kind:"enabled",allowZeroAnimation:s,buttonText:""};const c=(0,o.calcCounters)(n,t),l=(0,o.calcCountersWeightedSum)(c);return{kind:"enabled",allowZeroAnimation:s,buttonText:(0,i.langNumeric)(l,"%s",!0)}}function s(e){return!!e&&"disabled"!==e.kind}function c(e){return"enabled"===e.kind}},446106:(e,t,n)=>{n.d(t,{addDataUpdateListener:()=>s,addReactionChooseListener:()=>l,emitDataUpdate:()=>c,emitReactionChoose:()=>d});var o=n(558137),i=n(825127);const r=(0,o.makeSharedState)("reactions-menu-events",(()=>({emitter:new i.default})),{version:0}),a=()=>r().emitter,s=(e,t)=>{const n=a(),o=`${e}:data_update`,i={[o]:t};return n.addListeners(i),()=>{n.removeListeners(i)}},c=(e,t)=>{a().emit(`${e}:data_update`,t)},l=(e,t)=>{const n=a(),o=`${e}:reaction_choose`,i={[o]:t};return n.addListeners(i),()=>{n.removeListeners(i)}},d=e=>{a().emit(`${e}:reaction_choose`)}},284667:(e,t,n)=>{n.d(t,{getPreviewVariantForLikeBtn:()=>p,reactionsElemPayload:()=>m,reactionsElemPayloadForBadges:()=>b,shouldReactionsPreviewBeVisible:()=>w,updateReactionsButtonForCounts:()=>E,updateReactionsPreview:()=>S,verifyPayloadForBadges:()=>v});var o=n(261910),i=n(369296),r=n(939646),a=n(866467),s=n(66663),c=n(797596),l=n(574959),d=n(857461),u=n(280720),g=n(978265);const _=e=>{const t=e.getAttribute("data-reaction-counts");if(null===t)return{};const n=t?(0,o.parseJSON)(t):void 0;return"object"==typeof n&&null!==n?n:void 0},p=e=>{const t=e.getAttribute("data-reaction-preview-variant");if(t)return(0,d.parsePreviewVariant)(t)},m=e=>{const t=e.getAttribute("data-reaction-target-object"),n=e.getAttribute("data-reaction-hash"),o=e.getAttribute("data-reaction-set-id");if(null===o)return;const r=e.getAttribute(g.ATTR_USER_REACTION_ID),a=r?(0,i.parseReactionIdOrUnset)(r):void 0,s=e.getAttribute("data-reaction-style-variant"),c=s&&(0,l.isValidButtonStyleVariant)(s)?s:void 0,d=e.getAttribute("data-reaction-menu-title-variant"),u=d&&(0,l.isValidButtonTitleVariant)(d)?d:void 0,m=p(e);return{counts:_(e),csrfHash:n,objectRaw:t,reactionSetId:o,styleVariant:c,titleVariant:u,userReactionId:a,previewVariant:m}},b=e=>({ref:e.getAttribute("data-badges-ref"),donutMiniappUrl:e.getAttribute("data-donut-miniapp-url"),showOnboarding:e.getAttribute("data-badges-show-onboarding")}),v=e=>{const{donutMiniappUrl:t}=e;return Boolean(t)},w=e=>(0,i.hasReactionsForCounts)(e),y=(e,{counts:t,countsPrevious:n,objectRaw:o,reactionId:l,reactionSetId:d,styleVariant:g})=>{const _=(0,s.getReactionSet)(d),p=(0,i.calcCounters)(t,_),m=(0,i.calcCountersWeightedSum)(p),b=(0,i.calcCountersSum)(t),v=n?(0,i.calcCountersSum)(n):0,w=(0,c.getPreviewElem)(o);w&&((0,u.renderPreviewItems)(w,t,d,l,g),((e,t,n,o)=>{const i=(0,a.langNumeric)(n,(0,a.getLang)("reactions_n_reacted","raw")||"%s",!0);e.setAttribute("aria-label",i);const s=e.querySelector('[data-section-ref="like-button-count"]')??void 0;if(!s)return;e.tt&&"object"==typeof e.tt&&(e.tt.shown||e.tt.showing||e.tt?.destroy?.());const c=(0,a.langNumeric)(t,"%s",!0);(0,r.animateCount)(s,c,{allowZero:0!==o,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})})(w,m,b,v))},S=(e,t)=>{const n=(0,c.getLikeBtnElem)(e),o=t.counts;n&&o?((e,t,n)=>{const o=m(e);o&&o.objectRaw&&y(0,{counts:t,countsPrevious:n,objectRaw:o.objectRaw,reactionId:o.userReactionId,reactionSetId:o.reactionSetId,styleVariant:o.styleVariant})})(n,o,t.countsPrevious):console.warn("Unable to update object reactions",{objectRaw:e,options:t})},E=(e,{counts:t})=>{const n=(0,c.getLikeBtnElem)(e);n&&((e,t)=>{e.setAttribute("data-reaction-counts",JSON.stringify(t))})(n,t)}},873780:(e,t,n)=>{n.d(t,{reactionLogError:()=>r});var o=n(295673),i=n(66663);const r=({error:e})=>{const t=(0,i.getReactionConfig)(),n=t?.reportJsErrors??!1;(0,o.reactionLogError)({error:e,reportError:n})}},797596:(e,t,n)=>{n.d(t,{getButtonContainer:()=>a,getClosestLikeBtnContainerElem:()=>i,getHiddenLikeBtn:()=>l,getLikeBtn:()=>c,getLikeBtnElem:()=>o,getLikeWrap:()=>r,getMenuMount:()=>s,getPreviewElem:()=>d});const o=e=>document.querySelector(`[data-section-ref="reactions-button"][data-reaction-target-object="${e}"]`)??void 0,i=e=>e.closest('[data-section-ref="reactions-button-container"]')??void 0,r=e=>{const t=o(e);if(t)return t.closest(".like_wrap")??void 0},a=e=>e.closest('[data-section-ref="reactions-button-container"]'),s=e=>e.querySelector('[data-section-ref="reactions-menu-mount"]')??null,c=e=>e.querySelector('[data-section-ref="reactions-button"]')??null,l=e=>e.querySelector('[data-section-ref="reactions-hidden-button"]')??void 0,d=e=>document.querySelector(`[data-section-ref="reactions-preview-items"][data-reaction-target-object="${e}"]`)},66663:(e,t,n)=>{n.d(t,{getReactionConfig:()=>p,getReactionSet:()=>g,storageAddSets:()=>u,storageSetConfig:()=>_});var o=n(558137),i=n(351118),r=n(369296),a=n(873780),s=n(865556),c=n(927350);const l=(0,o.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),d=(0,o.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),u=e=>{(0,c.isDebugEnabled)()&&console.log(e),Object.entries(e).forEach((([e,t])=>{const n=(0,r.validateReactionSetPayloaditems)(t,e);if(n)return void(0,a.reactionLogError)({error:n.error});const o=t.map((e=>({...e,title:(0,i.decodeHTMLEntities)(e.title)})));l().set(e,(0,r.prepareReactionMenuSet)(e,o,{imageMenuSize:s.SIZE_96,imagePreviewSize:s.SIZE_32,imageStoryPanelSize:s.SIZE_128,imageStoryPreviewSize:s.SIZE_40}))}))},g=e=>{const t=l().get(e);if(t)return t;{const t=new Error(`Reaction set not found: ${e}`);(0,a.reactionLogError)({error:t})}},_=e=>{(0,c.isDebugEnabled)()&&console.log(e);const t=(0,r.parseReactionMenuConfig)(e);t?d().config=t:console.warn("Reactions: invalid menu config passed",e)},p=()=>{const e=d()?.config;return e}},574959:(e,t,n)=>{n.d(t,{isValidButtonStyleVariant:()=>g,isValidButtonTitleVariant:()=>u,isValidEnvironment:()=>a,preloadImage:()=>s,usePrevious:()=>c,usePreviousRef:()=>l});var o=n(296540),i=n(373502),r=n(163233);const a=()=>"function"==typeof window.cur?.viewAsBox?(window.cur.viewAsBox(),!1):!(window.vk.widget&&!window.vk.id)||(window.Widgets?.oauth?.(),!1),s=e=>new Promise(((t,n)=>{const o=new Image;o.src=e,o.onload=()=>t(),o.onerror=()=>n()})),c=e=>{const t=(0,o.useRef)(e);return(0,o.useEffect)((()=>{t.current=e})),t.current},l=e=>{const t=(0,o.useRef)(e);return(0,o.useEffect)((()=>{t.current=e})),t},d=Object.values(r.ButtonStyleVariant),u=e=>i.ReactionMenuTitleVariants.includes(e),g=e=>d.includes(e)},165703:(e,t,n)=>{n.d(t,{isReactionsFullUpdatePayload:()=>r,reactionsCountsOnlyUpdatePayload:()=>a,reactionsCountsUpdatePayload:()=>i});var o=n(913080);const i=(e,t)=>({kind:o.PayloadKindFull,...e,reactionIdState:{reactionId:t.id}}),r=e=>e.kind===o.PayloadKindFull,a=e=>({kind:o.PayloadKindCountsOnly,...e})},913080:(e,t,n)=>{n.d(t,{PayloadKindCountsOnly:()=>o,PayloadKindFull:()=>i});const o="counts_only",i="counts_with_current_reaction"},42858:(e,t,n)=>{n.d(t,{triggerReactionsUpdate:()=>s});var o=n(890332),i=n(865556),r=n(903401),a=n(165703);const s=(e,t,n,s)=>{const c=(0,o.parseLikeObjectId)(e);c&&c.objectType===i.SUPPORTED_OBJECT_TYPES.wall&&c.objectId?(0,r.emitEvent)(r.WallDataEvents.post_reactions_counts_update,function(e,t,n,o){const i={counts:e,isFromWkLayer:t?.isFromWkLayer,isPrimaryLikeButtonClick:t?.isPrimaryLikeButtonClick,isQueueUpdate:t?.isQueueUpdate,isUserAction:t.isUserAction,postFullId:n.objectId,previewVisibility:t.previewVisibility,reactionIdState:o?{reactionId:o.id}:void 0,suggestSubscribe:t.suggestSubscribe,isAfterWkLayerClose:t.isAfterWkLayerClose};return o?(0,a.reactionsCountsUpdatePayload)(i,o):(0,a.reactionsCountsOnlyUpdatePayload)(i)}(t,s,c,n)):c&&c.objectType===i.SUPPORTED_OBJECT_TYPES.wall_reply&&c.objectId?(0,r.emitEvent)(r.WallDataEvents.reply_reactions_counts_update,{counts:t,replyFullId:c.objectId,reactionIdState:n?{reactionId:n.id}:void 0}):console.warn("Unsupported reactions object update",e)}},913054:(e,t,n)=>{n.d(t,{postRenderReactionsInit:()=>F,postWkViewReactionsListener:()=>N});var o=n(536418),i=n(351118),r=n(461506),a=n(754866),s=n(753304),c=n(890332),l=n(927350),d=n(284667),u=n(857461),g=n(797596),_=n(165703),p=n(44280),m=n(15874),b=n(349835),v=n(540462),w=n(446106),y=n(65150),S=n(66663),E=n(897004),f=n(101965),I=n(978265),k=n(558137),A=n(369296);const L=(e,t,n=window.cur?.wallTpl)=>{const o=n?.[e];if(o)return(0,s.stripPercentVars)((0,a.rs)(o,t));console.warn(`renderTemplate: missing template '${e}'`,n)},R=({isUserAction:e=!1},...t)=>{e?console.error(...t):(0,l.isDebugEnabled)()&&console.warn(...t)},P=e=>(0,E.isBadgesEnabled)()&&e.classList.contains("PostActionStatusBar--withBadges");const h=(e,t,{isActionStatusBarVisible:n,isReactionsPreviewVisible:o,positionTrackingEnd:r})=>{const s=((e,t)=>{const n=(0,g.getLikeWrap)(e);if(!n)return;const o=(0,m.getPostElem)(t,n),i=o?.querySelector('[data-section-ref="post-action-status-bar"]');if(i)return{actionStatusBar:i};const r=(0,b.isWkLayerWallPostOpen)()?window.wkcur?.wallTpl:window.cur?.wallTpl,s=(0,a.se)(L("post_action_status_bar",{class:"PostActionStatusBar--hidden"},r));return s?((0,v.partConfigEnabled)("feed_redesign_post_bottom_2023_enabled")?(0,a.domInsertAfter)(s,n):(0,a.domInsertBefore)(s,n),{actionStatusBar:s}):void 0})(e,t.postFullId);if(!s)return void R({},"Unable to init ActionStatusBar in post",t);const{actionStatusBar:c}=s;if(c.classList.toggle("PostActionStatusBar--hidden",!n),P(c)&&c.classList.toggle("PostActionStatusBar--withReactions",o),n&&!(0,g.getPreviewElem)(e)){const t=(0,a.se)(function(e,t,n={}){const o=(0,b.isWkLayerWallPostOpen)()?window.wkcur?.wallTpl:window.cur?.wallTpl,r=(0,i.classNames)({"ReactionsPreview--empty":!e,"ReactionsPreview--isInActionStatusBar":!!n.isInActionStatusBar});return L("post_reactions_preview",{class:r,object_raw:t},o)}(o,e,{isInActionStatusBar:!0}));if(P(c)){const e=c.querySelector(".PostActionStatusBar__leftInner");e&&e.prepend(t)}else c.prepend(t)}if(r){const t=(0,g.getLikeBtnElem)(e);r?.(t)}},C=e=>{if(!(e=>void 0!==e.counts)(e))return void R(e,"Counts is invalid or missing");const t=(0,c.likePostObjectId)(e.postFullId),n=(0,m.getPostElem)(e.postFullId,(0,g.getLikeWrap)(t));n||R(e,"Missing post element for reactions preview update",{payload:e,likeWrap:(0,g.getLikeWrap)(t)});const o=(0,g.getLikeBtnElem)(t);if(!o)return void R(e,"Unable to find reactions button",{likeObjectId:t});const i=(0,d.reactionsElemPayload)(o),r=i?.counts;T({elemPayload:i,likeBtnElem:o,likeObjectId:t,payload:e}),B({countsPrevious:r,likeBtnElem:o,likeObjectId:t,payload:e,postEl:n})},T=({elemPayload:e,likeBtnElem:t,likeObjectId:n,payload:i})=>{const{counts:r}=i;if(!!i.isQueueUpdate&&(e=>{const t=(0,o.getLastOwnReactionChangeTime)(e);if(!t)return!1;const n=t+1e4;return Date.now()<n})(t))(0,l.isDebugEnabled)()&&console.log("Ignoring reactions update from queue",i);else{if(e){const{counts:n,reactionSetId:a}=e,s=(0,S.getReactionSet)(a);if((0,_.isReactionsFullUpdatePayload)(i)){const e=i.reactionIdState.reactionId;s&&(0,o.updateReactionButtonForCurrentReaction)(t,e,s,i.isUserAction)}s&&((0,o.updateReactionButtonCounts)(t,s,i.isUserAction,r,n),(0,o.updateReactionButtonContainerForCounts)(t,r))}if((0,_.isReactionsFullUpdatePayload)(i)){const n=i.reactionIdState.reactionId;(0,o.setDataCurrentId)(t,n),i.isUserAction&&e?.objectRaw&&(0,w.emitDataUpdate)(e.objectRaw,{currentReactionId:n})}(0,d.updateReactionsButtonForCounts)(n,{counts:r})}},B=({countsPrevious:e,likeBtnElem:t,likeObjectId:n,payload:o,postEl:i})=>{const{counts:a,previewVisibility:s=u.previewVisibilityUseCurrent}=o,c=((e,t)=>{if((0,u.isIntentPreviewInActionStatusBar)(e))return{previewVariant:y.PreviewVariantActionStatusBar};if((0,u.isIntentPreviewHidden)(e))return{previewVariant:y.PreviewVariantHidden};if((0,u.isIntentPreviewUseCurrent)(e)){const e=(0,d.getPreviewVariantForLikeBtn)(t);if(e)return{previewVariant:e}}})(s,t);if(!c)return;if(o.isAfterWkLayerClose)return;if(o.isFromWkLayer&&!window.wkcur.shown)return;const{previewVariant:l}=c,g=(0,u.isVariantInActionStatusBar)(l),_=(0,d.shouldReactionsPreviewBeVisible)(a),p=(0,u.isVariantHidden)(l)||g&&!_;if(g){let e;o.isPrimaryLikeButtonClick&&!o.isFromWkLayer&&(e=(0,r.preservePositionBetween)(t).start());const a=_;(0,E.isBadgesEnabled)()||i?.classList.toggle("post--withActionStatusBar",a),h(n,o,{isActionStatusBarVisible:a,isReactionsPreviewVisible:_,positionTrackingEnd:e})}p||(0,d.updateReactionsPreview)(n,{counts:a,countsPrevious:e})},O=e=>{if(!l.ENABLED_IN_POST_REPLY)return!1;const{counts:t}=e;if(!t)return;const n=(0,c.likeReplyObjectId)(e.replyFullId);(0,d.updateReactionsPreview)(n,{counts:t,countsPrevious:void 0}),(0,d.updateReactionsButtonForCounts)(n,{counts:t})},F=()=>{let e=[(0,p.registerUniqueListener)("wall-post-action-status-bar",p.WallDataEvents.post_reactions_counts_update,C),(0,p.registerUniqueListener)("wall-reply-reactions-counts",p.WallDataEvents.reply_reactions_counts_update,O)];return{onDestroy:()=>{e.forEach((e=>{e()})),e=[]}}},N=(()=>{if(!(0,v.partConfigEnabled)("feed_wk_view_likes_sync_fix"))return()=>{};const e=(0,k.makeSharedState)("shared-post-wk-view-reactions-listener",(()=>({isLoaded:!1})),{version:0});return()=>{e().isLoaded||(e().isLoaded=!0,(0,b.handleWkViewCloseEvent)((()=>{setTimeout((()=>{const e=window.cur.lastInteractedPostReactionsPayload;if(!e)return;const t=(0,g.getLikeBtnElem)(e.objectRaw);if(!t)return;const n=e.objectRaw,o=e.reactionId,i=(0,d.reactionsElemPayload)(t),r=i?.counts,a=e.counts,s=t?.getAttribute(I.ATTR_USER_REACTION_ID);if(void 0!==a&&(0,A.areCountersEqual)(r,a)&&o===s)return;const c=(0,b.isWkLayerWallPostOpen)(),l=(0,u.previewVisibilityIntentForVariant)(i?.previewVariant);(0,f.updateReactionsState)(t,{counts:a,isFromWkLayer:c,isPrimaryLikeButtonClick:!0,isUserAction:!0,objectRaw:n,previewVisibility:l,reactionId:o,isAfterWkLayerClose:!0})}),100)})))}})()},711615:(e,t,n)=>{n.d(t,{UnauthActionBox:()=>d});var o=n(314309),i=n(317216),r=n(412573),a=n(270959),s=n(351118),c=n(517673),l=n(832677);const d={show:function(e,t={}){const{onHide:n,onLogin:d}=t,u=e.withForm,g=new a.MessageBox({title:"",width:u?796:450,hideButtons:!0,containerClass:(0,s.classNames)("UnauthActionBoxContainer",{"UnauthActionBoxContainer--form":u}),onHide:()=>{n&&n()}});g.content(e.html),g.changed=!0;const _=g.bodyNode.querySelector(".UnauthActionBox__close"),p=g.bodyNode.querySelector(".UnauthActionBox__join"),m=g.bodyNode.querySelector(".UnauthActionBox__login"),b=t=>{o.marketingTransitionItemStat.logEvent(i.MarketingTransitionItemCampaignType.UNAUTH_ACTION_BOX,t,e.action,window.location.href)};_?.addEventListener("click",(()=>{b(i.MarketingTransitionItemEventType.CLOSE),g.hide()})),p?.addEventListener("click",(()=>{b(i.MarketingTransitionItemEventType.CLICK_SIGN_UP),(0,r.showJoinBox)(e.action)})),m?.addEventListener("click",(()=>{b(i.MarketingTransitionItemEventType.CLICK_SIGN_IN),d?d():(0,r.showQuickLoginBox)(e.action)})),b(i.MarketingTransitionItemEventType.OPEN),g.show();const v=g.bodyNode.querySelector(".LoginCombinedBox"),w=g.bodyNode.querySelector(".JoinForm"),y=e=>{e.preventDefault(),b(i.MarketingTransitionItemEventType.CLOSE),g.hide()};return g.bodyNode.querySelectorAll(".LoginBox").forEach((e=>{(0,c.initLoginBoxForm)(e)})),g.bodyNode.querySelectorAll(".LoginBox__notNow").forEach((e=>{e.addEventListener("click",y)})),g.bodyNode.querySelectorAll(".JoinForm__signIn, .LoginRecentBox__alternative").forEach((e=>{e.addEventListener("click",(()=>{b(i.MarketingTransitionItemEventType.CLICK_SIGN_IN)}))})),g.bodyNode.querySelectorAll(".LoginBox__buttonSignUp").forEach((e=>{e.addEventListener("click",(()=>{b(i.MarketingTransitionItemEventType.CLICK_SIGN_UP)}))})),v?(0,c.initLoginCombinedBoxForm)(v,e.formOptions):w&&(0,l.initJoinForm)(w,{...e.formOptions,onSignInClick:()=>{(0,r.showQuickLoginBox)()},onNotNowClick:y,ref:"box"}),requestAnimationFrame((()=>window.tooltips&&window.tooltips.hideAll())),g}}},903401:(e,t,n)=>{n.d(t,{WallDataEvents:()=>r,emitEvent:()=>d,registerNonGlobalNonUniqueListener:()=>l,registerUniqueListener:()=>c});var o=n(558137),i=n(825127);const r={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update",post_subscribe_update:"wall/post_subscribe_update"},a=(0,o.makeSharedState)("wall-data",(()=>({emitter:new i.default,keyedListeners:Object.create(null)})),{version:0}),s=(e,t,n)=>{const o=a(),i=o.keyedListeners?.[e]?.[t];return i&&o.emitter.removeListener(e,i),((e,t,n)=>{const o=a();return o.emitter.addListener(e,n),o.keyedListeners[e]={...o.keyedListeners[e],[t]:n},()=>{o.emitter.removeListener(e,n);const i=o.keyedListeners[e]?.[t];i===n&&delete o.keyedListeners[e]?.[t]}})(e,t,n)},c=(e,t,n)=>s(t,e,n),l=(e,t)=>((e,t)=>{const n=a();return n.emitter.addListener(e,t),()=>{n.emitter.removeListener(e,t)}})(e,t),d=(e,t)=>{a().emitter.emit(e,t)}},44280:(e,t,n)=>{n.d(t,{WallDataEvents:()=>o.WallDataEvents,registerUniqueListener:()=>o.registerUniqueListener});var o=n(903401)},655758:(e,t,n)=>{n.d(t,{ProductionStats:()=>a});var o=n(331635),i=n(132028),r=n(422057);class a extends r.AnalyticsStats{getLastEvent(){return this.lastEvent}send(e,t){const n={...e,id:this.getIntId(),prev_id:this.getLastEvent()?.id,prev_nav_id:this.getIntId()??0,prev_event_id:this.getLastEvent()?.prev_nav_id??0,timestamp:this.getCurrentTime(),url:window.location.href};this.analytics.sendProductionStats(n,t),this.lastEvent=n}}a=(0,o.__decorate)([i.scope.global()],a)}}])}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{e(),window.stManager?.done?.("dist/web/chunks/6069d9a3.2d51e0cf.js")}catch(e){throw window.stManager?.fail?.("dist/web/chunks/6069d9a3.2d51e0cf.js",e),e}else e(),"undefined"!=typeof window&&window.stManager?.done?.("dist/web/chunks/6069d9a3.2d51e0cf.js");