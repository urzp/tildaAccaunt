(()=>{"use strict";var __webpack_modules__={3604:(e,t,i)=>{i.d(t,{BaseSexEnumNames:()=>r});const r={UNKNOWN:0,FEMALE:1,MALE:2}},793766:(e,t,i)=>{i.d(t,{FriendsFriendStatusStatusEnumNames:()=>r});const r={NOT_A_FRIEND:0,OUTCOMING_REQUEST:1,INCOMING_REQUEST:2,IS_FRIEND:3}},74675:(e,t,i)=>{function r(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="#fff" d="m6.55 5.05 4.77 2.64a.35.35 0 0 1 0 .62l-4.77 2.64a.37.37 0 0 1-.5-.13.34.34 0 0 1-.05-.17v-5.3A.36.36 0 0 1 6.37 5c.06 0 .12.02.18.05Z"/></svg>',name:"play_marusia_foreground_16"}}i.d(t,{getIcon16PlayMarusiaForeground:()=>r})},449521:(e,t,i)=>{function r(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="#fff" d="M5 7.4c0-.84 0-1.26.16-1.58a1.5 1.5 0 0 1 .66-.66C6.14 5 6.56 5 7.4 5h1.2c.84 0 1.26 0 1.58.16a1.5 1.5 0 0 1 .66.66c.16.32.16.74.16 1.58v1.2c0 .84 0 1.26-.16 1.58a1.5 1.5 0 0 1-.66.66c-.32.16-.74.16-1.58.16H7.4c-.84 0-1.26 0-1.58-.16a1.5 1.5 0 0 1-.66-.66C5 9.86 5 9.44 5 8.6V7.4Z"/></svg>',name:"stop_marusia_foreground_16"}}i.d(t,{getIcon16StopMarusiaForeground:()=>r})},312020:(e,t,i)=>{i.d(t,{BRIDGE_STAT_CALL_ARGUMENTS_MAX_LENGTH:()=>y,CLOSE_STATUS:()=>l,ERROR_CODES:()=>s,ERROR_REASONS:()=>n,ERROR_TYPES:()=>o,MAX_COUNT_OF_APP_INIT:()=>w,NFT_APP_ID:()=>h,ONE_TIME_DONUT_APP_ID:()=>m,ORD_APP_ID:()=>c,OZON_APP_ID:()=>g,PLATFORM:()=>a,PMC_PART_CONFIG_KEY_LONG_ID:()=>_,SITPOSTING_APP_ID:()=>p,TEXTLIVE_APPS:()=>d,VKPAY_APPS:()=>u,VKPAY_TRANSACTION_EVENT:()=>r,VK_CONNECT_EVENTS:()=>v,VK_CONNECT_SUPERAPPKIT_EVENT_TYPE:()=>b,VMOJI_CONSTRUCTOR_APP_ID:()=>f});const r="VKWebAppActionDone",a={WEB:"web",MOBILE_WEB:"mobile-web"},s={UNKNOWN:1,MISSING_PARAM:2,OLD_MISSING_PARAM:100,CONNECTION_LOST:3,USER_DENIED:4,INVALID_PARAMS:5,UNSUPPORTED_PLATFORM:6,REQUESTS_LIMIT_REACHED:10,ACCESS_DENIED:11,CUSTOM:13,NO_ADS:20},n={ACCESS_DENIED:"Access denied",UNSUPPORTED_PLATFORM:"Unsupported platform",UNSUPPORTED_ACTION:"Unsupported action",NATIVE_APP_IS_NOT_INSTALLED:"VK client is not installed on device",USER_NOT_A_PRIVATE_GROUP_MEMBER:"User is not a member of the given private group",UNKNOWN_ERROR:"Unknown error",CONNECTION_LOST:"Connection lost",NETWORK_ERROR:"Network error",USER_DENIED:"User denied",INVALID_PARAMS:"Invalid params",NO_ADS:"No ads",ADS_ALREADY_PLAYED:"Ads already played",VK_PAY_DISABLED:"This app can't use VK Pay",SCROLL_SUBSCRIBER_ALREADY_EXIST:"Scroll subscriber already exist",SUBSCRIPTION_IS_ALREADY_CANCELLED:"Subscription is in invalid status: subscription is already cancelled",SURVEY_INIT_IN_PROGRESS:"Survey init in progress",SURVEY_ALREADY_INIT:"Survey already init",SURVEY_NO_MATCH:"Survey no match",SURVEY_USER_CANCEL:"Survey user cancel",ALREADY_IN_PROGRESS:"Already in progress",USER_IS_NOT_GROUP_ADMIN:"Only group admins have access to group tokens",DEVICE_CANT_GET_GEODATA:"Device can't get geodata",USER_DIDNT_ALLOWED_ACTION:"User didn't allowed"},o={CLIENT:"client_error",API:"api_error",AUTH:"auth_error"},l=["success","failed"],u=[6217559,7131443],d=[7512376],c=51707812,h=51459963,p=7644481,f=7929683,m=51528700,g=51903384,v={VKWebAppAddToCommunity:"add_to_community",VKWebAppAddToCommunityPreload:"get_groups_list",VKWebAppAddToFavorites:"add_to_favorites",VKWebAppAddToFavoritesPreload:"already_added_to_favorites",VKWebAppAddToMenu:"add_to_menu",VKWebAppAddToMenuPreload:"is_in_left_menu",VKWebAppGetCommunityToken:"get_community_token",VKWebAppGetCommunityTokenPreload:"get_community_preload_settings",VKWebAppGetAuthToken:"get_auth_token",VKWebAppGetAuthTokenPreload:"get_auth_token_info",VKWebAppGetPhoneNumber:"get_phone_number",VKWebAppGetPhoneNumberPreload:"already_get_phone_number",VKWebAppGetEmail:"get_email",VKWebAppGetEmailPreload:"already_get_email",VKWebAppGetFriends:"get_friends",VKWebAppOpenApp:"open_app",VKWebAppSendPayload:"send_payload",VKWebAppSendToClient:"send_to_client",VKWebAppSendToClientPreload:"get_open_in_native_permission",VKWebAppShowOrderBox:"order",VKWebAppShowSubscriptionBox:"subscription",VKWebAppShowLeaderBoardBox:"show_leader_board",VKWebAppShowLinkCardBox:"show_link_card",VKWebAppShowNftPaymentBox:"show_nft_pay_box",VKWebAppShowInviteBox:"invite_friends",VKWebAppShowStoryBox:"story_box",VKWebAppShowRequestBox:"send_request",VKWebAppShowRequestBoxPreload:"request_box_preload",VKWebAppOpenArticleEditor:"open_article_edit",VKWebAppClose:"close",VKWebAppGetSilentToken:"get_silent_token",VKWebAppOpenPayForm:"open_pay_form",VKWebAppAddToChat:"add_to_chat",VKWebAppTrackEvent:"track_event",VKWebAppCallStart:"call_start",VKWebAppCallJoin:"call_join",VKWebAppCallLeft:"call_left",VKWebAppCallFinished:"call_finished",VKWebAppCallGetStatus:"call_get_status",VKWebAppCallStartSharing:"call_start_sharing",VKWebAppCallStopSharing:"call_stop_sharing"},b="vk-sak-sdk",_="mini_apps_long_id",y=256,w=1},828058:(e,t,i)=>{function r(e,t,i,r){const a=t?"article.php":"al_articles.php";ajax.post(a,{act:"tts",article_owner_id:e.owner_id,article_id:e.id,hash:e.tts_hash,support_streaming:i?1:0},{onDone:e=>{r(e)}})}i.d(t,{loadArticle:()=>r})},844925:(e,t,i)=>{i(351118),i(273253),i(294787)},774725:(e,t,i)=>{i.d(t,{ArticleTts:()=>h});var r=i(979333),a=i(342443),s=i(306224),n=i(547214),o=i(48711),l=i(618290),u=i(863473),d=i(512347),c=i(828058);class h{static load(e,t,i,r){this.loadingArticleRawId=e.raw_id,(0,c.loadArticle)(e,t,i,(e=>{this.loadingArticleRawId=null,r(e)}))}static getAudio(e,t,i){const r=[],s=JSON.stringify({articleTts:!0,articleId:e,articleOwnerId:t,externalStream:!0});return r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=`${t}${e}`,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=t,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=i.url,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]=i.title,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]=i.artist,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=i.duration,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]=0,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=0,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=s,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS]={},r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM]=!1,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]=0,r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]="",r[a.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,r}static play(e,t,i,a){this.onArticleTtsExpire=a,this.statsHandlersInitialized||(this._audioPlayer().subscribe(o.AudioPlayerEventType.PLAY,(()=>{if(this.isAnyArticleInPlayer()){const e=this._audioPlayer().getCurrentProgress()>0?r.ArticleTtsActionType.CONTINUE:r.ArticleTtsActionType.START;this.sendStats(e)}})),this._audioPlayer().subscribe(o.AudioPlayerEventType.PAUSE,(()=>{this.isAnyArticleInPlayer()&&this.sendStats(r.ArticleTtsActionType.PAUSE)})),this._audioPlayer().subscribe(o.AudioPlayerEventType.ENDED,(()=>{if(this.isAnyArticleInPlayer()){let e=this._audioPlayer();if(e._impl?._hlsError||e._impl?._currentAudioEl?.error){e._impl&&(e._impl._hlsError=void 0);const t=(0,d.getAudioExtra)(e.getCurrentAudio());e.deleteCurrentPlaylist(),h.retryCount<3&&(h.retryCount+=1,setTimeout((()=>{this.onArticleTtsExpire?.(t)}),h.RETRY_TIMEOUT))}this.sendStats(r.ArticleTtsActionType.P100)}})),this.statsHandlersInitialized=!0);const s=this.getAudio(e,t,i),n=this._audioPlayer().getPlaylist(u.AudioPlaylist.TYPE_ARTICLE_TTS,t,e);n.mergeWith({list:[s]}),this._audioPlayer().play(s,n)}static _audioPlayer(){return(0,n.getAudioPlayer)()}static _audioExtra(){const e=this._audioPlayer().getCurrentAudio();return(0,d.getAudioExtra)(e)??{}}static isLoadingArticle(e){return this.loadingArticleRawId===e.raw_id}static isArticleInPlayer(e){return e.owner_id===this._audioExtra().articleOwnerId&&e.id===this._audioExtra().articleId}static isAnyArticleInPlayer(){return(0,s.isArticleTts)(this._audioPlayer().getCurrentAudio())}static sendStats(e){const{articleId:t,articleOwnerId:i}=this._audioExtra();r.articleTtsActionStatController.logEvent({action:e,nav_screen:"article_read",article_id:t,owner_id:i,audio_length:(0,l.audioTupleToAudioObject)(this._audioPlayer().getCurrentAudio())?.duration??0,speed:Math.round(100*AudioPlayer.podcastGetPlaybackRate()),volume:Math.round(100*this._audioPlayer().getVolume())})}}h.statsHandlersInitialized=!1,h.retryCount=0,h.RETRY_TIMEOUT=1e3},535187:(e,t,i)=>{i.d(t,{default:()=>d});var r=i(178009),a=i(956905),s=i(705144),n=i(804623),o=i(911753);const l="page_header_cont",u="onboarding";class d{initOnboardingBG(){if(!window.onboardingBG){let e='\n<div id="onboarding_layout">\n  <svg id="onboarding_bg_header" width="100%" height="49px">\n    <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="0" width="100%" height="100%" fill-opacity="0.8" fill="#000"></rect>\n  </svg>\n  <svg id="onboarding_bg" width="100%" height="100%">\n  <defs>\n    <mask id="mask" x="0" y="0" width="100%" height="100%">\n      <rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect>\n      <rect id="onboarding_bg_clip" class="GroupOnboardingBgClip" x="0" y="0" width="0" height="0" fill="#000" rx="8" ry="8"></rect>\n    </mask>\n  </defs>\n  <rect id="onboarding_bg_rect" class="GroupOnboardingBg" x="0" y="42" width="100%" height="100%" mask="url(#mask)" fill-opacity="0.8"></rect>\n  </svg>\n</div>\n      ',t=(0,r.se)(e);(0,r.domInsertBefore)(t,window.layerBG),window.onboardingBGHeader=(0,r.ge)("onboarding_bg_header"),window.onboardingBG=(0,r.ge)("onboarding_bg"),window.onboardingBGRect=(0,r.ge)("onboarding_bg_rect"),window.onboardingBGClip=(0,r.ge)("onboarding_bg_clip"),window.cur.destroy.push((()=>{(0,r.hide)(window.onboardingBG),(0,r.hide)(window.onboardingBGHeader),(0,r.removeClass)((0,r.ge)(l),u),this.hideDarkness=!0,this.hideTT(),delete window.onboardingBG,delete window.onboardingBGHeader,delete window.onboardingBGRect,delete window.onboardingBGClip,this.opts.onBGClick&&(0,a.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick)}))}this.opts.onBGClick&&(0,a.addEvent)(window.onboardingBG,"click",this.opts.onBGClick)}showTT(){const[,e]=(0,r.getXY)(this.el);this.tt=new o.ElementTooltip(this.el,this.ttParams),this.opts.highlight&&(this.addDarkness(),this.addHighlight()),this.tt.show();const t=this.tt.getContent();(0,n.isElementInViewport)(this.el)&&(0,n.isElementInViewport)(t)||(0,s.scrollToY)(e-42-this.ttParams.scrollOffset)}hideTT(){this.tt&&(this.tt.destroy(),this.removeDarkens(),this.hideDarkness&&((0,a.removeEvent)(window,"scroll"),(0,a.removeEvent)(window,"resize")),this.opts.onBGClick&&window.onboardingBG&&(0,a.removeEvent)(window.onboardingBG,"click",this.opts.onBGClick),this.opts.onHide&&this.opts.onHide())}addHighlight(){window.onboardingBGClip&&(this.highlightElement(),(0,a.addEvent)(window,"scroll",this.onScrollTT.bind(this)),(0,a.addEvent)(window,"resize",this.onResizeTT.bind(this)))}highlightElement(){let e=this.el.offsetWidth,t=this.el.offsetHeight,i=(0,r.getXY)(this.el);(0,r.attr)(window.onboardingBGClip,"width",e+this.border[1]+this.border[3]),(0,r.attr)(window.onboardingBGClip,"height",t+this.border[0]+this.border[2]),(0,r.attr)(window.onboardingBGClip,"x",i[0]-this.border[1]),(0,r.attr)(window.onboardingBGClip,"y",i[1]-this.border[0])}onResizeTT(){this.setDartToFullWidth(),this.highlightElement()}onScrollTT(){let e=this.getPageHeight();window.onboardingBG.height!=e&&this.setDartToFullHeight()}setDartToFullHeight(){(0,r.attr)(window.onboardingBG,"height",this.getPageHeight())}setDartToFullWidth(){(0,r.attr)(window.onboardingBG,"width",this.getPageWidth()),(0,r.attr)(window.onboardingBGHeader,"width",this.getPageWidth())}addDarkness(){(0,r.isVisible)(window.onboardingBG)||(this.setDartToFullHeight(),this.setDartToFullWidth(),(0,r.show)(window.onboardingBG),(0,r.isVisible)(window.onboardingBGHeader)||((0,r.show)(window.onboardingBGHeader),(0,r.addClass)((0,r.ge)(l),u)))}removeDarkens(){this.hideDarkness&&((0,r.hide)(window.onboardingBG),(0,r.hide)(window.onboardingBGHeader),(0,r.removeClass)((0,r.ge)(l),u))}ttOnHide(){this.hideTT()}show(){setTimeout(this.showTT.bind(this),1e3)}getPageWidth(){const e=document.documentElement,t=document.body;return Math.max(t.scrollWidth,e.scrollWidth,t.offsetWidth,e.offsetWidth,t.clientWidth,e.clientWidth)}getPageHeight(){const e=document.documentElement,t=document.body;return Math.max(t.scrollHeight,e.scrollHeight,t.offsetHeight,e.offsetHeight,t.clientHeight,e.clientHeight)}constructor(e,t,i={}){this.el=e,this.text=t,this.hideDarkness=!0,this.oldColor=!1;let r={autoShow:!1,noAutoHideOnWindowClick:i.noAutoHideOnWindowClick??!0,content:t instanceof HTMLElement?t:`${t}`,cls:`feature_intro_tt tutorial_tip_tt ${(()=>{const e=i.class??"";return i.tooltipWhite?e:e+" feature_intro_blue_tt"})()}`,appendToParent:!0,onHide:this.ttOnHide.bind(this),scrollOffset:i.scrollOffset||0,align:i.align||o.ElementTooltip.ALIGN_CENTER};i.side&&(r.forceSide=i.side),i.offset&&(r.offset=i.offset),i.width&&(r.width=i.width),i.shift&&(r.centerShift=i.shift),i.border?this.border=i.border:this.border=[10,10,10,10],i.ttOnHide&&(r.onHide=i.ttOnHide),i.withCloseButton&&(r.withCloseButton=i.withCloseButton,r.onCloseButtonClick=i.onCloseButtonClick),i.align&&(r.align=i.align),this.ttParams=r,this.opts=i,this.initOnboardingBG()}}},804623:(e,t,i)=>{function r(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}i.d(t,{isElementInViewport:()=>r})},427714:(e,t,i)=>{i.d(t,{UiScroll:()=>d});var r=i(538484),a=i(326107),s=i(451306),n=i(178009),o=i(956905),l=i(890043),u=i(733052);class d{init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,i,r){return this.removeEvents.push([e,t,i]),(0,o.addEvent)(e,t,i,void 0,void 0,r?{passive:!0}:void 0),i}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&(0,o.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,o.removeEvent)(document,"mousemove",this.dragHandler),(0,s.each)(this.removeEvents,(function(e,t){o.removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){const e=(0,n.cf)();for(;this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return(0,n.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),(0,s.each)(this.removeElements,(function(e,t){(0,n.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if((0,s.isFunction)(e)){this.animation&&this.animation.stop();const t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if((0,s.isFunction)(e)){this.animation&&this.animation.stop();const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){r.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),(0,n.setStyle)(this.el.container,"width",e?(0,n.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){let t=0;const i=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,r.browser.mac&&r.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==i?15:2==i?450:1)}isScrollEventUnused(e){return d.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),(0,n.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),(0,o.addEvent)(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),(0,o.addEvent)(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,(0,o.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&(0,o.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,o.removeEvent)(document,"mousemove",this.dragHandler),(0,n.setStyle)(document.body,"cursor",""),(0,n.removeClass)(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);const t=(e.pageY-(0,n.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&(0,o.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(this.disabled||!this.dragging||this.options.native)return;e||(e=window.event);const t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,(0,n.setStyle)(document.body,"cursor","pointer"),(0,n.addClass)(this.el.container,"ui_scroll_dragging")),(0,o.cancelEvent)(e),this.emitEvent("drag"),this.api}scroll(e,t,i){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new l.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:l.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:(0,s.isFunction)(i)?i.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,(0,s.isFunction)(i)&&i(this.api)),this.api}scrollTop(e,t,i,r){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll((0,s.intval)(t),i,r)}scrollBottom(e,t,i,r){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-(0,s.intval)(t),i,r)}scrollBy(e,t,i){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+(0,s.intval)(e),t,i)}scrollIntoView(e,t,i,r){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=(0,u.getScrollElement)(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){const e=(0,n.getXY)(t)[1],a=(0,n.getXY)(this.el.overflow)[1],o=(0,n.getSize)(t)[1];if(e<=a&&e+o>=a+this.api.data.viewportHeight||e>=a&&e+o<=a+this.api.data.viewportHeight)(0,s.isFunction)(r)&&(i?setTimeout(r.bind(this.api),0):r(this.api));else if(o>this.api.data.viewportHeight||e<a)this.scrollTop(!1,e-a+this.api.data.scrollTop-(this.options.shadows?(0,n.getSize)(this.el.shadowTop)[1]:0),i,r);else{const t=this.options.shadows?(0,n.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,e-a+this.api.data.scrollTop+o-this.api.data.viewportHeight+t,i,r)}}return this.api}update(e){let t,i;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));const r=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==r)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,r))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight),i=t<=this.api.data.viewportHeight,!i){const i=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==i)&&(this.barOuterHeight=i,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),(0,u.nextFrame)((()=>{const e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`}))}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!i)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!i),this.shadowBottom!=(this.api.data.scrollBottom&&!i)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!i)),this.unnecessary!==i&&((0,n.toggleClass)(this.el.container,"ui_scroll_unnecessary",i),this.unnecessary=i,this.options.stopScrollPropagation&&this.fixBlocker(),i&&this.barInnerHeight&&this.barOuterHeight&&(0,u.nextFrame)(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";const i=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${i}%)`}.bind(this)))}return this.emitEvent("update"),(!this.options.reversed||r>=0)&&this.more(),!0}return!1}more(){const e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}constructor(e,t){if(!(e=(0,u.getScrollElement)(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=(0,s.extend)({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1},t),this.options.native&&(this.options.shadows=!1),r.browser.mobile&&(this.options.stopScrollPropagation=!1),(0,a.isArray)(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,(0,s.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),(0,s.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),(0,s.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),(0,s.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),(0,s.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),(0,s.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),(0,s.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),(0,s.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),(0,s.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:(0,n.ce)("div",{className:"ui_scroll_overflow"}),outer:(0,n.ce)("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:(0,n.ce)("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:(0,n.ce)("div",{className:"ui_scroll_shadow_top"}),shadowBottom:(0,n.ce)("div",{className:"ui_scroll_shadow_bottom"}),content:(0,n.ce)("div",{className:"ui_scroll_content clear_fix"}),barContainer:(0,n.ce)("div",{className:"ui_scroll_bar_container"}),barOuter:(0,n.ce)("div",{className:"ui_scroll_bar_outer"}),barInner:(0,n.ce)("div",{className:"ui_scroll_bar_inner"})},(0,n.data)(this.el.container,"ui-scroll",this),(0,n.attr)(this.el.content,"data-testid","ui_scroll_content");const i=(0,n.cf)(),l=["ui_scroll_container"];for((0,s.each)((0,a.isArray)(this.options.theme)?this.options.theme:(0,s.trim)(this.options.theme+"").split(/\s+/),(function(e,t){t&&l.push("ui_scroll_"+t+"_theme")})),(0,n.addClass)(this.el.container,l.join(" ")),this.options.hidden&&(0,n.addClass)(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=(0,n.ce)("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),i.appendChild(this.el.overflow),this.options.native?(0,n.addClass)(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),i.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),r.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){const e=(0,u.addResizeSensor)(this.el.inner,this.resize.bind(this,!0)),t=(0,u.addResizeSensor)(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(e[0]),this.removeElements.push(t[0]),this.startResizeListening=function(){e[1](),t[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(i),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init();const c="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":r.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,c,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&(0,o.cancelEvent)(e):this.isScrollEventUnused(e)?(0,o.cancelEvent)(e):(0,o.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),(0,s.each)(this.options.scrollElements,function(e,t){this.addEvent(t,c,function(e){this.disabled||this.unnecessary||(this.scrollBy(d.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||(0,o.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;const t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){(0,o.removeEvent)(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,(0,n.addClass)(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||(0,n.removeClass)(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}}d.addResizeSensor=u.addResizeSensor},733052:(e,t,i)=>{i.d(t,{addResizeSensor:()=>c,getScrollElement:()=>d,nextFrame:()=>u});var r=i(451306),a=i(178009),s=i(538484);let n;const o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),l=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function u(e){n&&l(n),n=o(e)}function d(e){return(0,r.isString)(e)&&"_"===e[0]?(0,a.geByClass1)(e):(0,a.ge)(e)}function c(e,t){if((e=d(e))&&(0,r.isFunction)(t)){if(s.browser.msie9||s.browser.opera&&s.browser.version<13){let i=!1,n=!1;const o=(0,a.ce)("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){n=!0,i&&l()}});function l(){if(!o.contentDocument)return setTimeout(l,100);o.contentDocument.defaultView.removeEventListener("resize",t),o.contentDocument.defaultView.addEventListener("resize",t),t()}return e.appendChild(o),e.__resizeSensor__=[o,function(){i=!0,n&&l()}]}{const u=(0,a.ce)("div",{className:"ui_scroll_resize_sensor"}),c=(0,a.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),h=(0,a.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),p=(0,a.ce)("div"),f=(0,a.ce)("div");let m=null;return c.appendChild(p),h.appendChild(f),u.appendChild(c),u.appendChild(h),e.appendChild(u),e.__resizeSensor__=[u,c.onscroll=h.onscroll=function(){const i=(e.offsetWidth||1e4)+10,r=(e.offsetHeight||1e4)+10;p.style.width=i+"px",p.style.height=r+"px",c.scrollLeft=i,c.scrollTop=r,h.scrollLeft=i,h.scrollTop=r,m!==(m=i+" "+r)&&t()}]}}}},424700:(e,t,i)=>{i.d(t,{showHint:()=>l,showTitle:()=>o,showTooltip:()=>n});var r=i(178009),a=i(956905),s=i(451306);function n(e,t){(vk.loaded||t.noload)&&e&&(e.temphide||(e.temphide=function(){e.showing=!1},(0,a.addEvent)(e,"mouseout",e.temphide)),e.showing=!0,"loadingstat"!==e.tt&&(e.tt||(e.tt="loadingstat"),cur.cancelTooltip=!1,t.stat&&window.stManager.add(t.stat),window.stManager.add([window.jsc("web/tooltips.js"),"tooltips.css"],(function(){"loadingstat"===e.tt&&(e.tt=!1),e.showing&&!cur.cancelTooltip&&(!function(e){e.temphide&&((0,a.removeEvent)(e,"mouseout",e.temphide),(0,r.removeAttr)(e,"temphide"),(0,r.removeAttr)(e,"showing"))}(e),e.tt&&e.tt.el&&!t.force||(tooltips.create(e,t),t.onCreate&&t.onCreate()),tooltips.show(e,t))}))))}function o(e,t,i,a){e=(0,r.ge)(e);if(!i){i=[Math.round(20-(0,r.getSize)(e)[0]/2),8]}n(e,(0,s.extend)({text:function(){return t||e.getAttribute("data-title")},shift:i,black:1},a||{}))}function l(e,t){t=t||{};n(e=(0,r.ge)(e),(0,s.extend)({text:function(){return e.getAttribute("data-title")},dir:"auto",width:300,shift:[22,8]},t))}},43058:(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{function sourceFn(){var _shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(419299),_web_stories_narrative_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(449815),_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(712341),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(538484),_web_lib_revertLastInlineVideo__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(402247),_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(817715),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(405546),_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(350062),_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(225590),_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(326107),_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(424700),_web_lib_fx__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(890043),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(956905),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(427714),_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(178009),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(451306),_web_articles_article_utils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(348197),_web_evbus__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(138249),_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(932216),_shared_ranges__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(9327),idle;(0,_web_evbus__WEBPACK_IMPORTED_MODULE_17__.init)(),(0,_web_evbus__WEBPACK_IMPORTED_MODULE_17__.registerEvbusCommonEvents)(),window.WComments={init(e){e.reply_names&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(e.reply_names)&&(e.reply_names={}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(cur,{options:e,oid:e.user_id,postTo:e.user_id,heightEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_page"),countEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_count"),contentEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_content"),section:e.section,noAwayCheck:!0,sendPostBtn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("send_post"),postsEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts"),postsOuterEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_posts_outer"),wallType:"widget_comments",onReplyFormSizeUpdate:WComments.contentUpdated.bind(WComments,!1),onEditFormSizeUpdate:WComments.contentUpdated.bind(WComments,!1)}),cur.options.filter_media_types=cur.options.media_types||[],this.override("lite.js"),this.override(window.jsc("web/page.js")),this.override(window.jsc("web/emoji.js")),window.stManager.emitter.addListener("update",this.override.bind(this)),this.updateSize(),(e.is_auto||e.is_nano)&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(e,{media_opts:{hideAfterCount:0,maxShown:0}}),Wall.init(e),e.fixed_height?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(cur.postsOuterEl,{maxHeight:e.fixed_height-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_head"))[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_form"))[1]}),cur.scrollbar=new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_13__.UiScroll(cur.postsOuterEl,{hidden:1,onmore:this.showMore.bind(this),ondragstart:function(){cur.Rpc.callMethod("startDrag")},ondragstop:function(){cur.Rpc.callMethod("stopDrag")}}),cur.mouseMove=cur.scrollbar.ondrag.bind(cur.scrollbar),cur.mouseUp=cur.scrollbar.ondragstop.bind(cur.scrollbar)):(cur.mouseMove=function(){},cur.mouseUp=function(){}),e.qtransport&&this.initQTransport(e.qtransport),window.timeUpdateInt=setInterval(this.updateTimes.bind(this),1e4),cur.RpcMethods={onInit:function(){let e=this.resizeWidget.bind(this);setTimeout(e,0),setTimeout(e,500)}.bind(this),updateStickers:function(){window.emojiStickers=!1,window.Emoji&&Emoji.updateTabs()},mouseMove:cur.mouseMove,mouseUp:cur.mouseUp,chooseMedia:function(){let e=cleanObj(this.uncleanObj([].slice.call(arguments)));cur.chooseMedia.apply(cur.chooseMedia,e),setTimeout(this.resizeWidget.bind(this),0)}.bind(this),addMedia:function(e,t,...i){~["pollBackgroundUploaded"].indexOf(t)&&cur.addMedia&&cur.addMedia[e]&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.isFunction)(cur.addMedia[e][t])&&cur.addMedia[e][t].apply(cur.addMedia[e],i)},showMediaProgress:function(){let e=cleanObj([].slice.call(arguments));cur.showMediaProgress.apply(cur.showMediaProgress,e)},likeFullUpdate:function(){}};try{cur.Rpc=new fastXDM.Client(cur.RpcMethods,{safe:!0,sameOrigin:!0,unsafeMethods:["mouseMove","mouseUp"]}),cur.resizeInt=setInterval(this.resizeWidget.bind(this),1e3)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.debugLog)(e)}_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(e.user_id)||((0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_12__.addEvent)("send_post","click",Widgets.oauth.bind(Widgets)),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_12__.addEvent)("post_field","click",Widgets.oauth.bind(Widgets)))},uncleanObj:function(e){let t;if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isObject)(e)){t={};for(let i in e)t[i.replace(/[^a-zA-Z0-9_\-]/g,"")]=this.uncleanObj(e[i])}else if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(e))t=[],e.forEach((e=>{t.push(this.uncleanObj(e))}));else{let i=typeof e;t="number"==i||"boolean"==i||"function"==i?e:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.unclean)(e)}return t},getSectionParams:function(){let e={app:cur.options.app,width:cur.options.width,startWidth:cur.options.startWidth,limit:cur.options.limit};switch(cur.section){case"admin_browse":e.act="admin_browse";break;case"admin_bl":e.act="admin_bl",e.limit=15;break;case"admin_updates":e.act="admin_updates";break;case"browse":e.browse=1,e.replies=cur.options.replies;break;default:e.page_query=cur.options.page_query,e.part=1}return e},contentUpdated:function(e){e&&this.applyOptions(e),this.resizeWidget()},applyOptions:function(options){if(options.reply_names&&((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(options.reply_names)&&(options.reply_names={}),cur.options.reply_names=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(cur.options.reply_names||{},options.reply_names),delete options.reply_names),options.head_count&&"browse"!=cur.section&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_count"),options.head_count),delete options.head_count),options.script)try{eval(options.script),delete options.script}catch(e){(0,_shared_lib_js_logger__WEBPACK_IMPORTED_MODULE_18__.logEvalError)(e,options.script)}(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(cur.options,options),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.toggle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_more"),options.offset<options.count)},updateSize:function e(t){let i=(t||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)("page_wrap"))[0];if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(cur.heightEl,{width:i}),cur.options.is_auto){let t=1==cur.options.mini||0!=cur.options.mini&&i<630,r=t&&i<380;e.size!=t+""+r&&(e.size=t+""+r,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(document.body,"wcomments_mini"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(document.body,"wcomments_nano"),t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(document.body,"wcomments_mini"),r&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(document.body,"wcomments_nano"))}},resizeWidget:function e(){if(!cur.heightEl||!cur.Rpc)return;let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)("page_wrap");(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_3__.browser.msie&&!_shared_lib_browser__WEBPACK_IMPORTED_MODULE_3__.browser.msie8||_shared_lib_browser__WEBPACK_IMPORTED_MODULE_3__.browser.opera)&&(t[1]+=15),window.onBodyResize&&onBodyResize(),e.size!=t.join(" ")&&(e.size=t.join(" "),this.updateSize(t),cur.Rpc.callMethod("resize",t[1]))},showMore:function(){if(cur.switchingSection)return;let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_more");if(cur.options.offset>=cur.options.count)return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(e);buttonLocked(e)||ajax.post("al_widget_comments.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(WComments.getSectionParams(),{offset:cur.options.offset,width:cur.options.width,startWidth:cur.options.startWidth,part:1}),{onDone:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts").appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.cf)(t)),WComments.contentUpdated(e)},showProgress:lockButton.pbind(e),hideProgress:unlockButton.pbind(e)})},switchSection:function(e){if(cur.switchingSection||cur.section==e)return!1;cur.switchingSection=!0;let t=uiTabs&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_admin_tabs"),i=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_"+e);return"posts"==e||"posts"==cur.section?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(cur.contentEl,"wcomments_content_loading"):t&&uiTabs.showProgress(t),i&&uiTabs.switchTab((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("ui_tab",i)),cur.section=e,ajax.post("al_widget_comments.php",WComments.getSectionParams(),{onDone:function(i,r){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(cur.postsEl,r),t&&uiTabs.hideProgress(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.contentEl,"wcomments_content_loading"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.heightEl,"wcomments_section_posts"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.heightEl,"wcomments_section_admin_browse"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.heightEl,"wcomments_section_admin_bl"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.heightEl,"wcomments_section_admin_updates"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(cur.heightEl,"wcomments_section_browse"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(cur.heightEl,"wcomments_section_"+e),cur.options.fixed_height&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(cur.postsOuterEl,{maxHeight:cur.options.fixed_height-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_head"))[1]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)("posts"==cur.section||"browse"==cur.section?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_form"):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_admin_tabs"))[1]}),cur.scrollbar&&cur.scrollbar.scrollTop(),WComments.contentUpdated(i),cur.switchingSection=!1}}),!1},addToBl:function(e,t,i){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"wcomments_bl_action_loading"))return!1;ajax.post("al_widget_comments.php",{act:"a_add_to_bl",id:e,hash:t,app:cur.options.app},{onDone:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_bl_label_"+e)),i.onclick=WComments.delFromBl.bind(WComments,e,t,i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(i,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("widgets_remove_from_banlist"))},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass.pbind(i,"wcomments_bl_action_loading"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass.pbind(i,"wcomments_bl_action_loading")})},delFromBl:function(e,t,i){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"wcomments_bl_action_loading"))return!1;ajax.post("al_widget_comments.php",{act:"a_del_from_bl",id:e,hash:t,app:cur.options.app},{onDone:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_wcomments_bl_label_"+e),"display","inline"),i.onclick=WComments.addToBl.bind(WComments,e,t,i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(i,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("widgets_restore_to_banlist"))},showProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass.pbind(i,"wcomments_bl_action_loading"),hideProgress:_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass.pbind(i,"wcomments_bl_action_loading")})},updateTimes:function(e){if(!(cur.lang||{}).wall_X_seconds_ago_words)return;let t=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.vkNow)()/1e3),i=[];t-=cur.tsDiff,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("rel_date_needs_update",e||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts"),"span"),(function(e,r){if(!r)return;let a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(r.getAttribute("time")),s=t-a,n=r.getAttribute("abs_time");s<5?n=(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("profile_status_word_secs_ago",1):s<60?n=Wall.langWordNumeric(s,cur.lang.wall_X_seconds_ago_words,cur.lang.wall_X_seconds_ago):s<3600?n=Wall.langWordNumeric((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(s/60),cur.lang.wall_X_minutes_ago_words,cur.lang.wall_X_minutes_ago):s<14400?n=Wall.langWordNumeric((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(s/3600),cur.lang.wall_X_hours_ago_words,cur.lang.wall_X_hours_ago):i.push(r),r.innerHTML=n})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(i,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(this,"rel_date_needs_update")}))},langWordNumeric:function(e,t,i){return(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(t)&&e<t.length?t[e]:(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.langNumeric)(e,i)},showLikesBox:function(e,t){showBox("widget_like.php",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({act:"a_stats_box",app:cur.options.app,obj:e,from:"wcomments",check_hash:cur.likeCheckHash,widget_width:638},t||{}))},deleteAllAndBan:function(e,t,i,r){ajax.post("al_widget_comments.php",{act:"a_add_to_bl",id:t,hash:i,app:cur.options.app},{onDone(i,r){r&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("wcomments_post",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts"),"div"),(function(){!this.id.indexOf("post"+t)&&this.id.split("_")[1]>=r&&this.id!="post"+e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.isVisible)(this)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(this)})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_del"+e).innerHTML=i,WComments.contentUpdated()},showProgress:()=>{lockButton(r)},hideProgress:()=>{unlockButton(r)}})},initQTransport:function(e){window.curNotifier=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(e,{lp_connected:!1,error_timeout:1,addQueues:{},recvClbks:{},recvData:{},onConnectionId:[]}),WComments.lpInit(),WComments.lpStart()},lpGetTransportWrap(){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("queue_transport_wrap");return e||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("div",{id:"queue_transport_wrap"}),utilsNode.appendChild(e)),e},lpInit:function(){curNotifier.lpMakeRequest||(delete curNotifier.lpMakeRequest,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)("queue_transport_frame"),WComments.lpGetTransportWrap().appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("iframe",{id:"queue_transport_frame",name:"queue_transport_frame",src:curNotifier.frame_path})))},lpStart:function(){curNotifier.lp_started=!0,WComments.lpCheck()},lpStop(){curNotifier.lp_started=!1,clearTimeout(curNotifier.lp_check_to),clearTimeout(curNotifier.lp_error_to)},lpCheck(){curNotifier.lp_started&&(curNotifier.lpMakeRequest?curNotifier.lpMakeRequest(curNotifier.frame_url,{act:"a_check",ts:curNotifier.timestamp,key:curNotifier.key,id:curNotifier.uid,wait:25},(text=>{if(curNotifier.lp_started)try{let success=this.lpChecked(eval("("+text+")"));success&&(this.lpCheck(),curNotifier.error_timeout=1)}catch(e){(0,_web_lib_ui_util__WEBPACK_IMPORTED_MODULE_7__.topError)("Notify error: "+e.message),curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)}}),(()=>{curNotifier.lp_error_to=setTimeout(this.lpCheck.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2)})):curNotifier.lp_check_to=setTimeout(this.lpCheck.bind(this),1e3))},lpChecked:function(e){let t=e.failed;if(2==t)return curNotifier.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),!1;if(t)throw new Error((0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_unknown_error"));return curNotifier.timestamp=e.ts,!cur.section.indexOf("admin")||(cur.saveScrollPosition=cur.scrollbar&&cur.scrollbar.data.scrollTop>100,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(e.events,(function(e,t){WComments.eventsParse(t)})),!0)},lpGetKey:function(){ajax.post("al_widget_comments.php",{act:"a_get_key",id:curNotifier.uid,app:cur.options.app,page_query:cur.options.page_query},{onDone:function(e,t){curNotifier.timestamp=t,curNotifier.key=e,this.lpCheck()}.bind(this),onFail:function(e){if(3!=e)return curNotifier.error_timeout=64,this.lp_error_to=setTimeout(this.lpGetKey.bind(this),1e3*curNotifier.error_timeout),curNotifier.error_timeout<64&&(curNotifier.error_timeout*=2),!0;location.reload()}.bind(this)})},resizePostSizedThumbs:function(e,t,i,r,a){let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("page_post_thumb_wrap",e),n=[],o=0,l=0;const u=function(){o=l=0,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(this,{tiles:[],height:0,x:0,y:0}),n.push(this)};let d=function(e){e&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(this,{el:e,lastRow:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"page_post_thumb_last_row"),lastColumn:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"page_post_thumb_last_column"),width:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(e.style.width),height:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(e.style.height)})},c=new u,h=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(e.style.width),p=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(e.style.height),f=0;if(t>h&&(t=null),(r>p||a&&s.length>1)&&(r=null),!r&&t)r=Math.round(p*(t/h));else if(r&&!t)t=Math.round(h*(r/p));else{if(!t||!r)return;a&&(r=Math.min(r,Math.round(p*(t/h))),t=Math.round(h*(r/p)))}return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(s,(function(e,t){let r=t.tile||new d(t),a=new d(s[e+1]);c.height=Math.max(c.height,r.height),h-o>=r.width/2?(o+=r.width+(r.lastColumn?0:i),l=r.height,r.x=c.x,r.y=c.y=0,c.tiles.push(r),r.lastColumn?a&&a.lastColumn&&c.height-l>=a.height/2||(c=new u):c.x++):r.lastColumn&&c.height-l>=r.height/2&&(l+=r.height+i,r.x=c.x,r.y=++c.y,c.tiles.push(r),!r.lastRow&&a&&a.lastColumn&&c.height-l>=a.height/2||(c.height=Math.max(c.height,l),c=new u))})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(n,(function(e,a){let s=0,o=0,l=(t-i*a.x)/(h-i*a.x),u=(r-i*a.y)/(p-i*a.y),d=n.length-1==e?r-f:Math.round(a.height*u),c=0,m=0;f+=d+i,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(a.tiles,(function(e,r){r.x<a.x?(c=Math.round(r.width*l),s+=c+i,r.y||(m=d)):r.lastColumn&&(c=t-s,r.y==a.y?m=d-o:(m=Math.round(r.height*u),o+=m+i)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(r.el,{width:c,height:m})}))})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(e,{width:t,height:r}),[t,r]},resizePostAlbumWrap:function(e,t,i,r){r||(r="");let a=(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(e.style.width),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("page"+r+"_album_thumb_wrap",e,"div"),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("page"+r+"_album_photos",e,"div")),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domFC)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("page"+r+"_album_under_row",e,"div"));if(scaleX=t/a,a<t)return;if(!s)return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(e,{width:t});let l=Math.round((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(s.style.width)*scaleX),u=Math.round((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(s.style.height)*scaleX);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(s,{width:l,height:u}),n&&WComments.resizePostSizedThumbs(n,t-i-l,i,u),o&&WComments.resizePostSizedThumbs(o,t,i,(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.positive)(o.style.height)*((t-i)/(a-i)))},resizePost(e,t){let i=t?cur.options.reply_max_w:cur.options.max_w,r=Math.max(cur.options.kludges_min_h,i*(t?cur.options.reply_kludges_ratio:cur.options.kludges_ratio));return(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("page_album_wrap",e,"div"),(function(e,t){WComments.resizePostAlbumWrap(t,i,5)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("page_market_album_wrap",e,"div"),(function(e,t){WComments.resizePostAlbumWrap(t,i-2,2,"_market")})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("page_post_sized_thumbs",e,"div"),(function(e,t){WComments.resizePostSizedThumbs(t,i,5,r,!0)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("audio_pl_snippet",e,"div"),(function(e,t){let r;r=i<=cur.playlist_snippet_max_narrow_width?"audio_pl_snippet_size_narrow":i<=cur.playlist_snippet_max_medium_width?"audio_pl_snippet_size_medium":"",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.setStyle)(t,"width",i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(t,"audio_pl_snippet_size_narrow"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(t,"audio_pl_snippet_size_medium"),r&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(t,r)})),e},eventsQueue:[],eventsPaused:!1,eventsPause:function(){this.eventsPaused=!0},eventsProceed:function(){for(this.eventsPaused=!1;this.eventsQueue.length;)this.eventsParse(this.eventsQueue.shift())},eventsUpdateAttaches:function(e){(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("audio_row",e,"div"),(function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(t,"audio_no_actions")}))},eventsParse:function(e){if(this.eventsPaused)return this.eventsQueue.push(e);if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isObject)(e))return Wall.processQueueEvent(e);let t,i=e.split("<!>"),r=i[0],a=i[1],s=i[2],n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post"+s);if(r!=cur.options.qversion)return location.reload();switch(a){case"new_post":if(n)break;let o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts");function l(){o.insertBefore(t,o.firstChild),(0,_web_stories_narrative_utils__WEBPACK_IMPORTED_MODULE_1__.updateNarrativeSnippetsFromQueueByPost)(t),(0,_web_articles_article_utils__WEBPACK_IMPORTED_MODULE_16__.updateArticleSnippetsFromQueueByPost)(t)}t=this.resizePost((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.se)(Wall.getNewPostHTML(i,cur.options.is_admin))),WComments.eventsUpdateAttaches(t),cur.saveScrollPosition?cur.scrollbar.updateAbove(l):(l(),cur.scrollbar&&cur.scrollbar.scrollTop(0,!0)),nodeUpdated(t),Wall.updateMentionsIndex(),"browse"!==cur.section&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(cur.countEl,newCnt?(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("widgets_comments_top_count",newCnt):(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("widgets_comments"));break;case"del_post":n&&(!cur.wallMyDeleted[s]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(n),cur.options.offset--);break;case"res_post":n&&cur.options.offset++;break;case"new_reply":if(!n||cur.wallMyReplied[s]||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post"+i[3]))break;let u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("replies"+s);t=this.resizePost((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.se)(Wall.getNewReplyHTML(i,cur.options.is_admin)),!0);let d=!1;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.isVisible)("reply_link"+s))(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)("reply_link"+s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)("replies_wrap"+s),d=!0;else{let c=u.nextSibling,h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("new_reply",u,"div").length+1;if(cur.wallMyOpened[s]){c&&"replies_open"==c.className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(c),d=!0;let p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("wr_header",u,"a"),f=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("reply",u,"div").length+1,m=f;p&&(m=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(p.getAttribute("offs").split("/")[1])+1),(m>5||f<m)&&(p||(p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("a",{className:"wr_header"}),u.insertBefore(p,u.firstChild)),Wall.updateRepliesHeader(s,p,f,m))}else(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(t,"new_reply"),c&&"replies_open"==c.className||(c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("div",{className:"replies_open",onclick:Wall.openNewComments.pbind(s),role:"button",tabIndex:0}),u.parentNode.insertBefore(c,u.nextSibling)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(c,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("news_x_new_replies_more",Math.min(100,h))),c.newCnt=h}(0,_web_stories_narrative_utils__WEBPACK_IMPORTED_MODULE_1__.updateNarrativeSnippetsFromQueueByPost)(t),(0,_web_articles_article_utils__WEBPACK_IMPORTED_MODULE_16__.updateArticleSnippetsFromQueueByPost)(t),WComments.eventsUpdateAttaches(t),u.appendChild(t),d&&nodeUpdated(t);break;case"del_reply":!cur.wallMyDeleted[s]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(n)}this.resizeWidget()},override(e,t){const i=new RegExp(e.replace(/\.js$/,"\\.[0-9a-f]{8,20}\\.js$"));var r,a;if(Boolean(StaticFiles[e])||Object.keys(StaticFiles).some((function(e){return i.test(e)}))||!0===t)switch(e){case"lite.js":(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(window,{showTooltip:Widgets.showTooltip,showBox:Widgets.showBox({"al_photos.php":{photo_box:!0,choose_photo:!0},"al_video.php":{video_box:!0,a_choose_video_box:!0},"al_places.php":{show_photo_place:!0},"like.php":{publish_box:!0},"widget_like.php":{a_stats_box:!0},"al_wall.php":{canvas_draw_box:!0},"al_im.php":{stickers_store:!0,sticker_preview:!0},"al_audio.php":{choose_box:!0},"al_page.php":{owner_photo_box:!0},"al_voting.php":{export_box:!0},"docs.php":{show_box:!0}}),showReCaptchaBox:Widgets.showReCaptchaBox,gotSession(){location.reload()},showPhoto:Widgets.showPhoto,showVideo:Widgets.showVideo,shareAudioPlaylist:function(e){_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(vk.id)?e.apply(null,[].slice.call(arguments,1)):Widgets.oauth()}.bind(null,shareAudioPlaylist),addAudio:function(e){_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(vk.id)?e.apply(null,[].slice.call(arguments,1)):Widgets.oauth()}.bind(null,_web_audio_player_utils__WEBPACK_IMPORTED_MODULE_2__.AudioUtils.toggleAddAudio),showWiki:function(e){if("likes"==(e=(e&&e.w||"").split("/"))[0])WComments.showLikesBox(e[1]);else{if("shares"!=e[0])return!0;WComments.showLikesBox(e[1],{tab:"published"})}},mentionOver:function(){return!0},mentionClick:function(){return!0},showInlineVideo:Widgets.showInlineVideo,revertLastInlineVideo:Widgets.revertLastInlineVideo,pauseLastInlineVideo:Widgets.pauseLastInlineVideo});break;case window.jsc("web/emoji.js"):(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(Emoji,{focus:function(e,t){if(Emoji.editableFocus(e,!1,!0),t&&cur.scrollbar){let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domCA)(e,".reply_box");t&&cur.scrollbar.scrollIntoView(t)}}});break;case window.jsc("web/page.js"):(cur.options.is_auto||cur.options.is_nano)&&(Composer.init=(a=Composer.init,function(){let e=[].slice.call(arguments);return e[1].media&&(e[1].media.options=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(e[1].media.options||{},{hideAfterCount:0,maxShown:0,forceToUp:1})),a.apply(Wall,e)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(Wall,{scrollHighlightReply:function(e){(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)(e))&&(cur.options.fixed_height&&cur.scrollbar?cur.scrollbar.scrollIntoView(e,!0,Wall.highlightReply.bind(Wall,e)):(e.scrollIntoView(),Wall.highlightReply(e)))},postTooltip:(r=Wall.postTooltip,function(){let e=[].slice.call(arguments);return e[3]=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(e[3]||{},{appendEl:cur.postsOuterEl}),r.apply(this,e)}),sendPost:function(){if(!cur.sendPostBtn)return;let e=cur.wallAddMedia||{},t=e.chosenMedia||{},i=cur.wallAddMedia?e.getMedias():[],r=e.shareData||{},a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.trim)((window.Emoji?Emoji.editableVal:_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_field"))),s=cur.options.suggesting?"suggest":cur.wallType,n={act:"post",message:a,to_id:cur.postTo,type:s,status_export:"",widget_app:cur.options.app,widget_page_url:cur.options.page_url,widget_page_title:cur.options.page_title,widget_page_desc:cur.options.page_desc,widget_page_query:cur.options.page_query,hash:cur.options.post_hash},o=0;if((0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(t)&&t.length&&i.push((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.clone)(t)),i.length){let t=!1;if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(i,(function(i,s){if(!s)return;let l=this[0],u=this[1];switch(l){case"poll":let i=e.pollData();if(!i)return t=!0,!1;u=i.media,delete i.media,n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(n,i);break;case"share":if(r.share_upload_failed)break;if(r.failed||!r.url||!r.title&&(!r.images||!r.images.length)&&!r.photo_url)return cur.shareLastParseSubmitted&&(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.vkNow)()-cur.shareLastParseSubmitted<2e3?(t=!0,!1):void 0;if(u=!r.noPhoto&&_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(r.user_id)&&r.photo_id?r.user_id+"_"+r.photo_id:"",!u&&!r.share_own_image&&r.images&&r.images.length&&r.images.some((function(e){return(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isString)(e)&&e.length})))return e.uploadShare(Wall.sendPost),t=!0,!1;r.initialPattern&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.trim)(a)==r.initialPattern&&(n.message=""),r.is_vk_mini_app&&(n.is_vk_mini_app=!0,n.is_photo_edit=r.isPhotoEdit,n.image_offset=cur.shareShowImg),n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(n,{url:r.url,module:cur.module,title:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.replaceEntities)(r.title),description:(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.replaceEntities)(r.description),extra:r.extra,extra_data:r.extraData,mode:r.mode,photo_url:r.noPhoto?"":(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.replaceEntities)(r.photo_url),open_graph_data:(r.openGraph||{}).data,open_graph_hash:(r.openGraph||{}).hash});break;case"page":r.initialPattern&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.trim)(a)==r.initialPattern&&(n.message="");break;case"postpone":let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)("postpone_date"+e.lnkId);return n=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(n,{postpone:s}),void(cur.postponedLastDate=s)}this[3]&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.trim)(a)==this[3]&&(n.message=""),n["attach"+(o+1)+"_type"]=l,n["attach"+(o+1)]=u,o++})),t)return}if(!o&&!a)return void(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.elfocus)("post_field");let l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("send_post");l&&buttonLocked(l)||(cur.postAutosave&&clearTimeout(cur.postAutosave),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)("submit_post_error"),cur.postSent=!0,setTimeout((function(){WComments.eventsPause(),ajax.post("al_wall.php",Wall.fixPostParams(n),{onDone:function(e){if(e){let t={act:"a_post",post:e,width:cur.options.width,startWidth:cur.options.startWidth,hash:cur.options.post_hash,app:cur.options.app,limit:cur.options.limit,export:(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_5__.isChecked)("wcomments_export")};ajax.post("al_widget_comments.php",t,{onDone:function(e,t){"posts"==cur.section&&cur.Rpc&&cur.Rpc.callMethod("publish","widgets.comments.new_comment",e.count,e.last_comment,e.date,e.full_hash,e.pageId),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)("wcomments_posts",t),WComments.contentUpdated(e),Wall.updateMentionsIndex(),WComments.eventsProceed()},onFail(){WComments.eventsProceed()},showProgress(){lockButton((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("send_post"))},hideProgress(){Wall.clearInput(),cur.postSent=!1;let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_field");if(cur.withMentions){let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.data)(e,"mention");t&&(t.rtaEl.innerHTML="",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(t.cont),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)(e))}e.value="",e.blur(),e.phonblur(),Wall.hideEditPost(!0),cur.wallAddMedia&&cur.wallAddMedia.unchooseMedia(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)("post_warn"),cur.onWallSendPost&&cur.onWallSendPost(),unlockButton((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("send_post"))}})}},onFail:function(e){return cur.postSent=!1,!e||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("submit_post_error").innerHTML=e.length>60?'<div class="msg_text">'+e+"</div>":e,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.isVisible)("submit_post_error")||(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_11__.slideDown)("submit_post_error",100),!0)},showProgress:function(){lockButton(l)},hideProgress:function(){unlockButton(l)}})}),0))},sendReply:function(e,t,i){if(i=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({},i),window.mvcur&&mvcur.post==e)return Videoview.sendComment(e,t,i);let r,a,s=window.cur.wallLayer==e,n=s?wkcur:window.cur,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("reply_field"+e),l=o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.data)(o,"composer"),u=n.reply_to&&Wall.getReplyName(n.reply_to[0]),d=o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.data)(o,"send");if(d&&(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.isFunction)(d))return d(e,t,i);if(i.stickerId)a={message:"",attach1_type:"sticker",attach1:i.stickerId,sticker_referrer:i.sticker_referrer};else{if(a=l?Composer.getSendParams(l,Wall.sendReply.pbind(e)):{message:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.trim)(Emoji.editableVal(o))},a.delayed)return;if(!a.attach1_type&&(!a.message||(0,_shared_lib_common__WEBPACK_IMPORTED_MODULE_9__.isArray)(u)&&!u[1].indexOf(a.message)))return void Emoji.editableFocus((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("reply_field"+e),!1,!0);l?r=Composer.reset(l):window.Emoji&&Emoji.val(o,""),o.autosize&&o.autosize.update()}n.wallMyOpened=n.wallMyOpened||{},n.wallMyReplied[e]=1,n.wallMyOpened[e]=1;let c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_hash"+e)?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_hash"+e).value:n.options.post_hash,h=null;if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(a,{act:"post",type:"widget",width:n.options.width,startWidth:n.options.startWidth,reply_to:e,reply_to_msg:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)("reply_to"+e),reply_to_user:n.reply_to&&n.reply_to[0]||0,start_id:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)("start_reply"+e),from:"widget",hash:c}),n.reverse&&(a.rev=1),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_3__.browser.mobile?Wall.hideEditReply(e):(Emoji.editableFocus(o,!1,!0),Wall.cancelReplyTo(e,t)),ajax.post("al_wall.php",Wall.fixPostParams(a),{onDone:function(t,i,r,a){if("full"==n.wallType)return FullWall.onReplySent.apply(window,arguments);n.wallMyReplied[e]=0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)("reply_link"+e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)("reply_warn"+e),Wall._repliesLoaded(e,!1,i,r,a)},onFail:function(){h&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(h),l?r=Composer.restore(l,r):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.val)(o,a.message),o.autosize&&o.autosize.update()},showProgress:lockButton.pbind((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("reply_button"+e)),hideProgress:unlockButton.pbind((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("reply_button"+e))}),a.from_oid||!a.message)return;let p,f=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("replies"+e),m=-++n.wallMyRepliesCnt,g=Emoji.emojiToHTML((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.clean)(a.message),!0);p=_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isGroupId(a.reply_to_user)?(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("wall_replied_to_group"):_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(a.reply_to_user)?n.options.reply_names[a.reply_to_user]&&n.options.reply_names[a.reply_to_user][0]:null;let v=p?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.rs)(n.wallTpl.reply_link_to,{to_user:p}):"";if(h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.se)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.rs)(n.wallTpl.reply_fast,{reply_id:"0_"+m,message:g.replace(/\n/g,"<br/>"),to_link:v,date:Wall.getNowRelTime(n)})),f&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.isVisible)(f)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("reply_link"+e))(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)("reply_link"+e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)("replies_wrap"+e);else if(!n.onepost){let t=f.nextSibling;if(t&&"replies_open"==t.className&&Wall.openNewComments(e),!s){let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("wr_header",f,"a"),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass)("reply",f,"div").length+1,r=i;t&&(r=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.intval)(t.getAttribute("offs").split("/")[1])+1),(r>5||i<r)&&(t||f.insertBefore(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("a",{className:"wr_header"}),f.firstChild),Wall.updateRepliesHeader(e,t,i,r))}}n.reverse?f.insertBefore(h,f.firstChild):f.appendChild(h)},deletePost:function(e,t,i,r,a){(cur.wallLayer?wkcur:cur).wallMyDeleted[t]=1;let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post"+t),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("post_actions",s);ajax.post("al_wall.php",{act:"delete",post:t,hash:i,root:r?1:0,confirm:a?1:0,from:"widget"},{onDone:function(e,a,n){if(n){let a=showFastBox(e,n,(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("global_delete"),(function(){a.hide(),wall.deletePost(t,i,r,1)}),(0,_shared_lib_langs__WEBPACK_IMPORTED_MODULE_8__.getLang)("box_cancel"));return}a&&"posts"==cur.section&&cur.Rpc&&cur.Rpc.callMethod("publish","widgets.comments.delete_comment",a.count,a.last_comment,a.date,a.full_hash,a.pageId);let o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_post_content",s)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("feedback_row_t",s);(0,_web_lib_revertLastInlineVideo__WEBPACK_IMPORTED_MODULE_4__.revertLastInlineVideo)(o);let l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_del"+t);l?(l.innerHTML='<span class="dld_inner">'+e+"</span>",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)(l)):s.appendChild((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ce)("div",{id:"post_del"+t,className:"dld",innerHTML:'<span class="dld_inner">'+e+"</span>"})),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(o),"post_publish"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domNS)(o).className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domNS)(o)),"full_own"==cur.wallType||"full_all"==cur.wallType?(Pagination.recache(-1),FullWall.updateSummary(cur.pgCount)):"full"==cur.wallType&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(s,"reply")&&(cur.pgOffset--,cur.pgCount--,FullWall.repliesSummary(cur.pgCount)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(s,"suggest")?Wall.suggestUpdate(-1):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(s,"postponed")||"own"!=cur.wallType&&"all"!=cur.wallType||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(s,"own")&&++cur.deletedCnts.own,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(s,"all")&&++cur.deletedCnts.all,Wall.update()),WComments.contentUpdated()},showProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"ui_actions_menu_item")?lockActionsMenuItem(e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"flat_button")?lockButton(e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.addClass)(n,"post_actions_progress")},hideProgress:function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"ui_actions_menu_item")?unlockActionsMenuItem(e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(e,"flat_button")?unlockButton(e):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(n,"post_actions_progress")}});let o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("delete_post"+t);o&&o.tt&&o.tt.el&&o.tt.destroy()},restorePost:function(e,t,i){return(cur.wallLayer?wkcur:cur).wallMyDeleted[e]=0,ajax.post("al_wall.php",{act:"restore",post:e,hash:t,root:i?1:0,from:"widget"},{onDone:function(){let t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post_del"+e);if(!t)return;let i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post"+e),r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("_post_content",i)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("feedback_row_t",i);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)(r),"post_publish"==(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domNS)(r).className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.show)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domNS)(r)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hide)(t),"full_own"==cur.wallType||"full_all"==cur.wallType?(Pagination.recache(1),FullWall.updateSummary(cur.pgCount)):"full"==cur.wallType&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"reply")&&(cur.pgOffset++,cur.pgCount++,FullWall.repliesSummary(cur.pgCount)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"suggest")?Wall.suggestUpdate(1):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"postponed")||"own"!=cur.wallType&&"all"!=cur.wallType||((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"own")&&--cur.deletedCnts.own,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)(i,"all")&&--cur.deletedCnts.all,Wall.update()),WComments.contentUpdated()}}),!1},postClick:function(e,t,i){let r,a=(e||"").match(/^(-?\d+)_(wall)?(\d+)$/),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("post"+e);if(r=!(!i||!i.skipCheck)||Wall.checkPostClick(s,t),r){if(!0!==r){let e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.geByClass1)("wall_post_more",r,"a");if(e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.isVisible)(e))return e.onclick(),void(a||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.removeClass)(s,"wall_post_over"))}a&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("wcomments_posts"),"no_post_click")||window.open("wall"+a[1]+"_"+a[3],"_blank"))}},_repliesLoaded:function(e,t,i,r){let a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("replies"+e);if(!a)return;t?(cur.options.fixed_height&&cur.scrollbar?cur.scrollbar.updateAbove((function(){a.innerHTML=i})):a.innerHTML=i,setTimeout(Wall.scrollHighlightReply.pbind("post"+t),0)):a.innerHTML=i;let s=a.nextSibling;s&&"replies_open"==s.className&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.re)(s),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)(cur.options.reply_names||{},r),Wall.updateMentionsIndex()},checkTextLen:function(){},checkPostLen:function(){},replySubmitTooltip:function(){},repliesSideSetup:function(){},repliesSideClick:function(){},likesShow:function(e,t,i){i=i||{};let r=wall.parsePostId(t),a=r.type,s=r.id,n=a+s,o=e&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.gpeByClass)("_post_content",e)||wall.domPost(s),l=i.share?"_share_wrap":"_like_wrap",u=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domByClass)(o,l),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domByClass)(u,"_icon"),c=o&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.domByClass)(o,"_share_wrap");if(!d||cur.viewAsBox)return;let h=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getXY)(u)[0],p=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getXY)(d)[0]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.getSize)(d,!0)[0]/2-h-56;(0,_web_lib_tooltip_utils__WEBPACK_IMPORTED_MODULE_10__.showTooltip)(d.parentNode,{url:"/like.php",params:(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.extend)({act:"a_get_stats",object:n,has_share:c?1:""},i.share?{published:1}:{}),slide:15,shift:[-p,-3],ajaxdt:100,showdt:400,hidedt:200,dir:"auto",checkLeft:!0,reverseOffset:80,appendEl:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_14__.ge)("page_wrap"),tip:{over:function(){Wall.likesShow(e,t,i)}},typeClass:"like_tt wcomments_like_tt",className:i.cl||""})},showReplies:function(e,t,i,r){if(!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_12__.checkEvent)(r||window.event))return cur.viewAsBox?cur.viewAsBox():(cur.wallMyOpened[e]=3!=t,ajax.post("al_wall.php",{act:"get_replies",width:cur.options.width,startWidth:cur.options.startWidth,post:e,count:t,from:"widget"},{onDone:function(){let t=[].slice.call(arguments);t.unshift(e,i),Wall._repliesLoaded.apply(Wall,t),WComments.resizeWidget()},showProgress:lockButton.pbind("wrh"+e),hideProgress:unlockButton.pbind("wrh"+e)}),!1)}}),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_15__.each)(["showEditReply","markAsSpam","stickerClick","likeIt"],(function(e,t){var i;Wall[t]=(i=Wall[t],function(){if(_shared_ranges__WEBPACK_IMPORTED_MODULE_19__.Ranges.isUserId(vk.id))return i.apply(Wall,[].slice.call(arguments));Widgets.oauth()})}))}}},idle=window.requestIdleCallback,idle||(idle=e=>setTimeout((()=>e()),1)),idle((()=>{try{(0,_shared_lib_statlogs__WEBPACK_IMPORTED_MODULE_0__.statlogsValueEvent)("entries_requests",1,"comments","widgets")}catch{}}),{timeout:5e3})}if("undefined"!=typeof window&&window.partConfigEnabled?.("static_loading_execute_errors"))try{sourceFn(),window.stManager?.done?.("dist/api/widgets/comments.8c7e7c8c.js")}catch(e){throw window.stManager?.fail?.("dist/api/widgets/comments.8c7e7c8c.js",e),e}else sourceFn(),"undefined"!=typeof window&&window.stManager?.done?.("dist/api/widgets/comments.8c7e7c8c.js")},504496:(e,t,i)=>{i.d(t,{connectTrackTmrGroupsJoin:()=>o});var r=i(923284),a=(i(722007),i(32489));const s=()=>(0,r.tmrSendTimespentEvent)(r.MY_TRACKER_COUNT_EVENT_IDS.COMMUNITY_SUBSCRIBE),n=(0,a.createEffect)({name:"fx/track_group_join",handler:s}),o=e=>(0,a.sample)({clock:e.done,target:n})},265150:(e,t,i)=>{i.d(t,{connectTrackTmrGroupsJoin:()=>r.connectTrackTmrGroupsJoin});var r=i(504496)},438095:(e,t,i)=>{i.d(t,{createCacheService:()=>a});var r=i(332896);const a=e=>{const t=(0,r.getEffectorServiceDomain)(e),i=Object.create(null),a=t.createStore(Object.create(null)),s=t.createEvent("add"),n=t.createEvent("delete");return a.on(s,((e,{key:t,data:i})=>(e[t]=i,e))).on(n,((e,t)=>(delete e[t],e))),{$cache:a,add:s,delete:n,get:e=>a.getState()[e]||null,isWaited:e=>void 0!==i[e],getWaited:e=>i[e],setWaited:(e,t)=>{i[e]=t},deleteWaited:e=>{delete i[e]}}}},455704:(e,t,i)=>{i.d(t,{createUserService:()=>r.createUserService});var r=i(672603);i(289191)},289191:(e,t,i)=>{i(32489),i(497771),i(9327);var r=i(438095);i(332896),i(645964);(0,r.createCacheService)()},672603:(e,t,i)=>{i.d(t,{createUserService:()=>n});var r=i(32489),a=i(722007),s=i(497771);const n=({domain:e})=>{const t=(e,t)=>!(!e||e.id!==t.userId),i=e.createStore(null),n=e.createEffect((({params:e})=>(0,s.apiWithPrefetch)("users.get",e))),o=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("wall.subscribe",e.params)}))),l=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("wall.unsubscribe",e.params)}))),u=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("video.liveSubscribe",e.params)}))),d=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("video.liveUnsubscribe",e.params)}))),c=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,a.api)("fave.addUser",e.params)}))),h=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,a.api)("fave.removeUser",e.params)}))),p=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("account.ban",e.params)}))),f=e.createEffect((async e=>({userId:e.params.owner_id,response:await(0,a.api)("account.unban",e.params)}))),m=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,a.api)("bestFriends.add",e.params)}))),g=e.createEffect((async e=>({userId:e.params.user_id,response:await(0,a.api)("bestFriends.delete",e.params)})));return(0,r.sample)({clock:n.doneData,fn:e=>e[0]||null,target:i}),(0,r.sample)({clock:o.doneData,source:i,filter:t,fn:e=>({...e,is_subscribed:1}),target:i}),(0,r.sample)({clock:l.doneData,source:i,filter:t,fn:e=>({...e,is_subscribed:0}),target:i}),(0,r.sample)({clock:u.doneData,source:i,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:0}:void 0}),target:i}),(0,r.sample)({clock:d.doneData,source:i,filter:t,fn:e=>({...e,video_live:e.video_live?{...e.video_live,is_notifications_blocked:1}:void 0}),target:i}),(0,r.sample)({clock:c.doneData,source:i,filter:t,fn:e=>({...e,is_favorite:1}),target:i}),(0,r.sample)({clock:h.doneData,source:i,filter:t,fn:e=>({...e,is_favorite:0}),target:i}),(0,r.sample)({clock:p.doneData,source:i,filter:t,fn:e=>({...e,blacklisted_by_me:1}),target:i}),(0,r.sample)({clock:f.doneData,source:i,filter:t,fn:e=>({...e,blacklisted_by_me:0}),target:i}),(0,r.sample)({clock:m.doneData,source:i,filter:t,fn:e=>({...e,is_best_friend:!0}),target:i}),(0,r.sample)({clock:g.doneData,source:i,filter:t,fn:e=>({...e,is_best_friend:!1}),target:i}),{fetchUserFx:n,subscribeToPostsFx:o,unsubscribeFromPostsFx:l,subscribeToVideoLiveFx:u,unsubscribeFromVideoLiveFx:d,faveAddUserFx:c,faveRemoveUserFx:h,accountBanFx:p,accountUnbanFx:f,bestFriendAddFx:m,bestFriendDeleteFx:g,$user:i,domain:e}}},849765:(e,t,i)=>{i.d(t,{apiFaveAddNarrative:()=>a,apiFaveRemoveNarrative:()=>s});var r=i(722007);function a(e){return(0,r.api)("fave.addNarrative",e)}function s(e){return(0,r.api)("fave.removeNarrative",e)}},539846:(e,t,i)=>{i.d(t,{createFaveService:()=>s});var r=i(32489),a=i(849765);const s=({domain:e})=>{const t=e.createEvent("fire/faveAddNarrative"),i=e.createEvent("fire/faveRemoveNarrative"),s=e.createEffect("fx/faveAddNarrative"),n=e.createEffect("fx/faveRemoveNarrative");return s.use(a.apiFaveAddNarrative),n.use(a.apiFaveRemoveNarrative),(0,r.sample)({clock:t,target:s}),(0,r.sample)({clock:i,target:n}),{fireAddNarrative:t,fireRemoveNarrative:i,addNarrativeFx:s,removeNarrativeFx:n}}},412251:(e,t,i)=>{i.d(t,{findOwnerById:()=>a});var r=i(415086);const a=(e=0,t=[],i=[])=>{if(e)return r.Ranges.isUserId(e)?t.find((t=>t?.id===e)):i.find((t=>t?.id===Math.abs(e)))}},529931:(e,t,i)=>{i.d(t,{StickerTypes:()=>o,StoryBlockType:()=>s,StoryEntryPoint:()=>a,StoryListName:()=>n,StoryPollBackgroundType:()=>d,StoryType:()=>r});var r=function(e){return e.PHOTO="photo",e.VIDEO="video",e.LIVE="live",e}({}),a=function(e){return e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar",e.GROUP_ADD_STORIES_PAGE="group_add_stories_page",e.MUSIC_COVER_SHARING="music_cover_sharing",e}({}),s=function(e){return e.stories="stories",e.promoStories="promo_stories",e.discover="discover",e.liveActive="live_active",e.liveFinished="live_finished",e}({}),n=function(e){return e.feed="feed",e.discover="discover",e}({});const o={hashtag:1,mention:2,question:3,place:4,music:5,storyReply:6,owner:7,link:8,marketItem:9,post:10,poll:11,sticker:12,app:13,situationalTheme:14,playlist:15,videoButton:16,situationalTemplate:17,spoiler:18,service_yc_item:19,photo:20,album:21},l={situationalTemplate:o.situationalTemplate},u=Object.values(l);Object.values(o).filter((e=>!u.includes(e)));var d=function(e){return e.photo="photo",e.gradient="gradient",e.default="default",e}({})},660327:(e,t,i)=>{i.d(t,{apiLikesAdd:()=>a,apiLikesDelete:()=>s});var r=i(722007);function a(e){return(0,r.api)("likes.add",e)}function s(e){return(0,r.api)("likes.delete",e)}},981586:(e,t,i)=>{},109943:(e,t,i)=>{i.d(t,{createLikesService:()=>r.createLikesService});var r=i(86952);i(981586)},86952:(e,t,i)=>{i.d(t,{createLikesService:()=>s});var r=i(32489),a=i(660327);const s=({domain:e})=>{const t=e.createEvent("fire/likesAdd"),i=e.createEvent("fire/likesDelete"),s=e.createEffect("fx/likesAdd"),n=e.createEffect("fx/likesDelete");return s.use(a.apiLikesAdd),n.use(a.apiLikesDelete),(0,r.sample)({clock:t,target:s}),(0,r.sample)({clock:i,target:n}),{fireAdd:t,fireDelete:i,addFx:s,deleteFx:n}}},596749:(e,t,i)=>{i.d(t,{apiMessagesSend:()=>a});var r=i(722007);function a(e){return(0,r.api)("messages.send",e)}},870670:(e,t,i)=>{i.d(t,{createMessagesService:()=>s});var r=i(32489),a=i(596749);const s=({domain:e})=>{const t=e.createEvent("fire/messageSend"),i=e.createEffect("fx/messageSend");return i.use(a.apiMessagesSend),(0,r.sample)({clock:t,target:i}),{fireMessagesSend:t,sendFx:i}}},81842:(e,t,i)=>{i.d(t,{apiNarrativesBatchEdit:()=>n,apiNarrativesCreate:()=>a,apiNarrativesDelete:()=>o,apiNarrativesEdit:()=>s,apiNarrativesGetById:()=>l,apiNarrativesGetCustomCoverUploadServer:()=>p,apiNarrativesGetFeedBlock:()=>u,apiNarrativesGetFromOwner:()=>d,apiNarrativesReorder:()=>h,apiNarrativesSaveCustomCover:()=>c});var r=i(722007);function a(e){return(0,r.api)("narratives.create",e)}function s(e){return(0,r.api)("narratives.edit",e)}function n(e){return(0,r.api)("narratives.batchEdit",e)}function o(e){return(0,r.api)("narratives.delete",e)}function l(e){return(0,r.api)("narratives.getById",e)}function u(e={}){return(0,r.api)("narratives.getFeedBlock",e)}function d(e){return(0,r.api)("narratives.getFromOwner",e)}function c(e){return(0,r.api)("narratives.saveCustomCover",e)}function h(e){return(0,r.api)("narratives.reorder",e)}function p(e){return(0,r.api)("narratives.getCustomCoverUploadServer",e)}},288977:(e,t,i)=>{i.d(t,{createNarrativesService:()=>s});var r=i(32489),a=i(81842);const s=({domain:e})=>{const t=e.createEvent("fire/narrativesGetById"),i=e.createEvent("fire/narrativesGetFromOwner"),s=e.createEvent("fire/narrativesGetFeedBlock"),n=e.createEvent("fire/narrativesCreate"),o=e.createEvent("fire/narrativesEdit"),l=e.createEvent("fire/narrativesBatchEdit"),u=e.createEvent("fire/narrativesDelete"),d=e.createEvent("fire/narrativesSaveCustomCover"),c=e.createEvent("fire/narrativesReorder"),h=e.createEffect("fx/narrativesGetById"),p=e.createEffect("fx/narrativesGetFromOwner"),f=e.createEffect("fx/narrativesGetFeedBlock"),m=e.createEffect("fx/narrativesCreate"),g=e.createEffect("fx/narrativesEdit"),v=e.createEffect("fx/narrativesBatchEdit"),b=e.createEffect("fx/narrativesDelete"),_=e.createEffect("fx/narrativesSaveCustomCover"),y=e.createEffect("fx/narrativesReorder");return h.use(a.apiNarrativesGetById),p.use(a.apiNarrativesGetFromOwner),f.use(a.apiNarrativesGetFeedBlock),m.use(a.apiNarrativesCreate),g.use(a.apiNarrativesEdit),v.use(a.apiNarrativesBatchEdit),b.use(a.apiNarrativesDelete),_.use(a.apiNarrativesSaveCustomCover),y.use(a.apiNarrativesReorder),(0,r.sample)({clock:t,target:h}),(0,r.sample)({clock:i,target:p}),(0,r.sample)({clock:s,target:f}),(0,r.sample)({clock:n,target:m}),(0,r.sample)({clock:o,target:g}),(0,r.sample)({clock:l,target:v}),(0,r.sample)({clock:u,target:b}),(0,r.sample)({clock:d,target:_}),(0,r.sample)({clock:c,target:y}),{fireGetById:t,fireGetFromOwner:i,fireGetFeedBlock:s,fireCreate:n,fireEdit:o,fireBatchEdit:l,fireDelete:u,fireSaveCustomCover:d,fireReorder:c,getByIdFx:h,getFromOwnerFx:p,getFeedBlockFx:f,createFx:m,editFx:g,batchEditFx:v,deleteFx:b,saveCustomCoverFx:_,reorderFx:y}}},536821:(e,t,i)=>{i.d(t,{apiPollsCreate:()=>s,apiPollsGetById:()=>a});var r=i(722007);function a(e){return(0,r.api)("polls.getById",e)}function s(e){return(0,r.api)("polls.create",e)}},215766:(e,t,i)=>{i.d(t,{createPollsService:()=>s});var r=i(32489),a=i(536821);const s=({domain:e})=>{const t=e.createEvent("fire/pollsGetById"),i=e.createEvent("fire/pollsCreate"),s=e.createEffect("fx/pollsGetById"),n=e.createEffect("fx/pollsCreate");return s.use(a.apiPollsGetById),n.use(a.apiPollsCreate),(0,r.sample)({clock:t,target:s}),(0,r.sample)({clock:i,target:n}),{fireGetById:t,fireCreate:i,getByIdFx:s,createFx:n}}},979333:(e,t,i)=>{i.d(t,{ArticleTtsActionType:()=>a,articleTtsActionStatController:()=>s});var r=i(642402),a=function(e){return e.START="start",e.PAUSE="pause",e.CONTINUE="continue",e.SEEK="seek",e.CLOSE="close",e.P10="10p",e.P25="25p",e.P50="50p",e.P75="75p",e.P95="95p",e.P99="99p",e.P100="100p",e}({});const s=new class{logEvent(e,t){const i={type:"type_marusia_reading_item",type_marusia_reading_item:e};this.actionStatCollector.logEvent(i,t)}constructor(){this.productStatCollector=new r.ProductionStatCollector,this.actionStatCollector=new r.ActionStatCollector(this.productStatCollector)}}},632770:(e,t,i)=>{i.d(t,{OPENED_REACTED_USERS_DEFAULT_REACTION_ID:()=>l,REACTION_ID_DEFAULT:()=>r,REACTION_ID_MAX:()=>a,REACTION_ID_MIN:()=>s,REACTION_ID_UNSET:()=>n,REACTION_SET_ITEMS_MIN_COUNT:()=>o});const r=0,a=7,s=0,n=void 0,o=2,l=r},909238:(e,t,i)=>{i.d(t,{reactionCountsBrandUnwrap:()=>a,reactionCountsBrandWrap:()=>s});var r=i(998073);const a=e=>(0,r.unwrap)(e),s=e=>(0,r.wrap)(e)},552425:(e,t,i)=>{i.d(t,{prepareReactionMenuSet:()=>a});i(632770),i(909238),i(351118);Number.isInteger;const r=(e,t)=>0===e.length?"":((e,t,i=!0)=>e.reduce(((e,r)=>{const a=t(r),s=t(e);return s===a?i?e:r:s<a?e:r})))(e,(e=>(t.width-e.width)**2+(t.height-e.height)**2),!1).url,a=(e,t,i)=>{const a=t.map((({asset:e,color_sets:t,id:a,score:s,title:n})=>({animationURL:e.animation_url||void 0,backgroundColor:t?.background,id:a,imageMenuURL:r(e.images,i.imageMenuSize),imagePreviewURL:"imagePreviewSize"in i?r(e.images,i.imagePreviewSize):void 0,imageStoryPanelURL:"imageStoryPanelSize"in i?r(e.images,i.imageStoryPanelSize):void 0,imageStoryPreviewURL:"imageStoryPreviewSize"in i?r(e.images,i.imageStoryPreviewSize):void 0,score:s,title:n,titleColor:t?.foreground}))),s={};return a.forEach((e=>{s[e.id]=e})),{id:e,items:a,itemsById:s}}},998073:(e,t,i)=>{i.d(t,{unwrap:()=>r,wrap:()=>a});const r=e=>e,a=e=>e},19504:(e,t,i)=>{i.d(t,{apiStatsTrackEvents:()=>a});var r=i(722007);function a(e){return(0,r.api)("stats.trackEvents",e)}},273253:(e,t,i)=>{i.d(t,{STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION:()=>r,STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME:()=>a});const r="stories_viewer_navigation",a="stories_viewing_start_time"},314871:(e,t,i)=>{i.d(t,{createStatsService:()=>s});var r=i(32489),a=i(19504);const s=({domain:e})=>{const t=e.createEvent("fire/statsTrackEvents"),i=e.createEffect("fx/statsTrackEvents");return i.use(a.apiStatsTrackEvents),(0,r.sample)({clock:t,target:i}),{fireTrackEvents:t,trackEventsFx:i}}},345522:(e,t,i)=>{i.d(t,{apiStoriesAskQuestion:()=>_,apiStoriesBanOwner:()=>x,apiStoriesBanQuestionAuthor:()=>w,apiStoriesDelete:()=>b,apiStoriesDeleteQuestion:()=>y,apiStoriesGet:()=>a,apiStoriesGetArchive:()=>n,apiStoriesGetById:()=>s,apiStoriesGetDetailedStats:()=>h,apiStoriesGetPhotoUploadServer:()=>k,apiStoriesGetQuestions:()=>d,apiStoriesGetReplies:()=>l,apiStoriesGetStats:()=>c,apiStoriesGetVideoUploadServer:()=>T,apiStoriesGetViewers:()=>o,apiStoriesHideAllReplies:()=>P,apiStoriesHidePrivacyBlock:()=>v,apiStoriesHideReply:()=>A,apiStoriesMarkNotInterested:()=>f,apiStoriesMarkSeen:()=>g,apiStoriesMarkSkipped:()=>p,apiStoriesSave:()=>E,apiStoriesSearch:()=>m,apiStoriesSeenReplies:()=>u,apiStoriesSetDiscoverVisible:()=>C,apiStoriesUnbanOwner:()=>$,apiStoriesUnbanQuestionAuthor:()=>S});var r=i(722007);i(497771);function a(e){return(0,r.api)("stories.get",e)}function s(e){return(0,r.api)("stories.getById",e)}function n(e){return(0,r.api)("stories.getArchive",e)}function o(e){return(0,r.api)("stories.getViewers",e)}function l(e){return(0,r.api)("stories.getReplies",e)}function u(e){return(0,r.api)("stories.seenReplies",e)}function d(e){return(0,r.api)("stories.getQuestions",e)}function c(e){return(0,r.api)("stories.getStats",e)}function h(e){return(0,r.api)("stories.getDetailedStats",e)}function p(e){return(0,r.api)("stories.markSkipped",e)}function f(e){return(0,r.api)("stories.markNotInterested",e)}function m(e){return(0,r.api)("stories.search",e)}function g(e){return(0,r.api)("stories.markSeen",e)}function v(e){return(0,r.api)("stories.hidePrivacyBlock",e)}function b(e){return(0,r.api)("stories.delete",e)}function _(e){return(0,r.api)("stories.askQuestion",e)}function y(e){return(0,r.api)("stories.deleteQuestion",e)}function w(e){return(0,r.api)("stories.banQuestionAuthor",e)}function S(e){return(0,r.api)("stories.unbanQuestionAuthor",e)}function k(e){return(0,r.api)("stories.getPhotoUploadServer",e)}function T(e){return(0,r.api)("stories.getVideoUploadServer",e)}function E(e){return(0,r.api)("stories.save",e)}function x(e){return(0,r.api)("stories.banOwner",e)}function $(e){return(0,r.api)("stories.unbanOwner",e)}function C(e){return(0,r.api)("stories.setDiscoverVisible",e)}function A(e){return(0,r.api)("stories.hideReply",e)}function P(e){return(0,r.api)("stories.hideAllReplies",e)}},741127:(e,t,i)=>{i.d(t,{STORIES_ARCHIVE_START_TIME:()=>a,STORIES_EDITOR_FONTS:()=>s});var r=i(225590);const a=1559032200,s=[{label:r.getLang("stories_creator_text_label_modern"),fontFamily:"TT Firs Neue"},{label:r.getLang("stories_creator_text_label_playful"),fontFamily:"TT Knickerbockers Script"},{label:r.getLang("stories_creator_text_label_aesthetic"),fontFamily:"TT Knickerbockers Grotesk"},{label:r.getLang("stories_creator_text_label_dynamic"),fontFamily:"TT Commons Bold",fontStyle:"italic"},{label:r.getLang("stories_creator_text_label_classic"),fontFamily:"TT Barrels Trl"},{label:r.getLang("stories_creator_text_label_elegant"),fontFamily:"TT Barrels Trl Italic",fontStyle:"italic"},{label:r.getLang("stories_creator_text_label_rounded"),fontFamily:"TT Rounds Neue",textTransform:"uppercase"},{label:r.getLang("stories_creator_text_label_standard"),fontFamily:"TT Commons"},{label:r.getLang("stories_creator_text_label_handwritten"),fontFamily:"TT Lovelies Script"},{label:r.getLang("stories_creator_text_label_bookish"),fontFamily:"TT Phobos"}]},573527:(e,t,i)=>{var r=i(684531),a=i(87263);r.storiesDomain.createEffect({name:"fire/storiesGetFeedback",handler:({ownerId:e,storyId:t,pollId:i})=>{const s=((e,t)=>({0:{owner_id:e,story_id:t,extended:1,count:100,fields:(0,a.makeOwnerFields)(["photo_100","photo_50"])},1:{owner_id:e,story_id:t,extended:1,fields:(0,a.getStoryOwnerFields)()},2:{owner_id:e,story_id:t},3:{owner_id:e,story_id:t,extended:1,fields:(0,a.makeOwnerFields)(["domain","first_name_dat","first_name_ins","last_name_ins","last_name_dat","first_name_gen","last_name_gen"]),count:100},4:{owner_id:e,story_id:t}}))(e,t);return Promise.allSettled([r.storiesService.getViewersFx(s[0]),r.storiesService.getRepliesFx(s[1]),r.storiesService.getQuestionsFx(s[3]),i?r.pollsService.getByIdFx({owner_id:e,poll_id:i}):Promise.resolve(null),r.storiesService.getDetailedStatsFx(s[4])]).then((e=>e.map((e=>"fulfilled"===e.status?e?.value:null)))).finally((()=>{r.storiesService.seenRepliesFx(s[2])}))}})},764046:(e,t,i)=>{i.d(t,{STORIES_ARCHIVE_START_TIME:()=>s.STORIES_ARCHIVE_START_TIME,STORIES_EDITOR_FONTS:()=>s.STORIES_EDITOR_FONTS,apiStoriesGetArchive:()=>a.apiStoriesGetArchive,createStoriesService:()=>r.createStoriesService,storiesService:()=>n.storiesService});var r=i(125329),a=(i(844925),i(345522)),s=i(741127),n=i(684531);i(573527)},16957:(e,t,i)=>{i.d(t,{FEED_STORIES_BLOCK_OWNER_FIELDS:()=>a,FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:()=>r});const r=["photo_100"],a=["first_name","last_name","first_name_gen","last_name_gen","first_name_ins","last_name_ins","screen_name","name","is_member","is_closed","photo_50","photo_100","photo_200","friend_status","verified","sex"]},87263:(e,t,i)=>{i.d(t,{getStoryOwnerFields:()=>a,makeOwnerFields:()=>s});var r=i(16957);function a(e=!1){return s(e?r.FEED_STORIES_BLOCK_OWNER_MINIMIZED_FIELDS:r.FEED_STORIES_BLOCK_OWNER_FIELDS)}function s(e){return e.join(",")}},561596:(e,t,i)=>{i.d(t,{transformClickableStickers:()=>g});var r=i(351118),a=i(645964),s=i(9467),n=i(312020),o=i(950003),l=i(225590),u=i(412251),d=i(297520),c=i(529931);const h={hashtag:c.StickerTypes.hashtag,mention:c.StickerTypes.mention,question:c.StickerTypes.question,place:c.StickerTypes.place,music:c.StickerTypes.music,story_reply:c.StickerTypes.storyReply,owner:c.StickerTypes.owner,link:c.StickerTypes.link,market_item:c.StickerTypes.marketItem,post:c.StickerTypes.post,poll:c.StickerTypes.poll,sticker:c.StickerTypes.sticker,app:c.StickerTypes.app,situational_theme:c.StickerTypes.situationalTheme,playlist:c.StickerTypes.playlist,clip:c.StickerTypes.videoButton,vk_video:c.StickerTypes.videoButton,situational_template:c.StickerTypes.situationalTemplate,spoiler:c.StickerTypes.spoiler,service_yc_item:c.StickerTypes.service_yc_item,photo:c.StickerTypes.photo,album:c.StickerTypes.album},p={transparent:1,blue_gradient:2,red_gradient:3,underline:4,blue:5,green:6,white:7,question_reply:8,light:9,impressive:10,dark:11,accent_background:12,accent_text:13,dark_unique:14,light_unique:15,light_text:18,dark_text:19,black:20,dark_without_bg:21,light_without_bg:22,rectangle:23,circle:24,poop:25,heart:26,star:27,album:28,horizontal:29,equalizer:30,header_meta:31,preview:32,miniature:33,fullview:34,cta:35,sticker:36,sticker_and_cta:37,accent:38},f=(e,t=6)=>isNaN(e)?NaN:Number(e.toFixed(t)),m=/^\[(id|club)(\d+)\|(.*)]$/;function g(e,t=[],i=[],g){const v=e?.clickable_stickers;if(!(v&&Object.values(v).length&&v.original_width&&v.original_height))return{original_width:0,original_height:0,stickers:[]};let b=v.original_width,_=v.original_height;Number((_/b).toFixed(2))>1.78&&(_=1.78*b);const y=(v.original_height-_)/2,w=b/100,S=_/100;return{original_width:b,original_height:_,stickers:v?.clickable_stickers?.length?v.clickable_stickers.reduce(((e,v)=>{if(!v)return e;if(g&&"situational_template"===v.type&&!(0,s.partConfigEnabled)("stories_mvk_sticker_template"))return e;if(!g&&"situational_template"===v.type&&!(0,s.partConfigEnabled)("stories_sticker_template"))return e;const{clickable_area:b=[]}=v;if(b.length<4)return e;const _=Math.sqrt(Math.pow(b[1].x-b[0].x,2)+Math.pow(b[1].y-b[0].y,2)),k=Math.sqrt(Math.pow(b[1].x-b[2].x,2)+Math.pow(b[1].y-b[2].y,2));if(!_||!k)return e;const T=b[1].x-b[0].x;let E=180*Math.acos(T/_)/Math.PI;isNaN(E)&&(E=0),b[1].y<b[0].y&&(E=-E);const x=h[v.type],$={id:v.id,type:x,top:f((b[0].y-y)/S/100),left:f(b[0].x/w/100),width:f(_/w/100),height:f(k/S/100),rotate:f(E)};v.style&&($.style=p[v.style],$.stickerStyle=v.style);let C=!1;switch(x){case c.StickerTypes.hashtag:v.hashtag?$.hashtag=v.hashtag:C=!0;break;case c.StickerTypes.mention:{const e=v.mention?.match(m),r=e?.[1],s=Number(e?.[2]);if(!s||isNaN(s)){C=!0;break}const n="id"===r&&t.find((({id:e})=>e===s)),o=!n&&"club"===r&&i.find((({id:e})=>e===s));n?($.mentionedPhotoUrl=n.photo_100||n.photo_50||"",$.mentionedOwnerHref=(0,a.getOwnerHref)(n),$.mentionedText=(0,a.getOwnerFullName)(n)):o?($.mentionedText=o.name||"",$.mentionedPhotoUrl=o.photo_100||o.photo_50||"",$.mentionedOwnerHref=(0,a.getOwnerHref)(o)):C=!0;break}case c.StickerTypes.question:$.question=v.question||"";break;case c.StickerTypes.place:v.place_id?$.placeId=v.place_id:C=!0;break;case c.StickerTypes.music:if(!v.audio){C=!0;break}$.audioId=`${v.audio.owner_id}_${v.audio.id}`,$.audioData=JSON.stringify((0,o.apiAudioToAudioTuple)(v.audio)),v.audio_restrictions&&($.audioRestriction={code:v.audio_restrictions.id,title:v.audio_restrictions.title,buttonText:v.audio_restrictions.button?.title||"",buttonUrl:v.audio_restrictions.button?.action?.url||""});break;case c.StickerTypes.playlist:if(!v.playlist){C=!0;break}$.playlistOwnerId=v.playlist.owner_id,$.playlistId=v.playlist.id,$.playlistFollowed=Boolean(v.playlist.followed);break;case c.StickerTypes.storyReply:v.owner_id&&($.ownerId=v.owner_id),$.link=(0,a.getOwnerHref)((0,u.findOwnerById)(v.owner_id,t,i)),v.story_id?$.storyId=v.story_id:$.isExpired=!0;break;case c.StickerTypes.owner:v.owner_id&&($.ownerId=v.owner_id),$.link=(0,a.getOwnerHref)((0,u.findOwnerById)(v.owner_id,t,i));break;case c.StickerTypes.link:v.link_object?($.link=v.link_object.url?(0,d.wrapAwayIfExternal)(v.link_object.url,!0):"",$.tooltipText=v.tooltip_text||""):C=!0;break;case c.StickerTypes.marketItem:if(v.market_item)if($.photoUrl=v.market_item.thumb&&(0,r.getPhotoSize)(v.market_item.thumb,50*devicePixelRatio)?.url||"",$.isRestricted=!1,g)$.link=`/product${v.market_item.owner_id}_${v.market_item.id}`;else{const e=(0,a.getOwnerHref)((0,u.findOwnerById)(v.market_item.owner_id,t,i));$.link=`${e}?w=product${v.market_item.owner_id}_${v.market_item.id}`,$.seoSlug=v.market_item.seo_slug}else C=!0;break;case c.StickerTypes.service_yc_item:const e=window.location;try{if(!v.link_object?.title||!v.link_object?.url){C=!0;break}const t=new URL(v.link_object.url);$.link=e.origin+t.pathname+t.search,$.tooltipText=v.link_object.title}catch{C=!0}break;case c.StickerTypes.photo:v.photo_id&&v.photo_owner_id?($.photoId=v.photo_id,$.photoOwnerId=v.photo_owner_id):C=!0;break;case c.StickerTypes.post:v.post_owner_id&&($.postOwnerId=v.post_owner_id),v.post_id?$.postId=v.post_id:C=!0;break;case c.StickerTypes.poll:v.poll?($.pollId=v.poll.id,$.pollOwnerId=v.poll.owner_id):C=!0;break;case c.StickerTypes.sticker:v.sticker_pack_id?($.stickerPackId=v.sticker_pack_id,v.sticker_id&&($.stickerId=v.sticker_id),$.tooltipText=(0,l.getLang)("stories_view_sticker_pack")):C=!0;break;case c.StickerTypes.situationalTheme:v.situational_theme_id?($.situationalAppId=n.SITPOSTING_APP_ID,$.situationalThemeId=v.situational_theme_id):C=!0;break;case c.StickerTypes.videoButton:v.clip_id||v.video_id?(v.owner_id&&($.videoOwnerId=v.owner_id),$.videoId=v.clip_id||v.video_id||0,$.videoType=v.clip_id?"clip":"video",$.tooltipText=v.clip_id?(0,l.getLang)("stories_link_attach_clip"):(0,l.getLang)("stories_link_attach_video")):C=!0;break;case c.StickerTypes.situationalTemplate:v.situational_theme_id?($.situationalAppId=n.SITPOSTING_APP_ID,$.situationalThemeId=v.situational_theme_id,v.situational_replied_users&&($.situationalRepliedUsers=v.situational_replied_users,$.situationalRepliedAvatars=v.situational_replied_users?.items?.map((e=>{const{photo_100:r}=t.find((t=>t.id===e))||{},{photo_100:a}=i.find((t=>t.id===e))||{},s=r||a;if(s)return{photo_100:s}})).filter((e=>Boolean(e)))||[])):C=!0;break;default:C=!0}return C||e.push($),e}),[]):[]}}},466686:(e,t,i)=>{i(225590),i(351118),i(415086),i(645964),i(529931)},235709:(e,t,i)=>{i.d(t,{transformGetNarrativesResponseToLegacy:()=>r.transformGetNarrativesResponseToLegacy,transformStoryArchiveResponse:()=>a.transformStoryArchiveResponse,transformStoryGetApiResponseToLegacyFormat:()=>s.transformStoryGetApiResponseToLegacyFormat});i(561596);var r=i(557651),a=i(6285),s=i(262084);i(466686)},262084:(e,t,i)=>{i.d(t,{transformStoryGetApiResponseToLegacyFormat:()=>b});var r=i(793766),a=i(418562),s=i(207402),n=i(645964),o=i(7258),l=i(529931),u=i(225590),d=i(351118),c=i(326107),h=i(412251),p=i(561596),f=(i(557651),i(552425)),m=i(9467),g=i(970343),v=i(912479);function b(e,t,i){const{items:r,profiles:s=[],groups:n=[],reaction_sets:o}=e;return r.map((e=>{const r=e.owner_id||e.stories?.[0]?.owner_id||0,u=(0,h.findOwnerById)(r,s,n)||{id:r},d=(0,m.partConfigEnabled)("stories_preview_for_minimized")&&"feed"===t&&"discover"===e.type?[]:e.stories?.filter(Boolean)||[],c=t===l.StoryListName.feed||t===l.StoryListName.discover,p={id:e.id||(0,a.default)(),author:_(u,s,d[0]?.also_subscribed),has_unseen:e.has_unseen,items:d.map((e=>y(e,u,s,n,i,t))),track_code:e.track_code,can_blacklist:c,app:e.app&&(f=e.app,{url:`/app${f.id}`,name:f.title,photoUrl:f.icon_139||f.icon_150||f.icon_75||""}),type:e.type,send_mask_hash:"",remove_from_blacklist_hash:"",is_narrative:!1,next_from:""};var f;return e.grouped?.length&&(p.grouped=b({items:e.grouped,profiles:s,groups:n},t,i)),o&&(p.reaction_set=w(o)),p}))}function _(e,t=[],i){const r=e.verified?'<div class="page_verified"></div>':"",a=function(e,t=[]){if(!e)return;const i=[],r=e.user_ids||[];return r.forEach((e=>{const r=t.find((t=>t.id===e));r&&i.push({photo_url:r.photo_50||r.photo_100||"",href:(0,n.getOwnerHref)(r),name:r.first_name||"",sex:r.sex||0})})),{total_count:e.count||0,owners:i}}(i,t);if((0,n.isOwnerUser)(e)){const t=e.id,i=e.first_name||"",s=e.last_name||"",o=e.first_name_gen||"",l=e.last_name_gen||"",u=e.first_name_ins||"",c=(0,n.getOwnerFullName)(e),h=s?`${o} ${l}`:o;return{id:t,name:(0,d.escape)(c),name_get:(0,d.escape)(h),firstName:(0,d.escape)(i),first_name_gen:(0,d.escape)(o),first_name_ins:(0,d.escape)(u),photo:e.photo_100||e.photo_50||"",href:(0,n.getOwnerHref)(e),verify:r,gender:e.sex||0,can_follow:k(e),also_subscribed:a}}const s=-e.id,o=(0,d.escape)(e.name||"");return{id:s,name:o,name_get:o,firstName:o,first_name_gen:o,first_name_ins:o,photo:e.photo_100||e.photo_50||"",href:(0,n.getOwnerHref)(e),verify:r,gender:0,can_follow:k(e),also_subscribed:a}}function y(e,t,i,r,a,f){let m,b,_,y,w;if(e.mask?.owner_id){const t=(0,h.findOwnerById)(e.mask?.owner_id,i,r);t&&(m=t.screen_name,(0,n.isOwnerUser)(t)&&(b=t.sex))}const k=T(t,e),A=!k&&(f===l.StoryListName.feed||f===l.StoryListName.discover);return _=(0,p.transformClickableStickers)(e,i,r,a),y=(0,v.toStoryLink)(e,_),w=!!y&&"audio"===y.object_type,{owner_id:e.owner_id,raw_id:`${e.owner_id}_${e.id}`,date:(0,u.getSmDate)(e.date||0),time:e.date||0,type:C(e),unread:!e.seen,canLike:Boolean(e.can_like),can_comment:E(e),can_share:Boolean(e.can_share),can_remove:x(e,t),can_delete_with_reason:Boolean(e.can_delete_with_reason),can_manage:k,can_ask:Boolean(e.can_ask),can_ask_anonymous:Boolean(e.can_ask_anonymous),canAddToNarrative:e.can_use_in_narrative,stats:{follow:{event_type:"subscribe",rhash:""},url_view:{event_type:"url_view",rhash:""}},isLiked:Boolean(e.is_liked),likesCount:e.likes_count||0,reaction_set_id:e.reaction_set_id||"",user_reaction_id:e.user_reaction_id||0,preview_url:e.blurred_preview||"",preview_thumb_hash:e.photo?.thumb_hash||e.video?.thumb_hash,needMute:Boolean(e.need_mute),muteReply:Boolean(e.mute_reply),isPromo:Boolean(e.is_promo),isProfileQuestion:Boolean(e.is_profile_question),promoCaption:e.is_promo&&e.caption||"",track_code:e.track_code||"",video:{owner_id:e.owner_id,video_id:e.video?.id||0,duration:e.video?.duration||0},vkVideoConfig:e.video?.ov_id?(0,g.constructVideoData)(e.video):void 0,link:y??void 0,isPartOfNarrative:Boolean(e.narratives_count),report_hash:"",maskOwnerDomain:m,maskOwnerSex:b,can_hide_reply:$(e,i,r),noSound:Boolean(e.no_sound),isNewQuestions:k&&Boolean(e.questions?.new),views:Boolean(e.views)?(0,o.formatCount)(e.views||0):"",needShowEmptyStats:Boolean(e.need_show_empty_stats),is_expired:Boolean(e.is_expired),is_deleted:Boolean(e.is_deleted),is_private:!Boolean(e.can_see),isAds:Boolean(e.is_ads),isOneTime:Boolean(e.is_one_time),isOneTimeSeen:Boolean(e.is_one_time)&&!Boolean(e.can_see),seenProgress:0,replies:e.replies?.count?(0,o.formatCount)(e.replies.count):"",replies_new_counter:e.replies?.new||0,clickable_stickers:_,canMarkNotInterested:A,photo_url:e.photo?.sizes&&(0,d.getPhotoSize)(e.photo.sizes,(0,c.isRetina)()?1200:600)?.url||"",small_preview:S(e,a),smallest_preview:S(e,a,!0),video_url:e.video?.files?(0,s.getVideoBestQualityUrl)(e.video.files):"",first_frame:e.video?.first_frame&&(0,d.getPhotoSize)(e.video?.first_frame,800)?.url||"",repliesCountText:"",authorId:0,isMusicCover:w,is_authors_ads:e.is_authors_ads,advertiser_info_url:e.advertiser_info_url,ad_marker:e.ad_marker,caption:e.caption,is_best_friends_privacy:e.is_best_friends_privacy,parent_story:e.parent_story}}function w(e){return e.map((({id:e,items:t})=>(0,f.prepareReactionMenuSet)(e,t.map((e=>({...e,id:e.id}))),{imageMenuSize:{width:96,height:96},imagePreviewSize:{width:32,height:32},imageStoryPanelSize:{width:128,height:128},imageStoryPreviewSize:{width:40,height:40}})))}function S(e,t=!1,i=!1){const r=e.photo?.sizes;if(r)return(0,d.getPhotoSize)(r,t||i?10:(0,c.isRetina)()?600:300)?.url||"";const a=e.video?.first_frame;return a&&(0,d.getPhotoSize)(a,t||i?10:320)?.url||""}function k(e){return(0,n.isOwnerUser)(e)?window.vk.id!==e.id&&(e.friend_status===r.FriendsFriendStatusStatusEnumNames.NOT_A_FRIEND||e.friend_status===r.FriendsFriendStatusStatusEnumNames.INCOMING_REQUEST):!e.is_member&&!e.is_closed}function T(e,t){return(0,n.isOwnerUser)(e)?t.owner_id===e.id&&window.vk.id===e.id:t.owner_id===-e.id&&(t.is_ads?Boolean(e.is_advertiser):Boolean(e.is_admin))}function E(e){return e.can_comment?Boolean(e.can_comment):"live_active"===e.type&&Boolean(e.video?.can_comment)}function x(e,t){return!e.is_deleted&&(!e.can_delete_with_reason&&(!!e.can_delete||T(t,e)&&("photo"===e.type||"video"===e.type)))}function $(e,t,i){if(!e.parent_story_owner_id||!e.parent_story_id)return!1;const r=window.vk.id,a=e.parent_story_owner_id;if(a===r)return!0;const s=(0,h.findOwnerById)(a,t,i);return!!(s&&(0,n.isOwnerGroup)(s)&&s.is_admin)}function C(e){return"photo"===e.type?l.StoryType.PHOTO:"video"===e.type?l.StoryType.VIDEO:"live_active"===e.type||"live_finished"===e.type?l.StoryType.LIVE:l.StoryType.PHOTO}},557651:(e,t,i)=>{i.d(t,{transformGetNarrativesResponseToLegacy:()=>l,transformNarrative:()=>o});var r=i(351118),a=i(645964),s=i(412251),n=i(6285);function o(e,t){const i=`${e.owner_id}_${e.id}`,s=(0,a.isOwnerGroup)(t),o=s&&Boolean(t.is_closed),l={id:e.id,rawId:i,ownerId:e.owner_id,ownerName:(0,r.escape)((s?t.name:(0,a.getOwnerFullName)(t))||""),ownerShortName:(0,r.escape)((s?t.name:(0,a.getOwnerShortName)(t))||""),ownerUrl:(0,a.getOwnerHref)(t),ownerPath:`${s?"club":"id"}${e.owner_id}`,ownerAvatarUrl:t.photo_100||t.photo_50||"",title:(0,r.escape)(e.title),isBookmarked:e.is_favorite,bookmarkHash:"",reportHash:"",canEdit:u(e,t),editHash:"",canView:e.can_see,storiesCount:e.story_ids?.length||0,isOwnerClosedGroup:o,isGroupEditor:o&&Boolean(t.is_admin),url:`${window.location.origin}/narrative${i}`,storyIds:e.story_ids||[],stories:e.stories?.map(n.transformStoryArchive)||[],isDeleted:e.is_delete,date:"",coverUrl:""};if(e.cover){Object.assign(l,{coverUrl:e.cover.cropped_sizes&&(0,r.getPhotoSize)(e.cover.cropped_sizes,300)?.url||"",coverCrop:{x:e.cover.crop_x||0,y:e.cover.crop_y||0,width:e.cover.crop_width||0,height:e.cover.crop_height||0}}),e.cover.custom_photo&&(l.customCover=function(e,t=[]){if(!e)return;return{photoId:e.id,originalPhotoUrl:e.orig_photo?.url||e.sizes&&(0,r.getPhotoSize)(e.sizes,600)?.url||"",previewUrl:t&&(0,r.getPhotoSize)(t,300)?.url||e.sizes&&(0,r.getPhotoSize)(e.sizes,300)?.url||""}}(e.cover.custom_photo,e.cover.cropped_sizes));const t=e.cover.cover_story_id;if(t){Object.assign(l,{coverStoryId:t,coverStoryRawId:`${e.owner_id}_${t}`});const i=e.stories?.find((e=>e?.id===t));i&&(l.coverStory=(0,n.transformStoryArchive)(i))}}return l}function l(e){const{items:t,profiles:i=[],groups:r=[]}=e;return t?.length?t.reduce(((e=[],t)=>{if(!t)return e;const a=(0,s.findOwnerById)(t.owner_id,i,r)||{id:t.owner_id};if(!a)return e;const n=o(t,a);return n?e.concat(n):e}),[]):[]}function u(e,t){const i=Boolean(e.can_delete);let r=!1;if((0,a.isOwnerGroup)(t)){if(e.owner_id!==-t.id)return!1;r=Boolean(t.is_admin)}else{if(e.owner_id!==t.id)return!1;r=window.vk.id===t.id}return!!r&&i}},6285:(e,t,i)=>{i.d(t,{transformStoryArchive:()=>o,transformStoryArchiveResponse:()=>l});var r=i(207402),a=i(351118),s=i(764046),n=i(297520);function o(e){const t=Math.max(e.date?Math.ceil(new Date(1e3*e.date).setUTCHours(0,0,0,0)/1e3):0,s.STORIES_ARCHIVE_START_TIME),i=e.photo?.sizes||e.video?.image,o={id:e.id,rawId:`${e.owner_id}_${e.id}`,listId:`archive${e.owner_id}_${t}`,time:Number(e.date),preview:i&&(0,a.getPhotoSize)(i,350)?.url||"",originalPreviewUrl:i&&(0,a.getPhotoSize)(i,600)?.url||""};return"video"===e.type&&e.video&&Object.assign(o,{videoUrl:e.video.files&&(0,r.getVideoBestQualityUrl)(e.video.files)||"",duration:e.video.duration}),e.link&&Object.assign(o,{linkUrl:(0,n.wrapAwayIfExternal)(e.link.url)||"",linkText:e.link.text||"",linkType:""}),o}function l(e){const{items:t=[]}=e;return t.filter(Boolean).map(o)}},912479:(e,t,i)=>{i.d(t,{toStoryLink:()=>d});var r=i(663810),a=i(228909),s=i(452200),n=i(961829),o=i(85212),l=i(932216);const u=RegExp(`^\\/?audio${r.ANY_RAW_ID_INCLUDABLE_PATTERN}\\/?$`);function d(e,t){let i,d=e.link;return d?(i=function(e,t){let i,d;const c=function(e){let t,i;const n=URL.parse(e.url);if(!n||!o.VK_URL_REGEX.test(n.host))return null;if(t=n.pathname,!u.test(t))return null;if(i=t.match(r.ANY_RAW_ID_INCLUDABLE_REGEXP)?.[0],!i)return null;try{return new a.OwnedIdentity((0,s.parseRawId)(i))}catch(e){return(0,l.logError)(e),null}}(e);if(!c)return null;if(d=function(e,t){return e?.stickers?.find((({audioId:e,audioData:i})=>!!i&&(!!(0,n.isAnyRawId)(e)&&[t.rawId,t.accessRawId].includes(e))))}(t,c),!d)return null;try{return i=JSON.parse(d.audioData),{url:e.url,text:e.text,object_type:"audio",object:i}}catch(e){return(0,l.logError)(e),null}}(d,t),i||{url:d.url,text:d.text}):null}},125329:(e,t,i)=>{i.d(t,{createStoriesService:()=>l});var r=i(32489),a=i(345522),s=i(271246),n=i(714187),o=i(265150);const l=({domain:e})=>{const t=e.createEvent("fire/storiesGet"),i=e.createEvent("fire/storiesGetById"),l=e.createEvent("fire/storiesGetArchive"),u=e.createEvent("fire/storiesGetViewers"),d=e.createEvent("fire/storiesGetReplies"),c=e.createEvent("fire/storiesSeenReplies"),h=e.createEvent("fire/storiesGetQuestions"),p=e.createEvent("fire/storiesGetStats"),f=e.createEvent("fire/storiesGetDetailedStats"),m=e.createEvent("fire/storiesMarkSkipped"),g=e.createEvent("fire/storiesMarkNotInterested"),v=e.createEvent("fire/storiesMarkSeen"),b=e.createEvent("fire/storiesHidePrivacyBlock"),_=e.createEvent("fire/storiesDelete"),y=e.createEvent("fire/storiesAskQuestion"),w=e.createEvent("fire/storiesDeleteQuestion"),S=e.createEvent("fire/storiesBanQuestionAuthor"),k=e.createEvent("fire/storiesUnbanQuestionAuthor"),T=e.createEvent("fire/storiesGetPhotoUploadServer"),E=e.createEvent("fire/storiesGetVideoUploadServer"),x=e.createEvent("fire/storiesSave"),$=e.createEvent("fire/storiesSearch"),C=e.createEvent("fire/storiesUnbanOwner"),A=e.createEvent("fire/storiesBanOwner"),P=e.createEvent("fire/storiesSetDiscoverVisible"),L=e.createEvent("fire/storiesHideReply"),M=e.createEvent("fire/storieHideAllReplies"),I=e.createEffect("fx/storiesGet"),R=e.createEffect("fx/storiesGetById"),D=e.createEffect("fx/storiesGetArchive"),O=e.createEffect("fx/storiesGetViewers"),B=e.createEffect("fx/storiesGetReplies"),N=e.createEffect("fx/storiesSeenReplies"),V=e.createEffect("fx/storiesGetQuestions"),U=e.createEffect("fx/storiesGetStats"),F=e.createEffect("fx/storiesGetDetailedStats"),j=e.createEffect("fx/storiesMarkSkipped"),z=e.createEffect("fx/storiesMarkNotInterested"),W=e.createEffect("fx/storiesMarkSeen"),q=e.createEffect("fx/storiesHidePrivacyBlock"),H=e.createEffect("fx/storiesDelete"),K=e.createEffect("fx/storiesAskQuestion"),Q=e.createEffect("fx/storiesDeleteQuestion"),G=e.createEffect("fx/storiesBanQuestionAuthor"),Y=e.createEffect("fx/storiesUnbanQuestionAuthor"),X=e.createEffect("fx/storiesGetPhotoUploadServer"),Z=e.createEffect("fx/storiesGetVideoUploadServer"),J=e.createEffect("fx/storiesSave"),ee=e.createEffect("fx/storiesSearch"),te=e.createEffect("fx/storiesUnbanOwner"),ie=e.createEffect("fx/storiesBanOwner"),re=e.createEffect("fx/storiesSetDiscoverVisible"),ae=e.createEffect("fx/storiesHideReply"),se=e.createEffect("fx/storiesHideAllReplies"),ne=(0,s.createFriendsAddFx)({domain:e}),oe=(0,s.createFriendsDeleteFx)({domain:e}),le=(0,n.createGroupsJoinFx)({domain:e}),ue=(0,n.createGroupsLeaveFx)({domain:e});return I.use(a.apiStoriesGet),R.use(a.apiStoriesGetById),D.use(a.apiStoriesGetArchive),O.use(a.apiStoriesGetViewers),B.use(a.apiStoriesGetReplies),N.use(a.apiStoriesSeenReplies),V.use(a.apiStoriesGetQuestions),U.use(a.apiStoriesGetStats),F.use(a.apiStoriesGetDetailedStats),j.use(a.apiStoriesMarkSkipped),z.use(a.apiStoriesMarkNotInterested),W.use(a.apiStoriesMarkSeen),q.use(a.apiStoriesHidePrivacyBlock),H.use(a.apiStoriesDelete),K.use(a.apiStoriesAskQuestion),Q.use(a.apiStoriesDeleteQuestion),G.use(a.apiStoriesBanQuestionAuthor),Y.use(a.apiStoriesUnbanQuestionAuthor),X.use(a.apiStoriesGetPhotoUploadServer),Z.use(a.apiStoriesGetVideoUploadServer),J.use(a.apiStoriesSave),ee.use(a.apiStoriesSearch),ie.use(a.apiStoriesBanOwner),te.use(a.apiStoriesUnbanOwner),re.use(a.apiStoriesSetDiscoverVisible),ae.use(a.apiStoriesHideReply),se.use(a.apiStoriesHideAllReplies),(0,o.connectTrackTmrGroupsJoin)(le),(0,r.sample)({clock:t,target:I}),(0,r.sample)({clock:i,target:R}),(0,r.sample)({clock:l,target:D}),(0,r.sample)({clock:u,target:O}),(0,r.sample)({clock:d,target:B}),(0,r.sample)({clock:c,target:N}),(0,r.sample)({clock:h,target:V}),(0,r.sample)({clock:p,target:U}),(0,r.sample)({clock:f,target:F}),(0,r.sample)({clock:m,target:j}),(0,r.sample)({clock:g,target:z}),(0,r.sample)({clock:v,target:W}),(0,r.sample)({clock:b,target:q}),(0,r.sample)({clock:_,target:H}),(0,r.sample)({clock:y,target:K}),(0,r.sample)({clock:w,target:Q}),(0,r.sample)({clock:S,target:G}),(0,r.sample)({clock:k,target:Y}),(0,r.sample)({clock:T,target:X}),(0,r.sample)({clock:E,target:Z}),(0,r.sample)({clock:x,target:J}),(0,r.sample)({clock:$,target:ee}),(0,r.sample)({clock:C,target:te}),(0,r.sample)({clock:A,target:ie}),(0,r.sample)({clock:P,target:re}),(0,r.sample)({clock:L,target:ae}),(0,r.sample)({clock:M,target:se}),{fireGet:t,fireGetById:i,fireGetArchive:l,fireGetViewers:u,fireGetReplies:d,fireSeenReplies:c,fireGetQuestions:h,fireGetStats:p,fireGetDetailedStats:f,fireMarkSkipped:m,fireMarkNotInterested:g,fireMarkSeen:v,fireHidePrivacyBlock:b,fireDelete:_,fireAskQuestion:y,fireDeleteQuestion:w,fireBanQuestionAuthor:S,fireUnbanQuestionAuthor:k,fireGetPhotoUploadServer:T,fireGetVideoUploadServer:E,fireSave:x,fireSearch:$,fireUnbanOwner:C,fireBanOwner:A,fireSetDiscoverVisible:P,fireHideReply:L,fireHideAllReplies:M,getFx:I,getByIdFx:R,getArchiveFx:D,getViewersFx:O,getRepliesFx:B,seenRepliesFx:N,getQuestionsFx:V,getStatsFx:U,getDetailedStatsFx:F,markSkippedFx:j,markNotInterestedFx:z,markSeenFx:W,hidePrivacyBlockFx:q,deleteFx:H,askQuestionFx:K,deleteQuestionFx:Q,banQuestionAuthorFx:G,unbanQuestionAuthorFx:Y,getPhotoUploadServerFx:X,getVideoUploadServerFx:Z,saveFx:J,searchFx:ee,unbanOwnerFx:te,banOwnerFx:ie,setDiscoverVisibleFx:re,hideReplyFx:ae,hideAllRepliesFx:se,friendsAddFx:ne,friendsDeleteFx:oe,groupsJoinFx:le,groupsLeaveFx:ue}}},684531:(e,t,i)=>{i.d(t,{pollsService:()=>f,storiesDomain:()=>h,storiesService:()=>p});var r=i(32489),a=i(764046),s=i(314871),n=i(288977),o=i(109943),l=i(870670),u=i(539846),d=i(215766),c=i(455704);const h=(0,r.createDomain)("stories"),p=(0,a.createStoriesService)({domain:h}),f=((0,s.createStatsService)({domain:h}),(0,n.createNarrativesService)({domain:h}),(0,o.createLikesService)({domain:h}),(0,l.createMessagesService)({domain:h}),(0,u.createFaveService)({domain:h}),(0,d.createPollsService)({domain:h}));(0,c.createUserService)({domain:h})},294787:(e,t,i)=>{function r(e){return(e?.split("_")??[]).map(Number)}function a(e,t="windows-1251"){return new TextDecoder(t).decode(function(e){const t=atob(e);return Uint8Array.from(t,(e=>e.codePointAt(0)||0))}(e))}i.d(t,{decodeBase64:()=>a,splitStoryRawId:()=>r})},970343:(e,t,i)=>{i.d(t,{constructSources:()=>o,constructVideoData:()=>l});var r=i(425426),a=(i(435337),i(412591)),s=i(9467);const n={"144p":"mp4_144","240p":"mp4_240","360p":"mp4_360","480p":"mp4_480","720p":"mp4_720","1080p":"mp4_1080","1440p":"mp4_1440","2160p":"mp4_2160"};function o({files:e,live_settings:t}){const i={};let o=t?.playback_duration??t?.max_rewind_duration;o&&(o*=a.SECOND);const l=(0,s.partConfigEnabled)("video_player_support_new_live_links")&&Boolean(t),u=(0,s.partConfigEnabled)("video_player_support_new_live_links")&&!o;if(!e)return i;const d={};for(const[t,i]of Object.entries(n))i in e&&(d[t]=e[i]);return Object.keys(d).length>0?i.MPEG=d:e.src&&(i.MPEG={"Invariant quality":e.src}),e.dash_sep&&(i[r.VideoFormat.DASH_SEP]={type:"url",url:e.dash_sep}),e.dash_webm&&(i[r.VideoFormat.DASH_WEBM]={type:"url",url:e.dash_webm}),e.dash_webm_av1&&(i[r.VideoFormat.DASH_WEBM_AV1]={type:"url",url:e.dash_webm_av1}),e.dash_streams&&(i[r.VideoFormat.DASH_STREAMS]={type:"url",url:e.dash_streams}),e.cmaf&&(i[r.VideoFormat.DASH_LIVE_CMAF]={type:"url",url:e.cmaf}),e.hls&&!l&&(i[r.VideoFormat.HLS]={type:"url",url:e.hls}),e.dash_live&&u&&(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live}),!e.dash_live_playback||u&&e.dash_live||(i[r.VideoFormat.DASH_LIVE]={type:"url",url:e.dash_live_playback}),e.hls_live&&u&&(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live}),!e.hls_live_playback||u&&e.hls_live||(i[r.VideoFormat.HLS_LIVE]={type:"url",url:e.hls_live_playback,maxSeekBackTime:o}),e.dash_ondemand&&(i[r.VideoFormat.DASH_ONDEMAND]={type:"url",url:e.dash_ondemand}),e.hls_ondemand&&(i[r.VideoFormat.HLS_ONDEMAND]={type:"url",url:e.hls_ondemand}),e.hls_live_ondemand&&(i[r.VideoFormat.HLS_LIVE_CMAF]={type:"url",url:e.hls_live_ondemand,maxSeekBackTime:o}),e.ws&&(i[r.VideoFormat.WEB_RTC_LIVE]={type:"url",url:e.ws}),i}function l(e){const t=o(e),i={status:e.live_status,startTime:e.live_start_time},r=e.image?.sort(((e,t)=>e.height-t.height))??[],a=r.find((({height:e})=>e>500))??r.at(-1),s=e.restriction?{restriction:e.restriction}:{};return{...Object.keys(t).length>0?{sources:t}:{live:i},title:e.title??"",thumbUrl:a?.url,unitedVideoId:parseInt(e.ov_id??"0",10),duration:e.duration??0,videoEpisodes:e.episodes?.map((({time:e,text:t})=>({time:e??0,text:t??""}))),previewThumbsData:e.timeline_thumbs?{countPerImage:e.timeline_thumbs.count_per_image??1,countPerRow:e.timeline_thumbs.count_per_row??1,countTotal:e.timeline_thumbs.count_total??1,frameHeight:e.timeline_thumbs.frame_height??0,frameWidth:e.timeline_thumbs.frame_width??0,frequency:e.timeline_thumbs.frequency??1,isUV:e.timeline_thumbs.is_uv??!1,links:e.timeline_thumbs.links??[]}:void 0,subtitles:e.subtitles?.filter((e=>Boolean(e.url))).map((({is_auto:e,title:t,lang:i,manifest_name:r,url:a,storage_index:s})=>({isAuto:e,id:[t,i,s].filter(Boolean).join("_"),language:i,label:r,url:a}))),...s}}},435337:(e,t,i)=>{i.d(t,{fetchVideo:()=>s});var r=i(328911),a=i(497771);const s=async(e,t,i,s={})=>(0,a.apiWithPrefetch)("video.get",{owner_id:e,videos:(0,r.joinRawId)({ownerId:e,itemId:t,externalId:i}),extended:1,...s})},348197:(e,t,i)=>{i.d(t,{updateArticleSnippetsFromQueueByPost:()=>o});var r=i(932216),a=i(326107),s=i(9467);i(774725),i(547214),i(323263),i(449521),i(74675),i(358172),i(48711),i(519692),i(225590);const n="article_snippet";function o(e){if(!window.vk.id)return;if(!(0,s.partConfigEnabled)("update_private_snippets_by_queue"))return;const t=Array.from(e.querySelectorAll(`.${n}`));if(!t.length)return;const i=[];t.forEach((e=>{if(!window.vk.id||!e.dataset.needUpdate)return;const t=e.dataset.articleRawId;t&&i.push({article_raw_id:t,post_raw_id:e.dataset.postId,is_mini_snippet:(0,a.intval)(e.dataset.isMiniSnippet)})})),i.length&&window.ajax.post("al_articles.php",{act:"get_snippets",article_snippets:JSON.stringify(i)},{onDone:e=>{t.forEach((t=>{t.dataset.articleRawId&&e[t.dataset.articleRawId]&&(t.outerHTML=e[t.dataset.articleRawId])}))},onFail:()=>((0,r.logError)(new Error("Fail: updateArticleSnippetsFromQueueByPost")),!0)})}},138249:(e,t,i)=>{i.d(t,{init:()=>d,registerEvbusCommonEvents:()=>u});var r=i(170180),a=i(761534),s=i(422798),n=i(313881),o=i(444930),l=i(932216);const u=()=>{(0,a.tqi)().setHandler("Common/nav_go",(e=>{e.payload.event?.target&&window.nav.go(e.payload.event.target,e.payload.event,JSON.parse(e.payload.dataAttrs?.options||"{}"))}),!1),(0,a.tqi)().setHandler("Common/cur_box_hide",(()=>{(0,s.curBox)()?.hide()}),!1),(0,a.tqi)().setHandler("Common/show_menu_settings",(e=>{const t=e.payload.dataAttrs?.type?Number(e.payload.dataAttrs.type):void 0;(0,n.loadMenuSettingsBox)(t)}),!1),(0,a.tqs)().setHandler("HelpHints/init",(({payload:{target:e}})=>{e?.remove(),(0,o.ensureAccountHelpHintsService)().initialize({viewerId:window.vk?.id,logErrorFn:l.logError})}),!0)},d=()=>{(0,r.init)()}},510502:(e,t,i)=>{i.d(t,{highlightModule:()=>d});var r=i(535187),a=i(694300),s=i(705144),n=i(178009),o=i(67571);let l,u;function d(e){const t=document.getElementById(e.module);if(!t||!t.classList.contains("module"))return;window.cur.__narrowBarForceNotFixed=!0;const i=e.speed?e.speed:300;(0,s.scrollToY)((0,n.getXY)(t)[1]-100,i);const d=()=>{l&&(l.hideTT(),(0,s.enableBodyScroll)(),delete window.cur.__narrowBarForceNotFixed,(0,a.updateNarrow)(),e.onClose&&e.onClose())};l=new r.default(t,e.text,{highlight:!0,width:250,offset:[0,-17],side:"bottom",withCloseButton:!0,onBGClick:d,onCloseButtonClick:d}),l.show(),(0,s.disableBodyScroll)(),e.autoCancelDelay&&(u=setTimeout((()=>{d(),u=null}),e.autoCancelDelay),(0,o.pushNavDestroy)((()=>{u&&clearTimeout(u)})))}},313881:(e,t,i)=>{async function r(e){const{showMenuSettingsBox:t}=await Promise.all([i.e(8598),i.e(7523),i.e(6694)]).then(i.bind(i,160334));t(e)}i.d(t,{loadMenuSettingsBox:()=>r})},38078:(e,t,i)=>{i.d(t,{getStoryList:()=>s,removeStoryList:()=>n,setStoryList:()=>a,transformApiStoryList:()=>o});var r=i(235709);function a(e,t){window.cur[`stories_list_${e}`]=t}function s(e){return window.cur[`stories_list_${e}`]}function n(e){delete window.cur[`stories_list_${e}`]}function o(e,t){return(0,r.transformStoryGetApiResponseToLegacyFormat)(t,e,!1)}},449815:(e,t,i)=>{i.d(t,{UPDATE_NARRATIVE_BLOCK_EVENT_NAME:()=>d,prepareStoriesForPublishing:()=>h,updateNarrativeBlock:()=>p,updateNarrativeSnippetsFromQueueByPost:()=>f});var r=i(178009),a=i(422798),s=(i(510502),i(225590),i(326107)),n=i(932216),o=i(9467),l=i(9327),u=i(38078);const d="update_narrative_block",c="NarrativeSnippet";function h(e){return e.map((e=>e.id)).join(",")}function p(e=!1){const t=(0,s.intval)(window.cur.oid);if(!l.Ranges.isUserId(t)||"profile"!==window.cur.module)if(window.cur.narrativeBlock){const e=document.getElementById(`narratives_module${t}_wrapper`);if(e)window.ajax.post("al_stories.php",{act:"get_narrative_block",owner_id:t},{onDone:t=>{const i=(0,s.intval)(window.cur.oid);if(t)(0,r.domReplaceEl)(e,t),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),window.NarrativeBlock&&(window.cur.narrativeBlock=new window.NarrativeBlock);else{const t=e.parentElement;t?.children.length&&t?.children.length>1?e.remove():t?.remove(),window.cur.narrativeBlock&&window.cur.narrativeBlock.destroy(),delete window.cur.narrativeBlock}(0,u.removeStoryList)(`narratives${i}`)}});else if(window.cur.narrativeBlock.gallery){const e=document.querySelector('#group_tabs_content .group-tab-content[data-tab="narratives"]');e&&window.ajax.post("al_stories.php",{act:"get_narratives_tab",owner_id:t},{onDone:t=>{e.innerHTML=t}})}}else e&&function(e){window.boxQueue.hideAll();const t=document.querySelector("#box_layer_wrap"),i=document.querySelector("#box_loader");window.nav.reload({onDone:()=>{e&&e()},showProgress:()=>{(0,r.show)(t),(0,r.show)(i),(0,a.refreshBoxLoaderCoords)()},hideProgress:()=>{(0,r.hide)(t),(0,r.hide)(i)}})}((()=>{window.cur.needNarrativeOnboard=!0}))}function f(e){if(!window.vk.id)return;if(!(0,o.partConfigEnabled)("update_private_snippets_by_queue"))return;const t=Array.from(e.querySelectorAll(`.${c}`));if(!t.length)return;const i=[];t.forEach((e=>{if(!window.vk.id||!e.dataset.needUpdate)return;const t=e.dataset.narrativeRawId;t&&i.push({narrative_raw_id:t,from:e.dataset.from})})),i.length&&window.ajax.post("al_stories.php",{act:"get_narrative_snippets",narrative_snippets:JSON.stringify(i)},{onDone:e=>{t.forEach((t=>{t.dataset.narrativeRawId&&e[t.dataset.narrativeRawId]&&(t.outerHTML=e[t.dataset.narrativeRawId])}))},onFail:()=>((0,n.logError)(new Error("Fail: updateNarrativeSnippetFromQueueByPost")),!0)})}},207402:(e,t,i)=>{function r(e){if(!e)return"";const t=/^mp4_(\d+)$/,{url:i}=Object.keys(e).reduce(((i,r)=>{const a=r.match(t);if(!a)return i;const s=Number.parseInt(a[1]);return i.quality<s&&(i.quality=s,i.url=String(e[r]??"")),i}),{url:"",quality:0});return i}i.d(t,{getVideoBestQualityUrl:()=>r})},271246:(e,t,i)=>{i.d(t,{createFriendsAddFx:()=>a,createFriendsDeleteFx:()=>s});var r=i(617127);const a=e=>(0,r.createApiEffect)("friends.add",e),s=e=>(0,r.createApiEffect)("friends.delete",e)},714187:(e,t,i)=>{i.d(t,{createGroupsGetByIdFx:()=>a,createGroupsJoinFx:()=>s,createGroupsLeaveFx:()=>n});var r=i(617127);const a=e=>(0,r.createApiEffect)("groups.getById",e),s=e=>(0,r.createApiEffect)("groups.join",e),n=e=>(0,r.createApiEffect)("groups.leave",e)},85212:(e,t,i)=>{function r(){return("undefined"!=typeof window?window:"undefined"!=typeof self?self:{}).vk?.__domain||"vk.com"}i.d(t,{VK_URL_REGEX:()=>l});const a=e=>e.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1"),s=(a(r()),["vk.com","vk.ru",r()].filter(((e,t,i)=>i.indexOf(e)===t)).concat(["vkontakte.ru","vk.me","userapi.com"])),n=new RegExp("("+s.map(a).join("|")+")"),o=new RegExp(`([a-zA-Z0-9\\.\\_\\-]+\\.)?${n.source}`),l=new RegExp(`^(https?:\\/\\/)?${o.source}($|\\/(.*))`)},7258:(e,t,i)=>{i.d(t,{formatCount:()=>r});const r=(e,t)=>{const i=t?.separator||".",r=t?.maximumFractionDigits??1,a=t?.roundingMode||void 0,s=t?.kLimit||1e3,n=t?.mLimit||1e6,o=t?.bLimit||1e9,l=window.langConfig?.locale||"ru",u=(e,t)=>{"floor"===a&&(e=Math.floor(e*Math.pow(10,r))/Math.pow(10,r));let s=e.toFixed(r);return Number(s).toLocaleString(l).replace(/\./,i)+t};if(e>-s&&e<s)return e.toLocaleString(l);const d=e/o;if(d>=1||d<=-1)return u(e/1e9,"B");const c=e/n;if(c>=1||c<=-1)return u(e/1e6,"M");const h=e/s;return h>=1||h<=-1?u(e/1e3,"K"):String(e)}},645964:(e,t,i)=>{i.d(t,{getOwnerFullName:()=>o,getOwnerHref:()=>n,getOwnerShortName:()=>l,isOwnerGroup:()=>s,isOwnerUser:()=>a});var r=i(3604);const a=e=>!!e&&"first_name"in e,s=e=>!!e&&"name"in e;function n(e,t=!1,i="/"){let r=i;return e&&(s(e)?r+=e.screen_name||`club${e.id}`:r+=e.screen_name||e.domain||`id${e.id}`),t?window.location.origin+r:r}function o(e){let t="";return e?(e.first_name&&(t+=e.first_name.trim()),e.last_name&&(t+=` ${e.last_name.trim()}`),e.maiden_name&&e.sex===r.BaseSexEnumNames.FEMALE&&(t+=` (${e.maiden_name.trim()})`),t):t}function l(e){let t="";return e.first_name&&(t+=e.first_name.trim()),e.last_name&&(t+=` ${e.last_name.trim().slice(0,1)}.`),t}},358172:(e,t,i)=>{e.exports=i.p+"icons/d4181af8b45ee623.png"},99758:(e,t,i)=>{i.d(t,{ChromecastState:()=>Qi,HttpConnectionType:()=>Gi,PlaybackState:()=>Hi,Player:()=>ml,PredefinedQualityLimits:()=>Xi,Subscription:()=>u.Subscription,Surface:()=>Yi,VERSION:()=>qi,VideoFormat:()=>Ki,VideoQuality:()=>u.VideoQuality,clientChecker:()=>Ur,isMobile:()=>Cr});var r,a,s,n,o,l,u=i(319340),d=Object.create,c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,f=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty,g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),v=(e,t,i)=>(i=null!=e?d(f(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of p(t))!m.call(e,a)&&a!==i&&c(e,a,{get:()=>t[a],enumerable:!(r=h(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:c(i,"default",{value:e,enumerable:!0}),e)),b=g(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),_=g(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),y=g(((e,t)=>{var i=_();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),w=g(((e,t)=>{var i=y(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),S=g(((e,t)=>{var i=y(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),k=g(((e,t)=>{var i=S(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),T=g(((e,t)=>{var i=k(),r=S();t.exports=function(e){if("Function"===i(e))return r(e)}})),E=g(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),x=g(((e,t)=>{var i=_();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),$=g(((e,t)=>{var i=y(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),C=g((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),A=g(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),P=g(((e,t)=>{var i=S(),r=_(),a=k(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),L=g(((e,t)=>{t.exports=function(e){return null==e}})),M=g(((e,t)=>{var i=L(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),I=g(((e,t)=>{var i=P(),r=M();t.exports=function(e){return i(r(e))}})),R=g(((e,t)=>{var i=E();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),D=g(((e,t)=>{t.exports={}})),O=g(((e,t)=>{var i=D(),r=b(),a=E(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),B=g(((e,t)=>{var i=S();t.exports=i({}.isPrototypeOf)})),N=g(((e,t)=>{var i=b().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),V=g(((e,t)=>{var i,r,a=b(),s=N(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),U=g(((e,t)=>{var i=V(),r=_(),a=b().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),F=g(((e,t)=>{var i=U();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),j=g(((e,t)=>{var i=O(),r=E(),a=B(),s=F(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),z=g(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),W=g(((e,t)=>{var i=E(),r=z(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),q=g(((e,t)=>{var i=W(),r=L();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),H=g(((e,t)=>{var i=$(),r=E(),a=R(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),K=g(((e,t)=>{t.exports=!0})),Q=g(((e,t)=>{var i=b(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),G=g(((e,t)=>{var i=K(),r=b(),a=Q(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),Y=g(((e,t)=>{var i=G();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),X=g(((e,t)=>{var i=M(),r=Object;t.exports=function(e){return r(i(e))}})),Z=g(((e,t)=>{var i=S(),r=X(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),J=g(((e,t)=>{var i=S(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),ee=g(((e,t)=>{var i=b(),r=Y(),a=Z(),s=J(),n=U(),o=F(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),te=g(((e,t)=>{var i=$(),r=R(),a=j(),s=q(),n=H(),o=ee(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),ie=g(((e,t)=>{var i=te(),r=j();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),re=g(((e,t)=>{var i=b(),r=R(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),ae=g(((e,t)=>{var i=x(),r=_(),a=re();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),se=g((e=>{var t=x(),i=$(),r=C(),a=A(),s=I(),n=ie(),o=Z(),l=ae(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),ne=g(((e,t)=>{var i=_(),r=E(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),oe=g(((e,t)=>{var i=T(),r=W(),a=y(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),le=g(((e,t)=>{var i=x(),r=_();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ue=g(((e,t)=>{var i=R(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),de=g((e=>{var t=x(),i=ae(),r=le(),a=ue(),s=ie(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ce=g(((e,t)=>{var i=x(),r=de(),a=A();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),he=g(((e,t)=>{var i=b(),r=w(),a=T(),s=E(),n=se().f,o=ne(),l=D(),u=oe(),d=ce(),c=Z();G();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,_,y,w=e.target,S=e.global,k=e.stat,T=e.proto,E=S?i:k?i[w]:i[w]&&i[w].prototype,x=S?l:l[w]||d(l,w,{})[w],$=x.prototype;for(m in t)p=!(r=o(S?m:w+(k?".":"#")+m,e.forced))&&E&&c(E,m),v=x[m],p&&(e.dontCallGetSet?b=(y=n(E,m))&&y.value:b=E[m]),g=p&&b?b:t[m],(r||T||typeof v!=typeof g)&&(_=e.bind&&p?u(g,i):e.wrap&&p?h(g):T&&s(g)?a(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(_,"sham",!0),d(x,m,_),T&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&$&&(r||!$[m])&&d($,m,g)))}})),pe=g(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),fe=g(((e,t)=>{var i=pe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),me=g(((e,t)=>{var i=fe(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),ge=g(((e,t)=>{var i=fe(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ve=g(((e,t)=>{var i=ge();t.exports=function(e){return i(e.length)}})),be=g(((e,t)=>{var i=I(),r=me(),a=ve(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),_e=g(((e,t)=>{t.exports=function(){}})),ye=g((()=>{var e=he(),t=be().includes,i=_(),r=_e();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),we=g(((e,t)=>{var i=O();t.exports=i})),Se=g(((e,t)=>{ye();var i=we();t.exports=i("Array","includes")})),ke=g(((e,t)=>{var i=Se();t.exports=i})),Te=g(((e,t)=>{var i=ke();t.exports=i})),Ee=g(((e,t)=>{var i=Y(),r=J(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),xe=g(((e,t)=>{var i=_();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),$e=g(((e,t)=>{var i=Z(),r=E(),a=X(),s=Ee(),n=xe(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),Ce=g(((e,t)=>{t.exports={}})),Ae=g(((e,t)=>{var i=S(),r=Z(),a=I(),s=be().indexOf,n=Ce(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),Pe=g(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Le=g(((e,t)=>{var i=Ae(),r=Pe();t.exports=Object.keys||function(e){return i(e,r)}})),Me=g(((e,t)=>{var i=x(),r=_(),a=S(),s=$e(),n=Le(),o=I(),l=a(C().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ie=g((()=>{var e=he(),t=Me().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Re=g(((e,t)=>{Ie();var i=D();t.exports=i.Object.entries})),De=g(((e,t)=>{var i=Re();t.exports=i})),Oe=g(((e,t)=>{var i=De();t.exports=i})),Be=g(((e,t)=>{t.exports={}})),Ne=g(((e,t)=>{var i=b(),r=E(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),Ve=g(((e,t)=>{var i,r,a,s,n,o=Ne(),l=b(),u=R(),d=ce(),c=Z(),h=G(),p=Ee(),f=Ce(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((s=h.state||(h.state=new v)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new g(m);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new g(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),Ue=g(((e,t)=>{var i=x(),r=Z(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Fe=g((e=>{var t=x(),i=le(),r=de(),a=ue(),s=I(),n=Le();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),je=g(((e,t)=>{var i=O();t.exports=i("document","documentElement")})),ze=g(((e,t)=>{var i,r=ue(),a=Fe(),s=Pe(),n=Ce(),o=je(),l=re(),u=Ee(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete g[d][s[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:a.f(i,t)}})),We=g(((e,t)=>{var i=ce();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),qe=g(((e,t)=>{var i,r,a,s=_(),n=E(),o=R(),l=ze(),u=$e(),d=We(),c=ee(),h=K(),p=c("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),He=g(((e,t)=>{var i={};i[ee()("toStringTag")]="z",t.exports="[object z]"===String(i)})),Ke=g(((e,t)=>{var i=He(),r=E(),a=k(),s=ee()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Qe=g(((e,t)=>{var i=He(),r=Ke();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Ge=g(((e,t)=>{var i=He(),r=de().f,a=ce(),s=Z(),n=Qe(),o=ee()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),Ye=g(((e,t)=>{var i=qe().IteratorPrototype,r=ze(),a=A(),s=Ge(),n=Be(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),Xe=g(((e,t)=>{var i=S(),r=W();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Ze=g(((e,t)=>{var i=R();t.exports=function(e){return i(e)||null===e}})),Je=g(((e,t)=>{var i=Ze(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),et=g(((e,t)=>{var i=Xe(),r=R(),a=M(),s=Je();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),tt=g(((e,t)=>{var i=he(),r=$(),a=K(),s=Ue(),n=E(),o=Ye(),l=$e(),u=et(),d=Ge(),c=ce(),h=We(),p=ee(),f=Be(),m=qe(),g=s.PROPER,v=s.CONFIGURABLE,b=m.IteratorPrototype,_=m.BUGGY_SAFARI_ITERATORS,y=p("iterator"),w="keys",S="values",k="entries",T=function(){return this};t.exports=function(e,t,s,p,m,E,x){o(s,t,p);var $,C,A,P=function(e){if(e===m&&D)return D;if(!_&&e&&e in I)return I[e];switch(e){case w:case S:case k:return function(){return new s(this,e)}}return function(){return new s(this)}},L=t+" Iterator",M=!1,I=e.prototype,R=I[y]||I["@@iterator"]||m&&I[m],D=!_&&R||P(m),O="Array"===t&&I.entries||R;if(O&&(($=l(O.call(new e)))!==Object.prototype&&$.next&&(!a&&l($)!==b&&(u?u($,b):n($[y])||h($,y,T)),d($,L,!0,!0),a&&(f[L]=T))),g&&m===S&&R&&R.name!==S&&(!a&&v?c(I,"name",S):(M=!0,D=function(){return r(R,this)})),m)if(C={values:P(S),keys:E?D:P(w),entries:P(k)},x)for(A in C)(_||M||!(A in I))&&h(I,A,C[A]);else i({target:t,proto:!0,forced:_||M},C);return(!a||x)&&I[y]!==D&&h(I,y,D,{name:m}),f[t]=D,C}})),it=g(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),rt=g(((e,t)=>{var i=I(),r=_e(),a=Be(),s=Ve(),n=de().f,o=tt(),l=it(),u=K(),d=x(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),at=g(((e,t)=>{var i=ee(),r=Be(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),st=g(((e,t)=>{var i=Ke(),r=q(),a=L(),s=Be(),n=ee()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),nt=g(((e,t)=>{var i=$(),r=W(),a=ue(),s=z(),n=st(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),ot=g(((e,t)=>{var i=$(),r=ue(),a=q();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),lt=g(((e,t)=>{var i=oe(),r=$(),a=ue(),s=z(),n=at(),o=ve(),l=B(),u=nt(),d=st(),c=ot(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,_,y,w,S,k=m&&m.that,T=!(!m||!m.AS_ENTRIES),E=!(!m||!m.IS_RECORD),x=!(!m||!m.IS_ITERATOR),$=!(!m||!m.INTERRUPTED),C=i(t,k),A=function(e){return g&&c(g,"normal",e),new p(!0,e)},P=function(e){return T?(a(e),$?C(e[0],e[1],A):C(e[0],e[1])):$?C(e,A):C(e)};if(E)g=e.iterator;else if(x)g=e;else{if(!(v=d(e)))throw new h(s(e)+" is not iterable");if(n(v)){for(b=0,_=o(e);_>b;b++)if((y=P(e[b]))&&l(f,y))return y;return new p(!1)}g=u(e,v)}for(w=E?e.next:g.next;!(S=r(w,g)).done;){try{y=P(S.value)}catch(e){c(g,"throw",e)}if("object"==typeof y&&y&&l(f,y))return y}return new p(!1)}})),ut=g(((e,t)=>{var i=x(),r=de(),a=A();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),dt=g((()=>{var e=he(),t=lt(),i=ut();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),ct=g(((e,t)=>{rt(),dt();var i=D();t.exports=i.Object.fromEntries})),ht=g(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),pt=g((()=>{rt();var e,t=ht(),i=b(),r=Ge(),a=Be();for(e in t)r(i[e],e),a[e]=a.Array})),ft=g(((e,t)=>{var i=ct();pt(),t.exports=i})),mt=g(((e,t)=>{var i=ft();t.exports=i})),gt=g((()=>{})),vt=g(((e,t)=>{var i=b(),r=N(),a=k(),s=function(e){return r.slice(0,e.length)===e};t.exports=s("Bun/")?"BUN":s("Cloudflare-Workers")?"CLOUDFLARE":s("Deno/")?"DENO":s("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),bt=g(((e,t)=>{var i=vt();t.exports="NODE"===i})),_t=g(((e,t)=>{var i=de();t.exports=function(e,t,r){return i.f(e,t,r)}})),yt=g(((e,t)=>{var i=O(),r=_t(),a=ee(),s=x(),n=a("species");t.exports=function(e){var t=i(e);s&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),wt=g(((e,t)=>{var i=B(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),St=g(((e,t)=>{var i=S(),r=E(),a=G(),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(e){return s(e)}),t.exports=a.inspectSource})),kt=g(((e,t)=>{var i=S(),r=_(),a=E(),s=Ke(),n=O(),o=St(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!a(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!a(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),Tt=g(((e,t)=>{var i=kt(),r=z(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a constructor")}})),Et=g(((e,t)=>{var i=ue(),r=Tt(),a=L(),s=ee()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||a(n=i(o)[s])?t:r(n)}})),xt=g(((e,t)=>{var i=S();t.exports=i([].slice)})),$t=g(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Ct=g(((e,t)=>{var i=N();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),At=g(((e,t)=>{var i,r,a,s,n=b(),o=w(),l=oe(),u=E(),d=Z(),c=_(),h=je(),p=xt(),f=re(),m=$t(),g=Ct(),v=bt(),y=n.setImmediate,S=n.clearImmediate,k=n.process,T=n.Dispatch,x=n.Function,$=n.MessageChannel,C=n.String,A=0,P={},L="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(P,e)){var t=P[e];delete P[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},D=function(e){n.postMessage(C(e),i.protocol+"//"+i.host)};(!y||!S)&&(y=function(e){m(arguments.length,1);var t=u(e)?e:x(e),i=p(arguments,1);return P[++A]=function(){o(t,void 0,i)},r(A),A},S=function(e){delete P[e]},v?r=function(e){k.nextTick(I(e))}:T&&T.now?r=function(e){T.now(I(e))}:$&&!g?(s=(a=new $).port2,a.port1.onmessage=R,r=l(s.postMessage,s)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(D)?(r=D,n.addEventListener("message",R,!1)):r=L in f("script")?function(e){h.appendChild(f("script"))[L]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:y,clear:S}})),Pt=g(((e,t)=>{var i=b(),r=x(),a=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=a(i,e);return t&&t.value}})),Lt=g(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),Mt=g(((e,t)=>{var i=N();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),It=g(((e,t)=>{var i=N();t.exports=/web0s(?!.*chrome)/i.test(i)})),Rt=g(((e,t)=>{var i,r,a,s,n,o,l,u=b(),d=Pt(),c=oe(),h=At().set,p=Lt(),f=Ct(),m=Mt(),g=It(),v=bt(),_=u.MutationObserver||u.WebKitMutationObserver,y=u.document,w=u.process,S=u.Promise,k=d("queueMicrotask");k||(o=new p,l=function(){var e,t;for(v&&(e=w.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||v||g||!_||!y?!m&&S&&S.resolve?((s=S.resolve(void 0)).constructor=S,n=c(s.then,s),i=function(){n(l)}):v?i=function(){w.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,a=y.createTextNode(""),new _(l).observe(a,{characterData:!0}),i=function(){a.data=r=!r}),k=function(e){o.head||i(),o.add(e)}),t.exports=k})),Dt=g(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),Ot=g(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),Bt=g(((e,t)=>{var i=b();t.exports=i.Promise})),Nt=g(((e,t)=>{var i=b(),r=Bt(),a=E(),s=ne(),n=St(),o=ee(),l=vt(),u=K(),d=V(),c=r&&r.prototype,h=o("species"),p=!1,f=a(i.PromiseRejectionEvent),m=s("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=a,!(p=i.then((function(){}))instanceof a))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),Vt=g(((e,t)=>{var i=W(),r=TypeError,a=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw new r("Bad Promise constructor");t=e,a=i})),this.resolve=i(t),this.reject=i(a)};t.exports.f=function(e){return new a(e)}})),Ut=g((()=>{var e,t,i,r=he(),a=K(),s=bt(),n=b(),o=$(),l=We(),u=et(),d=Ge(),c=yt(),h=W(),p=E(),f=R(),m=wt(),g=Et(),v=At().set,_=Rt(),y=Dt(),w=Ot(),S=Lt(),k=Ve(),T=Bt(),x=Nt(),C=Vt(),A="Promise",P=x.CONSTRUCTOR,L=x.REJECTION_EVENT,M=x.SUBCLASSING,I=k.getterFor(A),D=k.set,O=T&&T.prototype,B=T,N=O,V=n.TypeError,U=n.document,F=n.process,j=C.f,z=j,q=!!(U&&U.createEvent&&n.dispatchEvent),H="unhandledrejection",Q=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},G=function(e,t){var i,r,a,s=t.value,n=1===t.state,l=n?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(n||(2===t.rejection&&ee(t),t.rejection=1),!0===l?i=s:(c&&c.enter(),i=l(s),c&&(c.exit(),a=!0)),i===e.promise?d(new V("Promise-chain cycle")):(r=Q(i))?o(r,i,u,d):u(i)):d(s)}catch(e){c&&!a&&c.exit(),d(e)}},Y=function(e,t){e.notified||(e.notified=!0,_((function(){for(var i,r=e.reactions;i=r.get();)G(i,e);e.notified=!1,t&&!e.rejection&&Z(e)})))},X=function(e,t,i){var r,a;q?((r=U.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),n.dispatchEvent(r)):r={promise:t,reason:i},!L&&(a=n["on"+e])?a(r):e===H&&y("Unhandled promise rejection",i)},Z=function(e){o(v,n,(function(){var t,i=e.facade,r=e.value;if(J(e)&&(t=w((function(){s?F.emit("unhandledRejection",r,i):X(H,i,r)})),e.rejection=s||J(e)?2:1,t.error))throw t.value}))},J=function(e){return 1!==e.rejection&&!e.parent},ee=function(e){o(v,n,(function(){var t=e.facade;s?F.emit("rejectionHandled",t):X("rejectionhandled",t,e.value)}))},te=function(e,t,i){return function(r){e(t,r,i)}},ie=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Y(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new V("Promise can't be resolved itself");var r=Q(t);r?_((function(){var i={done:!1};try{o(r,t,te(re,i,e),te(ie,i,e))}catch(t){ie(i,t,e)}})):(e.value=t,e.state=1,Y(e,!1))}catch(t){ie({done:!1},t,e)}}};if(P&&(N=(B=function(t){m(this,N),h(t),o(e,this);var i=I(this);try{t(te(re,i),te(ie,i))}catch(e){ie(i,e)}}).prototype,(e=function(e){D(this,{type:A,done:!1,notified:!1,parent:!1,reactions:new S,rejection:!1,state:0,value:void 0})}).prototype=l(N,"then",(function(e,t){var i=I(this),r=j(g(this,B));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=s?F.domain:void 0,0===i.state?i.reactions.add(r):_((function(){G(r,i)})),r.promise})),t=function(){var t=new e,i=I(t);this.promise=t,this.resolve=te(re,i),this.reject=te(ie,i)},C.f=j=function(e){return e===B||undefined===e?new t(e):z(e)},!a&&p(T)&&O!==Object.prototype)){i=O.then,M||l(O,"then",(function(e,t){var r=this;return new B((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete O.constructor}catch{}u&&u(O,N)}r({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:B}),d(B,A,!1,!0),c(A)})),Ft=g(((e,t)=>{var i,r,a=ee()("iterator"),s=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){s=!0}})[a]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!s)return!1}catch{return!1}var i=!1;try{var r={};r[a]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),jt=g(((e,t)=>{var i=Bt(),r=Ft(),a=Nt().CONSTRUCTOR;t.exports=a||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),zt=g((()=>{var e=he(),t=$(),i=W(),r=Vt(),a=Ot(),s=lt();e({target:"Promise",stat:!0,forced:jt()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=a((function(){var r=i(n.resolve),a=[],o=0,d=1;s(e,(function(e){var i=o++,s=!1;d++,t(r,n,e).then((function(e){s||(s=!0,a[i]=e,--d||l(a))}),u)})),--d||l(a)}));return d.error&&u(d.value),o.promise}})})),Wt=g((()=>{var e,t=he(),i=K(),r=Nt().CONSTRUCTOR,a=Bt(),s=O(),n=E(),o=We(),l=a&&a.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(a)&&(e=s("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),qt=g((()=>{var e=he(),t=$(),i=W(),r=Vt(),a=Ot(),s=lt();e({target:"Promise",stat:!0,forced:jt()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=a((function(){var r=i(n.resolve);s(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),Ht=g((()=>{var e=he(),t=Vt();e({target:"Promise",stat:!0,forced:Nt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),Kt=g(((e,t)=>{var i=ue(),r=R(),a=Vt();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=a.f(e);return(0,s.resolve)(t),s.promise}})),Qt=g((()=>{var e=he(),t=O(),i=K(),r=Bt(),a=Nt().CONSTRUCTOR,s=Kt(),n=t("Promise"),o=i&&!a;e({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return s(o&&this===n?r:this,e)}})})),Gt=g((()=>{Ut(),zt(),Wt(),qt(),Ht(),Qt()})),Yt=g((()=>{var e,t=he(),i=K(),r=Bt(),a=_(),s=O(),n=E(),o=Et(),l=Kt(),u=We(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&a((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,s("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=s("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),Xt=g(((e,t)=>{gt(),Gt(),Yt();var i=we();t.exports=i("Promise","finally")})),Zt=g(((e,t)=>{var i=Xt();t.exports=i})),Jt=g(((e,t)=>{var i=Zt();t.exports=i})),ei=g((()=>{var e=he(),t=Me().values;e({target:"Object",stat:!0},{values:function(e){return t(e)}})})),ti=g(((e,t)=>{ei();var i=D();t.exports=i.Object.values})),ii=g(((e,t)=>{var i=ti();t.exports=i})),ri=g(((e,t)=>{var i=ii();t.exports=i})),ai=g((()=>{var e=he(),t=X(),i=ve(),r=fe(),a=_e();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),si=g(((e,t)=>{ai();var i=we();t.exports=i("Array","at")})),ni=g(((e,t)=>{var i=si();t.exports=i})),oi=g(((e,t)=>{var i=ni();t.exports=i})),li=g(((e,t)=>{var i=k();t.exports=Array.isArray||function(e){return"Array"===i(e)}})),ui=g(((e,t)=>{var i=TypeError;t.exports=function(e){if(e>9007199254740991)throw i("Maximum allowed index exceeded");return e}})),di=g(((e,t)=>{var i=li(),r=ve(),a=ui(),s=oe(),n=function(e,t,o,l,u,d,c,h){for(var p,f,m=u,g=0,v=!!c&&s(c,h);g<l;)g in o&&(p=v?v(o[g],g,t):o[g],d>0&&i(p)?(f=r(p),m=n(e,t,p,f,m,d-1)-1):(a(m+1),e[m]=p),m++),g++;return m};t.exports=n})),ci=g(((e,t)=>{var i=li(),r=kt(),a=R(),s=ee()("species"),n=Array;t.exports=function(e){var t;return i(e)&&(t=e.constructor,r(t)&&(t===n||i(t.prototype))?t=void 0:a(t)&&(null===(t=t[s])&&(t=void 0))),void 0===t?n:t}})),hi=g(((e,t)=>{var i=ci();t.exports=function(e,t){return new(i(e))(0===t?0:t)}})),pi=g((()=>{var e=he(),t=di(),i=W(),r=X(),a=ve(),s=hi();e({target:"Array",proto:!0},{flatMap:function(e){var n,o=r(this),l=a(o);return i(e),(n=s(o,0)).length=t(n,o,o,l,0,1,e,arguments.length>1?arguments[1]:void 0),n}})})),fi=g((()=>{_e()("flatMap")})),mi=g(((e,t)=>{pi(),fi();var i=we();t.exports=i("Array","flatMap")})),gi=g(((e,t)=>{var i=mi();t.exports=i})),vi=g(((e,t)=>{var i=gi();t.exports=i})),bi=g(((e,t)=>{var i=Ke(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),_i=g(((e,t)=>{t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"})),yi=g(((e,t)=>{var i=S(),r=M(),a=bi(),s=_i(),n=i("".replace),o=RegExp("^["+s+"]+"),l=RegExp("(^|[^"+s+"])["+s+"]+$"),u=function(e){return function(t){var i=a(r(t));return 1&e&&(i=n(i,o,"")),2&e&&(i=n(i,l,"$1")),i}};t.exports={start:u(1),end:u(2),trim:u(3)}})),wi=g(((e,t)=>{var i=Ue().PROPER,r=_(),a=_i();t.exports=function(e){return r((function(){return!!a[e]()||"​᠎"!=="​᠎"[e]()||i&&a[e].name!==e}))}})),Si=g(((e,t)=>{var i=yi().start,r=wi();t.exports=r("trimStart")?function(){return i(this)}:"".trimStart})),ki=g((()=>{var e=he(),t=Si();e({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==t},{trimLeft:t})})),Ti=g((()=>{ki();var e=he(),t=Si();e({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==t},{trimStart:t})})),Ei=g(((e,t)=>{Ti();var i=we();t.exports=i("String","trimLeft")})),xi=g(((e,t)=>{var i=Ei();t.exports=i})),$i=g(((e,t)=>{var i=xi();t.exports=i})),Ci=g((()=>{})),Ai=g((()=>{})),Pi=g(((e,t)=>{var i=R(),r=k(),a=ee()("match");t.exports=function(e){var t;return i(e)&&(void 0!==(t=e[a])?!!t:"RegExp"===r(e))}})),Li=g(((e,t)=>{var i=ue();t.exports=function(){var e=i(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}})),Mi=g(((e,t)=>{var i=$(),r=Z(),a=B(),s=Li(),n=RegExp.prototype;t.exports=function(e){var t=e.flags;return void 0!==t||"flags"in n||r(e,"flags")||!a(n,e)?t:i(s,e)}})),Ii=g(((e,t)=>{var i=S(),r=X(),a=Math.floor,s=i("".charAt),n=i("".replace),o=i("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;t.exports=function(e,t,i,d,c,h){var p=i+e.length,f=d.length,m=u;return void 0!==c&&(c=r(c),m=l),n(h,m,(function(r,n){var l;switch(s(n,0)){case"$":return"$";case"&":return e;case"`":return o(t,0,i);case"'":return o(t,p);case"<":l=c[o(n,1,-1)];break;default:var u=+n;if(0===u)return r;if(u>f){var h=a(u/10);return 0===h?r:h<=f?void 0===d[h-1]?s(n,1):d[h-1]+s(n,1):r}l=d[u-1]}return void 0===l?"":l}))}})),Ri=g((()=>{var e=he(),t=$(),i=S(),r=M(),a=E(),s=L(),n=Pi(),o=bi(),l=q(),u=Mi(),d=Ii(),c=ee(),h=K(),p=c("replace"),f=TypeError,m=i("".indexOf),g=i("".replace),v=i("".slice),b=Math.max;e({target:"String",proto:!0},{replaceAll:function(e,i){var c,_,y,w,S,k,T,E,x,$,C=r(this),A=0,P="";if(!s(e)){if((c=n(e))&&(_=o(r(u(e))),!~m(_,"g")))throw new f("`.replaceAll` does not allow non-global regexes");if(y=l(e,p))return t(y,e,C,i);if(h&&c)return g(o(C),e,i)}for(w=o(C),S=o(e),(k=a(i))||(i=o(i)),T=S.length,E=b(1,T),x=m(w,S);-1!==x;)$=k?o(i(S,x,w)):d(S,w,x,[],void 0,i),P+=v(w,A,x)+$,A=x+T,x=x+E>w.length?-1:m(w,S,x+E);return A<w.length&&(P+=v(w,A)),P}})})),Di=g(((e,t)=>{Ci(),Ai(),Ri();var i=we();t.exports=i("String","replaceAll")})),Oi=g(((e,t)=>{var i=Di();t.exports=i})),Bi=g(((e,t)=>{var i=Oi();t.exports=i})),Ni=g(((e,t)=>{var i=fe(),r=bi(),a=M(),s=RangeError;t.exports=function(e){var t=r(a(this)),n="",o=i(e);if(o<0||o===1/0)throw new s("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),Vi=g(((e,t)=>{var i=S(),r=ge(),a=bi(),s=Ni(),n=M(),o=i(s),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,s){var d,c,h=a(n(t)),p=r(i),f=h.length,m=void 0===s?" ":a(s);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),Ui=g(((e,t)=>{var i=N();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),Fi=g((()=>{var e=he(),t=Vi().start;e({target:"String",proto:!0,forced:Ui()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),ji=g(((e,t)=>{Fi();var i=we();t.exports=i("String","padStart")})),zi=g(((e,t)=>{var i=ji();t.exports=i})),Wi=g(((e,t)=>{var i=zi();t.exports=i})),qi="2.0.134",Hi=((s=Hi||{}).STOPPED="stopped",s.READY="ready",s.PLAYING="playing",s.PAUSED="paused",s),Ki=((a=Ki||{}).MPEG="MPEG",a.DASH="DASH",a.DASH_SEP="DASH_SEP",a.DASH_SEP_VK="DASH_SEP",a.DASH_WEBM="DASH_WEBM",a.DASH_WEBM_AV1="DASH_WEBM_AV1",a.DASH_STREAMS="DASH_STREAMS",a.DASH_WEBM_VK="DASH_WEBM",a.DASH_ONDEMAND="DASH_ONDEMAND",a.DASH_ONDEMAND_VK="DASH_ONDEMAND",a.DASH_LIVE="DASH_LIVE",a.DASH_LIVE_CMAF="DASH_LIVE_CMAF",a.DASH_LIVE_WEBM="DASH_LIVE_WEBM",a.HLS="HLS",a.HLS_ONDEMAND="HLS_ONDEMAND",a.HLS_JS="HLS",a.HLS_LIVE="HLS_LIVE",a.HLS_LIVE_CMAF="HLS_LIVE_CMAF",a.WEB_RTC_LIVE="WEB_RTC_LIVE",a),Qi=(e=>(e.NOT_AVAILABLE="NOT_AVAILABLE",e.AVAILABLE="AVAILABLE",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e))(Qi||{}),Gi=((n=Gi||{}).HTTP1="http1",n.HTTP2="http2",n.QUIC="quic",n),Yi=((o=Yi||{}).NONE="none",o.INLINE="inline",o.FULLSCREEN="fullscreen",o.SECOND_SCREEN="second_screen",o.PIP="pip",o.INVISIBLE="invisible",o),Xi=(e=>(e.TRAFFIC_SAVING="traffic_saving",e.HIGH_QUALITY="high_quality",e.UNKNOWN="unknown",e))(Xi||{}),Zi=v(Te(),1),Ji=class{connect(){cast.framework.CastContext.getInstance()?.requestSession()}disconnect(){cast.framework.CastContext.getInstance()?.getCurrentSession()?.endSession(!0)}stopMedia(){return new Promise(((e,t)=>{cast.framework.CastContext.getInstance()?.getCurrentSession()?.getMediaSession()?.stop(new chrome.cast.media.StopRequest,e,t)}))}toggleConnection(){(0,u.isNonNullable)(this.connection$.getValue())?this.disconnect():this.connect()}setVolume(e){let t=this.connection$.getValue();(0,u.isNullable)(t)||(t.remotePlayer.volumeLevel=e,t.remotePlayerController.setVolumeLevel())}setMuted(e){let t=this.connection$.getValue();(0,u.isNullable)(t)||e!==t.remotePlayer.isMuted&&t.remotePlayerController.muteOrUnmute()}destroy(){this.isDestroyed=!0,this.subscription.unsubscribe()}initListeners(){let e=new cast.framework.RemotePlayer,t=new cast.framework.RemotePlayerController(e),i=cast.framework.CastContext.getInstance();this.subscription.add((0,u.fromEvent)(i,cast.framework.CastContextEventType.SESSION_STATE_CHANGED).subscribe((e=>{switch(e.sessionState){case cast.framework.SessionState.SESSION_STARTED:case cast.framework.SessionState.SESSION_STARTING:case cast.framework.SessionState.SESSION_RESUMED:this.contentId=i.getCurrentSession()?.getMediaSession()?.media?.contentId;break;case cast.framework.SessionState.NO_SESSION:case cast.framework.SessionState.SESSION_ENDING:case cast.framework.SessionState.SESSION_ENDED:case cast.framework.SessionState.SESSION_START_FAILED:this.contentId=void 0;break;default:return(0,u.assertNever)(e.sessionState)}}))).add((0,u.merge)((0,u.fromEvent)(i,cast.framework.CastContextEventType.CAST_STATE_CHANGED).pipe((0,u.tap)((e=>{this.log({message:`[cast.framework.RemotePlayerEventType.CAST_STATE_CHANGED]: ${JSON.stringify(e)}`})})),(0,u.map)((e=>e.castState))),(0,u.observableFrom)([i.getCastState()])).pipe((0,u.filterChanged)(),(0,u.map)(er),(0,u.tap)((e=>{this.log({message:`realCastState$: ${e}`})}))).subscribe(this.realCastState$)).add(this.realCastState$.subscribe((r=>{let a="CONNECTED"===r,s=(0,u.isNonNullable)(this.connection$.getValue());if(a&&!s){let r=i.getCurrentSession();(0,u.assertNonNullable)(r);let a=r.getCastDevice(),s=r.getMediaSession()?.media?.contentId;((0,u.isNullable)(s)||s===this.contentId)&&(this.log({message:"connection created"}),this.connection$.next({remotePlayer:e,remotePlayerController:t,session:r,castDevice:a}))}else!a&&s&&(this.log({message:"connection destroyed"}),this.connection$.next(void 0));this.castState$.next("CONNECTED"===r?(0,u.isNonNullable)(this.connection$.getValue())?"CONNECTED":"AVAILABLE":r)})))}initializeCastApi(){let e,t,i;try{e=cast.framework.CastContext.getInstance(),t=chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID,i=chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED}catch{return}try{e.setOptions({receiverApplicationId:this.params.receiverApplicationId??t,autoJoinPolicy:i}),this.initListeners()}catch(e){this.errorEvent$.next({id:"ChromecastInitializer",category:u.ErrorCategory.EXTERNAL_API,message:"[initializeCastApi] failed",thrown:e})}}constructor(e){this.connection$=new u.ValueSubject(void 0),this.castState$=new u.ValueSubject("NOT_AVAILABLE"),this.errorEvent$=new u.Subject,this.realCastState$=new u.ValueSubject("NOT_AVAILABLE"),this.subscription=new u.Subscription,this.isDestroyed=!1,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastInitializer");let t="chrome"in window;if(this.log({message:`[constructor] receiverApplicationId: ${this.params.receiverApplicationId}, isDisabled: ${this.params.isDisabled}, isSupported: ${t}`}),e.isDisabled||!t)return;let i=(0,u.isNonNullable)(window.chrome?.cast),r=!!window.__onGCastApiAvailable;var a;i?this.initializeCastApi():(window.__onGCastApiAvailable=e=>{delete window.__onGCastApiAvailable,e&&!this.isDestroyed&&this.initializeCastApi()},r||(a="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",new Promise(((e,t)=>{let i=document.createElement("script");i.setAttribute("src",a),i.onload=()=>e(),i.onerror=e=>t(e),document.body.appendChild(i)}))).catch((()=>this.errorEvent$.next({id:"ChromecastLoading",category:u.ErrorCategory.NETWORK,message:"Script loading failed!"}))))}},er=e=>{switch(e){case cast.framework.CastState.NO_DEVICES_AVAILABLE:return"NOT_AVAILABLE";case cast.framework.CastState.NOT_CONNECTED:return"AVAILABLE";case cast.framework.CastState.CONNECTING:return"CONNECTING";case cast.framework.CastState.CONNECTED:return"CONNECTED";default:return(0,u.assertNever)(e)}},tr=v(Te(),1),ir=v(Oe(),1),rr=v(mt(),1),ar=v(Jt(),1),sr=(e,t=0,i=0)=>{switch(i){case 0:return e.replace("_offset_p",0===t?"":"_"+t.toFixed(0));case 1:{if(0===t)return e;let i=new URL(e);return i.searchParams.append("playback_shift",t.toFixed(0)),i.toString()}case 2:{let i=new URL(e);return i.searchParams.get("offset_p")||0!==t?(i.searchParams.set("offset_p",t.toFixed(0)),i.toString()):e}default:(0,u.assertNever)(i)}return e},nr=(e,t)=>{switch(t){case 0:return NaN;case 1:{let t=new URL(e);return Number(t.searchParams.get("playback_shift"))}case 2:{let t=new URL(e);return Number(t.searchParams.get("offset_p")??0)}default:(0,u.assertNever)(t)}},or=(e,t,i=!1)=>{let r=e.getTransition();(i||!r||r.to===t)&&e.setState(t)},lr=class{setState(e){let t=this.transition,i=this.state;this.transition=void 0,this.prevState=i,this.state=e,t?t.to===e?this.transitionEnded$.next(t):this.forceChanged$.next({from:t.from,to:e,canceledTransition:t}):this.forceChanged$.next({from:i,to:e,canceledTransition:t})}startTransitionTo(e){let t=this.transition,i=this.state;i===e||(0,u.isNonNullable)(t)&&t.to===e||(this.prevState=i,this.state=e,t?(this.transition={from:t.from,to:e,canceledTransition:t},this.transitionUpdated$.next(this.transition)):(this.transition={from:i,to:e},this.transitionStarted$.next(this.transition)))}getTransition(){return this.transition}getState(){return this.state}getPrevState(){return this.prevState}constructor(e){this.transitionStarted$=new u.Subject,this.transitionEnded$=new u.Subject,this.transitionUpdated$=new u.Subject,this.forceChanged$=new u.Subject,this.stateChangeStarted$=(0,u.merge)(this.transitionStarted$,this.transitionUpdated$),this.stateChangeEnded$=(0,u.merge)(this.transitionEnded$,this.forceChanged$),this.state=e,this.prevState=void 0}},ur=class{destroy(){this.log({message:"[destroy]"}),this.subscription.unsubscribe()}subscribe(){this.subscription.add(this.loadMediaTimeoutSubscription);let e=new u.Subscription;this.subscription.add(e),this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>`stateChangeStarted$ ${JSON.stringify(e)}`))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>`stateChangeEnded$ ${JSON.stringify(e)}`)))).subscribe((e=>this.log({message:`[videoState] ${e}`}))));let t=(e,t)=>this.subscription.add(e.subscribe(t));if(this.params.output.isLive$.getValue())this.params.output.position$.next(0),this.params.output.duration$.next(0);else{let t=new u.Subject;e.add(t.pipe((0,u.debounce)(500)).subscribe((()=>{this.params.output.seekedEvent$.next()})));let i=NaN;e.add((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED).subscribe((e=>{this.logRemoteEvent(e);let r=e.value;this.params.output.position$.next(r),("applying"===this.params.desiredState.seekState.getState().state||Math.abs(r-i)>5)&&t.next(r),i=r}))),e.add((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.DURATION_CHANGED).subscribe((e=>{this.logRemoteEvent(e),this.params.output.duration$.next(e.value)})))}t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MEDIA_LOADED_CHANGED),(t=>{this.logRemoteEvent(t),t.value?this.handleRemoteReady():(this.handleRemoteStop(),e.unsubscribe())})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_PAUSED_CHANGED),(e=>{this.logRemoteEvent(e),e.value?this.handleRemotePause():this.handleRemotePlay()})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED),(e=>{this.logRemoteEvent(e);let{remotePlayer:t}=this.params.connection,i=e.value,r=this.params.output.isBuffering$.getValue(),a=i===chrome.cast.media.PlayerState.BUFFERING;switch(r!==a&&this.params.output.isBuffering$.next(a),i){case chrome.cast.media.PlayerState.IDLE:!this.params.output.isLive$.getValue()&&t.duration-t.currentTime<5&&this.params.output.endedEvent$.next(),this.handleRemoteStop(),or(this.params.desiredState.playbackState,"stopped");break;case chrome.cast.media.PlayerState.PAUSED:this.handleRemotePause();break;case chrome.cast.media.PlayerState.PLAYING:this.handleRemotePlay();break;case chrome.cast.media.PlayerState.BUFFERING:break;default:(0,u.assertNever)(i)}})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({volume:e.value})})),t((0,u.fromEvent)(this.params.connection.remotePlayerController,cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED),(e=>{this.logRemoteEvent(e),this.handleRemoteVolumeChange({muted:e.value})})),t((0,u.merge)(this.params.desiredState.playbackState.stateChangeStarted$,this.params.desiredState.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)),this.syncPlayback)}restoreSession(e){this.log({message:"restoreSession"});let{remotePlayer:t}=this.params.connection;if(e.playerState!==chrome.cast.media.PlayerState.IDLE){t.isPaused?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"));let e=this.params.output.isLive$.getValue();this.params.output.duration$.next(e?0:t.duration),this.params.output.position$.next(e?0:t.currentTime),this.params.desiredState.seekState.setState({state:"none"})}}prepare(){let e=this.params.format;this.log({message:`[prepare] format: ${e}`});let t=this.createMediaInfo(e),i=this.createLoadRequest(t);this.loadMedia(i)}handleRemotePause(){let e=this.videoState.getState();("paused"===this.videoState.getTransition()?.to||"playing"===e)&&(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused"))}handleRemotePlay(){let e=this.videoState.getState();("playing"===this.videoState.getTransition()?.to||"paused"===e)&&(this.videoState.setState("playing"),or(this.params.desiredState.playbackState,"playing"))}handleRemoteReady(){"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"ready"===this.params.desiredState.playbackState.getTransition()?.to&&or(this.params.desiredState.playbackState,"ready")}handleRemoteStop(){"stopped"!==this.videoState.getState()&&this.videoState.setState("stopped")}handleRemoteVolumeChange(e){let t=this.params.output.volume$.getValue(),i={volume:e.volume??t.volume,muted:e.muted??t.muted};(i.volume!==t.volume||i.muted!=i.muted)&&this.params.output.volume$.next(i)}seek(e){this.params.output.willSeekEvent$.next();let{remotePlayer:t,remotePlayerController:i}=this.params.connection;t.currentTime=e,i.seek()}stop(){let{remotePlayerController:e}=this.params.connection;e.stop()}createMediaInfo(e){let t,i,r,a=this.params.source;switch(e){case"MPEG":{let s=a[e];(0,u.assertNonNullable)(s);let n=(0,u.getHighestQuality)(Object.keys(s));(0,u.assertNonNullable)(n);let o=s[n];(0,u.assertNonNullable)(o),t=o,i="video/mp4",r=chrome.cast.media.StreamType.BUFFERED;break}case"HLS":case"HLS_ONDEMAND":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/x-mpegurl",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.BUFFERED;break}case"DASH_LIVE_CMAF":{let s=a[e];(0,u.assertNonNullable)(s),t=s.url,i="application/dash+xml",r=chrome.cast.media.StreamType.LIVE;break}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let s=a[e];(0,u.assertNonNullable)(s),t=sr(s.url),i="application/x-mpegurl",r=chrome.cast.media.StreamType.LIVE;break}case"DASH_LIVE":case"WEB_RTC_LIVE":{let e="Unsupported format for Chromecast",t=new Error(e);throw this.params.output.error$.next({id:"ChromecastProvider.createMediaInfo()",category:u.ErrorCategory.VIDEO_PIPELINE,message:e,thrown:t}),t}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,u.assertNever)(e)}let s=new chrome.cast.media.MediaInfo(this.params.meta.videoId??t,i);s.contentUrl=t,s.streamType=r,s.metadata=new chrome.cast.media.GenericMediaMetadata;let{title:n,subtitle:o}=this.params.meta;return(0,u.isNonNullable)(n)&&(s.metadata.title=n),(0,u.isNonNullable)(o)&&(s.metadata.subtitle=o),s}createLoadRequest(e){let t=new chrome.cast.media.LoadRequest(e);t.autoplay=!1;let i=this.params.desiredState.seekState.getState();return"applying"===i.state||"requested"===i.state?t.currentTime=this.params.output.isLive$.getValue()?0:i.position/1e3:t.currentTime=0,t}loadMedia(e){let t=this.params.connection.session.loadMedia(e),i=new Promise(((e,t)=>{this.loadMediaTimeoutSubscription.add((0,u.timeout)(7e3).subscribe((()=>t("timeout(7000)"))))}));(0,ar.default)(Promise.race([t,i]).then((()=>{this.log({message:`[loadMedia] completed, format: ${this.params.format}`}),"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.handleRemoteReady()}),(e=>{let t=`[prepare] loadMedia failed, format: ${this.params.format}, reason: ${e}`;this.log({message:t}),this.params.output.error$.next({id:"ChromecastProvider.loadMedia",category:u.ErrorCategory.VIDEO_PIPELINE,message:t,thrown:e})})),(()=>{this.loadMediaTimeoutSubscription.unsubscribe()}))}logRemoteEvent(e){this.log({message:`[remoteEvent] ${JSON.stringify(e)}`})}constructor(e){this.subscription=new u.Subscription,this.loadMediaTimeoutSubscription=new u.Subscription,this.videoState=new lr("stopped"),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; desiredPlaybackStateTransition: ${this.params.desiredState.playbackState.getTransition()}; seekState: ${JSON.stringify(a)};`}),"stopped"!==i){if(!t){if("paused"!==r?.to&&"requested"===a.state&&"stopped"!==e)return void this.seek(a.position/1e3);switch(i){case"ready":switch(e){case"playing":case"paused":case"ready":break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;case"playing":switch(e){case"playing":break;case"paused":case"ready":this.videoState.startTransitionTo("playing"),this.params.connection.remotePlayerController.playOrPause();break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;case"paused":switch(e){case"playing":this.videoState.startTransitionTo("paused"),this.params.connection.remotePlayerController.playOrPause();break;case"paused":break;case"ready":this.videoState.startTransitionTo("paused"),this.videoState.setState("paused");break;case"stopped":this.videoState.startTransitionTo("ready"),this.prepare();break;default:(0,u.assertNever)(e)}break;default:(0,u.assertNever)(i)}}}else"stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.stop())},this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ChromecastProvider"),this.log({message:`constructor, format: ${e.format}`}),this.params.output.isLive$.next((e=>{switch(e){case"MPEG":case"DASH":case"DASH_SEP":case"DASH_ONDEMAND":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_STREAMS":case"HLS":case"HLS_ONDEMAND":return!1;case"DASH_LIVE":case"DASH_LIVE_CMAF":case"HLS_LIVE":case"HLS_LIVE_CMAF":case"DASH_LIVE_WEBM":case"WEB_RTC_LIVE":return!0;default:return(0,u.assertNever)(e)}})(e.format)),this.params.output.isAudioAvailable$.next(!0),this.handleRemoteVolumeChange({volume:this.params.connection.remotePlayer.volumeLevel,muted:this.params.connection.remotePlayer.isMuted});let t=this.params.connection.session.getMediaSession();t&&this.restoreSession(t),this.subscribe()}},dr=v(Te(),1),cr=window.WeakMap?new WeakMap:new class{get(e){return e.hasAttribute(this.attribute)}set(e,t){e.toggleAttribute(this.attribute,t)}delete(e){e.removeAttribute(this.attribute)}constructor(){this.attribute="data-pool-reused"}},hr=window.WeakMap?new WeakMap:new Map,pr=(e,{audioVideoSyncRate:t,disableYandexPiP:i})=>{let r=e.querySelector("video"),a=!!r;r?(0,u.clearVideoElement)(r):(r=document.createElement("video"),e.appendChild(r)),cr.set(r,a);let s=new u.Subscription;return s.add(((e,t=20)=>{let i=0;return(0,u.fromEvent)(e,"ratechange").subscribe((r=>{i++,i>=t&&(e.currentTime=e.currentTime,i=0)}))})(r,t)),hr.set(r,s),r.setAttribute("crossorigin","anonymous"),r.setAttribute("playsinline","playsinline"),i&&r.setAttribute("x-yandex-pip","false"),r.controls=!1,r.setAttribute("poster","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="),r},fr=e=>{hr.get(e)?.unsubscribe(),hr.delete(e);let t=cr.get(e);cr.delete(e),t?(0,u.clearVideoElement)(e):(e=>{try{e.pause(),e.playbackRate=0,(0,u.clearVideoElement)(e),e.remove()}catch(e){console.error(e)}})(e)},mr=v(ri(),1),gr=(e,t,i,{equal:r=(e,t)=>e===t,changed$:a,onError:s}={})=>{let n=e.getState(),o=t(),l=(0,u.isNullable)(a),d=new u.Subscription;return a&&d.add(a.subscribe((t=>{let i=e.getState();r(t,i)&&e.setState(t)}),s)),r(o,n)||(i(n),l&&e.setState(n)),d.add(e.stateChangeStarted$.subscribe((t=>{i(t.to),l&&e.setState(t.to)}),s)),d},vr=(e,t,i)=>gr(t,(()=>e.loop),(t=>{(0,u.isNonNullable)(t)&&(e.loop=t)}),{onError:i}),br=(e,t,i,r)=>gr(t,(()=>({muted:e.muted,volume:e.volume})),(t=>{(0,u.isNonNullable)(t)&&(e.muted=t.muted,e.volume=t.volume)}),{equal:(e,t)=>e===t||e?.muted===t?.muted&&e?.volume===t?.volume,changed$:i,onError:r}),_r=(e,t,i,r)=>gr(t,(()=>e.playbackRate),(t=>{(0,u.isNonNullable)(t)&&(e.playbackRate=t)}),{changed$:i,onError:r}),yr=gr,wr=(e,t)=>{if(e.id===t)return!0;let[i,r,a]=t.split("|");return e.language===r&&e.label===a},Sr=class e{connect(e,t,i){this.video=e,this.cueSettings=t.textTrackCuesSettings,this.subscribe();let r=e=>{this.error$.next({id:"TextTracksManager",category:u.ErrorCategory.WTF,message:"Generic HtmlVideoTextTrackManager error",thrown:e})};this.subscription.add(this.available$.subscribe(i.availableTextTracks$)),this.subscription.add(this.current$.subscribe(i.currentTextTrack$)),this.subscription.add(this.error$.subscribe(i.error$)),this.subscription.add(yr(t.internalTextTracks,(()=>(0,mr.default)(this.internalTracks)),(e=>{(0,u.isNonNullable)(e)&&this.setInternal(e)}),{equal:(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,u.map)((e=>e.filter((({type:e})=>"internal"===e))))),onError:r})),this.subscription.add(yr(t.externalTextTracks,(()=>(0,mr.default)(this.externalTracks)),(e=>{(0,u.isNonNullable)(e)&&this.setExternal(e)}),{equal:(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&e.length===t.length&&e.every((({id:e},i)=>e===t[i].id)),changed$:this.available$.pipe((0,u.map)((e=>e.filter((({type:e})=>"external"===e))))),onError:r})),this.subscription.add(yr(t.currentTextTrack,(()=>{if(this.video)return;let e=this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e));return e&&this.htmlTextTrackToITextTrack(e).id}),(e=>this.select(e)),{changed$:this.current$,onError:r})),this.subscription.add(yr(t.textTrackCuesSettings,(()=>({})),(()=>{if(this.video)for(let e of this.htmlTextTracksAsArray())this.applyCueSettings(e.cues),this.applyCueSettings(e.activeCues)})))}subscribe(){(0,u.assertNonNullable)(this.video);let{textTracks:e}=this.video;this.subscription.add((0,u.fromEvent)(e,"addtrack").subscribe((()=>{let e=this.current$.getValue();e&&this.select(e)}))),this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"addtrack"),(0,u.fromEvent)(e,"removetrack"),(0,u.observableFrom)(["init"])).pipe((0,u.map)((()=>this.htmlTextTracksAsArray().map((e=>this.htmlTextTrackToITextTrack(e))))),(0,u.filterChanged)(((e,t)=>e.length===t.length&&e.every((({id:e},i)=>e===t[i].id))))).subscribe(this.available$)),this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).pipe((0,u.map)((()=>this.htmlTextTracksAsArray().find((({mode:e})=>"showing"===e)))),(0,u.map)((e=>e&&this.htmlTextTrackToITextTrack(e).id)),(0,u.filterChanged)()).subscribe(this.current$));let t=e=>this.applyCueSettings(e.target?.activeCues??null);this.subscription.add((0,u.fromEvent)(e,"addtrack").subscribe((e=>{e.track?.addEventListener("cuechange",t);let i=e=>{let t=e.target?.cues??null;t&&t.length&&(this.applyCueSettings(e.target?.cues??null),e.target?.removeEventListener("cuechange",i))};e.track?.addEventListener("cuechange",i)}))),this.subscription.add((0,u.fromEvent)(e,"removetrack").subscribe((e=>{e.track?.removeEventListener("cuechange",t)})))}applyCueSettings(e){if(!e||!e.length)return;let t=this.cueSettings.getState();for(let i of Array.from(e)){let e=i;(0,u.isNonNullable)(t.align)&&(e.align=t.align),(0,u.isNonNullable)(t.position)&&(e.position=t.position),(0,u.isNonNullable)(t.size)&&(e.size=t.size),(0,u.isNonNullable)(t.line)&&(e.line=t.line)}}htmlTextTracksAsArray(t=!1){(0,u.assertNonNullable)(this.video);let i=[...this.video.textTracks];return t?i:i.filter(e.isHealthyTrack)}htmlTextTrackToITextTrack(e){let{language:t,label:i}=e,r=e.id?e.id:(e=>["__",e.language,e.label].join("|"))(e),a=this.externalTracks.has(r),s=(a?this.externalTracks.get(r)?.isAuto:this.internalTracks.get(r)?.isAuto)??r.includes("auto");return a?{id:r,type:"external",isAuto:s,language:t,label:i,url:this.externalTracks.get(r)?.url}:{id:r,type:"internal",isAuto:s,language:t,label:i,url:this.internalTracks.get(r)?.url}}static isHealthyTrack(e){return!("metadata"===e.kind||e.groupId||""===e.id&&""===e.label&&""===e.language)}setExternal(e){this.internalTracks.size>0&&Array.from(this.internalTracks).forEach((([,e])=>this.detach(e))),e.filter((({id:e})=>!this.externalTracks.has(e))).forEach((e=>this.attach(e))),Array.from(this.externalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}setInternal(e){let t=[...this.externalTracks];e.filter((({id:e,language:i,isAuto:r})=>!this.internalTracks.has(e)&&!t.some((([,e])=>e.language===i&&e.isAuto===r)))).forEach((e=>this.attach(e))),Array.from(this.internalTracks).filter((([t])=>!e.find((e=>e.id===t)))).forEach((([,e])=>this.detach(e)))}select(e){(0,u.assertNonNullable)(this.video);for(let e of this.htmlTextTracksAsArray(!0))e.mode="showing";for(let t of this.htmlTextTracksAsArray(!0))((0,u.isNullable)(e)||!wr(t,e))&&(t.mode="disabled")}destroy(){if(this.subscription.unsubscribe(),this.video)for(let e of Array.from(this.video.getElementsByTagName("track"))){let t=e.getAttribute("id");t&&this.externalTracks.has(t)&&this.video.removeChild(e)}this.externalTracks.clear()}attach(e){(0,u.assertNonNullable)(this.video);let t=document.createElement("track");this.baseURL?t.setAttribute("src",new URL(e.url,this.baseURL).toString()):t.setAttribute("src",e.url),t.setAttribute("id",e.id),e.label&&t.setAttribute("label",e.label),e.language&&t.setAttribute("srclang",e.language),"external"===e.type?this.externalTracks.set(e.id,e):"internal"===e.type&&this.internalTracks.set(e.id,e),this.video.appendChild(t)}detach(e){(0,u.assertNonNullable)(this.video);let t=Array.prototype.find.call(this.video.getElementsByTagName("track"),(t=>t.getAttribute("id")===e.id));t&&this.video.removeChild(t),"external"===e.type?this.externalTracks.delete(e.id):"internal"===e.type&&this.internalTracks.delete(e.id)}constructor(e){this.available$=new u.Subject,this.current$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.subscription=new u.Subscription,this.externalTracks=new Map,this.internalTracks=new Map,this.baseURL=e}},kr=class{getTotalPausedTime(){return this.pausedTime+this.getCurrentPausedTime()}getCurrentPausedTime(){return this.pauseTimestamp>0?Date.now()-this.pauseTimestamp:0}getStreamOffset(){return this.streamOffset}getTotalOffset(){return this.getTotalPausedTime()+this.streamOffset}pause(){0===this.pauseTimestamp&&(this.pauseTimestamp=Date.now())}resume(){this.pauseTimestamp>0&&(this.pausedTime+=this.getCurrentPausedTime(),this.pauseTimestamp=0)}resetTo(e,t=!1){this.streamOffset=e,this.pauseTimestamp=0,this.pausedTime=0,t&&this.pause()}constructor(){this.pausedTime=0,this.streamOffset=0,this.pauseTimestamp=0}},Tr=e=>{let t=e;for(;!(t instanceof Document||t instanceof ShadowRoot||null===t);)t=t?.parentNode;return t??void 0},Er=e=>{let t=Tr(e);return!(!t||!t.fullscreenElement||t.fullscreenElement!==e)},xr=class{get current(){return this._current}get isYandex(){return"Yandex"===this.current}get isSafari(){return"Safari"===this.current}get isFirefox(){return"Firefox"===this.current}get isSamsungBrowser(){return"SamsungBrowser"===this.current}get safariVersion(){return this._safariVersion}get isMiuiBrowser(){return this._isMiuiBrowser}detect(){let{userAgent:e}=navigator;try{let t=/yabrowser/i.test(e)?"Yandex":void 0,i=/samsungbrowser/i.test(e)?"SamsungBrowser":void 0,r=/chrome|crios/i.test(e)?"Chrome":void 0,a=/chromium/i.test(e)?"Chromium":void 0,s=/firefox|fxios/i.test(e)?"Firefox":void 0,n=/webkit|safari|khtml/i.test(e)?"Safari":void 0,o=/opr\//i.test(e)?"Opera":void 0,l=/edg/i.test(e)?"Edge":void 0;this._isMiuiBrowser=/(XiaoMi)|(MiuiBrowser)/i.test(e),this._current=t||i||s||o||l||r||a||n||"Rest"}catch(e){console.error(e)}this.isSafari&&this.detectSafariVersion()}detectSafariVersion(){try{let{userAgent:e}=window.navigator,t=e.match(/Version\/(\d+)/);if(!t)return;let i=t[1],r=parseInt(i,10);if(isNaN(r))return;this._safariVersion=r}catch(e){console.error(e)}}constructor(){this._isMiuiBrowser=!1}},$r=v(Te(),1),Cr=()=>/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(navigator.appVersion??navigator.userAgent)||navigator?.userAgentData?.mobile,Ar=class{get current(){return this._current}get isIOS(){return"iOS"===this._highEntropyValues.platform||(0,$r.default)(["iPhone","iPad","iPod"],this.current)}get isMac(){return"macOS"===this._highEntropyValues.platform||"Mac"===this.current}get isApple(){return this.isIOS||this.isMac}get isIphoneOrOldIpad(){if(!this.isApple||!this._displayChecker.isTouch)return!1;let e="iPad"===this.current||this._displayChecker.width>700,t=this._iosVersion;return!e||e&&!!t&&t<16}get isAndroid(){return"Android"===this._highEntropyValues.platform||"Android"===this.current}get isMobile(){return this._highEntropyValues.mobile||this._isMobile}get iOSVersion(){return this._iosVersion}detect(){let{userAgent:e}=navigator;try{this._isMobile=Cr()}catch(e){console.error(e)}this.detectDevice(e),this.detectHighEntropyValues(),this.isIOS&&this.detectIOSVersion()}async detectHighEntropyValues(){let{userAgentData:e}=navigator;if(e?.getHighEntropyValues){let t=await e.getHighEntropyValues(["architecture","bitness","brands","mobile","platform","formFactor","model","platformVersion","wow64"]);this._highEntropyValues=t}}detectDevice(e){try{let t=/android/i.test(e)?"Android":void 0,i=/iphone/i.test(e)?"iPhone":void 0,r=/ipad/i.test(e)?"iPad":void 0,a=/ipod/i.test(e)?"iPod":void 0,s=/mac/i.test(e)?"Mac":void 0,n=/webOS|BlackBerry|IEMobile|Opera Mini/i.test(e)?"RestMobile":void 0;this._current=t||i||r||a||n||s||"Desktop"}catch(e){console.error(e)}}detectIOSVersion(){try{if(this._highEntropyValues.platformVersion){let e=this._highEntropyValues.platformVersion.split(".").slice(0,2).join("."),t=parseFloat(e);return void(this._iosVersion=t)}let{userAgent:e}=window.navigator,t=e.match(/OS (\d+(_\d+)?)/i);if(!t)return;let i=t[1].replace(/_/g,".");if(!i)return;let r=parseFloat(i);if(isNaN(r))return;this._iosVersion=r}catch(e){console.error(e)}}constructor(e){this._highEntropyValues={},this._displayChecker=e}},Pr=class{get isTouch(){return"number"==typeof this._maxTouchPoints?this._maxTouchPoints>1:"ontouchstart"in window}get maxTouchPoints(){return this._maxTouchPoints}get height(){return this._height}get width(){return this._width}get screenHeight(){return this._screenHeight}get screenWidth(){return this._screenWidth}get pixelRatio(){return this._pixelRatio}get isHDR(){return this._isHdr}get colorDepth(){return this._colorDepth}detect(){let{maxTouchPoints:e}=navigator;try{this._maxTouchPoints=e??0,this._isHdr=!!matchMedia("(dynamic-range: high)")?.matches,this._colorDepth=screen.colorDepth}catch(e){console.error(e)}try{this._pixelRatio=window.devicePixelRatio||1,this._height=screen.height,this._width=screen.width,this._height=screen.height,this._screenHeight=this._height*this._pixelRatio,this._screenWidth=this._width*this._pixelRatio}catch(e){console.error(e)}}},Lr=()=>window.ManagedMediaSource||window.MediaSource,Mr=()=>!(!window.ManagedMediaSource||!window.ManagedSourceBuffer?.prototype?.appendBuffer),Ir=()=>window.ManagedMediaSource?new ManagedMediaSource:new MediaSource,Rr=document.createElement("video"),Dr='video/webm; codecs="vp09.00.10.08"',Or='video/webm; codecs="av01.0.00M.08"';(async()=>{if(!window.navigator.mediaCapabilities)return;let e={type:"media-source",video:{contentType:"video/webm",width:1280,height:720,bitrate:1e6,framerate:30}},[t,i]=await Promise.all([window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Or}}),window.navigator.mediaCapabilities.decodingInfo({...e,video:{...e.video,contentType:Dr}})]);l={DASH_WEBM_AV1:t,DASH_WEBM:i}})().catch((e=>{console.log(Rr),console.error(e)}));var Br=class{get protocols(){return this._protocols}get containers(){return this._containers}get codecs(){return this._codecs}get webmDecodingInfo(){return l}get supportedCodecs(){return Object.keys(this._codecs).filter((e=>this._codecs[e]))}get nativeHlsSupported(){return this._nativeHlsSupported}detect(){this._video=document.createElement("video");try{this._protocols={mms:Mr(),mse:!(!window.MediaSource||!window.SourceBuffer?.prototype?.appendBuffer),hls:!(!this._video.canPlayType?.("application/x-mpegurl")&&!this._video.canPlayType?.("vnd.apple.mpegURL")),webrtc:!!window.RTCPeerConnection,ws:!!window.WebSocket},this._containers={mp4:!!this._video.canPlayType?.("video/mp4"),webm:!!this._video.canPlayType?.("video/webm"),cmaf:!0};let e=!!Lr()?.isTypeSupported?.('video/mp4; codecs="avc1.42000a,mp4a.40.2"'),t=!!Lr()?.isTypeSupported?.('video/mp4; codecs="hev1.1.6.L93.B0"'),i=!!Lr()?.isTypeSupported?.('audio/mp4; codecs="mp4a.40.2"');this._codecs={h264:e,h265:t,vp9:!!Lr()?.isTypeSupported?.(Dr),av1:!!Lr()?.isTypeSupported?.(Or),aac:i,opus:!!Lr()?.isTypeSupported?.('audio/webm; codecs="opus"'),mpeg:(e||t)&&i},this._nativeHlsSupported=this._protocols.hls&&this._containers.mp4}catch(e){console.error(e)}this.destroyVideoElement()}destroyVideoElement(){if(!this._video)return;if(this._video.pause(),this._video.currentTime=0,this._video.removeAttribute("src"),this._video.src="",this._video.load(),this._video.remove)return this._video.remove(),void(this._video=null);this._video.parentNode&&this._video.parentNode.removeChild(this._video);let e=this._video.cloneNode(!1);this._video.parentNode?.replaceChild(e,this._video),this._video=null}constructor(e,t){this._deviceChecker=e,this._browserChecker=t}},Nr="audio/mpeg",Vr=class{supportMp3(){return this._codecs.mp3&&this._containers.mpeg}detect(){this._audio=document.createElement("audio");try{this._containers={mpeg:!!this._audio.canPlayType?.(Nr)},this._codecs={mp3:!!Lr()?.isTypeSupported?.(Nr)}}catch(e){console.error(e)}this.destroyAudioElement()}destroyAudioElement(){if(!this._audio)return;if(this._audio.pause(),this._audio.currentTime=0,this._audio.removeAttribute("src"),this._audio.src="",this._audio.load(),this._audio.remove)return this._audio.remove(),void(this._audio=null);this._audio.parentNode&&this._audio.parentNode.removeChild(this._audio);let e=this._audio.cloneNode(!1);this._audio.parentNode?.replaceChild(e,this._audio),this._audio=null}},Ur=new class{get display(){return this._displayChecker}get device(){return this._deviceChecker}get browser(){return this._browserChecker}get video(){return this._videoChecker}get audio(){return this._audioChecker}async detect(){this._displayChecker.detect(),this._deviceChecker.detect(),this._browserChecker.detect(),this._videoChecker.detect(),this._audioChecker.detect(),this.isInited$.next(!0)}constructor(){this.isInited$=new u.ValueSubject(!1),this._displayChecker=new Pr,this._deviceChecker=new Ar(this._displayChecker),this._browserChecker=new xr,this._videoChecker=new Br(this._deviceChecker,this._browserChecker),this._audioChecker=new Vr,this.detect()}},Fr=e=>{let t,i=t=>(0,u.fromEvent)(e,t).pipe((0,u.mapTo)(void 0)),r=new u.Subscription,a=(0,u.merge)((0,u.fromEvent)(e,"progress"),(0,u.fromEvent)(e,"timeupdate")).pipe((0,u.map)((()=>((e,t,i=3)=>{let r=0,a=0;for(let s=0;s<e.length;s++){let n=e.start(s),o=e.end(s);if(n<=t&&t<=o){if(r=n,a=o,!i)return{from:r,to:a};for(let t=s-1;t>=0;t--)e.end(t)+i>=r&&(r=e.start(t));for(let t=s+1;t<e.length;t++)e.start(t)-i<=a&&(a=e.end(t))}}return{from:r,to:a}})(e.buffered,e.currentTime)))),s=Ur.browser.isSafari?(0,u.combine)({play:i("play").pipe((0,u.once)()),playing:i("playing")}).pipe((0,u.mapTo)(void 0)):i("playing"),n=(0,u.fromEvent)(e,"volumechange").pipe((0,u.map)((()=>({muted:e.muted,volume:e.volume})))),o=(0,u.fromEvent)(e,"ratechange").pipe((0,u.map)((()=>e.playbackRate))),l=(0,u.fromEvent)(e,"error").pipe((0,u.filter)((()=>!(!e.error&&!e.played.length))),(0,u.map)((()=>{let t=e.error;return{id:t?`MediaError#${t.code}`:"HtmlVideoError",category:u.ErrorCategory.VIDEO_PIPELINE,message:t?t.message:"Error event from HTML video element",thrown:e.error??void 0}}))),d=(0,u.fromEvent)(e,"timeupdate").pipe((0,u.map)((()=>e.currentTime))),c=new u.Subject;r.add((0,u.merge)(...["waiting","seeking","seeked","timeupdate"].map((t=>(0,u.fromEvent)(e,t)))).subscribe((i=>{let r=e.currentTime;e.loop&&(0,u.isNonNullable)(t)&&(0,u.isNonNullable)(r)&&t>=e.duration-.3&&r<=.3&&c.next(t),t=r})));let h=i("pause").pipe((0,u.filter)((()=>!e.error&&t!==e.duration))),p=(0,u.fromEvent)(e,"enterpictureinpicture"),f=(0,u.fromEvent)(e,"leavepictureinpicture"),m=new u.ValueSubject((e=>{let t=Tr(e);return!(!t||!t.pictureInPictureElement||t.pictureInPictureElement!==e)})(e));r.add(p.subscribe((()=>m.next(!0)))),r.add(f.subscribe((()=>m.next(!1))));let g=new u.ValueSubject(Er(e)),v=(0,u.fromEvent)(e,"fullscreenchange");r.add(v.pipe((0,u.map)((()=>Er(e)))).subscribe(g));let b=(0,u.fromEvent)(e,"timeupdate").pipe((0,u.map)((t=>e.duration-e.currentTime<.1)),(0,u.filterChanged)()),_=(0,u.merge)(b.pipe((0,u.filter)((t=>!e.loop&&t))),(0,u.fromEvent)(e,"ended")).pipe((0,u.throttle)(1e3),(0,u.mapTo)(void 0)),y=(0,u.merge)(...["waiting","pause","canplay","play","canplaythrough","playing","seeking","seeked","ended"].map((t=>(0,u.fromEvent)(e,t))),b.pipe((0,u.map)((e=>({type:e?"ended":"unknown"}))))).pipe((0,u.map)((t=>Ur.browser.isFirefox&&"ended"===t.type?e.readyState<2:e.readyState<3)),(0,u.filterChanged)());return{playing$:s,pause$:h,canplay$:i("canplay"),ended$:_,looped$:c,error$:l,seeked$:i("seeked"),seeking$:i("seeking"),progress$:i("progress"),loadStart$:i("loadstart"),loadedMetadata$:i("loadedmetadata"),loadedData$:i("loadeddata"),timeUpdate$:d,durationChange$:(0,u.fromEvent)(e,"durationchange").pipe((0,u.map)((()=>e.duration))),isBuffering$:y,currentBuffer$:a,volumeState$:n,playbackRateState$:o,inPiP$:m,inFullscreen$:g,enterPip$:p,leavePip$:f,destroy:()=>r.unsubscribe()}},jr=e=>{switch(e){case"mobile":return u.VideoQuality.Q_144P;case"lowest":return u.VideoQuality.Q_240P;case"low":return u.VideoQuality.Q_360P;case"sd":case"medium":return u.VideoQuality.Q_480P;case"hd":case"high":return u.VideoQuality.Q_720P;case"fullhd":case"full":return u.VideoQuality.Q_1080P;case"quadhd":case"quad":return u.VideoQuality.Q_1440P;case"ultrahd":case"ultra":return u.VideoQuality.Q_2160P}},zr=v(oi(),1),Wr=v(Te(),1),qr=v(Oe(),1),Hr=!1,Kr={},Qr=e=>{e(Kr)},Gr=(e,t)=>{Hr&&(Kr.meta=Kr.meta??{},Kr.meta[e]=t)},Yr=class{next(e){if(!Hr)return;Kr.series=Kr.series??{};let t=Kr.series[this.name]??[];t.push([Date.now(),e]),Kr.series[this.name]=t}constructor(e){this.name=e}};function Xr(e,t,i){return e.max||e.min!==t?e.min||e.max!==i?"unknown":"traffic_saving":"high_quality"}function Zr(e,t,i){return!!e&&"high_quality"===Xr(e,t,i)}function Jr(e,t,i){return(0,u.isNullable)(e)||(0,u.isNonNullable)(e.min)&&(0,u.isNonNullable)(e.max)&&(0,u.isLower)(e.max,e.min)||(0,u.isNonNullable)(e.min)&&t&&(0,u.isHigher)(e.min,t)||(0,u.isNonNullable)(e.max)&&i&&(0,u.isLower)(e.max,i)}function ea({limits:e,highestAvailableHeight:t,lowestAvailableHeight:i}){return Jr({max:e?.max?(0,u.videoHeightToQuality)(e.max):void 0,min:e?.min?(0,u.videoHeightToQuality)(e.min):void 0},t?(0,u.videoHeightToQuality)(t):void 0,i?(0,u.videoHeightToQuality)(i):void 0)}var ta=new Yr("best_bitrate"),ia=(e,t,i)=>(t-i)*Math.pow(2,-10*e)+i,ra=e=>(t,i)=>e*(Number(t.bitrate)-Number(i.bitrate)),aa=class{recordSelection(e){this.history[e.id]=(0,u.now)()}recordSwitch(e){this.last=e}clear(){this.last=void 0,this.history={}}constructor(){this.history={}}},sa='Assertion "ABR Tracks is empty array" failed',na=new WeakMap,oa=new WeakMap,la=new WeakMap,ua=(e,t,i,r)=>{let a=[...t].sort(ra(1)),s=[...i].sort(ra(1)),n=s.filter((t=>!(0,u.isNonNullable)(t.bitrate)||!(0,u.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),o=(0,zr.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1)))??(0,zr.default)(s,-1);return o&&(0,Wr.default)(n,o)?o:n.length?(0,zr.default)(n,-1):(0,zr.default)(s,0)},da=(e,t,i,r)=>{let a=na.get(t);a||(a=[...t].sort(ra(1)),na.set(t,a));let s=na.get(i);s||(s=[...i].sort(ra(1)),na.set(i,s));let n=la.get(e);n||(n=s.filter((t=>!(0,u.isNonNullable)(t.bitrate)||!(0,u.isNonNullable)(e.bitrate)||e.bitrate/t.bitrate>r)),la.set(e,n));let o=(0,zr.default)(s,Math.round(s.length*a.indexOf(e)/(a.length+1)))??(0,zr.default)(s,-1);return o&&(0,Wr.default)(n,o)?o:n.length?(0,zr.default)(n,-1):(0,zr.default)(s,0)},ca=e=>"quality"in e,ha=(e,t,i,r)=>{let a=(0,u.isNonNullable)(r?.last?.bitrate)&&(0,u.isNonNullable)(i?.bitrate)&&r.last.bitrate<i.bitrate?e.trackCooldownIncreaseQuality:e.trackCooldownDecreaseQuality,s=i&&r&&r.history[i.id]&&(0,u.now)()-r.history[i.id]<=a&&(!r.last||i.id!==r.last.id);if(i?.id&&r&&!s&&r.recordSelection(i),s&&r?.last){let e=r.last;return r?.recordSwitch(e),t({message:`\n    [last ${ca(e)?"video":"audio"} selected] ${ca(e)?e.quality:e.bitrate}\n    `}),e}return r?.recordSwitch(i),i},pa=({tuning:e,container:t,limits:i,panelSize:r})=>{let a=e.containerSizeFactor;if(r)return{containerSizeLimit:r,containerSizeFactor:a};if(e.usePixelRatio&&Ur.display.pixelRatio){let t=Ur.display.pixelRatio;if(e.pixelRatioMultiplier)a*=e.pixelRatioMultiplier*(t-1)+1;else{let i=e.pixelRatioLogBase,[r=0,s=0,n=0]=e.pixelRatioLogCoefficients,o=((e,t)=>Math.log(t)/Math.log(e))(i,r*t+s)+n;Number.isFinite(o)&&(a*=o)}}return Zr(i,e.highQualityLimit,e.trafficSavingLimit)&&(a*=2),{containerSizeLimit:e.limitByContainer&&t&&t.width>0&&t.height>0?{width:t.width*a,height:t.height*a}:void 0,containerSizeFactor:a}},fa=new WeakMap,ma=(e,{container:t,estimatedThroughput:i,tuning:r,limits:a,reserve:s=0,forwardBufferHealth:n,playbackRate:o,current:l,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:g})=>{(0,u.assertNotEmptyArray)(e,sa);let{containerSizeFactor:v,containerSizeLimit:b}=pa({container:t,tuning:r,limits:a,panelSize:g}),_=r.considerPlaybackRate&&(0,u.isNonNullable)(o)?o:1,y=fa.get(e);y||(y=e.filter((e=>!(0,u.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,u.isHigher)(e.quality,t.quality)?-1:1)),fa.set(e,y));let w=(0,zr.default)(y,-1)?.quality,S=(0,zr.default)(y,0)?.quality,k=Jr(a,S,w),T=_*ia(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),E={},x=null;for(let e of y){let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,u.videoSizeToQuality)(b);t=!i||(0,u.isLowerOrEqual)(e.quality,i)}if(!t){E[e.quality]="FitsContainer";continue}let o=f||i,d=!((0,u.isNonNullable)(o)&&isFinite(o)&&(0,u.isNonNullable)(e.bitrate))||o-s>=e.bitrate*T,m=Zr(a,r.highQualityLimit,r.trafficSavingLimit)&&a?.min===e.quality;if(!d&&!m){E[e.quality]="FitsThroughput";continue}if(r.lazyQualitySwitch&&(0,u.isNonNullable)(r.minBufferToSwitchUp)&&l&&!(0,u.isInvariantQuality)(l.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,u.isHigher)(e.quality,l.quality)){E[e.quality]="Buffer";continue}if(h&&(0,u.isHigherOrEqual)(e.quality,h)&&!m){E[e.quality]="DroppedFramesLimit";continue}if(p&&(0,u.isHigherOrEqual)(e.quality,p)&&!m){E[e.quality]="StallsLimit";continue}let g=k||((0,u.isNullable)(a?.max)||(0,u.isLowerOrEqual)(e.quality,a.max))&&((0,u.isNullable)(a?.min)||(0,u.isHigherOrEqual)(e.quality,a.min)),v=!((0,u.isNonNullable)(c)&&!c)||(0,u.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);g&&v?x||(x=e):E[e.quality]="FitsQualityLimits"}x&&x.bitrate&&ta.next(x.bitrate);let $=x??(0,zr.default)(y,-1)??e[0],C=d?.last,A=ha(r,m,$,d);return(0,u.isNonNullable)(d)&&A.quality!==C?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,qr.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${v},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${s},\n    playbackRate: ${o},\n    playbackRateFactor: ${_},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${T},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${k},\n    maxQualityLimit: ${a?.max},\n    minQualityLimit: ${a?.min},\n\n    [limited video tracks]\n    ${(0,qr.default)(E).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${x?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},ga=(e,{container:t,estimatedThroughput:i,tuning:r,limits:a,reserve:s=0,forwardBufferHealth:n,playbackRate:o,current:l,history:d,visible:c,droppedVideoMaxQualityLimit:h,stallsVideoMaxQualityLimit:p,stallsPredictedThroughput:f,abrLogger:m,panelSize:g})=>{(0,u.assertNotEmptyArray)(e,sa);let{containerSizeFactor:v,containerSizeLimit:b}=pa({container:t,tuning:r,limits:a,panelSize:g}),_=r.considerPlaybackRate&&(0,u.isNonNullable)(o)?o:1,y=e.filter((e=>!(0,u.isInvariantQuality)(e.quality))).sort(((e,t)=>(0,u.isHigher)(e.quality,t.quality)?-1:1)),w=(0,zr.default)(y,-1)?.quality,S=(0,zr.default)(y,0)?.quality,k=Jr(a,S,w),T=_*ia(n??.5,r.bitrateFactorAtEmptyBuffer,r.bitrateFactorAtFullBuffer),E={},x=y.filter((e=>{let t=!0;if(b)if(e.size)t=e.size.width<=b.width&&e.size.height<=b.height;else{let i=b&&(0,u.videoSizeToQuality)(b);t=!i||(0,u.isLowerOrEqual)(e.quality,i)}if(!t)return E[e.quality]="FitsContainer",!1;let o=f||i,d=!((0,u.isNonNullable)(o)&&isFinite(o)&&(0,u.isNonNullable)(e.bitrate))||o-s>=e.bitrate*T,m=Zr(a,r.highQualityLimit,r.trafficSavingLimit)&&a?.min===e.quality;if(!d&&!m)return E[e.quality]="FitsThroughput",!1;if(r.lazyQualitySwitch&&(0,u.isNonNullable)(r.minBufferToSwitchUp)&&l&&!(0,u.isInvariantQuality)(l.quality)&&(n??0)<r.minBufferToSwitchUp&&(0,u.isHigher)(e.quality,l.quality))return E[e.quality]="Buffer",!1;if(h&&(0,u.isHigherOrEqual)(e.quality,h)&&!m)return E[e.quality]="DroppedFramesLimit",!1;if(p&&(0,u.isHigherOrEqual)(e.quality,p)&&!m)return E[e.quality]="StallsLimit",!1;let g=k||((0,u.isNullable)(a?.max)||(0,u.isLowerOrEqual)(e.quality,a.max))&&((0,u.isNullable)(a?.min)||(0,u.isHigherOrEqual)(e.quality,a.min)),v=!((0,u.isNonNullable)(c)&&!c)||(0,u.isLowerOrEqual)(e.quality,r.backgroundVideoQualityLimit);return!(!g||!v)||(E[e.quality]="FitsQualityLimits",!1)}))[0];x&&x.bitrate&&ta.next(x.bitrate);let $=x??(0,zr.default)(y,-1)??e[0],C=d?.last,A=ha(r,m,$,d);return(0,u.isNonNullable)(d)&&A.quality!==C?.quality&&m({message:`\n    [VIDEO TRACKS ABR]\n    [available video tracks]\n\t${e.map((e=>`{ id: ${e.id}, quality: ${e.quality}, bitrate: ${e.bitrate}, size: ${e.size?.width}:${e.size?.height} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,qr.default)(r??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    containerSizeFactor: ${v},\n    containerSizeLimit: ${b?.width??0} x ${b?.height??0},\n    estimatedThroughput: ${i},\n    stallsPredictedThroughput: ${f},\n    reserve: ${s},\n    playbackRate: ${o},\n    playbackRateFactor: ${_},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${T},\n    minBufferToSwitchUp: ${r.minBufferToSwitchUp},\n    droppedVideoMaxQualityLimit: ${h},\n    stallsVideoMaxQualityLimit: ${p},\n    limitsAreInvalid: ${k},\n    maxQualityLimit: ${a?.max},\n    minQualityLimit: ${a?.min},\n\n    [limited video tracks]\n    ${(0,qr.default)(E).map((([e,t])=>`${e}: ${t}`)).join("\n\t")||"All tracks are available"}\n\n    [best video track] ${x?.quality}\n    [selected video track] ${A?.quality}\n    `}),A},va=(e,t,i,{estimatedThroughput:r,tuning:a,playbackRate:s,forwardBufferHealth:n,history:o,abrLogger:l,stallsPredictedThroughput:d})=>{(0,u.assertNotEmptyArray)(i,sa);let c=a.considerPlaybackRate&&(0,u.isNonNullable)(s)?s:1,h=[...i].sort(ra(-1)),p=e.bitrate;(0,u.assertNonNullable)(p);let f,m=c*ia(n??.5,a.bitrateAudioFactorAtEmptyBuffer,a.bitrateAudioFactorAtFullBuffer),g=ua(e,t,i,a.minVideoAudioRatio),v=d||r;(0,u.isNonNullable)(v)&&isFinite(v)&&(f=h.find((e=>!(!(0,u.isNonNullable)(e.bitrate)||!(0,u.isNonNullable)(g?.bitrate))&&(v-p>=e.bitrate*m&&e.bitrate>=g.bitrate)))),f||(f=g);let b=o?.last,_=f&&ha(a,l,f,o);return(0,u.isNonNullable)(o)&&_?.bitrate!==b?.bitrate&&l({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,qr.default)(a??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${s},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${a.minBufferToSwitchUp},\n\n    [selected audio track] ${_?.id}\n    `}),_},ba=(e,t,i,{estimatedThroughput:r,tuning:a,playbackRate:s,forwardBufferHealth:n,history:o,abrLogger:l,stallsPredictedThroughput:d})=>{(0,u.assertNotEmptyArray)(i,sa);let c=a.considerPlaybackRate&&(0,u.isNonNullable)(s)?s:1,h=oa.get(i);h||(h=[...i].sort(ra(-1)),oa.set(i,h));let p=e.bitrate;(0,u.assertNonNullable)(p);let f,m=c*ia(n??.5,a.bitrateAudioFactorAtEmptyBuffer,a.bitrateAudioFactorAtFullBuffer),g=da(e,t,i,a.minVideoAudioRatio),v=d||r;(0,u.isNonNullable)(v)&&isFinite(v)&&(f=h.find((e=>!(!(0,u.isNonNullable)(e.bitrate)||!(0,u.isNonNullable)(g?.bitrate))&&(v-p>=e.bitrate*m&&e.bitrate>=g.bitrate)))),f||(f=g);let b=o?.last,_=f&&ha(a,l,f,o);return(0,u.isNonNullable)(o)&&_?.bitrate!==b?.bitrate&&l({message:`\n    [AUDIO TRACKS ABR]\n    [available audio tracks]\n\t${i.map((e=>`{ id: ${e.id}, bitrate: ${e.bitrate} }`)).join("\n\t")}\n\n    [tuning]\n\t${(0,qr.default)(a??{}).map((([e,t])=>`${e}: ${t}`)).join("\n\t")}\n\n    [limit params]\n    estimatedThroughput: ${r},\n    stallsPredictedThroughput: ${d},\n    reserve: ${p},\n    playbackRate: ${s},\n    playbackRateFactor: ${c},\n    forwardBufferHealth: ${n},\n    bitrateFactor: ${m},\n    minBufferToSwitchUp: ${a.minBufferToSwitchUp},\n\n    [selected audio track] ${_?.id}\n    `}),_},_a=e=>new URL(e).hostname,ya=v(oi(),1),wa=v(Te(),1),Sa=e=>{if(e instanceof DOMException&&(0,wa.default)(["Failed to load because no supported source was found.","The element has no supported sources."],e.message))throw e;return!(e instanceof DOMException&&(20===e.code||"AbortError"===e.name))},ka=async(e,t)=>{let i=e.muted;try{await e.play()}catch(r){if(!Sa(r))return!1;if(t&&t(),i)return console.warn(r),!1;e.muted=!0;try{await e.play()}catch(t){return Sa(t)&&(e.muted=!1,console.warn(t)),!1}}return!0},Ta=v(ri(),1);function Ea(){return(0,u.now)()}function xa(e){return Ea()-e}function $a(e){let t=e.split("/"),i=t.slice(0,t.length-1).join("/"),r=/^([a-z]+:)?\/\//i;return{resolve:(e,t,a=!1)=>{(e=>r.test(e))(e)||(e.startsWith("/")||(e="/"+e),e=i+e);let s=e.indexOf("?")>-1?"&":"?";return a&&(e+=s+"lowLat=1",s="&"),t&&(e+=s+"_rnd="+Math.floor(999999999*Math.random())),e}}}function Ca(e,t,i,r){let a,s,n,o,l,d=window.XMLHttpRequest,c=!1,h=0,p=!1,f="arraybuffer",m=7e3,g=2e3,v=()=>{if(c)return;(0,u.assertNonNullable)(o);let e,t=xa(o);if(t<g)return e=g-t,void setTimeout(v,e);g*=2,g>m&&(g=m),s&&s.abort(),s=new d,_()},b=()=>{if(!c){if(--h>=0)return v(),void(r&&r());c=!0,l&&l(),i&&i()}},_=()=>{o=Ea(),s=new d,s.open("get",e);let i,r=0,h=0,m=()=>((0,u.assertNonNullable)(o),Math.max(o,Math.max(i||0,h||0)));if(a&&s.addEventListener("progress",(e=>{let t=Ea();a.updateChunk&&e.loaded>r&&(a.updateChunk(m(),e.loaded-r),r=e.loaded,i=t)})),n&&(s.timeout=n,s.addEventListener("timeout",(()=>b()))),s.addEventListener("load",(()=>{if(c)return;(0,u.assertNonNullable)(s);let e=s.status;if(e>=200&&e<300){let{response:e,responseType:i}=s,n=e?.byteLength;if("number"==typeof n&&a){let e=n-r;e&&a.updateChunk&&a.updateChunk(m(),e)}"json"!==i||e&&(0,Ta.default)(e).length?(l&&l(),t(e)):b()}else b()})),s.addEventListener("error",(()=>{b()})),p){let e=()=>{(0,u.assertNonNullable)(s),s.readyState===XMLHttpRequest.HEADERS_RECEIVED&&(h=Ea(),s.removeEventListener("readystatechange",e))};s.addEventListener("readystatechange",e)}return s.responseType=f,s.send(),y},y={withBitrateReporting:e=>(a=e,y),withParallel:e=>(p=e,y),withJSONResponse:()=>(f="json",y),withRetryCount:e=>(h=e,y),withRetryInterval:(e,t)=>((0,u.isNonNullable)(e)&&(g=e),(0,u.isNonNullable)(t)&&(m=t),y),withTimeout:e=>(n=e,y),withFinally:e=>(l=e,y),send:_,abort:()=>{s&&(s.abort(),s=void 0),c=!0,l&&l()}};return y}var Aa=class{_updateRate(e){let t=.2;this.currentRate&&(e<.1*this.currentRate?t=.8:e<.5*this.currentRate?t=.5:e<.7*this.currentRate&&(t=.3)),e=Math.max(1,Math.min(e,104857600)),this.currentRate=this.currentRate?this.currentRate*(1-t)+e*t:e}_createInterval(e,t,i){return{start:e,end:t,bytes:i}}_doMergeIntervals(e,t){e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end),e.bytes+=t.bytes}_mergeIntervals(e,t){return e.start<=t.end&&t.start<=e.end&&(this._doMergeIntervals(e,t),!0)}_flushIntervals(){if(!this.intervals.length)return!1;let e=this.intervals[0].start,t=this.intervals[this.intervals.length-1].end-500;if(t-e>2e3){let i=0,r=0;for(;this.intervals.length>0;){let e=this.intervals[0];if(e.end<=t)i+=e.end-e.start,r+=e.bytes,this.intervals.splice(0,1);else{if(e.start>=t)break;{let a=t-e.start,s=e.end-e.start;i+=a;let n=e.bytes*a/s;r+=n,e.start=t,e.bytes-=n}}}if(r>0&&i>0){let a=8*r/(i/1e3);return this._updateRate(a),this.logger(`rate updated, new=${Math.round(a/1024)}K; average=${Math.round(this.currentRate/1024)}K bytes/ms=${Math.round(r)}/${Math.round(i)} interval=${Math.round(t-e)}`),!0}}return!1}_joinIntervals(){let e;do{e=!1;for(let t=0;t<this.intervals.length-1;++t)this._mergeIntervals(this.intervals[t],this.intervals[t+1])&&(this.intervals.splice(t+1,1),e=!0)}while(e)}addInterval(e,t,i){return this.intervals.push(this._createInterval(e,t,i)),this._joinIntervals(),this.intervals.length>100&&(this.logger(`too many intervals (${this.intervals.length}); will merge`,{type:"warn"}),this._doMergeIntervals(this.intervals[1],this.intervals[0]),this.intervals.splice(0,1)),this._flushIntervals()}getBitRate(){return this.currentRate}constructor(e){this.intervals=[],this.currentRate=0,this.logger=e}},Pa=v(ri(),1),La=class{limitCompleteCount(){let e;for(;(e=Object.keys(this.completeRequests)).length>this._getParallelRequestCount()+2;){let t=e[Math.floor(Math.random()*e.length)];this.logger(`Dropping completed request for url ${t}`,{type:"warn"}),delete this.completeRequests[t]}}_sendRequest(e,t){let i=Ea(),r=i=>{delete this.activeRequests[t],this.limitCompleteCount(),this.completeRequests[t]=e,this._sendPending(),e._error=1,e._errorMsg=i,e._errorCB?e._errorCB(i):(this.limitCompleteCount(),this.completeRequests[t]=e)};e._request=Ca(t,(r=>{e._complete=1,e._responseData=r,e._downloadTime=Ea()-i,delete this.activeRequests[t],this._sendPending(),e._cb?e._cb(r,e._downloadTime):(this.limitCompleteCount(),this.completeRequests[t]=e)}),(()=>r("error")),(()=>{e._retry=1,e._retryCB&&e._retryCB()})),e._request.withRetryCount(this.RETRY_COUNT).withTimeout(this.TIMEOUT).withBitrateReporting(this.BITRATE_ESTIMATOR).withParallel(this._getParallelRequestCount()>1).withFinally((()=>{e._finallyCB&&e._finallyCB()})),this.activeRequests[t]=e,e._request.send(),this.lastPrefetchStart=Ea()}_getParallelRequestCount(){return Math.min(this.MAX_PARALLEL_REQUESTS,this.averageSegmentDuration<3e3?3:2)}_getPrefetchDelay(){return Math.max(100,Math.min(5e3,this.averageSegmentDuration/3))}_canSendPending(){let e=this._getParallelRequestCount(),t=Ea();if(Object.keys(this.activeRequests).length>=e)return!1;let i=this._getPrefetchDelay()-(t-this.lastPrefetchStart);return this.throttleTimeout&&clearTimeout(this.throttleTimeout),!(i>0)||(this.throttleTimeout=window.setTimeout((()=>this._sendPending()),i),!1)}_sendPending(){for(;this._canSendPending();){let e=this.pendingQueue.pop();if(!e)return;this.activeRequests[e]||this.completeRequests[e]||(this.logger(`Submitting pending request url=${e}`),this._sendRequest({},e))}}_removeFromActive(e){delete this.completeRequests[e],delete this.activeRequests[e]}abortAll(){(0,Pa.default)(this.activeRequests).forEach((e=>{e&&e._request&&e._request.abort()})),this.activeRequests={},this.pendingQueue=[],this.completeRequests={}}requestData(e,t,i,r){let a={};return a.send=()=>{let s=this.activeRequests[e]||this.completeRequests[e];if(s)s._cb=t,s._errorCB=i,s._retryCB=r,s._finallyCB=a._finallyCB,s._error||s._complete?(this._removeFromActive(e),setTimeout((()=>{s._complete?(this.logger(`Requested url already prefetched, url=${e}`),t(s._responseData,s._downloadTime)):(this.logger(`Requested url already prefetched with error, url=${e}`),i(s._errorMsg)),a._finallyCB&&a._finallyCB()}),0)):this.logger(`Attached to active request, url=${e}`);else{let t=this.pendingQueue.indexOf(e);-1!==t&&this.pendingQueue.splice(t,1),this.logger(`Request not prefetched, starting new request, url=${e}${-1===t?"":"; removed pending"}`),this._sendRequest(a,e)}},a._cb=t,a._errorCB=i,a._retryCB=r,a.abort=function(){a.request&&a.request.abort()},a.withFinally=e=>(a._finallyCB=e,a),a}prefetch(e){this.activeRequests[e]||this.completeRequests[e]?this.logger(`Request already active for url=${e}`):(this.logger(`Added to pending queue; url=${e}`),this.pendingQueue.unshift(e),this._sendPending())}optimizeForSegDuration(e){this.averageSegmentDuration=e}constructor(e,t,i,r,a){this.pendingQueue=[],this.activeRequests={},this.completeRequests={},this.averageSegmentDuration=2e3,this.lastPrefetchStart=0,this.throttleTimeout=null,this.RETRY_COUNT=e,this.TIMEOUT=t,this.BITRATE_ESTIMATOR=i,this.MAX_PARALLEL_REQUESTS=r,this.logger=a}},Ma=1e4,Ia=class{attachSource(e){this.manifestUrl=e,this.urlResolver=$a(e),this.bitrateSwitcher=this._initBitrateSwitcher(),this._initManifest()}setAutoQualityEnabled(e){this.autoQuality=e}setAutoQualityLimits(e){this.autoQualityLimits=e}switchByName(e){let t;for(let i=0;i<this.manifest.length;++i)if(t=this.manifest[i],t.name===e)return void this._switchToQuality(t)}catchUp(){if(this.rep&&this.rep.stop(),this.currentManifestEntry){let e=this.params.playbackState.getState();this.paused="paused"===e,this._initPlayerWith(this.currentManifestEntry),this._notifyBuffering(!0)}}stop(){this.params.videoElement.pause(),this.rep&&(this.rep.stop(),this.rep=null)}pause(){this.paused=!0,this.params.videoElement.pause(),this.videoPlayStarted=!1,this._notifyBuffering(!1)}play(){this.paused=!1;let e=this.lowLatency&&this._getBufferSizeSec()>this.sourceJitter+5;this.rep&&!e?(this.bufferStates=[],this.videoPlayStarted=!1,this.shouldPlay()?this._playVideoElement():this._notifyBuffering(!0)):this.catchUp()}startPlay(e,t){this.autoQuality=t,this._initPlayerWith(e)}destroy(){this.destroyed=!0,this.rep&&(this.rep.stop(),this.rep=null),this.manifestRequest&&this.manifestRequest.abort(),this.manifestRefetchTimer&&(clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=void 0)}reinit(e){this.manifestUrl=e,this.urlResolver=$a(e),this.catchUp()}_handleNetworkError(){this.params.logger("Fatal network error"),this.params.playerCallback({name:"error",type:"network"})}_retryCallback(){this.params.playerCallback({name:"retry"})}_getBufferSizeSec(){let e=this.params.videoElement,t=0,i=e.buffered.length;return 0!==i&&(t=e.buffered.end(i-1)-Math.max(e.currentTime,e.buffered.start(0))),t}_notifyBuffering(e){this.destroyed||(this.params.logger(`buffering: ${e}`),this.params.playerCallback({name:"buffering",isBuffering:e}),this.buffering=e)}_initVideo(){let{videoElement:e,logger:t}=this.params;e.addEventListener("error",(()=>{e.error&&!this.destroyed&&(t(`Video element error: ${e.error?.code}, details: ${e.error?.message}`),this.params.playerCallback({name:"error",type:"media"}))})),e.addEventListener("timeupdate",(()=>{let e=this._getBufferSizeSec();!this.paused&&e<.3?this.buffering||(this.buffering=!0,window.setTimeout((()=>{!this.paused&&this.buffering&&this._notifyBuffering(!0)}),1e3*(e+.1))):this.buffering&&this.videoPlayStarted&&this._notifyBuffering(!1)})),e.addEventListener("playing",(()=>{t("playing")})),e.addEventListener("stalled",(()=>this._fixupStall())),e.addEventListener("waiting",(()=>this._fixupStall()))}_fixupStall(){let e,{logger:t,videoElement:i}=this.params,r=i.buffered.length;0!==r&&!this.waitingForFirstBufferAfterSrcChange&&(e=i.buffered.start(r-1),i.currentTime<e&&(t("Fixup stall"),i.currentTime=e))}_selectQuality(e){let t,i,r,{videoElement:a}=this.params,s=a&&1.62*(Ur.display.pixelRatio||1)*a.offsetHeight||520;for(let a=0;a<this.manifest.length;++a){r=this.manifest[a];let{max:n,min:o}=this.autoQualityLimits||{};!ea({limits:this.autoQualityLimits,highestAvailableHeight:this.manifest[0].video.height,lowestAvailableHeight:(0,ya.default)(this.manifest,-1).video.height})&&(n&&r.video.height>n||o&&r.video.height<o)||(r.bitrate<e&&s>Math.min(r.video.height,r.video.width)?(!i||r.bitrate>i.bitrate)&&(i=r):(!t||t.bitrate>r.bitrate)&&(t=r))}return i||t}shouldPlay(){if(this.paused)return!1;let e=this._getBufferSizeSec()-Math.max(1,this.sourceJitter);return e>3||(0,u.isNonNullable)(this.downloadRate)&&(this.downloadRate>1.5&&e>2||this.downloadRate>2&&e>1)}_setVideoSrc(e,t){let{logger:i,videoElement:r,playerCallback:a}=this.params;this.mediaSource=new window.MediaSource,i("setting video src"),r.src=URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",(()=>{this.mediaSource&&(this.sourceBuffer=this.mediaSource.addSourceBuffer(e.codecs),this.bufferStates=[],t())})),this.videoPlayStarted=!1,r.addEventListener("canplay",(()=>{this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement())}));let s=()=>{!function(e,t,i){let r=(...a)=>{i.apply(null,a),e.removeEventListener(t,r)};e.addEventListener(t,r)}(r,"progress",(()=>{r.buffered.length?(r.currentTime=r.buffered.start(0),this.waitingForFirstBufferAfterSrcChange=!1,a({name:"playing"})):s()}))};this.waitingForFirstBufferAfterSrcChange=!0,s()}_initPlayerWith(e){this.bitrate=0,this.rep=0,this.sourceBuffer=0,this.bufferStates=[],this.filesFetcher&&this.filesFetcher.abortAll(),this.filesFetcher=new La(3,Ma,this.bitrateSwitcher,this.params.config.maxParallelRequests,this.params.logger),this._setVideoSrc(e,(()=>this._switchToQuality(e)))}_representation(e){let{logger:t,videoElement:i,playerCallback:r}=this.params,a=!1,s=null,n=null,o=null,l=null,d=!1,c=()=>{let e=a&&(!d||d===this.rep);return e||t("Not running!"),e},h=(e,t,i)=>{o&&o.abort(),o=Ca(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withTimeout(Ma).withBitrateReporting(this.bitrateSwitcher).withRetryCount(3).withFinally((()=>{o=null})).send()},p=(e,t,i)=>{(0,u.assertNonNullable)(this.filesFetcher),n?.abort(),n=this.filesFetcher.requestData(this.urlResolver.resolve(e,!1),t,i,(()=>this._retryCallback())).withFinally((()=>{n=null})).send()},f=e=>{let r=i.playbackRate;i.playbackRate!==e&&(t(`Playback rate switch: ${r}=>${e}`),i.playbackRate=e)},m=e=>{this.lowLatency=e,t(`lowLatency changed to ${e}`),g()},g=()=>{if(this.lowLatency||this.params.config.isLiveCatchUpMode){let e=this._getBufferSizeSec();if(this.bufferStates.length<5)return void f(1);let i=Ea()-1e4,r=0;for(let t=0;t<this.bufferStates.length;t++){let a=this.bufferStates[t];e=Math.min(e,a.buf),a.ts<i&&r++}this.bufferStates.splice(0,r),t(`update playback rate;  minBuffer=${e} drop=${r} jitter=${this.sourceJitter}`);let a=e-1;this.sourceJitter>=0?a-=this.sourceJitter/2:this.sourceJitter-=1,f(a>3?1.15:a>1?1.1:a>.3?1.05:1)}else f(1)},v=e=>{let i,a=()=>i&&i.start?i.start.length:0,s=e=>i.start[e]/1e3,n=e=>i.dur[e]/1e3,o=e=>i.fragIndex+e,d=(e,t)=>({chunkIdx:o(e),startTS:s(e),dur:n(e),discontinuity:t}),h=()=>{let e=0;if(i&&i.dur){let t=this.lowLatency?this.params.config.lowLatencyMinBuffer:this.params.config.minBuffer,r=this.lowLatency?this.params.config.lowLatencyMinBufferSegments:this.params.config.minBufferSegments,a=t;this.sourceJitter>1&&(a+=this.sourceJitter-1);let s=i.dur.length-1;for(;s>=0&&(a-=i.dur[s],!(a<=0));--s);e=Math.min(s,i.dur.length-1-r),e=Math.max(e,0)}return d(e,!0)},p=(e,t,i)=>{l&&l.abort(),l=Ca(this.urlResolver.resolve(e,!0,this.lowLatency),t,i,(()=>this._retryCallback())).withTimeout(Ma).withRetryCount(3).withFinally((()=>{l=null})).withJSONResponse().send()};return{seek:(t,n)=>{p(e,(e=>{if(!c())return;i=e;let o=!!i.lowLatency;o!==this.lowLatency&&m(o);let l=0;for(let e=0;e<i.dur.length;++e)l+=i.dur[e];l>0&&((0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.optimizeForSegDuration(l/i.dur.length)),r({name:"index",zeroTime:i.zeroTime,shiftDuration:i.shiftDuration}),this.sourceJitter=i.hasOwnProperty("jitter")?Math.min(10,Math.max(.01,i.jitter/1e3)):1,t((e=>{let t=a();if(!(t<=0)){if((0,u.isNonNullable)(e))for(let i=0;i<t;i++)if(s(i)>e)return d(i);return h()}})(n))}),(()=>this._handleNetworkError()))},nextChunk:e=>{let r=a(),s=e?e.chunkIdx+1:0,n=s-i.fragIndex;if(!(r<=0)){if(!e||n<0||n-r>10)return t(`Resync: offset=${n} bChunks=${r} chunk=`+JSON.stringify(e)),h();if(!(n>=r))return d(s-i.fragIndex,!1)}}}},b=()=>{a=!1,n&&n.abort(),o&&o.abort(),l&&l.abort(),(0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.abortAll()};return d={start:t=>{let i,r,n,o,d,f,m,{videoElement:_,logger:y}=this.params,w=v(e.jidxUrl),S=0,k=()=>{d&&(clearTimeout(d),d=void 0);let e=Math.max(500,1e3*(this._getBufferSizeSec()-this.sourceJitter-5)),t=S+e,i=Ea(),r=Math.min(1e4,t-i);S=i;let a=()=>{l||c()&&w.seek((()=>{c()&&(S=Ea(),T(),k())}))};r>0?d=window.setTimeout((()=>{this.paused?k():a()}),r):a()},T=()=>{let t;for(;t=w.nextChunk(o);)o=t,A(t);let i=w.nextChunk(n);if(i){if(n&&i.discontinuity)return y("Detected discontinuity; restarting playback"),void(this.paused?k():(b(),this._initPlayerWith(e)));C(i)}else k()},E=(e,t)=>{if(!c()||!this.sourceBuffer)return;let i,r,a,s=i=>{window.setTimeout((()=>{c()&&E(e,t)}),i)};if(this.sourceBuffer.updating)y("Source buffer is updating; delaying appendBuffer"),s(100);else{let n=Ea(),o=_.currentTime;!this.paused&&_.buffered.length>1&&f===o&&n-m>500&&(y("Stall suspected; trying to fix"),this._fixupStall()),f!==o&&(f=o,m=n);let l=this._getBufferSizeSec();if(l>30)y(`Buffered ${l} seconds; delaying appendBuffer`),s(2e3);else try{this.sourceBuffer.appendBuffer(e),this.videoPlayStarted?(this.bufferStates.push({ts:n,buf:l}),g(),this.bufferStates.length>200&&this.bufferStates.shift()):this.shouldPlay()&&(this.videoPlayStarted=!0,this._playVideoElement()),t&&t()}catch(e){if("QuotaExceededError"!==e.name)throw e;y("QuotaExceededError; delaying appendBuffer"),a=this.sourceBuffer.buffered.length,0!==a&&(i=this.sourceBuffer.buffered.start(0),r=o,r-i>4&&this.sourceBuffer.remove(i,r-3)),s(1e3)}}},x=()=>{r&&i&&(y([`Appending chunk, sz=${r.byteLength}:`,JSON.stringify(n)]),E(r,(function(){r=null,T()})))},$=t=>e.fragUrlTemplate.replace("%%id%%",t.chunkIdx),C=e=>{c()&&p($(e),((t,i)=>{if(c()){if(i/=1e3,r=t,n=e,s=e.startTS,i){let t=Math.min(10,e.dur/i);this.downloadRate=this.downloadRate?.7*this.downloadRate+.3*t:t}x()}}),(()=>this._handleNetworkError()))},A=e=>{c()&&((0,u.assertNonNullable)(this.filesFetcher),this.filesFetcher.prefetch(this.urlResolver.resolve($(e),!1)))},P=t=>{c()&&(e.cachedHeader=t,E(t,(()=>{i=!0,x()})))};a=!0,w.seek((e=>{if(c()){if(S=Ea(),!e)return void k();o=e,!(0,u.isNullable)(t)||e.startTS>t?C(e):(n=e,T())}}),t),e.cachedHeader?P(e.cachedHeader):h(e.headerUrl,P,(()=>this._handleNetworkError()))},stop:b,getTimestampSec:()=>s},d}_switchToQuality(e){let t,{logger:i,playerCallback:r}=this.params;e.bitrate!==this.bitrate&&(this.rep&&(t=this.rep.getTimestampSec(),(0,u.isNonNullable)(t)&&(t+=.1),this.rep.stop()),this.currentManifestEntry=e,this.rep=this._representation(e),i(`switch to quality: codecs=${e.codecs}; headerUrl=${e.headerUrl}; bitrate=${e.bitrate}`),this.bitrate=e.bitrate,(0,u.assertNonNullable)(this.bitrateSwitcher),this.bitrateSwitcher.notifySwitch(this.bitrate),this.rep.start(t),r({name:"qualitySwitch",quality:e}))}_qualityAvailable(e){return(0,u.isNonNullable)(this.manifest.find((t=>t.name===e)))}_initBitrateSwitcher(){let e,{logger:t,playerCallback:i}=this.params,r=e=>{if(!this.autoQuality)return;let i,r,a;this.currentManifestEntry&&this._qualityAvailable(this.currentManifestEntry.name)&&e<this.bitrate&&(r=this._getBufferSizeSec(),a=e/this.bitrate,r>10&&a>.8||r>15&&a>.5||r>20&&a>.3)?t(`Not switching: buffer=${Math.floor(r)}; bitrate=${this.bitrate}; newRate=${Math.floor(e)}`):(i=this._selectQuality(e),i?this._switchToQuality(i):t(`Could not find quality by bitrate ${e}`))},a=(e,t)=>{let r=Ea();if(this.chunkRateEstimator.addInterval(e,r,t)){let a=this.chunkRateEstimator.getBitRate();return i({name:"bandwidth",size:t,duration:r-e,speed:a}),!0}},s=()=>{let e=this.chunkRateEstimator.getBitRate();return e?.85*e:0},n=-1/0,o=!0,l=()=>{let t=s();if(t&&e&&this.autoQuality){if(o&&t>e&&xa(n)<3e4)return;r(t)}o=this.autoQuality};return{updateChunk:(e,t)=>{let i=a(e,t);return i&&l(),i},notifySwitch:t=>{let i=Ea();t<e&&(n=i),e=t}}}_fetchManifest(e,t,i){this.manifestRequest=Ca(this.urlResolver.resolve(e,!0),t,i,(()=>this._retryCallback())).withJSONResponse().withTimeout(Ma).withRetryCount(this.params.config.manifestRetryMaxCount).withRetryInterval(this.params.config.manifestRetryInterval,this.params.config.manifestRetryMaxInterval).send().withFinally((()=>{this.manifestRequest=void 0}))}_playVideoElement(){let{videoElement:e}=this.params;ka(e,(()=>{this.soundProhibitedEvent$.next()})).then((e=>{e||(this.params.liveOffset.pause(),this.params.videoState.setState("paused"))}))}_handleManifestUpdate(e){let{logger:t,playerCallback:i,videoElement:r}=this.params;this.manifest=(e=>{let t=[];return e?.length?(e.forEach(((e,i)=>{e.video&&r.canPlayType(e.codecs).replace(/no/,"")&&window.MediaSource?.isTypeSupported?.(e.codecs)&&(e.index=i,t.push(e))})),t.sort((function(e,t){return e.video&&t.video?t.video.height-e.video.height:t.bitrate-e.bitrate})),t):(i({name:"error",type:"empty_manifest"}),[])})(e),t(`Valid manifest entries: ${this.manifest.length}/${e.length}`),i({name:"manifest",manifest:this.manifest})}_refetchManifest(e){this.destroyed||(this.manifestRefetchTimer&&clearTimeout(this.manifestRefetchTimer),this.manifestRefetchTimer=window.setTimeout((()=>{this._fetchManifest(e,(t=>{this.destroyed||(this._handleManifestUpdate(t),this._refetchManifest(e))}),(()=>this._refetchManifest(e)))}),6e4))}_initManifest(){this._fetchManifest(this.manifestUrl,(e=>{this.destroyed||(this._handleManifestUpdate(e),this._refetchManifest(this.manifestUrl))}),(()=>this._handleNetworkError()))}constructor(e){this.paused=!1,this.autoQuality=!0,this.autoQualityLimits=void 0,this.buffering=!0,this.destroyed=!1,this.videoPlayStarted=!1,this.lowLatency=!1,this.bitrate=0,this.manifest=[],this.sourceBuffer=0,this.bufferStates=[],this.sourceJitter=-1,this.waitingForFirstBufferAfterSrcChange=!1,this.params=e,this.soundProhibitedEvent$=new u.Subject,this.chunkRateEstimator=new Aa(this.params.logger),this._initVideo()}},Ra=v(Oe(),1),Da=class{connect(e){this.log=e.logger.createComponentLog("DroppedFramesManager"),this.video=e.video,this.isAuto=e.isAuto,this.tracks=e.tracks,this.droppedFramesChecker=e.droppedFramesChecker,this.subscription.add(e.playing$.subscribe((()=>this.playing=!0))),this.subscription.add(e.pause$.subscribe((()=>this.playing=!1))),this.isEnabled&&this.subscribe()}destroy(){this.currentTimer&&window.clearTimeout(this.currentTimer),this.subscription.unsubscribe()}get droppedVideoMaxQualityLimit(){return this.maxQualityLimit}subscribe(){this.subscription.add((0,u.fromEvent)(this.video,"resize").subscribe(this.handleChangeVideoQuality));let e=(0,u.interval)(this.droppedFramesChecker.checkTime).pipe((0,u.filter)((()=>this.playing)),(0,u.filter)((()=>{let e=!!this.isForceCheckCounter;return e&&(this.isForceCheckCounter-=1),!e}))),t=this.forceChecker$.pipe((0,u.debounce)(this.droppedFramesChecker.checkTime)),i=(0,u.merge)(e,t);this.subscription.add(i.subscribe(this.checkDroppedFrames))}onChangeQuality(e){this.currentQuality=e;let{totalVideoFrames:t,droppedVideoFrames:i}=this.video.getVideoPlaybackQuality();this.savePrevFrameCounts(t,i),this.isForceCheckCounter=this.droppedFramesChecker.tickCountAfterQualityChange,this.forceChecker$.next()}onDroopedVideoFramesLimitTrigger(){this.isAuto.getState()&&(this.log({message:`[onDroopedVideoFramesLimit]. maxQualityLimit: ${this.maxQualityLimit}`}),this.onDroopedVideoFramesLimit$.next())}getMaxQualityLimit(e){let t=(0,Ra.default)(this.limitCounts).filter((([,e])=>e>=this.droppedFramesChecker.countLimit)).sort((([e],[t])=>(0,u.isLower)(e,t)?-1:1))?.[0]?.[0];return e??t}get isEnabled(){return this.droppedFramesChecker.enabled&&this.isDroppedFramesCheckerSupport}get isDroppedFramesCheckerSupport(){return!!this.video&&"function"==typeof this.video.getVideoPlaybackQuality}savePrevFrameCounts(e,t){this.prevTotalVideoFrames=e,this.prevDroppedVideoFrames=t}constructor(){this.onDroopedVideoFramesLimit$=new u.Subject,this.subscription=new u.Subscription,this.playing=!1,this.tracks=[],this.forceChecker$=new u.Subject,this.isForceCheckCounter=0,this.prevTotalVideoFrames=0,this.prevDroppedVideoFrames=0,this.limitCounts={},this.handleChangeVideoQuality=()=>{let e=this.tracks.find((({size:e})=>e?.height===this.video.videoHeight&&e?.width===this.video.videoWidth));e&&!(0,u.isInvariantQuality)(e.quality)&&this.onChangeQuality(e.quality)},this.checkDroppedFrames=()=>{let{totalVideoFrames:e,droppedVideoFrames:t}=this.video.getVideoPlaybackQuality(),i=e-this.prevTotalVideoFrames,r=1-(i-(t-this.prevDroppedVideoFrames))/i;!isNaN(r)&&r>0&&this.log({message:`[dropped]. current dropped percent: ${r}, limit: ${this.droppedFramesChecker.percentLimit}`}),!isNaN(r)&&r>=this.droppedFramesChecker.percentLimit&&(0,u.isHigher)(this.currentQuality,this.droppedFramesChecker.minQualityBanLimit)&&(this.limitCounts[this.currentQuality]=(this.limitCounts[this.currentQuality]??0)+1,this.maxQualityLimit=this.getMaxQualityLimit(this.currentQuality),this.currentTimer&&window.clearTimeout(this.currentTimer),this.currentTimer=window.setTimeout((()=>this.maxQualityLimit=this.getMaxQualityLimit()),this.droppedFramesChecker.qualityUpWaitingTime),this.onDroopedVideoFramesLimitTrigger()),this.savePrevFrameCounts(e,t)}}},Oa=()=>!!window.documentPictureInPicture?.window||!!document.pictureInPictureElement,Ba=(e,t)=>new u.Observable((i=>{if(!window.IntersectionObserver)return;let r=new IntersectionObserver(((e,t)=>{e.forEach((e=>i.next(e.isIntersecting||Oa())))}),{root:null,...t});r.observe(e);let a=(0,u.fromEvent)(document,"visibilitychange").pipe((0,u.map)((e=>!document.hidden||Oa()))).subscribe((e=>i.next(e)));return()=>{r.unobserve(e),a.unsubscribe()}})),Na=["paused","playing","ready"],Va=["paused","playing","ready"],Ua=class{destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.droppedFramesManager.destroy(),this.dash.destroy(),this.params.output.element$.next(void 0),fr(this.video)}createLiveDashPlayer(){let e=new Ia({videoElement:this.video,videoState:this.videoState,playbackState:this.params.desiredState.playbackState,liveOffset:this.liveOffset,config:{maxParallelRequests:this.params.config.maxParallelRequests,minBuffer:this.params.tuning.live.minBuffer,minBufferSegments:this.params.tuning.live.minBufferSegments,lowLatencyMinBuffer:this.params.tuning.live.lowLatencyMinBuffer,lowLatencyMinBufferSegments:this.params.tuning.live.lowLatencyMinBufferSegments,isLiveCatchUpMode:this.params.tuning.live.isLiveCatchUpMode,manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},playerCallback:this._dashCb,logger:e=>{this.params.dependencies.logger.log({message:String(e),component:"LiveDashPlayer"})}});return e.pause(),e}prepare(){let e=this.representations$.getValue(),t=this.params.desiredState.videoTrack.getTransition()?.to??this.params.desiredState.videoTrack.getState(),i=this.params.desiredState.autoVideoTrackSwitching.getTransition()?.to??this.params.desiredState.autoVideoTrackSwitching.getState(),r=!i&&(0,u.isNonNullable)(t)?t:ma(e.map((({track:e})=>e)),{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,limits:this.params.desiredState.autoVideoTrackLimits.getState(),droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,abrLogger:this.params.dependencies.abrLogger}),a=r?.id,s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.videoTrack.getState()?.id,o=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(r&&(s||a!==n)&&this.setVideoTrack(r),o&&this.setAutoQuality(i),s||o||a!==n){let t=e.find((({track:e})=>e.id===a))?.representation;(0,u.assertNonNullable)(t,"Representations missing"),this.dash.startPlay(t,i)}}setVideoTrack(e){let t=this.representations$.getValue().find((({track:t})=>t.id===e.id))?.representation;(0,u.assertNonNullable)(t,`No such representation ${e.id}`),this.dash.switchByName(t.name),this.params.desiredState.videoTrack.setState(e)}setAutoQuality(e){this.dash.setAutoQualityEnabled(e),this.params.desiredState.autoVideoTrackSwitching.setState(e)}seek(e){this.log({message:`[seek] position: ${e}`}),this.params.output.willSeekEvent$.next();let t=this.params.desiredState.playbackState.getState(),i=this.videoState.getState(),r="paused"===t&&"paused"===i,a=-e,s=a<=this.maxSeekBackTime$.getValue()?a:0;this.params.output.position$.next(e/1e3),this.dash.reinit(sr(this.params.source.url,s)),r&&this.dash.pause(),this.liveOffset.resetTo(s,r)}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.representations$=new u.ValueSubject([]),this.droppedFramesManager=new Da,this.maxSeekBackTime$=new u.ValueSubject(1/0),this.zeroTime$=new u.ValueSubject(void 0),this.liveOffset=new kr,this._dashCb=e=>{switch(e.name){case"buffering":{let t=e.isBuffering;this.params.output.isBuffering$.next(t);break}case"error":this.params.output.error$.next({id:`DashLiveProviderInternal:${e.type}`,category:u.ErrorCategory.WTF,message:"LiveDashPlayer reported error"});break;case"manifest":{let t=e.manifest,i=[];for(let e of t){let t=e.name??e.index.toString(10),r=jr(e.name)??(0,u.videoSizeToQuality)(e.video),a=e.bitrate/1e3,s={...e.video};if(!r)continue;let n={id:t,quality:r,bitrate:a,size:s};i.push({track:n,representation:e})}this.representations$.next(i),this.params.output.availableVideoTracks$.next(i.map((({track:e})=>e))),"manifest_ready"===this.videoState.getTransition()?.to&&this.videoState.setState("manifest_ready");break}case"qualitySwitch":{let t=e.quality,i=this.representations$.getValue().find((({representation:e})=>e===t))?.track;this.params.output.hostname$.next(new URL(t.headerUrl,this.params.source.url).hostname),(0,u.isNonNullable)(i)&&this.params.output.currentVideoTrack$.next(i);break}case"bandwidth":{let{size:t,duration:i}=e;this.params.dependencies.throughputEstimator.addRawSpeed(t,i);break}case"index":this.maxSeekBackTime$.next(e.shiftDuration||0),this.zeroTime$.next(e.zeroTime)}},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.playbackState.getState(),r=this.params.desiredState.playbackState.getTransition(),a=this.params.desiredState.seekState.getState();if(this.log({message:`[syncPlayback] videoState: ${e}; videoTransition: ${JSON.stringify(t)}; desiredPlaybackState: ${i}; seekState: ${JSON.stringify(a)};`}),"stopped"===i)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.dash.destroy(),this.video.removeAttribute("src"),this.video.load(),this.videoState.setState("stopped")));if(t)return;let s=this.params.desiredState.videoTrack.getTransition(),n=this.params.desiredState.autoVideoTrackSwitching.getTransition();if((0,dr.default)(Va,e)&&(s||n))this.prepare();else if("paused"!==r?.to&&"requested"===a.state&&(0,dr.default)(Na,e))this.seek(a.position-this.liveOffset.getTotalPausedTime());else switch(e){case"stopped":return this.videoState.startTransitionTo("manifest_ready"),void this.dash.attachSource(sr(this.params.source.url));case"manifest_ready":this.videoState.startTransitionTo("ready"),this.prepare();break;case"ready":if("paused"===i)this.videoState.setState("paused");else if("playing"===i){this.videoState.startTransitionTo("playing");let e=r?.from;e&&"ready"===e&&this.dash.catchUp(),this.dash.play()}return;case"playing":return void("paused"===i&&(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.dash.pause()));case"paused":if("playing"===i)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.dash.play(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.dash.reinit(sr(this.params.source.url,e))}return;default:return(0,u.assertNever)(e)}},this.textTracksManager=new Sr(e.source.url),this.params=e,this.log=this.params.dependencies.logger.createComponentLog("DashLiveProvider");let t=t=>{e.output.error$.next({id:"DashLiveProvider",category:u.ErrorCategory.WTF,message:"DashLiveProvider internal logic error",thrown:t})};this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})}))),this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.dash=this.createLiveDashPlayer(),this.subscription.add(this.dash.soundProhibitedEvent$.subscribe(this.params.output.soundProhibitedEvent$)),this.params.output.duration$.next(1/0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.textTracksManager.connect(this.video,this.params.desiredState,this.params.output);let i=Fr(this.video);this.subscription.add((()=>i.destroy())),this.subscription.add(this.representations$.pipe((0,u.map)((e=>e.map((({track:e})=>e)))),(0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})))),this.subscription.add(i.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),t)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused")}),t)).add(i.playing$.subscribe((()=>{"applying"===this.params.desiredState.seekState.getState().state&&this.params.output.seekedEvent$.next(),this.videoState.setState("playing")}),t)).add(i.error$.subscribe(this.params.output.error$)).add(this.maxSeekBackTime$.pipe((0,u.filterChanged)(),(0,u.map)((e=>-e/1e3))).subscribe(this.params.output.duration$)).add((0,u.combine)({zeroTime:this.zeroTime$.pipe((0,u.filter)(u.isNonNullable)),position:i.timeUpdate$}).subscribe((({zeroTime:e,position:t})=>this.params.output.liveTime$.next(e+1e3*t)),t)).add(vr(this.video,this.params.desiredState.isLooped,t)).add(br(this.video,this.params.desiredState.volume,i.volumeState$,t)).add(i.volumeState$.subscribe(this.params.output.volume$,t)).add(_r(this.video,this.params.desiredState.playbackRate,i.playbackRateState$,t)).add(i.loadStart$.subscribe(this.params.output.firstBytesEvent$)).add(i.loadedMetadata$.subscribe(this.params.output.loadedMetadataEvent$)).add(i.playing$.subscribe(this.params.output.firstFrameEvent$)).add(i.canplay$.subscribe(this.params.output.canplay$)).add(i.inPiP$.subscribe(this.params.output.inPiP$)).add(i.inFullscreen$.subscribe(this.params.output.inFullscreen$)).add(Ba(this.video).subscribe(this.params.output.elementVisible$)).add(this.params.desiredState.autoVideoTrackLimits.stateChangeStarted$.subscribe((({to:{max:e,min:t}})=>{this.dash.setAutoQualityLimits({max:e&&(0,u.videoQualityToHeight)(e),min:t&&(0,u.videoQualityToHeight)(t)}),this.params.output.autoVideoTrackLimits$.next({max:e,min:t})}))).add(this.videoState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"stopped":this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.desiredState.playbackState.setState("stopped");break;case"manifest_ready":case"ready":"ready"===this.params.desiredState.playbackState.getTransition()?.to&&this.params.desiredState.playbackState.setState("ready");break;case"paused":this.params.desiredState.playbackState.setState("paused");break;case"playing":this.params.desiredState.playbackState.setState("playing");break;default:return(0,u.assertNever)(e.to)}}),t)).add((0,u.merge)(e.desiredState.playbackState.stateChangeStarted$,e.desiredState.seekState.stateChangeEnded$,e.desiredState.videoTrack.stateChangeStarted$,e.desiredState.autoVideoTrackSwitching.stateChangeStarted$,this.videoState.stateChangeEnded$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)).subscribe(this.syncPlayback,t))}},Fa=v(Te(),1),ja=(e,t)=>{let i=0;for(let r=0;r<e.length;r++){let a=1e3*e.start(r),s=1e3*e.end(r);a<=t&&t<=s&&(i=s)}return Math.max(i-t,0)},za=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Wa=class extends za{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||za.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},qa=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Wa,writable:!0,configurable:!0})}};function Ha(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(qa.prototype[Symbol.toStringTag]="AbortController",Wa.prototype[Symbol.toStringTag]="AbortSignal");var Ka="fetch"in window&&Ha({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Qa=Ka?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Ha({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Ga=Ka?Qa.fetch:window.fetch,Ya=(Ka?Qa.Request:window.Request,Ka?qa:window.AbortController),Xa=(Ka||window.AbortSignal,v(vi(),1)),Za=v($i(),1),Ja=e=>{if(!e)return{id:"EmptyResponse",category:u.ErrorCategory.PARSER,message:"Empty response"};if(e.length<=2&&e.match(/^\d+$/))return{id:`UVError#${e}`,category:u.ErrorCategory.NETWORK,message:`UV Error ${e}`};let t=(0,Za.default)(e).substring(0,100).toLowerCase();return t.startsWith("<!doctype")||t.startsWith("<html>")||t.startsWith("<body>")||t.startsWith("<head>")?{id:"UnexpectedHTML",category:u.ErrorCategory.NETWORK,message:"Received unexpected HTML, possibly a ISP block"}:t.startsWith("<?xml")?(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?{id:"InvalidXML",category:u.ErrorCategory.PARSER,message:"XML parsing error"}:{id:"XMLParserLogicError",category:u.ErrorCategory.PARSER,message:"Response is valid XML, but parser failed"}:void 0},es=(e,t,i=0)=>{for(let r=0;r<e.length;r++)if(1e3*e.start(r)-i<=t&&1e3*e.end(r)+i>t)return!0;return!1},ts=v(Te(),1),is=v(oi(),1),rs=v(vi(),1),as=e=>"function"==typeof e&&e?.toString().endsWith("{ [native code] }"),ss=!as(window.requestIdleCallback)||!as(window.cancelIdleCallback),ns=ss?(e,t={})=>{let i=t.timeout||1,r=performance.now();return window.setTimeout((()=>{e({get didTimeout(){return!t.timeout&&performance.now()-r-1>i},timeRemaining(){return Math.max(0,performance.now()-r+1)}})}),1)}:window.requestIdleCallback,os=ss?e=>window.clearTimeout(e):window.cancelIdleCallback,ls=v(Jt(),1),us=!1;try{us=Ur.browser.isSafari&&!!Ur.browser.safariVersion&&Ur.browser.safariVersion<=18}catch(e){console.error(e)}var ds=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let a={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(a),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=us&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,u.assertNever)(t)}}constructor(e){this.bufferFull$=new u.Subject,this.error$=new u.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}},cs=e=>{let t=0;for(let i=0;i<e.length;i++)t+=e.end(i)-e.start(i);return 1e3*t},hs=class{get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),this.size32=i<=e.buffer.byteLength-e.byteOffset?i:NaN;let r=this.size32?this.size32-8:void 0,a=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,a,r)}},ps=class extends hs{},fs=class extends hs{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},ms=class extends fs{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let a=e>>>28,s=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:a,SAPDeltaTime:s})}}},gs={ftyp:class extends hs{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends fs{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends hs{constructor(e,t){super(e,t),this.data=this.content}},sidx:ms,trak:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends fs{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends fs{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends fs{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends fs{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends fs{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends fs{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends fs{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends fs{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends hs{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,a=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],s=JSON.parse(a);this.serverDataReceivedTimestamp=s[this.ondemandDataReceivedKey],this.serverDataPreparedTime=s[this.ondemandDataPreparedKey]}},stbl:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends fs{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends hs{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:ps},vs=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),a=this.createBox(r,new DataView(e.buffer,e.byteOffset+i));if(!a.size)break;t.push(a),i+=a.size}catch{break}return t}createBox(t,i){let r=gs[t];return r?new r(i,new e):new ps(i,new e)}constructor(e={}){this.options={offset:0,...e}}},bs=class{indexBoxLevel(e){e.forEach((e=>{var t,i;(t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},_s=new TextDecoder("ascii"),ys={validateData:e=>"ftyp"===_s.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new vs).parse(e),r=new bs(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let a=r.find("equi");a&&(t.projectionData.bounds.top=a.projectionBoundsTop,t.projectionData.bounds.right=a.projectionBoundsRight,t.projectionData.bounds.bottom=a.projectionBoundsBottom,t.projectionData.bounds.left=a.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new ms(e,new vs),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let a=e.subsegmentDuration/t.timescale*1e3,s={status:"none",time:{from:i,to:i+a},byte:{from:r,to:r+e.referencedSize-1}};return i+=a,r+=e.referencedSize,s}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new vs).parse(e),r=new bs(i),a=r.findAll("moof"),s=t?r.findAll("uuid"):r.findAll("mdat");if(!s.length||!a.length)return null;let n=a[0],o=s[s.length-1],l=n.source.byteOffset,u=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new vs).parse(e),r=new bs(i).findAll("traf"),a=r[r.length-1].children.find((e=>"tfhd"===e.type)),s=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):a.defaultSampleDuration*n.sampleCount,(Number(s.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new vs).parse(e),i=new bs(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{let t=(new vs).parse(e);return new bs(t).find("sidx")?.timescale}},ws=v(Te(),1),Ss={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},ks=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=Ts(e,i),a=r in Ss,s=a?Ss[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(n&255>>o)*2**(8*(o-1))+Ts(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:a?r:"0x"+r.toString(16).toUpperCase(),type:s,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},Ts=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},Es=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return Ts(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,u.assertNever)(t)}},xs=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),a=ks(r);if(!t(a))return;"master"===a.type&&xs(a.value,t),i=a.value.byteOffset-e.byteOffset+a.valueSize}},$s=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],Cs=[231,22612,22743,167,171,163,160,175],As={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,a=ks(e);return xs(a.value,(({tag:e,type:a,value:s})=>(17143===e?t=Es(s,a):17026===e?i=Es(s,a):17029===e&&(r=Es(s,a)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,a,s,n,o=!1,l=!1,d=!1,c=!1;return xs(e,(({tag:e,type:u,value:h,valueSize:p})=>{if(21419===e){let e=Es(h,u);n=Ts(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?l=!0:2807729===e?r=Es(h,u):17545===e?a=Es(h,u):21420===e&&475249515===n?s=Es(h,u):374648427===e?xs(h,(({tag:e,type:t,value:i})=>30321!==e||(c=1===Es(i,t),!1))):o&&l&&(0,ws.default)($s,e)&&(d=!0),!d})),(0,u.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,u.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,u.assertNonNullable)(a,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(a/1e9*r*1e3),cuesSeekPosition:s,is3dVideo:c,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,u.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,a=!1,s=e=>(0,u.isNonNullable)(e.time)&&(0,u.isNonNullable)(e.position),n=[];return xs(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&s(i)&&n.push(i),i={};break;case 179:i&&(i.time=Es(o,t));break;case 183:break;case 241:i&&(i.position=Es(o,t));break;default:r&&(0,ws.default)($s,e)&&(a=!0)}return!(r&&a)})),i&&s(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:a}=e,s=n[i+1];return{status:"none",time:{from:r,to:s?s.time:t.segmentDuration},byte:{from:t.segmentStart+a,to:s?t.segmentStart+s.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{xs(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,ws.default)(Cs,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,ws.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},Ps=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return As;case"mp4":return ys}}throw new ReferenceError(`Unsupported mime type ${e}`)},Ls=v(Bi(),1),Ms=v(Oe(),1),Is=v(Wi(),1),Rs=v(oi(),1),Ds=v(ri(),1),Os=v(Te(),1),Bs=e=>{let t=e.split("."),[i,...r]=t;if(!i)return!1;switch(i){case"av01":{let[e,t,i]=r;return!!(i&&parseInt(i,10)>8)}case"vp09":{let[e,t,i]=r;return!!(e&&parseInt(e,10)>=2&&i&&parseInt(i,10)>8)}case"avc1":{let e=r[0];if(!e||6!==e.length)return!1;let[t,i]=e.toUpperCase(),a=t+i;return(0,Os.default)(["6E","7A","F4"],a)}}return!1},Ns=e=>{if(e.includes("/")){let t=e.split("/");return parseInt(t[0])/parseInt(t[1])}return parseFloat(e)},Vs=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var Us=v(oi(),1),Fs=({id:e,width:t,height:i,bitrate:r,fps:a,quality:s,streamId:n})=>{let o=(s?jr(s):void 0)??(0,u.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:a,streamId:n}},js=({id:e,bitrate:t})=>({id:e,bitrate:t}),zs=({language:e,label:t},{id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}),Ws=({id:e,language:t,label:i,codecs:r,isDefault:a})=>({id:e,language:t,label:i,codec:(0,Us.default)(r.split("."),0),isDefault:a}),qs=({id:e,language:t,label:i,hdr:r,codecs:a})=>({id:e,language:t,hdr:r,label:i,codec:(0,Us.default)(a.split("."),0)}),Hs=e=>"url"in e,Ks=e=>"template"===e.type,Qs=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),Gs=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},Ys=(e,t)=>{let i=e;i=(0,Ls.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,Ms.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,Ls.default)(i,r,((e,i)=>(0,u.isNullable)(t)?e:(0,u.isNullable)(i)?t:(0,Is.default)(t,parseInt(i,10),"0")))}return i},Xs=(e,t)=>(0,u.isNonNullable)(e)&&(0,u.isNonNullable)(t)&&"open"===e.readyState&&function(e,t){for(let i=0;i<e.activeSourceBuffers.length;++i)if(e.activeSourceBuffers[i]===t)return!0;return!1}(e,t);var Zs=class{switchToWithPreviousAbort(e,t=!1){!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ya,(0,u.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,u.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ya,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,u.isNullable)(e)||(0,u.isNullable)(this.downloadingRepresentationId)||(0,u.isNullable)(this.playingRepresentationId)||(0,u.isNullable)(this.sourceBuffer)||!Xs(this.mediaSource,this.sourceBuffer)||(0,u.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if((0,u.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));(0,u.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from);let a=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=this.getForwardBufferDuration(e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(a=i)}if(isFinite(this.bufferLimit)&&cs(this.sourceBuffer.buffered)>=this.bufferLimit){let t=this.getForwardBufferDuration(e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let s=[];if(!this.activeSegments.size&&(s=this.selectForwardBufferSegments(i,t.segmentReference.type,a),s.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,ts.default)(s,r))e="high";else{let t=(0,is.default)(s,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(s,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!s.length&&this.getForwardBufferDuration(e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let n=(0,is.default)(i,-1);!this.isLive&&n&&(this.fullyBuffered$.next(n.time.to-e-this.getForwardBufferDuration(e)<100),this.onLastSegment$.next(e-n.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let a of e)Math.trunc(a.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:a.time.from+r}),i=a.time.to;(0,u.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],a=0,s=t.length-1;do{r.unshift(t[s]),a+=t[s].time.to-t[s].time.from,s--}while(a<i&&s>=0);return this.liveInitialAdditionalOffset=a-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,rs.default)(e?.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return i?.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){let t=(0,rs.default)(e?.streams[this.kind],(e=>e.representations))??[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of t){if(!e||!Ks(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],a=(0,is.default)(r,-1)?.time.to??0,s=t?.findIndex((e=>a>=e.time.from+i&&a<=e.time.to+i));if(-1===s){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(s+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,u.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!Ks(r))return;let a=this.segments.get(i.id)??[],s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,t=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=Ys(r.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.gapDetectionIdleCallback&&os&&os(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&os&&os(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));return this.playingRepresentationId!==this.downloadingRepresentationId&&(this.liveUpdateSegmentIndex=i),this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):[]}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},a)=>{let s=t>i||t<=i&&r>=i||0===a&&0===i,n=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+n||r<=i+n;return("none"===e||"partially_ejected"===e&&s&&o&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&!(es(this.sourceBuffer.buffered,t)&&es(this.sourceBuffer.buffered,r)))&&s&&o}));if(-1===r)return[];if("byteRange"!==t)return e.slice(r,r+1);let a=e,s=0,n=0,o=[],l=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,u=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<a.length&&(s<=l||n<=u);e++){let t=a[e];if(s+=t.byte.to+1-t.byte.from,n+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){Ks(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:a,url:s,signal:n,onProgress:o,onProgressTasks:l}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,u.abortable)(n,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(s,{range:a,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=(0,u.now)(),!e)return;let d=new DataView(e),c=Ps(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&l?await Promise.all(l):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),Qs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())Ks(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:a,signal:s,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&s&&(await(0,u.abortable)(s,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,u.fromEvent)(window,"online").pipe((0,u.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),s.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(a,{range:r,onProgress:n,signal:s,priority:i}),this.lastDataObtainedTimestampMs=(0,u.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),Qs(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(Ks(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,is.default)(e,0).byte.from,to:(0,is.default)(e,-1).byte.to},{signal:a}=this.downloadAbortController;return{url:i,range:r,signal:a,onProgress:async(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!Ks(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:a}=this.downloadAbortController,s=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});s.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:a,onProgress:n,onProgressTasks:s}}abortActiveSegments(e){for(let t of this.activeSegments)(0,ts.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:a}){if(!this.activeSegments.size||!Xs(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(a.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=Ps(s.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:a,onSegmentAppendFailed:s}){if(!this.activeSegments.size||!Xs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){let{segment:l}=o;if(o.representationId!==t)continue;if(a.aborted){await s();continue}let u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(!(u<r))continue;let p=Ps(n.mime);if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,a)&&!a.aborted?this.onSegmentFullyAppended(o,t):await s()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:p.parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,a)&&!a.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await s())}}}onSegmentFullyAppended(e,t){if(!(0,u.isNullable)(this.sourceBuffer)&&Xs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Ur.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(es(this.sourceBuffer.buffered,e.segment.time.from,100)&&es(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",Hs(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values())if(i.id!==t)for(let t of this.segments.get(i.id)??[])"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none");this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,[e.segment])}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=ns((()=>(0,ls.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",a=(!i&&this.failedDownloads>0?(0,u.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,Ps(e.mime),r))).then((async t=>{if(!t)return;let{init:i,dataView:r,segments:a}=t,s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,s);let n=a;this.isLive&&Ks(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:u.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!Xs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,u.isNullable)(e))return!1;let r=[],a=0,s=e=>{if(a>=t)return r;r.push({...e.time}),r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:a}=e[i],s=t[t.length-1];s.to>=r?s.to=Math.max(s.to,a):t.push(e[i])}return t})(r);let i=Hs(e)?e.size??0:e.byte.to-e.byte.from;a+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&s(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let a of e)(0,ts.default)(["none","partially_ejected"],a.status)&&Math.round(a.time.from)<=Math.round(t)&&Math.round(a.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){s({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&s(r)}return!!r.length&&(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1)}async abortBuffer(){if(!this.sourceBuffer||!Xs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,u.isNullable)(e)?ja(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));for(let i of t){let t={representation:e,from:i.time.from,to:i.time.to};for(let e=0;e<this.sourceBuffer.buffered.length;e++){let r=1e3*this.sourceBuffer.buffered.start(e),a=1e3*this.sourceBuffer.buffered.end(e);if(!(a<=i.time.from||r>=i.time.to)){if(r<=i.time.from&&a>=i.time.to){t=void 0;break}a>i.time.from&&a<i.time.to&&(t.from=a),r<i.time.to&&r>i.time.from&&(t.to=r)}}t&&t.to-t.from>1&&!this.gaps.some((e=>t&&e.from===t.from&&e.to===t.to))&&this.gaps.push(t)}}}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=ns((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:u.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if((0,u.isNullable)(this.sourceBuffer)||!Xs(this.mediaSource,this.sourceBuffer)||(0,u.isNullable)(this.playingRepresentationId))return;let e=[];for(let t=0;t<this.sourceBuffer.buffered.length;t++){let i=Math.floor(1e3*this.sourceBuffer.buffered.start(t)),r=Math.ceil(1e3*this.sourceBuffer.buffered.end(t));e.push({from:i,to:r})}let t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let a=Math.floor(r.time.from),s=Math.ceil(r.time.to),n=e.some((e=>e.from-t<=a&&e.to+t>=s)),o=e.filter((e=>a>=e.from&&a<e.to-t||s>e.from+t&&s<=e.to));n||(1===o.length||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:a,getCurrentPosition:s,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:l}){this.currentLiveSegmentServerLatency$=new u.ValueSubject(0),this.currentLowLatencySegmentLength$=new u.ValueSubject(0),this.currentSegmentLength$=new u.ValueSubject(0),this.onLastSegment$=new u.ValueSubject(!1),this.fullyBuffered$=new u.ValueSubject(!1),this.playingRepresentation$=new u.ValueSubject(void 0),this.playingRepresentationInit$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.gaps=[],this.subscription=new u.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ya,this.switchAbortController=new Ya,this.destroyAbortController=new Ya,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.startWith=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,u.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new ds(this.sourceBuffer),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.checkEjectedSegments(),this.maintain()}),(e=>{let t,i=this.mediaSource.readyState;"open"!==i&&(t={id:`SegmentEjection_source_${i}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),t??(t={id:"SegmentEjection",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when trying to clear segments ejected by browser",thrown:e}),this.error$.next(t)}))),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!Xs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*cs(this.sourceBuffer.buffered));this.bufferLimit=i;let r=this.getForwardBufferDuration(t),a=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<a).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),a=this.parsedInitData.get(t.id);(0,u.assertNonNullable)(i,"No init buffer for starting representation"),(0,u.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(a))}.bind(this)),this.switchTo=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,rs.default)(e,(e=>e.representations))??[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!t)return;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!Ks(r.segmentReference))return;let a=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,a)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,u.assertNonNullable)(r);let a=this.segments.get(i);(0,u.assertNonNullable)(a,"No segments for starting representation");let s=this.initData.get(i);if((0,u.assertNonNullable)(s,"No init buffer for starting representation"),!(s instanceof ArrayBuffer))return;let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(a,r),yield this.sourceBufferTaskQueue.append(s,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=a,this.compatibilityMode=o,this.forwardBufferTarget=a.dash.forwardBufferTargetAuto,this.getCurrentPosition=s,this.isActiveLowLatency=n,this.isLive=!!l?.live,this.baseUrls=l?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},Js=e=>{let t=new URL(e);return t.searchParams.set("quic","1"),t.toString()},en=e=>{let t=e.get("X-Delivery-Type"),i=e.get("X-Reused");return{type:null===t?"http1":t??void 0,reused:null===i?void 0:{1:!0,0:!1}[i]??void 0}},tn=e=>{let t=new URL(e);return t.searchParams.set("enable-subtitles","yes"),t.toString()},rn=class{onHeadersReceived(e){let{type:t,reused:i}=en(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,u.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.subscription.unsubscribe(),this.tracer.end()}async doFetch(e,t){let i=await Ga(e,t);if(i.ok)return i;let r=await i.text(),a=parseInt(r);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:u.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:u.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:u.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:u.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:u.ErrorCategory.FATAL})}}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:a=!1}){this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.recoverableError$=new u.Subject,this.error$=new u.Subject,this.abortAllController=new Ya,this.subscription=new u.Subscription,this.fetchManifest=(0,u.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Js(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=tn(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(an);return r?(t.log("success",(0,u.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,u.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,u.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:a="auto",signal:s,measureThroughput:n=!0,isLowLatency:o=!1}={}){let l=e,d=new Headers,c=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:d.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(l,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),l=e.toString();break}default:(0,u.assertNever)(t)}this.requestQuic&&(l=Js(l));let h,p=this.abortAllController.signal;if(s){let e=new Ya;if(h=(0,u.merge)((0,u.fromEvent)(this.abortAllController.signal,"abort"),(0,u.fromEvent)(s,"abort")).subscribe((()=>{try{e.abort()}catch(e){an(e)}})),this.subscription.add(h),this.abortAllController.signal.aborted||s.aborted)try{e.abort()}catch(e){an(e)}p=e.signal}let f=(0,u.now)();c.log("startRequest",(0,u.flattenObject)({url:l,priority:a,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:f}));let m=yield this.doFetch(l,{priority:a,headers:d,signal:p}),g=(0,u.now)();if(!m)return c.error("error",{message:"No response in request"}),c.end(),h?.unsubscribe(),null;if(this.throughputEstimator?.addRawRtt(g-f),!m.ok||!m.body){h?.unsubscribe();let e=`Fetch error ${m.status}: ${m.statusText}`;return c.error("error",{message:e}),c.end(),Promise.reject(new Error(`Fetch error ${m.status}: ${m.statusText}`))}if(this.onHeadersReceived(m.headers),!r&&!n){h?.unsubscribe();let e=(0,u.now)(),t={requestStartedAt:f,requestEndedAt:e,duration:e-f};return c.log("endRequest",(0,u.flattenObject)(t)),c.end(),m.arrayBuffer()}let[v,b]=m.body.tee(),_=v.getReader();n&&this.throughputEstimator?.trackStream(b,o);let y=0,w=new Uint8Array(0),S=!1,k=e=>{h?.unsubscribe(),S=!0,an(e)},T=(0,u.abortable)(p,async function*({done:e,value:t}){if(0===y&&this.lastRequestFirstBytes$.next((0,u.now)()-f),p.aborted)h?.unsubscribe();else if(!e&&t){let e=new Uint8Array(w.length+t.length);e.set(w),e.set(t,w.length),w=e,y+=t.byteLength,r?.(new DataView(w.buffer),y),yield _?.read().then(T,k)}}.bind(this));yield _?.read().then(T,k),h?.unsubscribe();let E=(0,u.now)(),x={failed:S,requestStartedAt:f,requestEndedAt:E,duration:E-f};return S?(c.error("endRequest",(0,u.flattenObject)(x)),c.end(),null):(c.log("endRequest",(0,u.flattenObject)(x)),c.end(),w.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,a,{from:s,to:n}=e.initRange,o=s,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,a=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,s),l=Math.max(a,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,s-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=a}},an=e=>{if(!Qs(e))throw e},sn=(e,t,i)=>i*t+(1-i)*e,nn=(e,t)=>e.reduce(((e,t)=>e+t),0)/t,on=class{next(e){let t=0,i=0;for(let e=0;e<this.pastMeasures.length;e++)void 0!==this.pastMeasures[e]&&(t+=(this.pastMeasures[e]-this.smoothed)**2,i++);this.takenMeasures=i,t/=i;let r=Math.sqrt(t),a=this.smoothed+this.params.deviationFactor*r,s=this.smoothed-this.params.deviationFactor*r;this.pastMeasures[this.measuresCursor]=e,this.measuresCursor=(this.measuresCursor+1)%this.pastMeasures.length,this.rawSeries$.next(e),this.updateSmoothedValue(e),this.smoothed$.next(this.smoothed),this.smoothedSeries$.next(this.smoothed),!(this.smoothed>a||this.smoothed<s)&&((0,u.isNullable)(this.prevReported)||Math.abs(this.smoothed-this.prevReported)/this.prevReported>=this.params.changeThreshold)&&(this.prevReported=this.smoothed,this.debounced$.next(this.smoothed),this.reportedSeries$.next(this.smoothed))}constructor(e){this.prevReported=void 0,this.pastMeasures=[],this.takenMeasures=0,this.measuresCursor=0,this.params=e,this.pastMeasures=Array(e.deviationDepth),this.smoothed=this.prevReported=e.initial,this.smoothed$=new u.ValueSubject(e.initial),this.debounced$=new u.ValueSubject(e.initial);let t=e.label??"value"+Math.random().toString(16).substring(2,6);this.rawSeries$=new Yr(`raw_${t}`),this.smoothedSeries$=new Yr(`smoothed_${t}`),this.reportedSeries$=new Yr(`reported_${t}`),this.rawSeries$.next(e.initial),this.smoothedSeries$.next(e.initial),this.reportedSeries$.next(e.initial)}},ln=class extends on{updateSmoothedValue(e){this.slow=sn(this.slow,e,this.params.emaAlphaSlow),this.fast=sn(this.fast,e,this.params.emaAlphaFast);let t=this.params.fastDirection>0?Math.max:Math.min;this.smoothed=t(this.slow,this.fast)}constructor(e){super(e),this.slow=this.fast=e.initial}},un=class extends on{updateSmoothedValue(e){let t=nn(this.pastMeasures,this.takenMeasures);this.emaSmoothed=sn(this.emaSmoothed,e,this.params.emaAlpha);let i=((e,t,i,r)=>{let a=0,s=i,n=nn(e,t),o=t<r?t:r;for(let t=0;t<o;t++)e[s]>n?a++:a--,s=(e.length+s-1)%e.length;return Math.abs(a)===o})(this.pastMeasures,this.takenMeasures,this.measuresCursor-1,this.params.basisTrendChangeCount);this.smoothed=i?this.emaSmoothed:t}constructor(e){super(e),this.emaSmoothed=e.initial}},dn=class extends on{next(e){this.currentTopExtremumValue<=e?(this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.length===this.extremumInterval?(super.next(this.currentTopExtremumValue),this.currentTopExtremumValue=e,this.furtherValues=[]):this.furtherValues.push(e)}updateSmoothedValue(e){this.smoothed=this.smoothed?sn(this.smoothed,e,this.params.emaAlpha):e}constructor(e){super(e),this.furtherValues=[],this.currentTopExtremumValue=0,this.extremumInterval=e.extremumInterval}},cn=class{static getSmoothedValue(e,t,i){return"TwoEma"===i.type?new ln({initial:e,emaAlphaSlow:i.emaAlphaSlow,emaAlphaFast:i.emaAlphaFast,changeThreshold:i.changeThreshold,fastDirection:t,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"}):new un({initial:e,emaAlpha:i.emaAlpha,basisTrendChangeCount:i.basisTrendChangeCount,changeThreshold:i.changeThreshold,deviationDepth:i.deviationDepth,deviationFactor:i.deviationFactor,label:"throughput"})}static getLiveBufferSmoothedValue(e,t){return new dn({initial:e,label:"liveEdgeDelay",...t})}},hn=(e,t)=>{e&&e.playbackRate!==t&&(e.playbackRate=t)},pn=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,u.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,a=t.segments[0].time.from,s=t.segments[r-1].time.to;if(e<a||e>s)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&Ks(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new u.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},fn=v(oi(),1),mn=e=>{let{webmDecodingInfo:t}=Ur.video,i="DASH_WEBM",r="DASH_WEBM_AV1";switch(e){case"vp9":return[i,r];case"av1":return[r,i];case"none":return[];case"smooth":return t?t[r].smooth?[r,i]:t[i].smooth?[i,r]:[r,i]:[i,r];case"power_efficient":return t?t[r].powerEfficient?[r,i]:t[i].powerEfficient?[i,r]:[r,i]:[i,r];default:(0,u.assertNever)(e)}return[i,r]},gn=({webmCodec:e,androidPreferredFormat:t,preferMultiStream:i})=>{let r=[...i?["DASH_STREAMS"]:[],...mn(e),"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]],a=[...i?["DASH_STREAMS"]:[],"DASH_SEP","DASH_ONDEMAND",...i?[]:["DASH_STREAMS"]];if(Ur.device.isAndroid)switch(t){case"mpeg":return["MPEG",...r,"HLS","HLS_ONDEMAND"];case"hls":return["HLS","HLS_ONDEMAND",...r,"MPEG"];case"dash":return[...r,"HLS","HLS_ONDEMAND","MPEG"];case"dash_any_mpeg":return[...a,"MPEG",...mn(e),"HLS","HLS_ONDEMAND"];case"dash_any_webm":return[...mn(e),"MPEG",...a,"HLS","HLS_ONDEMAND"];case"dash_sep":return["DASH_SEP","MPEG",...mn(e),...a,"HLS","HLS_ONDEMAND"];default:(0,u.assertNever)(t)}return Ur.video.nativeHlsSupported,[...r,"HLS","HLS_ONDEMAND","MPEG"]},vn=({androidPreferredFormat:e,preferCMAF:t,preferWebRTC:i})=>{let r,a=t?["DASH_LIVE_CMAF","DASH_LIVE"]:["DASH_LIVE","DASH_LIVE_CMAF"],s=t?["HLS_LIVE_CMAF","HLS_LIVE"]:["HLS_LIVE","HLS_LIVE_CMAF"],n=[...a,...s],o=[...s,...a],l=Ur.device.isMac&&Ur.browser.isSafari;if(Ur.device.isAndroid)switch(e){case"dash":case"dash_any_mpeg":case"dash_any_webm":case"dash_sep":r=n;break;case"hls":case"mpeg":r=o;break;default:(0,u.assertNever)(e)}else r=Ur.video.nativeHlsSupported&&!l?o:l?t?["DASH_LIVE_CMAF","HLS_LIVE_CMAF","HLS_LIVE","DASH_LIVE"]:["HLS_LIVE","DASH_LIVE","DASH_LIVE_CMAF","HLS_LIVE_CMAF"]:n;return i?["WEB_RTC_LIVE",...r]:[...r,"WEB_RTC_LIVE"]},bn=e=>e?["HLS_LIVE","HLS_LIVE_CMAF","DASH_LIVE_CMAF"]:["DASH_WEBM","DASH_WEBM_AV1","DASH_SEP","DASH_ONDEMAND","HLS","HLS_ONDEMAND","MPEG"],_n=e=>{if(0===e.size)return;if(1===e.size){let t=e.values().next();return(0,fn.default)(t.value.split("."),0)}for(let t of e){let e=(0,fn.default)(t.split("."),0);if("opus"===e||"vp09"===e||"av01"===e)return e}let t=e.values().next();return(0,fn.default)(t.value.split("."),0)},yn=["timeupdate","progress","play","seeked","stalled","waiting"],wn=["timeupdate","progress","loadeddata","playing","seeked"],Sn=class{async seekLive(e){(0,u.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,u.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=sr(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,u.assertNonNullable)(this.element),this.state$.setState("running"),this.subscription.add((0,u.merge)(...yn.map((e=>(0,u.fromEvent)(this.element,e))),(0,u.fromEvent)(window,"online")).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:u.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,u.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,u.fromEvent)(this.element,"waiting").subscribe((()=>{this.element&&2===this.element.readyState&&!this.element.seeking&&es(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription?.unsubscribe(),this.stallWatchdogSubscription=(0,u.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,u.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,s=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=s<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,l=this.audioBufferManager&&n<100&&i-a>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||l)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:u.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,u.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:u.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,u.assertNonNullable)(this.element),(0,u.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),es(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,u.isNullable)(this.element)&&!(0,u.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,u.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,u.isNonNullable)(this.element)&&(0,u.isNonNullable)(this.source)&&(0,u.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){if(!this.element||!this.isLive$.getValue())return!1;let e=1-this.element.playbackRate;return Number(e.toFixed(2))>Number(this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup.toFixed(2))}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers?.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getDebugBufferState();if(!e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i={isJumpGapAfterSeekLive:this.isJumpGapAfterSeekLive,isActiveLowLatency:t,initialCurrentTime:this.element.currentTime};this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e.to&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let r=1e3*this.element.currentTime,a=[],s=1===this.element.readyState?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)e.playingRepresentation$.getValue()===t.representation&&t.from-s<=r&&t.to+s>r&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?a.push(1/0):a.push(t.to));if(a.length){let e=Math.max(...a)+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,i={...i,gapEnds:a,jumpTo:e,resultCurrentTime:this.element.currentTime},this.tracer.log("jumpGap",(0,u.flattenObject)(i)))}}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new u.Subscription,this.representationSubscription=new u.Subscription,this.state$=new lr("none"),this.currentVideoRepresentation$=new u.ValueSubject(void 0),this.currentVideoRepresentationInit$=new u.ValueSubject(void 0),this.currentAudioRepresentation$=new u.ValueSubject(void 0),this.currentVideoSegmentLength$=new u.ValueSubject(0),this.currentAudioSegmentLength$=new u.ValueSubject(0),this.error$=new u.Subject,this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.currentLiveTextRepresentation$=new u.ValueSubject(null),this.isLive$=new u.ValueSubject(!1),this.isActiveLive$=new u.ValueSubject(!1),this.isLowLatency$=new u.ValueSubject(!1),this.liveDuration$=new u.ValueSubject(0),this.liveSeekableDuration$=new u.ValueSubject(0),this.liveAvailabilityStartTime$=new u.ValueSubject(0),this.liveStreamStatus$=new u.ValueSubject(void 0),this.bufferLength$=new u.ValueSubject(0),this.liveLatency$=new u.ValueSubject(void 0),this.liveLoadBufferLength$=new u.ValueSubject(0),this.livePositionFromPlayer$=new u.ValueSubject(0),this.currentStallDuration$=new u.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new u.ValueSubject(0),this.fetcherRecoverableError$=new u.Subject,this.fetcherError$=new u.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new u.Subject,this.gapWatchdogActive=!1,this.destroyController=new Ya,this.initManifest=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=sr(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:u.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,u.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:u.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=((e,t)=>{let i,r={video:[],audio:[],text:[]},a=(new DOMParser).parseFromString(e,"application/xml").children[0],s=Array.from(a.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,Rs.default)(s,0)??"",o="dynamic"===a.getAttribute("type"),l=a.getAttribute("availabilityStartTime"),d=a.getAttribute("publishTime"),c=a.getElementsByTagName("vk:Attrs")[0],h=c?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=c?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=c?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=c?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:l?new Date(l).getTime():0,publishTime:d?new Date(d).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let g,v=a.getAttribute("mediaPresentationDuration"),b=[...a.getElementsByTagName("Period")],_=b.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),y=b.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});v?g=Gs(v):(0,Ds.default)(y).filter((e=>e)).length&&!o?g=(0,Ds.default)(y).reduce(((e,t)=>e+(Gs(t)??0)),0):m&&(g=parseInt(m,10));let w=0,S=a.getAttribute("profiles")?.split(",")??[];for(let e of b.map((e=>e.id)))for(let i of _[e]){let e=i.getAttribute("id")??"id"+(w++).toString(10),a=i.getAttribute("mimeType")??"",s=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??a?.split("/")[0],l=i.getAttribute("profiles")?.split(",")??[],d=Vs(i.getAttribute("lang")??"")??{},c=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,v={id:e,language:d.language,isDefault:"main"===f,label:c,codecs:s,hdr:"video"===m&&Bs(s),mime:a,representations:[]};for(let e of h){var k,T,E,x,$;let r,h=e.getAttribute("lang")??void 0,f=c??i.getAttribute("label")??e.getAttribute("label")??void 0,b=e.querySelector("BaseURL")?.textContent?.trim()??"",_=new URL(b||n,t).toString(),y=e.getAttribute("mimeType")??a,C=e.getAttribute("codecs")??s??"";if("text"===o){let t=e.getAttribute("id")||"",i=d.privateuse?.includes("x-auto")||t.includes("_auto"),a=e.querySelector("SegmentTemplate");if(a){let s={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(a.getAttribute("startNumber")??"",10)??1,l=parseInt(a.getAttribute("timescale")??"",10),u=a.querySelectorAll("SegmentTimeline S")??[],d=a.getAttribute("media");if(!d)continue;let c=[],h=0,p="",f=0,m=o,v=0;for(let e of u){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);v=Number.isFinite(r)?r:v;let a=t/l*1e3,n=v/l*1e3;for(let e=0;e<i+1;e++){let i=Ys(d,{...s,segmentNumber:m.toString(10),segmentTime:(v+e*t).toString(10)}),r=(n??0)+e*a,o=r+a;m++,c.push({time:{from:r,to:o},url:i})}v+=(i+1)*t,h+=(i+1)*a}f=v/l*1e3,p=Ys(d,{...s,segmentNumber:m.toString(10),segmentTime:v.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:_,segmentTemplateUrl:d,initUrl:"",totalSegmentsDurationMs:h,segments:c,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:l},profiles:[],duration:g,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:_}}else{let t,a=e.getAttribute("contentType")??y?.split("/")[0]??o,s=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),d=parseInt(e.getAttribute("height")??"",10),c=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,v=h?Ns(h):void 0,b=`${e.getAttribute("id")??"id"+(w++).toString(10)}@${"video"===a?`${d}p`:"audio"===a?`${c}Kbps`:C}`,k=[...S,...l,...s],T=e.querySelector("SegmentBase"),E=e.querySelector("SegmentTemplate")??p;if(T){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,a]=i.split("-").map((e=>parseInt(e,10))),s={from:r,to:a},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,l]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:_,initRange:s,indexRange:n?{from:o,to:l}:void 0}}else{if(!E)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(E.getAttribute("timescale")??"",10),a=E.getAttribute("initialization")??"",s=E.getAttribute("media"),n=parseInt(E.getAttribute("startNumber")??"",10)??1,o=Ys(a,i);if(!s)throw new ReferenceError("No media attribute in SegmentTemplate");let l=E.querySelectorAll("SegmentTimeline S")??[],d=[],c=0,h="",p=0;if(l.length){let e=n,t=0;for(let a of l){let n=parseInt(a.getAttribute("d")??"",10),o=parseInt(a.getAttribute("r")??"",10)||0,l=parseInt(a.getAttribute("t")??"",10);t=Number.isFinite(l)?l:t;let u=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let a=Ys(s,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:a})}t+=(o+1)*n,c+=(o+1)*u}p=t/r*1e3,h=Ys(s,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,u.isNonNullable)(g)){let e=parseInt(E.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(g/e),a=0;for(let r=1;r<t;r++){let t=Ys(s,{...i,segmentNumber:r.toString(10),segmentTime:a.toString(10)});d.push({time:{from:a,to:a+e},url:t}),a+=e}p=a,h=Ys(s,{...i,segmentNumber:t.toString(10),segmentTime:a.toString(10)})}t={type:"template",baseUrl:_,segmentTemplateUrl:s,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!a||!y)continue;let x={video:"video",audio:"audio",text:"text"}[a];if(!x)continue;m||(m=x),r={id:b,kind:x,segmentReference:t,profiles:k,duration:g,bitrate:c,mime:y,codecs:C,width:n,height:d,fps:v,quality:f}}(k=v).language||(k.language=h),(T=v).label||(T.label=f),(E=v).mime||(E.mime=y),(x=v).codecs||(x.codecs=C),($=v).hdr||($.hdr="video"===m&&Bs(C)),v.representations.push(r)}if(m){let e=r[m].find((e=>e.id===v.id));if(e&&v.representations.every((e=>Ks(e.segmentReference))))for(let t of e.representations){let e=v.representations.find((e=>e.id===t.id))?.segmentReference,i=t.segmentReference;i.segments.push(...e.segments),i.nextSegmentBeyondManifest=e.nextSegmentBeyondManifest}else r[m].push(v)}}return{duration:g,streams:r,baseUrls:s,live:i}})(e??"",this.manifestUrlString)}catch(t){let i=Ja(e)??{id:"ManifestParsing",category:u.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&Lr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:a}=t.live,s=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";a||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let a=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r))),s=new Set(a.map((({codecs:e})=>e))),n=_n(s);if(n&&(r[e]=a.filter((({codecs:e})=>e.startsWith(n)))),"video"===e){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Ur.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...t,streams:r};return this.tracer.log("updateManifestEnd",(0,u.flattenObject)(a)),a}.bind(this)),this.initRepresentations=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,u.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,u.assertNonNullable)(this.manifest),(0,u.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,u.fromEvent)(e,"error").pipe((0,u.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource?Ir():new MediaSource;let a=document.createElement("source");if(r(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&Mr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new Zs("video",this.source,n,s),this.bufferManagers=[this.videoBufferManager],(0,u.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new Zs("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}pn.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new pn(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,u.merge)(...wn.map((e=>(0,u.fromEvent)(this.element,e)))).pipe((0,u.map)((e=>this.element?ja(this.element.buffered,1e3*this.element.currentTime):0)),(0,u.filterChanged)(),(0,u.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,u.merge)((0,u.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,u.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,u.now)()))),this.subscription.add((0,u.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,u.interval)(1e3).subscribe((e=>{let t=nr(this.manifestUrlString,2);this.manifestUrlString=sr(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,u.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,u.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,u.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||hn(this.element,1)}))),this.representationSubscription.add((0,u.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,u.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,u.filter)((({isLive:e})=>e)),(0,u.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,u.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+nr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,u.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,a=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,s=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>a&&(o=1+Math.sign(n)*s),hn(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,u.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,u.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,a=nr(this.manifestUrlString,2),s=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(s,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=s<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==a&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),s=this.normolizeLiveOffset(Math.trunc(a+i/r)),l=Math.abs(s-a),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=a:s>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=s),this.manifestUrlString=sr(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let l=(0,u.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,u.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),d=(0,u.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,u.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),c=(0,u.combine)({allBuffersFull:l,someBufferEnded:d}).pipe((0,u.filterChanged)(),(0,u.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,u.filter)((e=>e)));if(this.representationSubscription.add((0,u.merge)(this.forceEnded$,c).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,u.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,Xa.default)((0,Xa.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),Ks(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,u.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,u.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:u.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new rn({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=cn.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},kn=class{constructor(e,t){this.fov=e,this.orientation=t}},Tn=class{turnCamera(e=0,t=0,i=0){this.pointCameraTo(this.camera.orientation.x+e,this.camera.orientation.y+t,this.camera.orientation.z+i)}pointCameraTo(e=0,t=0,i=0){t=this.limitCameraRotationY(t);let r=e-this.camera.orientation.x,a=t-this.camera.orientation.y,s=i-this.camera.orientation.z;this.camera.orientation.x=e,this.camera.orientation.y=t,this.camera.orientation.z=i,this.lastCameraTurn={x:r,y:a,z:s},this.lastCameraTurnTS=Date.now()}setRotationSpeed(e,t,i){this.rotationSpeed.x=e??this.rotationSpeed.x,this.rotationSpeed.y=t??this.rotationSpeed.y,this.rotationSpeed.z=i??this.rotationSpeed.z}startRotation(){this.rotating=!0}stopRotation(e=!1){e?(this.setRotationSpeed(0,0,0),this.fadeStartSpeed=null):this.startFading(this.rotationSpeed.x,this.rotationSpeed.y,this.rotationSpeed.z),this.rotating=!1}onCameraRelease(){if(this.lastCameraTurn&&this.lastCameraTurnTS){let e=Date.now()-this.lastCameraTurnTS;if(e<this.options.speedFadeThreshold){let t=(1-e/this.options.speedFadeThreshold)*this.options.rotationSpeedCorrection;this.startFading(this.lastCameraTurn.x*t,this.lastCameraTurn.y*t,this.lastCameraTurn.z*t)}}}startFading(e,t,i){this.setRotationSpeed(e,t,i),this.fadeStartSpeed={...this.rotationSpeed},this.fading=!0}stopFading(){this.fadeStartSpeed=null,this.fading=!0,this.fadeTime=0}limitCameraRotationY(e){return Math.max(-this.options.maxYawAngle,Math.min(e,this.options.maxYawAngle))}tick(e){if(!this.lastTickTS)return this.lastTickTS=e,void(this.lastCameraTurnTS=Date.now());let t=e-this.lastTickTS,i=t/1e3;if(this.rotating)this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i);else if(this.fading&&this.fadeStartSpeed){let e=-this.fadeCorrection*(this.fadeTime/1e3)**2+1;this.setRotationSpeed(this.fadeStartSpeed.x*e,this.fadeStartSpeed.y*e,this.fadeStartSpeed.z*e),e>0?this.turnCamera(this.rotationSpeed.x*this.options.rotationSpeedCorrection*i,this.rotationSpeed.y*this.options.rotationSpeedCorrection*i,this.rotationSpeed.z*this.options.rotationSpeedCorrection*i):(this.stopRotation(!0),this.stopFading()),this.fadeTime=Math.min(this.fadeTime+t,this.options.speedFadeTime)}this.lastTickTS=e}constructor(e,t){this.rotating=!1,this.fading=!1,this.lastTickTS=0,this.lastCameraTurnTS=0,this.fadeStartSpeed=null,this.fadeTime=0,this.camera=e,this.options=t,this.rotationSpeed={x:0,y:0,z:0},this.fadeCorrection=1/(this.options.speedFadeTime/1e3)**2}},En=class{play(){this.active||(this.videoInitialized?this.doPlay():this.sourceVideoElement.readyState>=2?(this.videoInitialized=!0,this.doPlay()):this.sourceVideoElement.addEventListener("loadeddata",this.videoElementDataLoadedFn))}stop(){this.active=!1}startCameraManualRotation(e,t){this.cameraRotationManager.setRotationSpeed(e*this.params.rotationSpeed,t*this.params.rotationSpeed,0),this.cameraRotationManager.startRotation()}stopCameraManualRotation(e=!1){this.cameraRotationManager.stopRotation(e)}turnCamera(e,t){this.cameraRotationManager.turnCamera(e,t)}pointCameraTo(e,t){this.cameraRotationManager.pointCameraTo(e,t)}pixelToDegree(e){return{x:this.params.degreeToPixelCorrection*this.params.fov.x*-e.x/this.viewportWidth,y:this.params.degreeToPixelCorrection*this.params.fov.y*e.y/this.viewportHeight}}getCameraRotation(){return this.camera.orientation}holdCamera(){this.cameraRotationManager.stopRotation(!0)}releaseCamera(){this.cameraRotationManager.onCameraRelease()}destroy(){this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),this.stop(),this.canvas.remove()}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t,this.canvas.width=this.viewportWidth,this.canvas.height=this.viewportHeight,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}onDataLoadedHandler(){this.videoInitialized=!0,this.doPlay()}doPlay(){this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.active=!0,this.sourceVideoElement.removeEventListener("loadeddata",this.videoElementDataLoadedFn),requestAnimationFrame(this.renderFn)}render(e){this.cameraRotationManager.tick(e),this.updateTexture(),this.updateTextureMappingBuffer();let t=this.gl.getAttribLocation(this.program,"a_vertex"),i=this.gl.getAttribLocation(this.program,"a_texel"),r=this.gl.getUniformLocation(this.program,"u_texture"),a=this.gl.getUniformLocation(this.program,"u_focus");this.gl.enableVertexAttribArray(t),this.gl.enableVertexAttribArray(i),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexBuffer),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.vertexAttribPointer(i,2,this.gl.FLOAT,!1,0,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.uniform1i(r,0),this.gl.uniform2f(a,-this.camera.orientation.x,-this.camera.orientation.y),this.gl.drawArrays(this.gl.TRIANGLE_FAN,0,4),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disableVertexAttribArray(t),this.gl.disableVertexAttribArray(i),this.active&&requestAnimationFrame(this.renderFn)}createShader(e,t){let i=this.gl.createShader(t);if(!i)throw this.destroy(),new Error(`Could not create shader (${t})`);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS))throw this.destroy(),new Error("An error occurred while compiling the shader: "+this.gl.getShaderInfoLog(i));return i}createProgram(){let e=this.gl.createProgram();if(!e)throw this.destroy(),new Error("Could not create shader program");let t=this.createShader("attribute vec2 a_vertex;\nattribute vec2 a_texel;\n\nvarying vec2 v_texel;\n\nvoid main(void) {\n    // direct vertex drawing\n    gl_Position = vec4(a_vertex, 0.0, 1.0);\n    // save texel vector to pass to fragment shader\n    v_texel = a_texel;\n}\n",this.gl.VERTEX_SHADER),i=this.createShader("#ifdef GL_ES\n    precision highp float;\n    precision highp int;\n#else\n    precision highp float;\n#endif\n\n#define PI 3.14159265358979323846264\n\nvarying vec2 v_texel; // [0..1, 0..1]\n\nuniform sampler2D u_texture;\nuniform vec2 u_focus; // current central point [-180..180, -90..90] (degrees)\n\nvoid main(void) {\n    // center point of output projection\n    float lambda0 = u_focus.x / 360.0;\n    float phi0 = u_focus.y / 180.0;\n\n    float lambda = PI * 2.0 * (v_texel.x - 0.5 - lambda0); // [-pi..+pi] (rad)\n    float phi = PI * (v_texel.y - 0.5 - phi0); // [-pi/2..+pi/2] (rad)\n\n    float p = sqrt(lambda * lambda + phi * phi); // rou\n    float c = atan(p);\n    float cos_c = cos(c);\n    float sin_c = sin(c);\n\n    // geo coordinates of projection\n    float x = lambda0 + atan(\n        lambda * sin_c,\n        p * cos(phi0) * cos_c - phi * sin(phi0) * sin_c\n    );\n    float y = asin(cos_c * sin(phi0) + (phi * sin_c * cos(phi0)) / p);\n\n    // reprojected texture coordinates\n    vec2 tc = vec2(\n        mod(x / (PI * 2.0) - 0.5, 1.0), // [0..1]\n        mod(y / PI - 0.5, 1.0) // [0..1]\n    );\n\n    // sample using new coordinates\n    gl_FragColor = texture2D(u_texture, tc);\n}\n",this.gl.FRAGMENT_SHADER);if(this.gl.attachShader(e,t),this.gl.attachShader(e,i),this.gl.linkProgram(e),!this.gl.getProgramParameter(e,this.gl.LINK_STATUS))throw this.destroy(),new Error("Could not link shader program.");return e}createTexture(){let e=this.gl.createTexture();if(!e)throw this.destroy(),new Error("Could not create texture");return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.bindTexture(this.gl.TEXTURE_2D,null),e}updateTexture(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.videoTexture),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.sourceVideoElement),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}createVertexBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create vertex buffer");let t=1,i=1,r=this.frameHeight/(this.frameWidth/this.viewportWidth);return r>this.viewportHeight?t=this.viewportHeight/r:i=r/this.viewportHeight,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-t,-i,t,-i,t,i,-t,i]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),e}createTextureMappingBuffer(){let e=this.gl.createBuffer();if(!e)throw this.destroy(),new Error("Could not create texture mapping buffer");return e}calculateTexturePosition(){let e=.5-this.camera.orientation.x/360,t=.5-this.camera.orientation.y/180,i=this.camera.fov.x/360/2,r=this.camera.fov.y/180/2;return[e-i,t-r,e+i,t-r,e+i,t+r,e-i,t+r]}updateTextureMappingBuffer(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureMappingBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([...this.calculateTexturePosition()]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}updateFrameSize(){this.frameWidth=this.sourceVideoElement.videoWidth,this.frameHeight=this.sourceVideoElement.videoHeight}createCanvas(){let e=document.createElement("canvas");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="100%",e.style.height="100%",e}constructor(e,t,i){this.videoInitialized=!1,this.active=!1,this.container=e,this.sourceVideoElement=t,this.params=i,this.canvas=this.createCanvas();let r=this.canvas.getContext("webgl");if(!r)throw new Error("Could not initialize WebGL context");this.gl=r,this.container.appendChild(this.canvas),this.camera=new kn(this.params.fov,this.params.orientation),this.cameraRotationManager=new Tn(this.camera,{rotationSpeed:this.params.rotationSpeed,maxYawAngle:this.params.maxYawAngle,rotationSpeedCorrection:this.params.rotationSpeedCorrection,degreeToPixelCorrection:this.params.degreeToPixelCorrection,speedFadeTime:this.params.speedFadeTime,speedFadeThreshold:this.params.speedFadeThreshold}),this.updateFrameSize(),this.vertexBuffer=this.createVertexBuffer(),this.textureMappingBuffer=this.createTextureMappingBuffer(),this.updateTextureMappingBuffer(),this.program=this.createProgram(),this.videoTexture=this.createTexture(),this.gl.useProgram(this.program),this.videoElementDataLoadedFn=this.onDataLoadedHandler.bind(this),this.renderFn=this.render.bind(this)}},xn="stalls_manager_metrics",$n="stalls_manager_abr_params",Cn="stalls_manager_default_tuning_abr_params",An=class{init(e){this.currentStallDuration$=e.currentStallDuration$,this.videoLastDataObtainedTimestamp$=e.videoLastDataObtainedTimestamp$,this.throughput$=e.throughput$,this.rtt$=e.rtt$,this.tuning=e.tuning,this.abrParams=e.abrParams,this.resetStoredAbrParamsIfNeeded(),this.subscribe(e)}get videoMaxQualityLimit(){return this.maxQualityLimit}get predictedThroughput(){return this.predictedThroughputWithoutData}get abrTuningParams(){let e=this.tuning.enabled?this.getStoredData($n):{};return{...this.abrParams,...e}}set lastVideoTrackSelected(e){this.lastUniqueVideoTrackSelected?.id!==e.id&&(this.lastUniqueVideoTrackSelected=e,this.lastUniqueVideoTrackSelectedTimestamp=(0,u.now)(),this.currentStallsCount=0)}destroy(){window.clearTimeout(this.qualityRestrictionTimer),this.subscription.unsubscribe(),0!==this.currentStallDuration$.getValue()&&this.updateStallData();let e=((0,u.now)()-this.providerStartWatchingTimestamp-this.sumStallsDuration)/1e3,t=this.sumStallsDuration;this.addStallInfoToHistory(e,t),this.updateStoredAbrParams()}resetStoredAbrParamsIfNeeded(){let{bitrateFactorAtEmptyBuffer:e,bitrateFactorAtFullBuffer:t,containerSizeFactor:i}={...this.getStoredData(Cn)},{bitrateFactorAtEmptyBuffer:r,bitrateFactorAtFullBuffer:a,containerSizeFactor:s}={...this.abrParams};this.tuning.enabled&&e===r&&t===a&&i===s||(this.removeStoredData($n),this.setStoredData(Cn,{bitrateFactorAtEmptyBuffer:r,bitrateFactorAtFullBuffer:a,containerSizeFactor:s}))}updateStoredAbrParams(){let e=[],t=this.getStoredData(xn,"[]");if(!this.tuning.enabled||t.length<this.tuning.stallsMetricsHistoryLength)return;if(this.tuning.useTotalStallsDurationPerTvt){let i=t.reduce(((e,t)=>e+t.tvt),0),r=t.reduce(((e,t)=>e+t.stallsDuration),0)/i;e.push(this.calculateOptimalAbrParams(r))}if(this.tuning.useAverageStallsDurationPerTvt){let i=t.reduce(((e,t)=>e+t.stallsDurationPerTvt),0)/t.length;e.push(this.calculateOptimalAbrParams(i))}this.tuning.useEmaStallsDurationPerTvt&&e.push(this.calculateOptimalAbrParams(t[t.length-1].stallsDurationPerTvtSmoothed));let i={bitrateFactorAtEmptyBuffer:Math.max(...e.map((e=>e.bitrateFactorAtEmptyBuffer))),bitrateFactorAtFullBuffer:Math.max(...e.map((e=>e.bitrateFactorAtFullBuffer))),containerSizeFactor:Math.min(...e.map((e=>e.containerSizeFactor)))};this.setStoredData(xn,[]),this.setStoredData($n,i)}calculateOptimalAbrParams(e){let{targetStallsDurationPerTvt:t,deviationStallsDurationPerTvt:i,criticalStallsDurationPerTvt:r,abrAdjustingSpeed:a}=this.tuning,s=this.abrTuningParams;return e<t-i?s={bitrateFactorAtEmptyBuffer:Math.max(s.bitrateFactorAtEmptyBuffer-a,this.abrParams.minBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(s.bitrateFactorAtFullBuffer-a,this.abrParams.minBitrateFactorAtFullBuffer),containerSizeFactor:Math.min(s.containerSizeFactor+a,this.abrParams.maxContainerSizeFactor)}:e>t+i&&(s={bitrateFactorAtEmptyBuffer:Math.min(s.bitrateFactorAtEmptyBuffer+a,this.abrParams.maxBitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.min(s.bitrateFactorAtFullBuffer+a,this.abrParams.maxBitrateFactorAtFullBuffer),containerSizeFactor:Math.max(s.containerSizeFactor-a,this.abrParams.minContainerSizeFactor)}),e>r&&(s={bitrateFactorAtEmptyBuffer:Math.max(s.bitrateFactorAtEmptyBuffer,this.abrParams.bitrateFactorAtEmptyBuffer),bitrateFactorAtFullBuffer:Math.max(s.bitrateFactorAtFullBuffer,this.abrParams.bitrateFactorAtFullBuffer),containerSizeFactor:Math.min(s.containerSizeFactor,this.abrParams.containerSizeFactor)}),s}getStoredData(e,t="{}"){return JSON.parse(u.safeStorage.get(e)??t)}setStoredData(e,t){u.safeStorage.set(e,JSON.stringify(t))}removeStoredData(e){u.safeStorage.remove(e)}addStallInfoToHistory(e,t){if(e<this.tuning.minTvtToBeCounted||e>this.tuning.maxTvtToBeCounted||1e3*e<t)return;let i=this.getStoredData(xn,"[]"),r=t/e,a={tvt:e,stallsDuration:t,stallsDurationPerTvt:r,stallsDurationPerTvtSmoothed:i.length?sn(i[i.length-1].stallsDurationPerTvtSmoothed,t/e,this.tuning.emaAlpha):r};i.push(a),i.length>this.tuning.stallsMetricsHistoryLength&&i.shift(),this.setStoredData(xn,i)}updateStallData(){this.providerStartWatchingTimestamp&&!this.isSeeked$.getValue()&&(this.sumStallsDuration+=Math.min(this.lastStallDuration,this.tuning.maxPossibleStallDuration),this.currentStallsCount++)}subscribe(e){this.subscription.add(e.isSeeked$.subscribe(this.isSeeked$)),this.subscription.add(e.isBuffering$.subscribe(this.isBuffering$)),this.subscription.add(e.looped$.subscribe((e=>this.currentStallsCount=0))),this.subscription.add(e.playing$.pipe((0,u.once)()).subscribe((e=>this.providerStartWatchingTimestamp=(0,u.now)()))),this.subscription.add(this.currentStallDuration$.pipe((0,u.filterChanged)()).subscribe((e=>{let{stallDurationNoDataBeforeQualityDecrease:t,stallCountBeforeQualityDecrease:i,resetQualityRestrictionTimeout:r,ignoreStallsOnSeek:a}=this.tuning;if((0,u.isNullable)(this.lastUniqueVideoTrackSelected)||a&&this.isSeeked$.getValue())return;let s=this.rtt$.getValue(),n=this.throughput$.getValue(),o=this.videoLastDataObtainedTimestamp$.getValue(),l=(0,u.now)(),d=i&&this.currentStallsCount>=i,c=t&&l-this.lastUniqueVideoTrackSelectedTimestamp>=t+s&&l-o>=t+s&&e>=t;(d||c)&&(this.severeStallOccurred$.next(!0),window.clearTimeout(this.qualityRestrictionTimer),this.maxQualityLimit=this.lastUniqueVideoTrackSelected.quality,(0,u.isNonNullable)(this.lastUniqueVideoTrackSelected.bitrate)&&n>this.lastUniqueVideoTrackSelected.bitrate&&(this.predictedThroughputWithoutData=this.lastUniqueVideoTrackSelected.bitrate)),!e&&(0,u.now)()-this.providerStartWatchingTimestamp>this.lastStallDuration&&(this.updateStallData(),this.severeStallOccurred$.next(!1),window.clearTimeout(this.qualityRestrictionTimer),this.qualityRestrictionTimer=window.setTimeout((()=>{this.maxQualityLimit=void 0,this.predictedThroughputWithoutData=0}),r)),this.lastStallDuration=e})))}constructor(){this.isSeeked$=new u.ValueSubject(!1),this.isBuffering$=new u.ValueSubject(!1),this.maxQualityLimit=void 0,this.currentStallsCount=0,this.sumStallsDuration=0,this.lastStallDuration=0,this.providerStartWatchingTimestamp=0,this.lastUniqueVideoTrackSelectedTimestamp=0,this.predictedThroughputWithoutData=0,this.subscription=new u.Subscription,this.severeStallOccurred$=new u.ValueSubject(!1)}},Pn=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,u.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,u.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,u.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new u.Subscription,this.pipSize$=new u.ValueSubject(void 0),this.videoSize$=new u.ValueSubject(void 0),this.elementSize$=new u.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=u.noop}},Ln=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=Fr(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,a=t=>{e.error$.next({id:r,category:u.ErrorCategory.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:a,connect:(e,t)=>this.subscription.add(e.subscribe(t,a))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:a}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let s=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>"none"!==e.to.state)),(0,u.filterChanged)());this.stallsManager.init({isSeeked$:s,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$}),a(i.ended$,e.endedEvent$),a(i.looped$,e.loopedEvent$),a(i.error$,e.error$),a(i.isBuffering$,e.isBuffering$),a(i.currentBuffer$,e.currentBuffer$),a(i.playing$,e.firstFrameEvent$),a(i.canplay$,e.canplay$),a(i.inPiP$,e.inPiP$),a(i.inFullscreen$,e.inFullscreen$),a(i.loadedMetadata$,e.loadedMetadataEvent$),a(this.player.error$,e.error$),a(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),a(this.player.fetcherError$,e.fetcherError$),a(this.player.lastConnectionType$,e.httpConnectionType$),a(this.player.lastConnectionReused$,e.httpConnectionReused$),a(this.player.isLive$,e.isLive$),a(this.player.lastRequestFirstBytes$.pipe((0,u.filter)(u.isNonNullable),(0,u.once)()),e.firstBytesEvent$),a(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(vr(this.video,t.isLooped,r)),this.subscription.add(br(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(_r(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),a(Ba(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if((0,u.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(Ws(i));let e=[];for(let t of i.representations){let r=js(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push(qs(i));let e=[];for(let t of i.representations){let r=Fs({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=zs(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r)),this.subscription.add((0,u.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.fromEvent)(this.video,"progress")).pipe((0,u.filter)((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if(!(0,Fa.default)(["manifest_ready","running"],e)||i)return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState());let r=this.selectVideoAudioRepresentations();if(!r)return;let[a,s]=r,n=[...this.videoTracksMap.keys()].find((e=>this.videoTracksMap.get(e)?.representation.id===a.id));(0,u.isNonNullable)(n)&&(this.stallsManager.lastVideoTrackSelected=n);let o=this.params.desiredState.autoVideoTrackLimits.getTransition();if(o&&this.params.output.autoVideoTrackLimits$.next(o.to),"manifest_ready"===e)await this.player.initRepresentations(a.id,s?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",a.id),s){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",s.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=[...this.videoTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.videoStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.videoStream.setState(s.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(qs(a))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=[...this.audioTracksMap.entries()].find((([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.audioStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.audioStream.setState(s.to),e.currentAudioStream$.next(Ws(a))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let n=t.playbackState.stateChangeStarted$.pipe((0,u.map)((({to:e})=>"ready"===e)),(0,u.filterChanged)());this.subscription.add((0,u.merge)(n,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,u.merge)(n,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let o=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(o.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?da:ua,t=this.params.tuning.useNewAutoSelectVideoTrack?ba:va,i=this.params.tuning.useNewAutoSelectVideoTrack?ma:ga,{desiredState:r,output:a}=this.params,s=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=[...this.videoTracksMap.keys()].find((({id:e})=>e===n)),l=a.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=[...this.videoStreamsMap.keys()].find((({id:e})=>e===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=ja(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:s?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),g=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),v=[...this.audioStreamsMap.keys()].find((({id:e})=>e===g?.id))??this.audioStreamsMap.keys().next().value,b=0;if(v){if(o&&!s){let t=e(o,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let _=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}),y=s?_??o:o??_,w=v&&t(y,c,this.audioStreamsMap.get(v)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),S=this.videoTracksMap.get(y)?.representation,k=w&&this.audioTracksMap.get(w)?.representation;return S&&k?[S,k]:S&&!k&&0===this.audioTracksMap.size?[S,void 0]:void 0}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),fr(this.video),this.tracer.end()}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.droppedFramesManager=new Da,this.stallsManager=new An,this.elementSizeManager=new Pn,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new aa,this.audioTrackSwitchHistory=new aa,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&or(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new En(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new Sr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new Sn({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}},Mn=class extends Ln{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},In=class extends Ln{subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),a(i.timeUpdate$,t.liveBufferTime$),a(this.player.liveSeekableDuration$,t.duration$),a(this.player.liveLatency$,t.liveLatency$);let s=new u.ValueSubject(1);a(i.playbackRateState$,s),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,u.combine)({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,u.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add((0,u.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let a=t.liveBufferTime$.getValue(),s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;s||r<1-n||this.video.paused||(0,u.isNullable)(a)||(e=i-a)}))).add((0,u.combine)({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:a})=>{let s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!s&&!this.video.paused&&a>=1-n||(0,u.isNullable)(i)||(0,u.isNullable)(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},Rn=v(vi(),1),Dn=v(Te(),1),On=v(oi(),1),Bn=v(vi(),1),Nn=v(Jt(),1),Vn=!1;try{Vn=Ur.browser.isSafari&&!!Ur.browser.safariVersion&&Ur.browser.safariVersion<=18}catch(e){console.error(e)}var Un=class{async append(e,t){return(!t||!t.aborted)&&new Promise((i=>{let r={operation:"append",data:e,signal:t,callback:i};this.queue.push(r),this.pull()}))}async remove(e,t,i){return(!i||!i.aborted)&&new Promise((r=>{let a={operation:"remove",from:e,to:t,signal:i,callback:r};this.queue.unshift(a),this.pull()}))}async abort(e){return new Promise((t=>{let i,r=e=>{this.abortRequested=!1,t(e)};i=Vn&&e?{operation:"safariAbort",init:e,callback:r}:{operation:"abort",callback:r};for(let{callback:e}of this.queue)e(!1);this.abortRequested=!0,i&&(this.queue=[i]),this.pull()}))}destroy(){this.destroyed=!0,this.buffer.removeEventListener("updateend",this.completeTask),this.queue=[],this.currentTask=null;try{this.buffer.abort()}catch(e){if(!(e instanceof DOMException&&"InvalidStateError"===e.name))throw e}}pull(){if((this.buffer.updating||this.currentTask||this.destroyed)&&!this.abortRequested)return;let e=this.queue.shift();if(!e)return;if(e.signal?.aborted)return e.callback(!1),void this.pull();this.currentTask=e;let{operation:t}=this.currentTask;try{this.execute(this.currentTask)}catch(e){e instanceof DOMException&&"QuotaExceededError"===e.name&&"append"===t?this.bufferFull$.next(this.currentTask.data.byteLength):e instanceof DOMException&&"InvalidStateError"===e.name||this.error$.next({id:`BufferTaskQueue:${t}`,category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer operation failed",thrown:e}),this.currentTask.callback(!1),this.currentTask=null}this.currentTask&&"abort"===this.currentTask.operation&&this.completeTask()}execute(e){let{operation:t}=e;switch(t){case"append":this.buffer.appendBuffer(e.data);break;case"remove":this.buffer.remove(e.from/1e3,e.to/1e3);break;case"abort":this.buffer.abort();break;case"safariAbort":this.buffer.abort(),this.buffer.appendBuffer(e.init);break;default:(0,u.assertNever)(t)}}constructor(e){this.bufferFull$=new u.Subject,this.error$=new u.Subject,this.queue=[],this.currentTask=null,this.destroyed=!1,this.abortRequested=!1,this.completeTask=()=>{try{if(this.currentTask){let e=this.currentTask.signal?.aborted;this.currentTask.callback(!e),this.currentTask=null}this.queue.length&&this.pull()}catch(e){this.error$.next({id:"BufferTaskQueueUnknown",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Buffer appending or removal failed",thrown:e})}},this.buffer=e,this.buffer.addEventListener("updateend",this.completeTask)}},Fn=class{get id(){return this.type}get size(){return this.size32}scanForBoxes(e){return this.boxParser.parse(e)}readString(e,t="ascii"){let i=new TextDecoder(t).decode(new DataView(this.source.buffer,this.source.byteOffset+this.cursor,e));return this.cursor+=e,i}readUint8(){let e=this.source.getUint8(this.cursor);return this.cursor+=1,e}readUint16(){let e=this.source.getUint16(this.cursor);return this.cursor+=2,e}readUint32(){let e=this.source.getUint32(this.cursor);return this.cursor+=4,e}readUint64(){let e=this.source.getBigInt64(this.cursor);return this.cursor+=8,e}constructor(e,t){this.cursor=0,this.source=e,this.boxParser=t,this.children=[];let i=this.readUint32();this.type=this.readString(4),i>e.byteLength-e.byteOffset&&(this.size32=NaN);let r=this.size32?this.size32-8:void 0,a=e.byteOffset+this.cursor;this.size64=0,this.usertype=0,this.content=new DataView(e.buffer,a,r)}},jn=class extends Fn{},zn=class extends Fn{constructor(e,t){super(e,t);let i=this.readUint32();this.version=i>>>24,this.flags=16777215&i}},Wn=class extends zn{get earliestPresentationTime(){return this.earliestPresentationTime32}get firstOffset(){return this.firstOffset32}constructor(e,t){super(e,t),this.segments=[],this.referenceId=this.readUint32(),this.timescale=this.readUint32(),this.earliestPresentationTime32=this.readUint32(),this.firstOffset32=this.readUint32(),this.earliestPresentationTime64=0,this.firstOffset64=0,this.referenceCount=65535&this.readUint32();for(let e=0;e<this.referenceCount;e++){let e=this.readUint32(),t=e>>>31,i=e<<1>>>1,r=this.readUint32();e=this.readUint32();let a=e>>>28,s=e<<3>>>3;this.segments.push({referenceType:t,referencedSize:i,subsegmentDuration:r,SAPType:a,SAPDeltaTime:s})}}},qn={ftyp:class extends Fn{constructor(e,t){super(e,t),this.compatibleBrands=[],this.majorBrand=this.readString(4),this.minorVersion=this.readUint32();let i=this.size-this.cursor;for(;i;){let e=this.readString(4);this.compatibleBrands.push(e),i-=4}}},moov:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mvhd:class extends zn{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.timescale=this.readUint32(),this.duration=this.readUint32(),this.rate=this.readUint32(),this.volume=this.readUint16()}},moof:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdat:class extends Fn{constructor(e,t){super(e,t),this.data=this.content}},sidx:Wn,trak:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mdia:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},mfhd:class extends zn{constructor(e,t){super(e,t),this.sequenceNumber=this.readUint32()}},tkhd:class extends zn{constructor(e,t){super(e,t),this.creationTime=this.readUint32(),this.modificationTime=this.readUint32(),this.trackId=this.readUint32(),this.cursor+=4,this.duration=this.readUint32(),this.cursor+=8,this.layer=this.readUint16(),this.alternateGroup=this.readUint16(),this.cursor+=2,this.cursor+=2,this.matrix=[[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()],[this.readUint32(),this.readUint32(),this.readUint32()]],this.width=this.readUint32(),this.height=this.readUint32()}},traf:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},tfhd:class extends zn{constructor(e,t){super(e,t),this.trackId=this.readUint32(),1&this.flags&&(this.baseDataOffset=this.readUint64()),2&this.flags&&(this.sampleDescriptionIndex=this.readUint32()),8&this.flags&&(this.defaultSampleDuration=this.readUint32()),16&this.flags&&(this.defaultSampleSize=this.readUint32()),32&this.flags&&(this.defaultSampleFlags=this.readUint32())}},tfdt:class extends zn{get baseMediaDecodeTime(){return 1===this.version?this.baseMediaDecodeTime64:this.baseMediaDecodeTime32}constructor(e,t){super(e,t),this.baseMediaDecodeTime32=0,this.baseMediaDecodeTime64=BigInt(0),1===this.version?this.baseMediaDecodeTime64=this.readUint64():this.baseMediaDecodeTime32=this.readUint32()}},trun:class extends zn{constructor(e,t){super(e,t),this.sampleDuration=[],this.sampleSize=[],this.sampleFlags=[],this.sampleCompositionTimeOffset=[],this.optionalFields=0,this.sampleCount=this.readUint32(),1&this.flags&&(this.dataOffset=this.readUint32()),4&this.flags&&(this.firstSampleFlags=this.readUint32());for(let e=0;e<this.sampleCount;e++)256&this.flags&&this.sampleDuration.push(this.readUint32()),512&this.flags&&this.sampleSize.push(this.readUint32()),1024&this.flags&&this.sampleFlags.push(this.readUint32()),2048&this.flags&&this.sampleCompositionTimeOffset.push(this.readUint32())}},minf:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},sv3d:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},st3d:class extends zn{constructor(e,t){switch(super(e,t),this.readUint8()){case 0:this.stereoMode=0;break;case 1:this.stereoMode=1;break;case 2:this.stereoMode=2;break;case 3:this.stereoMode=3;break;case 4:this.stereoMode=4}this.cursor+=1}},prhd:class extends zn{constructor(e,t){super(e,t),this.poseYawDegrees=this.readUint32(),this.posePitchDegrees=this.readUint32(),this.poseRollDegrees=this.readUint32()}},proj:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},equi:class extends zn{constructor(e,t){super(e,t),this.projectionBoundsTop=this.readUint32(),this.projectionBoundsBottom=this.readUint32(),this.projectionBoundsLeft=this.readUint32(),this.projectionBoundsRight=this.readUint32()}},uuid:class extends Fn{constructor(e,t){super(e,t),this.ondemandPrefix="ondemandlivejson",this.ondemandDataReceivedKey="t-in",this.ondemandDataPreparedKey="t-out";let i=this.content.byteOffset,r=i+this.content.byteLength,a=new TextDecoder("ascii").decode(this.content.buffer.slice(i,r)).split(this.ondemandPrefix)[1],s=JSON.parse(a);this.serverDataReceivedTimestamp=s[this.ondemandDataReceivedKey],this.serverDataPreparedTime=s[this.ondemandDataPreparedKey]}},stbl:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(this.content)}},stsd:class extends zn{constructor(e,t){super(e,t),this.entryCount=this.readUint32(),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+8,this.content.byteLength-8))}},avc1:class extends Fn{constructor(e,t){super(e,t),this.children=this.scanForBoxes(new DataView(this.content.buffer,this.content.byteOffset+78,this.content.byteLength-78))}},unknown:jn},Hn=class e{parse(e){let t=[],i=this.options.offset;for(;i<e.byteLength;)try{let r=new TextDecoder("ascii").decode(new DataView(e.buffer,e.byteOffset+i+4,4)),a=this.createBox(r,new DataView(e.buffer,e.byteOffset+i,e.byteLength-i));if(!a.size)break;t.push(a),i+=a.size}catch{break}return t}createBox(t,i){let r=qn[t];return r?new r(i,new e):new jn(i,new e)}constructor(e={}){this.options={offset:0,...e}}},Kn=class{indexBoxLevel(e){e.forEach((e=>{var t,i;(t=this.index)[i=e.type]??(t[i]=[]),this.index[e.type].push(e),e.children.length>0&&this.indexBoxLevel(e.children)}))}find(e){return this.index[e]&&this.index[e][0]?this.index[e][0]:null}findAll(e){return this.index[e]||[]}constructor(e){this.index={},this.indexBoxLevel(e)}},Qn=new TextDecoder("ascii"),Gn={validateData:e=>"ftyp"===Qn.decode(new DataView(e.buffer,e.byteOffset+4,4)),parseInit:e=>{let t={is3dVideo:!1,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}},i=(new Hn).parse(e),r=new Kn(i);if(r.find("sv3d")){t.is3dVideo=!0;let e=r.find("st3d");e&&(t.stereoMode=e.stereoMode);let i=r.find("prhd");i&&(t.projectionData.pose.yaw=i.poseYawDegrees,t.projectionData.pose.pitch=i.posePitchDegrees,t.projectionData.pose.roll=i.poseRollDegrees);let a=r.find("equi");a&&(t.projectionData.bounds.top=a.projectionBoundsTop,t.projectionData.bounds.right=a.projectionBoundsRight,t.projectionData.bounds.bottom=a.projectionBoundsBottom,t.projectionData.bounds.left=a.projectionBoundsLeft)}return t},getIndexRange:()=>{},parseSegments:e=>{let t=new Wn(e,new Hn),i=t.earliestPresentationTime/t.timescale*1e3,r=e.byteOffset+e.byteLength+t.firstOffset;return t.segments.map((e=>{if(0!==e.referenceType)throw new Error("Unsupported multilevel sidx");let a=e.subsegmentDuration/t.timescale*1e3,s={status:"none",time:{from:i,to:i+a},byte:{from:r,to:r+e.referencedSize-1}};return i+=a,r+=e.referencedSize,s}))},parseFeedableSegmentChunk:(e,t)=>{let i=(new Hn).parse(e),r=new Kn(i),a=r.findAll("moof"),s=t?r.findAll("uuid"):r.findAll("mdat");if(!s.length||!a.length)return null;let n=a[0],o=s[s.length-1],l=n.source.byteOffset,u=o.source.byteOffset-n.source.byteOffset+o.size;return new DataView(e.buffer,l,u)},getChunkEndTime:(e,t)=>{let i=(new Hn).parse(e),r=new Kn(i).findAll("traf"),a=r[r.length-1].children.find((e=>"tfhd"===e.type)),s=r[r.length-1].children.find((e=>"tfdt"===e.type)),n=r[r.length-1].children.find((e=>"trun"===e.type)),o=0;return o=n.sampleDuration.length?n.sampleDuration.reduce(((e,t)=>e+t),0):a.defaultSampleDuration*n.sampleCount,(Number(s.baseMediaDecodeTime)+o)/t*1e3},getServerLatencyTimestamps:e=>{let t=(new Hn).parse(e),i=new Kn(t).findAll("uuid");return i.length?i[i.length-1]:{}},getTimescaleFromIndex:e=>{let t=(new Hn).parse(e);return new Kn(t).find("sidx")?.timescale}},Yn=v(Te(),1),Xn={440786851:{type:"master"},17030:{type:"uint"},17143:{type:"uint"},17138:{type:"uint"},17139:{type:"uint"},17026:{type:"string"},17031:{type:"uint"},17029:{type:"uint"},236:{type:"binary"},408125543:{type:"master"},290298740:{type:"master"},19899:{type:"master"},21419:{type:"binary"},21420:{type:"uint"},357149030:{type:"master"},2807729:{type:"uint"},17545:{type:"float"},374648427:{type:"master"},174:{type:"master"},224:{type:"master"},30320:{type:"master"},30321:{type:"uint"},30322:{type:"master"},272869232:{type:"master"},524531317:{type:"master"},231:{type:"uint"},22612:{type:"master"},22743:{type:"uint"},167:{type:"uint"},171:{type:"uint"},163:{type:"binary"},160:{type:"master"},175:{type:"binary"},423732329:{type:"master"},307544935:{type:"master"},475249515:{type:"master"},187:{type:"master"},179:{type:"uint"},183:{type:"master"},247:{type:"uint"},241:{type:"uint"},240:{type:"uint"},178:{type:"uint"},21368:{type:"uint"},234:{type:"uint"},219:{type:"master"},150:{type:"uint"}},Zn=e=>{let t=e.getUint8(0),i=0;128&t?i=1:64&t?i=2:32&t?i=3:16&t&&(i=4);let r=Jn(e,i),a=r in Xn,s=a?Xn[r].type:"binary",n=e.getUint8(i),o=0;128&n?o=1:64&n?o=2:32&n?o=3:16&n?o=4:8&n?o=5:4&n?o=6:2&n?o=7:1&n&&(o=8);let l,u=new DataView(e.buffer,e.byteOffset+i+1,o-1),d=(n&255>>o)*2**(8*(o-1))+Jn(u),c=i+o;return l=c+d>e.byteLength?new DataView(e.buffer,e.byteOffset+c):new DataView(e.buffer,e.byteOffset+c,d),{tag:a?r:"0x"+r.toString(16).toUpperCase(),type:s,tagHeaderSize:c,tagSize:c+d,value:l,valueSize:d}},Jn=(e,t=e.byteLength)=>{switch(t){case 1:return e.getUint8(0);case 2:return e.getUint16(0);case 3:return 65536*e.getUint8(0)+e.getUint16(1);case 4:return e.getUint32(0);case 5:return e.getUint8(0)*2**32+e.getUint32(1);case 6:return e.getUint16(0)*2**32+e.getUint32(2);case 7:{let t=281474976710656*e.getUint8(0)+4294967296*e.getUint16(1)+e.getUint32(3);if(Number.isSafeInteger(t))return t}case 8:throw new ReferenceError("Int64 is not supported")}return 0},eo=(e,t)=>{switch(t){case"int":return e.getInt8(0);case"uint":return Jn(e);case"float":return 4===e.byteLength?e.getFloat32(0):e.getFloat64(0);case"string":return new TextDecoder("ascii").decode(e);case"utf8":return new TextDecoder("utf-8").decode(e);case"date":return new Date(Date.UTC(2001,0)+e.getInt8(0)).getTime();case"master":case"binary":return e;default:(0,u.assertNever)(t)}},to=(e,t)=>{let i=0;for(;i<e.byteLength;){let r=new DataView(e.buffer,e.byteOffset+i),a=Zn(r);if(!t(a))return;"master"===a.type&&to(a.value,t),i=a.value.byteOffset-e.byteOffset+a.valueSize}},io=[357149030,290298740,374648427,174,224,30320,30321,30322,272869232,524531317,475249515,423732329,307544935],ro=[231,22612,22743,167,171,163,160,175],ao={validateData:e=>{if(440786851!==e.getUint32(0))return!1;let t,i,r,a=Zn(e);return to(a.value,(({tag:e,type:a,value:s})=>(17143===e?t=eo(s,a):17026===e?i=eo(s,a):17029===e&&(r=eo(s,a)),!0))),(void 0===t||t<=1)&&void 0!==i&&"webm"===i&&(void 0===r||r<=2)},parseInit:e=>{let t,i,r,a,s,n,o=!1,l=!1,d=!1,c=!1;return to(e,(({tag:e,type:u,value:h,valueSize:p})=>{if(21419===e){let e=eo(h,u);n=Jn(e)}else 21420!==e&&(n=void 0);return 408125543===e?(t=h.byteOffset,i=h.byteOffset+p):357149030===e?o=!0:290298740===e?l=!0:2807729===e?r=eo(h,u):17545===e?a=eo(h,u):21420===e&&475249515===n?s=eo(h,u):374648427===e?to(h,(({tag:e,type:t,value:i})=>30321!==e||(c=1===eo(i,t),!1))):o&&l&&(0,Yn.default)(io,e)&&(d=!0),!d})),(0,u.assertNonNullable)(t,"Failed to parse webm Segment start"),(0,u.assertNonNullable)(i,"Failed to parse webm Segment end"),(0,u.assertNonNullable)(a,"Failed to parse webm Segment duration"),r=r??1e6,{segmentStart:Math.round(t/1e9*r*1e3),segmentEnd:Math.round(i/1e9*r*1e3),timeScale:r,segmentDuration:Math.round(a/1e9*r*1e3),cuesSeekPosition:s,is3dVideo:c,stereoMode:0,projectionType:1,projectionData:{pose:{yaw:0,pitch:0,roll:0},bounds:{top:0,bottom:0,left:0,right:0}}}},getIndexRange:e=>{if((0,u.isNullable)(e.cuesSeekPosition))return;let t=e.segmentStart+e.cuesSeekPosition;return{from:t,to:t+1048576}},parseSegments:(e,t)=>{let i,r=!1,a=!1,s=e=>(0,u.isNonNullable)(e.time)&&(0,u.isNonNullable)(e.position),n=[];return to(e,(({tag:e,type:t,value:o})=>{switch(e){case 475249515:r=!0;break;case 187:i&&s(i)&&n.push(i),i={};break;case 179:i&&(i.time=eo(o,t));break;case 183:break;case 241:i&&(i.position=eo(o,t));break;default:r&&(0,Yn.default)(io,e)&&(a=!0)}return!(r&&a)})),i&&s(i)&&n.push(i),n.map(((e,i)=>{let{time:r,position:a}=e,s=n[i+1];return{status:"none",time:{from:r,to:s?s.time:t.segmentDuration},byte:{from:t.segmentStart+a,to:s?t.segmentStart+s.position-1:t.segmentEnd-1}}}))},parseFeedableSegmentChunk:e=>{let t=0,i=!1;try{to(e,(r=>524531317===r.tag?r.tagSize<=e.byteLength?(t=r.tagSize,!1):(t+=r.tagHeaderSize,!0):!!(0,Yn.default)(ro,r.tag)&&(t+r.tagSize<=e.byteLength&&(t+=r.tagSize,i||(i=(0,Yn.default)([163,160,175],r.tag))),!0)))}catch{}return t>0&&t<=e.byteLength&&i?new DataView(e.buffer,e.byteOffset,t):null}},so=e=>{let t=/^(.+)\/([^;]+)(?:;.*)?$/.exec(e);if(t){let[,e,i]=t;if("audio"===e||"video"===e)switch(i){case"webm":return ao;case"mp4":return Gn}}throw new ReferenceError(`Unsupported mime type ${e}`)},no=v(Bi(),1),oo=v(Oe(),1),lo=v(Wi(),1),uo=v(oi(),1),co=v(ri(),1),ho=e=>{try{let t=function(){let e="(?<extlang>(?:[a-z]{3}(?:-[a-z]{3}){0,2}))",t="x(?:-[a-z0-9]{1,8})+",i=`^(?:(?<langtag>\n    (?<language>(?:[a-z]{2,3}(?:-${e})?|[a-z]{4}|[a-z]{5,8}))\n    (-(?<script>[a-z]{4}))?\n    (-(?<region>(?:[a-z]{2}|[0-9]{3})))?\n    (?<variants>(?:-(?:[a-z0-9]{5,8}|[0-9][a-z0-9]{3}))*)\n    (?<extensions>(?:-[0-9a-wy-z](?:-[a-z0-9]{2,8})+)*)\n    (?:-(?<privateuse>(?:${t})))?\n  )|(?<privateuse2>${t}))$`.replace(/[\s\t\n]/g,"");return new RegExp(i,"i")}(),i=e.match(t),{groups:r}=i??{};if(r){let e={};if(r.extensions){let t=r.extensions.toLowerCase().match(/(?:[0-9a-wy-z](?:-[a-z0-9]{2,8})+)/g);Array.from(t||[]).forEach((t=>{e[t[0]]=t.slice(2)}))}let t=r.variants?.split(/-/).filter((e=>""!==e)),i={extlang:r.extlang,langtag:r.langtag,language:r.language,privateuse:r.privateuse||r.privateuse2,region:r.region,script:r.script,extensions:e,variants:t};return Object.keys(i).forEach((e=>{let t=i[e];(typeof t>"u"||""===t)&&delete i[e]})),i}return null}catch{return null}};var po=v(oi(),1),fo=({id:e,width:t,height:i,bitrate:r,fps:a,quality:s,streamId:n})=>{let o=(s?jr(s):void 0)??(0,u.videoSizeToQuality)({width:t,height:i});return o&&{id:e,quality:o,bitrate:r,size:{width:t,height:i},fps:a,streamId:n}},mo=({id:e,bitrate:t})=>({id:e,bitrate:t}),go=({language:e,label:t},{id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}),vo=({id:e,language:t,label:i,codecs:r,isDefault:a})=>({id:e,language:t,label:i,codec:(0,po.default)(r.split("."),0),isDefault:a}),bo=({id:e,language:t,label:i,hdr:r,codecs:a})=>({id:e,language:t,hdr:r,label:i,codec:(0,po.default)(a.split("."),0)}),_o=e=>"url"in e,yo=e=>"template"===e.type,wo=e=>e instanceof DOMException&&("AbortError"===e.name||20===e.code),So=(e,t)=>{for(let i of e)if(t(i))return i;return null},ko=e=>{if(!e?.startsWith("P"))return;let t=(e,t)=>{let i=e?parseFloat(e.replace(",",".")):NaN;return(isNaN(i)?0:i)*t},i=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/.exec(e),r="-"===i?.[1]?-1:1;return 24*t(i?.[5],r)*60*60*1e3+60*t(i?.[6],r)*60*1e3+60*t(i?.[7],r)*1e3+1e3*t(i?.[8],r)},To=(e,t)=>{let i=e;i=(0,no.default)(i,"$$","$");let r={RepresentationID:t.representationId,Number:t.segmentNumber,Bandwidth:t.bandwidth,Time:t.segmentTime};for(let[e,t]of(0,oo.default)(r)){let r=new RegExp(`\\$${e}(?:%0(\\d+)d)?\\$`,"g");i=(0,no.default)(i,r,((e,i)=>(0,u.isNullable)(t)?e:(0,u.isNullable)(i)?t:(0,lo.default)(t,parseInt(i,10),"0")))}return i},Eo=e=>{let t=[];for(let i=0;i<e.length;i++){let r=Math.floor(1e3*e.start(i)),a=Math.ceil(1e3*e.end(i));t.push(r,a)}return t},xo=class{updateend(){if(!Xs(this.mediaSource,this.sourceBuffer))return;let{prevRanges:e}=this,t=Eo(this.sourceBuffer.buffered);this.prevRanges=t,this.isRangesRemoved(e,t)&&(this.lastUpdateTs=Date.now())}isRangesRemoved(e,t){if(e.length!==t.length)return!0;for(let i=0;i<e.length;i+=2){let r=e[i],a=e[i+1],s=t[i],n=t[i+1];if(s>r||n<a)return!0}return!1}wasUpdated(){let{lastCallTs:e,lastUpdateTs:t}=this;return this.lastCallTs=Date.now(),e<=t}destroy(){this.subscription.unsubscribe()}constructor(e,t){this.lastUpdateTs=0,this.lastCallTs=0,this.prevRanges=[],this.subscription=new u.Subscription,this.mediaSource=e,this.sourceBuffer=t,this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>this.updateend())))}},$o=class{switchToWithPreviousAbort(e,t=!1){!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId||(this.switchAbortController.abort(),this.switchAbortController=new Ya,(0,u.abortable)(this.switchAbortController.signal,async function*(e,t=!1){this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=this.forwardBufferTarget,yield this.pruneBuffer(t,1/0,!0)),this.downloadingRepresentationId=e,this.switchingToRepresentationId=void 0}this.maintain()}}.bind(this))(e,t))}warmUpMediaSource(){!(0,u.isNullable)(this.sourceBuffer)&&!this.sourceBuffer.updating&&(this.sourceBuffer.mode="segments")}async abort(){for(let e of this.activeSegments)this.abortSegment(e.segment);return this.activeSegments.clear(),this.downloadAbortController.abort(),this.downloadAbortController=new Ya,this.abortBuffer()}maintain(e=this.getCurrentPosition()){if((0,u.isNullable)(e)||(0,u.isNullable)(this.downloadingRepresentationId)||(0,u.isNullable)(this.playingRepresentationId)||(0,u.isNullable)(this.sourceBuffer)||!Xs(this.mediaSource,this.sourceBuffer)||(0,u.isNonNullable)(this.switchingToRepresentationId)||this.isSeekingLive)return;let t=this.representations.get(this.downloadingRepresentationId),i=this.segments.get(this.downloadingRepresentationId);if((0,u.assertNonNullable)(t,`No such representation ${this.downloadingRepresentationId}`),!i)return;let r=i.find((t=>e>=t.time.from&&e<t.time.to));(0,u.isNonNullable)(r)&&isFinite(r.time.from)&&isFinite(r.time.to)&&this.currentSegmentLength$.next(r?.time.to-r.time.from);let a=e;if(this.playingRepresentationId!==this.downloadingRepresentationId){let t=ja(this.sourceBuffer.buffered,e),i=r?r.time.to+100:-1/0;r&&r.time.to-e<this.tuning.dash.maxSegmentDurationLeftToSelectNextSegment&&t>=r.time.to-e+100&&(a=i)}if(isFinite(this.bufferLimit)&&cs(this.sourceBuffer.buffered)>=this.bufferLimit){let t=ja(this.sourceBuffer.buffered,e),i=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;return void this.pruneBuffer(e,1/0,t<i).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}let s=null;if(!this.activeSegments.size&&(s=this.selectForwardBufferSegments(i,t.segmentReference.type,a),s?.length)){let e="auto";if(this.tuning.dash.useFetchPriorityHints&&r)if((0,Dn.default)(s,r))e="high";else{let t=(0,On.default)(s,0);t&&t.time.from-r.time.to>=this.forwardBufferTarget/2&&(e="low")}this.loadSegments(s,t,e).catch((e=>{this.handleAsyncError(e,"loadSegments")}))}(!this.preloadOnly&&!this.allInitsLoaded&&r&&"fed"===r.status&&!s?.length&&ja(this.sourceBuffer.buffered,e)>3e3||this.isActiveLowLatency())&&this.loadNextInit();let n=(0,On.default)(i,-1);!this.isLive&&n&&(this.fullyBuffered$.next(n.time.to-e-ja(this.sourceBuffer.buffered,e)<100),this.onLastSegment$.next(e-n.time.from>0))}get lastDataObtainedTimestamp(){return this.lastDataObtainedTimestampMs}searchGaps(e,t){this.gaps=[];let i=0,r=this.isLive?this.liveInitialAdditionalOffset:0;for(let a of e)Math.trunc(a.time.from-i)>0&&this.gaps.push({representation:t.id,from:i,to:a.time.from+r,persistent:!0}),i=a.time.to;(0,u.isNonNullable)(t.duration)&&t.duration-i>0&&!this.isLive&&this.gaps.push({representation:t.id,from:i,to:t.duration,persistent:!0})}getActualLiveStartingSegments(e){let t=e.segments,i=this.isActiveLowLatency()?this.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.tuning.dashCmafLive.maxActiveLiveOffset,r=[],a=0,s=t.length-1;do{r.unshift(t[s]),a+=t[s].time.to-t[s].time.from,s--}while(a<i&&s>=0);return this.liveInitialAdditionalOffset=a-i,this.isActiveLowLatency()?[r[0]]:r}getLiveSegmentsToLoadState(e){let t=(0,Bn.default)(e?.streams[this.kind],(e=>e.representations)).find((e=>e.id===this.downloadingRepresentationId));if(!t)return;let i=this.segments.get(t.id);return i?.length?{from:i[0].time.from,to:i[i.length-1].time.to}:void 0}updateLive(e){let t=(0,Bn.default)(e?.streams[this.kind],(e=>e.representations))??[];if(![...this.segments.values()].every((e=>!e.length)))for(let e of t){if(!e||!yo(e.segmentReference))return;let t=e.segmentReference.segments.map((e=>({...e,status:"none",size:void 0}))),i=100,r=this.segments.get(e.id)??[],a=(0,On.default)(r,-1)?.time.to??0,s=t?.findIndex((e=>a>=e.time.from+i&&a<=e.time.to+i));if(-1===s){this.liveUpdateSegmentIndex=0;let t=this.getActualLiveStartingSegments(e.segmentReference);this.segments.set(e.id,t)}else{let i=t.slice(s+1);this.segments.set(e.id,[...r,...i])}}}proceedLowLatencyLive(){let e=this.downloadingRepresentationId;(0,u.assertNonNullable)(e);let t=this.segments.get(e);if(t?.length){let e=t[t.length-1];this.updateLowLatencyLiveIfNeeded(e)}}updateLowLatencyLiveIfNeeded(e){let t=0;for(let i of this.representations.values()){let r=i.segmentReference;if(!yo(r))return;let a=this.segments.get(i.id);if(!a)continue;let s=a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.from)));if(s&&!isFinite(s.time.to)&&(s.time.to=e.time.to,t=s.time.to-s.time.from),!a.find((t=>Math.floor(t.time.from)===Math.floor(e.time.to)))&&this.isActiveLowLatency()){let t=Math.round(e.time.to*r.timescale/1e3).toString(10),i=To(r.segmentTemplateUrl,{segmentTime:t});a.push({status:"none",time:{from:e.time.to,to:1/0},url:i})}}this.currentLowLatencySegmentLength$.next(t)}findSegmentStartTime(e){let t=this.switchingToRepresentationId??this.downloadingRepresentationId??this.playingRepresentationId;if(!t)return;let i=this.segments.get(t);return i?i.find((t=>t.time.from<=e&&t.time.to>=e))?.time.from??void 0:void 0}setTarget(e){this.forwardBufferTarget=e}setPreloadOnly(e){this.preloadOnly=e}destroy(){if(this.initData.clear(),this.segments.clear(),this.parsedInitData.clear(),this.representations.clear(),this.sourceBufferTaskQueue?.destroy(),this.sourceBufferBufferedDiff?.destroy(),this.gapDetectionIdleCallback&&os&&os(this.gapDetectionIdleCallback),this.initLoadIdleCallback&&os&&os(this.initLoadIdleCallback),this.subscription.unsubscribe(),this.sourceBuffer)try{this.mediaSource.removeSourceBuffer(this.sourceBuffer)}catch(e){if(!(e instanceof DOMException&&"NotFoundError"===e.name))throw e}this.sourceBuffer=null,this.downloadAbortController.abort(),this.switchAbortController.abort(),this.destroyAbortController.abort(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}selectForwardBufferSegments(e,t,i){return this.checkEjectedSegments(),this.isLive?this.selectForwardBufferSegmentsLive(e,i):this.selectForwardBufferSegmentsRecord(e,t,i)}selectForwardBufferSegmentsLive(e,t){if(this.playingRepresentationId!==this.downloadingRepresentationId){let i=e.findIndex((e=>t>=e.time.from&&t<e.time.to));this.liveUpdateSegmentIndex=i}return this.liveUpdateSegmentIndex<e.length?e.slice(this.liveUpdateSegmentIndex++):null}selectForwardBufferSegmentsRecord(e,t,i){let r=e.findIndex((({status:e,time:{from:t,to:r}},a)=>{let s=t>i||t<=i&&r>=i||0===a&&0===i,n=Math.min(this.forwardBufferTarget,this.bufferLimit),o=this.preloadOnly&&t<=i+n||r<=i+n;return("none"===e||"partially_ejected"===e&&s&&o&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&!(es(this.sourceBuffer.buffered,t)&&es(this.sourceBuffer.buffered,r)))&&s&&o}));if(-1===r)return null;if("byteRange"!==t)return e.slice(r,r+1);let a=e,s=0,n=0,o=[],l=this.preloadOnly?0:this.tuning.dash.segmentRequestSize,u=this.preloadOnly?this.forwardBufferTarget:0;for(let e=r;e<a.length&&(s<=l||n<=u);e++){let t=a[e];if(s+=t.byte.to+1-t.byte.from,n+=t.time.to+1-t.time.from,"none"!==t.status&&"partially_ejected"!==t.status)break;o.push(t)}return o}async loadSegments(e,t,i="auto"){yo(t.segmentReference)?await this.loadTemplateSegment(e[0],t,i):await this.loadByteRangeSegments(e,t,i)}async loadTemplateSegment(e,t,i="auto"){e.status="downloading";let r={segment:e,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id};this.activeSegments.add(r);let{range:a,url:s,signal:n,onProgress:o,onProgressTasks:l}=this.prepareTemplateFetchSegmentParams(e,t);this.failedDownloads&&n&&(await(0,u.abortable)(n,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))(),n.aborted&&this.abortActiveSegments([e]));try{let e=await this.fetcher.fetch(s,{range:a,signal:n,onProgress:o,priority:i,isLowLatency:this.isActiveLowLatency()});if(this.lastDataObtainedTimestampMs=(0,u.now)(),!e)return;let d=new DataView(e),c=so(t.mime);if(!isFinite(r.segment.time.to)){let e=t.segmentReference.timescale;r.segment.time.to=c.getChunkEndTime(d,e)}o&&r.feedingBytes&&l?await Promise.all(l):await this.sourceBufferTaskQueue.append(d,n);let{serverDataReceivedTimestamp:h,serverDataPreparedTime:p}=c.getServerLatencyTimestamps(d);h&&p&&this.currentLiveSegmentServerLatency$.next(p-h),r.segment.status="downloaded",this.onSegmentFullyAppended(r,t.id),this.failedDownloads=0}catch(t){this.abortActiveSegments([e]),wo(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}updateRepresentationsBaseUrlIfNeeded(){if(!this.tuning.dash.enableBaseUrlSupport||!this.baseUrls.length||this.failedDownloads<=this.tuning.dash.maxSegmentRetryCount)return;this.baseUrlsIndex=(this.baseUrlsIndex+1)%this.baseUrls.length;let e=this.baseUrls[this.baseUrlsIndex];for(let t of this.representations.values())yo(t.segmentReference)?t.segmentReference.baseUrl=e:t.segmentReference.url=e}async loadByteRangeSegments(e,t,i="auto"){if(!e.length)return;for(let i of e)i.status="downloading",this.activeSegments.add({segment:i,loadedBytes:0,feedingBytes:0,fedBytes:0,representationId:t.id});let{range:r,url:a,signal:s,onProgress:n}=this.prepareByteRangeFetchSegmentParams(e,t);this.failedDownloads&&s&&(await(0,u.abortable)(s,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>{this.loadByteRangeSegmentsTimeoutId=window.setTimeout(t,e),(0,u.fromEvent)(window,"online").pipe((0,u.once)()).subscribe((()=>{t(),window.clearTimeout(this.loadByteRangeSegmentsTimeoutId)}))}))}.bind(this))(),s.aborted&&this.abortActiveSegments(e));try{await this.fetcher.fetch(a,{range:r,onProgress:n,signal:s,priority:i}),this.lastDataObtainedTimestampMs=(0,u.now)(),this.failedDownloads=0}catch(t){this.abortActiveSegments(e),wo(t)||(this.failedDownloads++,this.updateRepresentationsBaseUrlIfNeeded())}}prepareByteRangeFetchSegmentParams(e,t){if(yo(t.segmentReference))throw new Error("Representation is not byte range type");let i=t.segmentReference.url,r={from:(0,On.default)(e,0).byte.from,to:(0,On.default)(e,-1).byte.to},{signal:a}=this.downloadAbortController;return{url:i,range:r,signal:a,onProgress:async(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)(),await this.onSomeByteRangesDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),globalFrom:r?r.from:0,representationId:t.id})}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}}}prepareTemplateFetchSegmentParams(e,t){if(!yo(t.segmentReference))throw new Error("Representation is not template type");let i=new URL(e.url,t.segmentReference.baseUrl);this.isActiveLowLatency()&&i.searchParams.set("low-latency","yes");let r=i.toString(),{signal:a}=this.downloadAbortController,s=[],n=this.isActiveLowLatency()||this.tuning.dash.enableSubSegmentBufferFeeding&&this.liveUpdateSegmentIndex<3?(e,i)=>{if(!a.aborted)try{this.lastDataObtainedTimestampMs=(0,u.now)();let r=this.onSomeTemplateDataLoaded({dataView:e,loaded:i,signal:a,onSegmentAppendFailed:()=>this.abort(),representationId:t.id});s.push(r)}catch(e){this.error$.next({id:"SegmentFeeding",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Error when feeding segments",thrown:e})}}:void 0;return{url:r,signal:a,onProgress:n,onProgressTasks:s}}abortActiveSegments(e){for(let t of this.activeSegments)(0,Dn.default)(e,t.segment)&&this.abortSegment(t.segment)}async onSomeTemplateDataLoaded({dataView:e,representationId:t,loaded:i,onSegmentAppendFailed:r,signal:a}){if(!this.activeSegments.size||!Xs(this.mediaSource,this.sourceBuffer))return;let s=this.representations.get(t);if(s)for(let n of this.activeSegments){let{segment:o}=n;if(n.representationId===t){if(a.aborted){r();continue}if(n.loadedBytes=i,n.loadedBytes>n.feedingBytes){let t=new DataView(e.buffer,e.byteOffset+n.feedingBytes,n.loadedBytes-n.feedingBytes),i=so(s.mime).parseFeedableSegmentChunk(t,this.isLive);i?.byteLength&&(o.status="partially_fed",n.feedingBytes+=i.byteLength,await this.sourceBufferTaskQueue.append(i),n.fedBytes+=i.byteLength)}}}}async onSomeByteRangesDataLoaded({dataView:e,representationId:t,globalFrom:i,loaded:r,signal:a,onSegmentAppendFailed:s}){if(!this.activeSegments.size||!Xs(this.mediaSource,this.sourceBuffer))return;let n=this.representations.get(t);if(n)for(let o of this.activeSegments){if(o.representationId!==t)continue;if(a.aborted){await s();continue}let{segment:l}=o,u=l.byte.from-i,d=l.byte.to-i,c=d-u+1,h=d<=r;if(u<r)if("downloading"===l.status&&h){l.status="downloaded";let i=new DataView(e.buffer,e.byteOffset+u,c);await this.sourceBufferTaskQueue.append(i,a)&&!a.aborted?this.onSegmentFullyAppended(o,t):await s()}else if(this.tuning.dash.enableSubSegmentBufferFeeding&&("downloading"===l.status||"partially_fed"===l.status)&&(o.loadedBytes=Math.min(c,r-u),o.loadedBytes>o.feedingBytes)){let i=new DataView(e.buffer,e.byteOffset+u+o.feedingBytes,o.loadedBytes-o.feedingBytes),r=o.loadedBytes===c?i:so(n.mime).parseFeedableSegmentChunk(i);r?.byteLength&&(l.status="partially_fed",o.feedingBytes+=r.byteLength,await this.sourceBufferTaskQueue.append(r,a)&&!a.aborted?(o.fedBytes+=r.byteLength,o.fedBytes===c&&this.onSegmentFullyAppended(o,t)):await s())}}}onSegmentFullyAppended(e,t){if(!(0,u.isNullable)(this.sourceBuffer)&&Xs(this.mediaSource,this.sourceBuffer)){!this.isLive&&Ur.browser.isSafari&&this.tuning.useSafariEndlessRequestBugfix&&(es(this.sourceBuffer.buffered,e.segment.time.from,100)&&es(this.sourceBuffer.buffered,e.segment.time.to,100)||this.error$.next({id:"EmptyAppendBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Browser stuck on empty result of adding segment to source buffer"})),this.playingRepresentationId=t,this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(this.parsedInitData.get(this.playingRepresentationId)),e.segment.status="fed",_o(e.segment)&&(e.segment.size=e.fedBytes);for(let i of this.representations.values()){if(i.id===t)continue;let r=this.segments.get(i.id);if(r)for(let t of r)"fed"===t.status&&Math.round(t.time.from)===Math.round(e.segment.time.from)&&Math.round(t.time.to)===Math.round(e.segment.time.to)&&(t.status="none")}this.isActiveLowLatency()&&this.updateLowLatencyLiveIfNeeded(e.segment),this.activeSegments.delete(e),this.detectGapsWhenIdle(t,e.segment)}}abortSegment(e){"partially_fed"===e.status?e.status="partially_ejected":"partially_ejected"!==e.status&&(e.status="none");for(let t of this.activeSegments.values())if(t.segment===e){this.activeSegments.delete(t);break}}loadNextInit(){if(this.allInitsLoaded||this.initLoadIdleCallback)return;let e=null,t=!1;for(let[i,r]of this.initData.entries()){t||(t=r instanceof Promise),null===r&&(e=i)}if(!e)return void(this.allInitsLoaded=!0);if(t)return;let i=this.representations.get(e);i&&(this.initLoadIdleCallback=ns((()=>(0,Nn.default)(this.loadInit(i,"low",!1),(()=>this.initLoadIdleCallback=null)))))}async loadInit(e,t="auto",i=!1){let r=this.tuning.dash.useFetchPriorityHints?t:"auto",a=(!i&&this.failedDownloads>0?(0,u.abortable)(this.destroyAbortController.signal,async function*(){let e=(0,u.getExponentialDelay)(this.failedDownloads,this.tuning.downloadBackoff);yield new Promise((t=>setTimeout(t,e)))}.bind(this))():Promise.resolve()).then((()=>this.fetcher.fetchRepresentation(e.segmentReference,so(e.mime),r))).then((t=>{if(!t)return;let{init:i,dataView:r,segments:a}=t,s=r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength);this.initData.set(e.id,s);let n=a;this.isLive&&yo(e.segmentReference)&&(n=this.getActualLiveStartingSegments(e.segmentReference)),(!this.isLive||!this.segments.has(e.id))&&this.segments.set(e.id,n),i&&this.parsedInitData.set(e.id,i)})).then((()=>this.failedDownloads=0),(t=>{this.initData.set(e.id,null),i&&this.error$.next({id:"LoadInits",category:u.ErrorCategory.WTF,message:"loadInit threw",thrown:t})}));return this.initData.set(e.id,a),a}async dropBuffer(){for(let e of this.segments.values())for(let t of e)t.status="none";await this.pruneBuffer(0,1/0,!0)}async pruneBuffer(e,t,i=!1){if(!this.sourceBuffer||!Xs(this.mediaSource,this.sourceBuffer)||!this.playingRepresentationId||(0,u.isNullable)(e))return!1;this.checkEjectedSegments();let r=[],a=0,s=e=>{if(a>=t)return;r.push({...e.time});let i=_o(e)?e.size??0:e.byte.to-e.byte.from;a+=i};for(let t of this.segments.values())for(let i of t){let t=i.time.to<=e-this.tuning.dash.bufferPruningSafeZone,r=i.time.from>=e+Math.min(this.forwardBufferTarget,this.bufferLimit);(t||r)&&"fed"===i.status&&s(i)}for(let e=0;e<this.sourceBuffer.buffered.length;e++){let t=1e3*this.sourceBuffer.buffered.start(e),i=1e3*this.sourceBuffer.buffered.end(e),r=0;for(let e of this.segments.values())for(let a of e)(0,Dn.default)(["none","partially_ejected"],a.status)&&Math.round(a.time.from)<=Math.round(t)&&Math.round(a.time.to)>=Math.round(i)&&r++;if(r===this.segments.size){s({time:{from:t,to:i},url:"",status:"none"})}}if(r.length&&i){let t=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;for(let i of this.segments.values())for(let r of i)r.time.from>=e+t&&"fed"===r.status&&s(r)}return!!r.length&&(r=(e=>{e.sort(((e,t)=>e.from-t.from));let t=[e[0]];for(let i=1;i<e.length;i++){let{from:r,to:a}=e[i],s=t[t.length-1];s.to>=r?s.to=Math.max(s.to,a):t.push(e[i])}return t})(r),(await Promise.all(r.map((e=>this.sourceBufferTaskQueue.remove(e.from,e.to))))).reduce(((e,t)=>e||t),!1))}async abortBuffer(){if(!this.sourceBuffer||!Xs(this.mediaSource,this.sourceBuffer))return!1;let e=this.playingRepresentationId&&this.initData.get(this.playingRepresentationId),t=e instanceof ArrayBuffer?e:void 0;return this.sourceBufferTaskQueue.abort(t)}getDebugBufferState(){if(this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length)return{from:this.sourceBuffer.buffered.start(0),to:this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1)}}getBufferedTo(){return this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length?this.sourceBuffer.buffered.end(this.sourceBuffer.buffered.length-1):null}getForwardBufferDuration(e=this.getCurrentPosition()){return this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)&&this.sourceBuffer.buffered.length&&!(0,u.isNullable)(e)?ja(this.sourceBuffer.buffered,e):0}detectGaps(e,t){if(!this.sourceBuffer||!Xs(this.mediaSource,this.sourceBuffer))return;let{buffered:i}=this.sourceBuffer;this.tuning.useRefactoredSearchGap&&(this.gaps=this.gaps.filter((e=>{if(e.persistent)return!0;let t=Math.round(e.from),r=Math.round(e.to);for(let e=0;e<i.length;e++)if(t>=Math.round(1e3*i.start(e))&&r<=Math.round(1e3*i.end(e)))return!1;return!0})));let r={representation:e,from:t.time.from,to:t.time.to,persistent:!1};for(let e=0;e<i.length;e++){let a=1e3*i.start(e),s=1e3*i.end(e);if(!(s<=t.time.from||a>=t.time.to)){if(a<=t.time.from&&s>=t.time.to){r=void 0;break}s>t.time.from&&s<t.time.to&&(r.from=s),a<t.time.to&&a>t.time.from&&(r.to=a)}}r&&r.to-r.from>1&&!this.gaps.some((e=>r&&e.from===r.from&&e.to===r.to))&&this.gaps.push(r)}detectGapsWhenIdle(e,t){if(!this.gapDetectionIdleCallback&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(!this.tuning.useRefactoredSearchGap)for(let e=0;e<this.sourceBuffer.buffered.length;e++)this.gaps=this.gaps.filter((t=>t.persistent||this.sourceBuffer&&(Math.round(t.from)<Math.round(1e3*this.sourceBuffer.buffered.start(e))||Math.round(t.to)>Math.round(1e3*this.sourceBuffer.buffered.end(e)))));this.gapDetectionIdleCallback=ns((()=>{try{this.detectGaps(e,t)}catch(e){this.error$.next({id:"GapDetection",category:u.ErrorCategory.WTF,message:"detectGaps threw",thrown:e})}finally{this.gapDetectionIdleCallback=null}}))}}checkEjectedSegments(){if((0,u.isNullable)(this.sourceBuffer)||!Xs(this.mediaSource,this.sourceBuffer)||(0,u.isNullable)(this.playingRepresentationId)||this.sourceBufferBufferedDiff&&!this.sourceBufferBufferedDiff.wasUpdated())return;let e=Eo(this.sourceBuffer.buffered),t=100;for(let i of this.segments.values())for(let r of i){let{status:i}=r;if("fed"!==i&&"partially_ejected"!==i)continue;let a=Math.floor(r.time.from),s=Math.ceil(r.time.to),n=!1,o=0;for(let i=0;i<e.length;i+=2){let r=e[i],l=e[i+1];n||(n=r-t<=a&&l+t>=s),(a>=r&&a<l-t||s>r+t&&s<=l)&&(o+=1)}n||(1===o||this.gaps.some((e=>e.from===r.time.from||e.to===r.time.to))?r.status="partially_ejected":r.status="none")}}handleAsyncError(e,t){this.error$.next({id:t,category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Something went wrong"})}constructor(e,t,i,{fetcher:r,tuning:a,getCurrentPosition:s,isActiveLowLatency:n,compatibilityMode:o=!1,manifest:l}){this.currentLiveSegmentServerLatency$=new u.ValueSubject(0),this.currentLowLatencySegmentLength$=new u.ValueSubject(0),this.currentSegmentLength$=new u.ValueSubject(0),this.onLastSegment$=new u.ValueSubject(!1),this.fullyBuffered$=new u.ValueSubject(!1),this.playingRepresentation$=new u.ValueSubject(void 0),this.playingRepresentationInit$=new u.ValueSubject(void 0),this.error$=new u.Subject,this.gaps=[],this.subscription=new u.Subscription,this.allInitsLoaded=!1,this.activeSegments=new Set,this.downloadAbortController=new Ya,this.switchAbortController=new Ya,this.destroyAbortController=new Ya,this.bufferLimit=1/0,this.failedDownloads=0,this.baseUrls=[],this.baseUrlsIndex=0,this.isLive=!1,this.liveUpdateSegmentIndex=0,this.liveInitialAdditionalOffset=0,this.isSeekingLive=!1,this.index=0,this.lastDataObtainedTimestampMs=0,this.loadByteRangeSegmentsTimeoutId=0,this.sourceBufferBufferedDiff=null,this.startWith=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=this.representations.get(e);(0,u.assertNonNullable)(t,`Cannot find representation ${e}`),this.playingRepresentationId=e,this.downloadingRepresentationId=e,this.sourceBuffer=this.mediaSource.addSourceBuffer(`${t.mime}; codecs="${t.codecs}"`),this.sourceBufferTaskQueue=new Un(this.sourceBuffer),this.sourceBufferBufferedDiff=new xo(this.mediaSource,this.sourceBuffer),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"updateend").subscribe((()=>{this.maintain()}))),this.subscription.add((0,u.fromEvent)(this.sourceBuffer,"error").subscribe((()=>this.error$.next({id:"SourceBuffer",category:u.ErrorCategory.VIDEO_PIPELINE,message:"SourceBuffer Error event fired"})))),this.subscription.add(this.sourceBufferTaskQueue.bufferFull$.subscribe((e=>{let t=this.getCurrentPosition();if(!this.sourceBuffer||!t||!Xs(this.mediaSource,this.sourceBuffer))return;let i=Math.min(this.bufferLimit,.8*cs(this.sourceBuffer.buffered));this.bufferLimit=i;let r=ja(this.sourceBuffer.buffered,t),a=Math.min(this.forwardBufferTarget,this.bufferLimit)*this.tuning.dash.minSafeBufferThreshold;this.pruneBuffer(t,2*e,r<a).catch((e=>{this.handleAsyncError(e,"pruneBuffer")}))}))),this.subscription.add(this.sourceBufferTaskQueue.error$.subscribe((e=>this.error$.next(e)))),yield this.loadInit(t,"high",!0);let i=this.initData.get(t.id),r=this.segments.get(t.id),a=this.parsedInitData.get(t.id);(0,u.assertNonNullable)(i,"No init buffer for starting representation"),(0,u.assertNonNullable)(r,"No segments for starting representation"),i instanceof ArrayBuffer&&(this.searchGaps(r,t),yield this.sourceBufferTaskQueue.append(i,this.destroyAbortController.signal),this.playingRepresentation$.next(this.playingRepresentationId),this.playingRepresentationInit$.next(a))}.bind(this)),this.switchTo=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer)){if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&!this.isLive&&(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}this.maintain()}}.bind(this)),this.switchToOld=(0,u.abortable)(this.destroyAbortController.signal,async function*(e,t=!1){if(!Xs(this.mediaSource,this.sourceBuffer)||e===this.downloadingRepresentationId||e===this.switchingToRepresentationId)return;this.switchingToRepresentationId=e;let i=this.representations.get(e);(0,u.assertNonNullable)(i,`No such representation ${e}`);let r=this.segments.get(e),a=this.initData.get(e);if((0,u.isNullable)(a)||(0,u.isNullable)(r)?yield this.loadInit(i,"high",!1):a instanceof Promise&&(yield a),r=this.segments.get(e),(0,u.assertNonNullable)(r,"No segments for starting representation"),a=this.initData.get(e),a&&a instanceof ArrayBuffer&&this.sourceBuffer&&Xs(this.mediaSource,this.sourceBuffer))if(yield this.abort(),yield this.sourceBufferTaskQueue.append(a,this.downloadAbortController.signal),t)this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e,yield this.dropBuffer(),this.maintain();else{let t=this.getCurrentPosition();(0,u.isNonNullable)(t)&&(this.isLive||(this.bufferLimit=1/0,await this.pruneBuffer(t,1/0,!0)),this.maintain(t)),this.switchingToRepresentationId=void 0,this.downloadingRepresentationId=e}}.bind(this)),this.seekLive=(0,u.abortable)(this.destroyAbortController.signal,async function*(e){let t=(0,Bn.default)(e,(e=>e.representations))??[];if(this.isSeekingLive=!0,!this.downloadingRepresentationId||!t)return;for(let e of this.representations.keys()){let i=t.find((t=>t.id===e));i&&this.representations.set(e,i);let r=this.representations.get(e);if(!r||!yo(r.segmentReference))return;let a=this.getActualLiveStartingSegments(r.segmentReference);this.segments.set(r.id,a)}let i=this.switchingToRepresentationId??this.downloadingRepresentationId,r=this.representations.get(i);(0,u.assertNonNullable)(r);let a=this.segments.get(i);(0,u.assertNonNullable)(a,"No segments for starting representation");let s=this.initData.get(i);if((0,u.assertNonNullable)(s,"No init buffer for starting representation"),!(s instanceof ArrayBuffer))return;let n=this.getDebugBufferState();this.liveUpdateSegmentIndex=0,yield this.abort(),n&&(yield this.sourceBufferTaskQueue.remove(1e3*n.from,1e3*n.to,this.destroyAbortController.signal)),this.searchGaps(a,r),yield this.sourceBufferTaskQueue.append(s,this.destroyAbortController.signal),this.isSeekingLive=!1}.bind(this)),this.fetcher=r,this.tuning=a,this.compatibilityMode=o,this.forwardBufferTarget=a.dash.forwardBufferTargetAuto,this.getCurrentPosition=s,this.isActiveLowLatency=n,this.isLive=!!l?.live,this.baseUrls=l?.baseUrls??[],this.initData=new Map(i.map((e=>[e.id,null]))),this.segments=new Map,this.parsedInitData=new Map,this.representations=new Map(i.map((e=>[e.id,e]))),this.kind=e,this.mediaSource=t,this.sourceBuffer=null}},Co=class{onHeadersReceived(e){let{type:t,reused:i}=en(e);this.lastConnectionType$.next(t),this.lastConnectionReused$.next(i)}async fetchRepresentation(e,t,i="auto"){let{type:r}=e;switch(r){case"byteRange":return await this.fetchByteRangeRepresentation(e,t,i)??null;case"template":return await this.fetchTemplateRepresentation(e,i)??null;default:(0,u.assertNever)(r)}}destroy(){this.abortAllController.abort(),this.tracer.end(),this.subscription.unsubscribe()}async doFetch(e,t){let i=await Ga(e,t);if(i.ok)return i;let r=await i.text(),a=parseInt(r);if(!isNaN(a))switch(a){case 1:this.recoverableError$.next({id:"VideoDataLinkExpiredError",message:"Video data links have expired",category:u.ErrorCategory.FATAL});break;case 8:this.recoverableError$.next({id:"VideoDataLinkBlockedForFloodError",message:"Url blocked for flood",category:u.ErrorCategory.FATAL});break;case 18:this.recoverableError$.next({id:"VideoDataLinkIllegalIpChangeError",message:"Client IP has changed",category:u.ErrorCategory.FATAL});break;case 21:this.recoverableError$.next({id:"VideoDataLinkIllegalHostChangeError",message:"Request HOST has changed",category:u.ErrorCategory.FATAL});break;default:this.error$.next({id:"GeneralVideoDataFetchError",message:`Generic video data fetch error (${a})`,category:u.ErrorCategory.FATAL})}}unsubscribeAbortSubscription(e){e&&(e.unsubscribe(),this.subscription.remove(e))}constructor({throughputEstimator:e,requestQuic:t,tracer:i,compatibilityMode:r=!1,useEnableSubtitlesParam:a=!1}){this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.recoverableError$=new u.Subject,this.error$=new u.Subject,this.abortAllController=new Ya,this.subscription=new u.SubscriptionRemovable,this.fetchManifest=(0,u.abortable)(this.abortAllController.signal,async function*(e){let t=this.tracer.createComponentTracer("FetchManifest"),i=e;this.requestQuic&&(i=Js(i)),!this.compatibilityMode&&this.useEnableSubtitlesParam&&(i=tn(i));let r=yield this.doFetch(i,{signal:this.abortAllController.signal}).catch(Ao);return r?(t.log("success",(0,u.flattenObject)({url:i,message:"Request successfully executed"})),t.end(),this.onHeadersReceived(r.headers),r.text()):(t.error("error",(0,u.flattenObject)({url:i,message:"No data in request manifest"})),t.end(),null)}.bind(this)),this.fetch=(0,u.abortable)(this.abortAllController.signal,async function*(e,{rangeMethod:t=(this.compatibilityMode?0:1),range:i,onProgress:r,priority:a="auto",signal:s,measureThroughput:n=!0,isLowLatency:o=!1}={}){let l=e,d=new Headers,c=this.tracer.createComponentTracer("Fetch");if(i)switch(t){case 0:d.append("Range",`bytes=${i.from}-${i.to}`);break;case 1:{let e=new URL(l,location.href);e.searchParams.append("bytes",`${i.from}-${i.to}`),l=e.toString();break}default:(0,u.assertNever)(t)}this.requestQuic&&(l=Js(l));let h,p=this.abortAllController.signal;if(s){let e=new Ya;if(h=(0,u.merge)((0,u.fromEvent)(this.abortAllController.signal,"abort"),(0,u.fromEvent)(s,"abort")).subscribe((()=>{try{e.abort()}catch(e){Ao(e)}})),this.subscription.add(h),this.abortAllController.signal.aborted||s.aborted)try{e.abort()}catch(e){Ao(e)}p=e.signal}let f=(0,u.now)();c.log("startRequest",(0,u.flattenObject)({url:l,priority:a,rangeMethod:t,range:i,isLowLatency:o,requestStartedAt:f}));let m=yield this.doFetch(l,{priority:a,headers:d,signal:p}),g=(0,u.now)();if(!m)return c.error("error",{message:"No response in request"}),c.end(),this.unsubscribeAbortSubscription(h),null;if(this.throughputEstimator?.addRawRtt(g-f),!m.ok||!m.body){this.unsubscribeAbortSubscription(h);let e=`Fetch error ${m.status}: ${m.statusText}`;return c.error("error",{message:e}),c.end(),Promise.reject(new Error(`Fetch error ${m.status}: ${m.statusText}`))}if(this.onHeadersReceived(m.headers),!r&&!n){this.unsubscribeAbortSubscription(h);let e=(0,u.now)(),t={requestStartedAt:f,requestEndedAt:e,duration:e-f};return c.log("endRequest",(0,u.flattenObject)(t)),c.end(),m.arrayBuffer()}let v=m.body;if(n){let e;[v,e]=m.body.tee(),this.throughputEstimator?.trackStream(e,o)}let b,_=v.getReader(),y=parseInt(m.headers.get("content-length")??"",10);Number.isFinite(y)&&(b=y),!b&&i&&(b=i.to-i.from+1);let w=0,S=b?new Uint8Array(b):new Uint8Array(0),k=!1,T=e=>{this.unsubscribeAbortSubscription(h),k=!0,Ao(e)},E=(0,u.abortable)(p,async function*({done:e,value:t}){if(0===w&&this.lastRequestFirstBytes$.next((0,u.now)()-f),p.aborted)this.unsubscribeAbortSubscription(h);else if(!e&&t){if(b)S.set(t,w),w+=t.byteLength;else{let e=new Uint8Array(S.length+t.length);e.set(S),e.set(t,S.length),S=e,w+=t.byteLength}r?.(new DataView(S.buffer),w),yield _?.read().then(E,T)}}.bind(this));yield _?.read().then(E,T),this.unsubscribeAbortSubscription(h);let x=(0,u.now)(),$={failed:k,requestStartedAt:f,requestEndedAt:x,duration:x-f};return k?(c.error("endRequest",(0,u.flattenObject)($)),c.end(),null):(c.log("endRequest",(0,u.flattenObject)($)),c.end(),S.buffer)}.bind(this)),this.fetchByteRangeRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t,i){if("byteRange"!==e.type)return null;let r,a,{from:s,to:n}=e.initRange,o=s,l=n,u=!1;e.indexRange&&(r=e.indexRange.from,a=e.indexRange.to,u=n+1===r,u&&(o=Math.min(r,s),l=Math.max(a,n))),o=Math.min(o,0);let d=yield this.fetch(e.url,{range:{from:o,to:l},priority:i,measureThroughput:!1});if(!d)return null;let c=new DataView(d,s-o,n-o+1);if(!t.validateData(c))throw new Error("Invalid media file");let h,p=t.parseInit(c),f=e.indexRange??t.getIndexRange(p);if(!f)throw new ReferenceError("No way to load representation index");if(u)h=new DataView(d,f.from-o,f.to-f.from+1);else{let t=yield this.fetch(e.url,{range:f,priority:i,measureThroughput:!1});if(!t)return null;h=new DataView(t)}let m=t.parseSegments(h,p,f);return{init:p,dataView:new DataView(d),segments:m}}.bind(this)),this.fetchTemplateRepresentation=(0,u.abortable)(this.abortAllController.signal,async function*(e,t){if("template"!==e.type)return null;let i=new URL(e.initUrl,e.baseUrl).toString(),r=yield this.fetch(i,{priority:t,measureThroughput:!1});return r?{init:null,segments:e.segments.map((e=>({...e,status:"none",size:void 0}))),dataView:new DataView(r)}:null}.bind(this)),this.throughputEstimator=e,this.requestQuic=t,this.compatibilityMode=r,this.tracer=i.createComponentTracer("Fetcher"),this.useEnableSubtitlesParam=a}},Ao=e=>{if(!wo(e))throw e},Po=class e{updateLive(e){this.processStreams(e?.streams.text)}seekLive(e){this.processStreams(e)}maintain(e=this.getCurrentPosition()){if(!(0,u.isNullable)(e))for(let t of this.representations)for(let i of t){let t=i.segmentReference,r=t.segments.length,a=t.segments[0].time.from,s=t.segments[r-1].time.to;if(e<a||e>s)continue;let n=t.segments.find((t=>t.time.from<=e&&t.time.to>=e));!n||this.currentSegment?.time.from===n.time.from&&this.currentSegment.time.to===n.time.to||(this.currentSegment=n,this.currentRepresentation$.next({...i,label:"Live Text",language:"ru",isAuto:!0,url:new URL(n.url,t.baseUrl).toString()}))}}destroy(){this.currentRepresentation$.next(null),this.currentSegment=null,this.representations=[]}processStreams(t){for(let i of t??[]){let t=e.filterRepresentations(i.representations);if(t){this.representations[this.representationsCursor]=t,this.representationsCursor=(this.representationsCursor+1)%this.maxRepresentations;break}}}static isSupported(t){return!!t?.some((t=>e.filterRepresentations(t.representations)))}static filterRepresentations(e){return e?.filter((e=>"text"===e.kind&&"segmentReference"in e&&yo(e.segmentReference)))}constructor(e,t){this.currentRepresentation$=new u.ValueSubject(null),this.maxRepresentations=4,this.representationsCursor=0,this.representations=[],this.currentSegment=null,this.getCurrentPosition=t.getCurrentPosition,this.processStreams(e)}},Lo=["progress","play","seeked","stalled","waiting"],Mo=["timeupdate","progress","loadeddata","playing","seeked"],Io=class{async seekLive(e){(0,u.assertNonNullable)(this.element);let t="active"!==this.liveStreamStatus$.getValue()?(0,u.now)()-this.liveStreamEndTimestamp:0,i=this.normolizeLiveOffset(e+t);this.isActiveLive$.next(0===i),this.manifestUrlString=sr(this.manifestUrlString,i,2),this.manifest=await this.updateManifest(),this.manifest&&(this.isJumpGapAfterSeekLive=!0,await(this.videoBufferManager?.seekLive(this.manifest.streams.video)),await(this.audioBufferManager?.seekLive(this.manifest.streams.audio)),this.liveTextManager?.seekLive(this.manifest.streams.text))}initBuffer(){(0,u.assertNonNullable)(this.element),this.state$.setState("running");let e=(0,u.fromEvent)(this.element,"timeupdate");this.tuning.dash.timeupdateEventTickThrottle&&(e=e.pipe((0,u.throttle)(this.tuning.dash.timeupdateEventTickThrottle))),this.subscription.add((0,u.merge)(...Lo.map((e=>(0,u.fromEvent)(this.element,e))),(0,u.fromEvent)(window,"online"),e).subscribe((()=>this.tick()),(e=>{this.error$.next({id:"DashVKPlayer",category:u.ErrorCategory.WTF,message:"Internal logic error",thrown:e})}))),this.subscription.add((0,u.fromEvent)(this.element,"progress").subscribe((()=>{this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&(this.element.currentTime=this.element.currentTime)}))),this.subscription.add((0,u.fromEvent)(this.element,"waiting").subscribe((()=>{this.element&&this.element.readyState===HTMLMediaElement.HAVE_CURRENT_DATA&&!this.element.seeking&&es(this.element.buffered,1e3*this.element.currentTime)&&(this.element.currentTime=this.element.currentTime);this.stallWatchdogSubscription?.unsubscribe(),this.stallWatchdogSubscription=(0,u.interval)(50).subscribe((()=>{if(!this.element||"open"!==this.source?.readyState)return;let e=this.currentStallDuration$.getValue();e+=50,this.currentStallDuration$.next(e);let t={timeInWaiting:e},i=(0,u.now)(),r=this.videoBufferManager?.lastDataObtainedTimestamp??0;this.videoLastDataObtainedTimestamp$.next(r);let a=this.audioBufferManager?.lastDataObtainedTimestamp??0,s=this.videoBufferManager?.getForwardBufferDuration()??0,n=this.audioBufferManager?.getForwardBufferDuration()??0,o=s<100&&i-r>this.tuning.dash.crashOnStallTWithoutDataTimeout,l=this.audioBufferManager&&n<100&&i-a>this.tuning.dash.crashOnStallTWithoutDataTimeout;if((o||l)&&e>this.tuning.dash.crashOnStallTWithoutDataTimeout||e>=this.tuning.dash.crashOnStallTimeout)throw new Error(`Stall timeout exceeded: ${e} ms`);if(this.isLive$.getValue()&&e%2e3==0){let e=this.normolizeLiveOffset(-1*this.livePositionFromPlayer$.getValue()*1e3);this.seekLive(e).catch((e=>{this.error$.next({id:"stallIntervalCallback",category:u.ErrorCategory.VIDEO_PIPELINE,message:"stallIntervalCallback failed",thrown:e})})),t.liveLastOffset=e}else{let e=1e3*this.element.currentTime;this.videoBufferManager?.maintain(e),this.audioBufferManager?.maintain(e),t.position=e}this.tracer.log("stallIntervalCallback",(0,u.flattenObject)(t))}),(e=>{this.error$.next({id:"StallWatchdogCallback",category:u.ErrorCategory.NETWORK,message:"Can't restore DASH after stall.",thrown:e})})),this.subscription.add(this.stallWatchdogSubscription)}))),this.tick()}async switchRepresentation(e,t,i=!1){let r={video:this.videoBufferManager,audio:this.audioBufferManager,text:null}[e];return this.tuning.useNewSwitchTo?this.currentStallDuration$.getValue()>0?r?.switchToWithPreviousAbort(t,i):r?.switchTo(t,i):r?.switchToOld(t,i)}async seek(e,t){let i;(0,u.assertNonNullable)(this.element),(0,u.assertNonNullable)(this.videoBufferManager),i=t||1e3*this.element.duration<=this.tuning.dashSeekInSegmentDurationThreshold||Math.abs(1e3*this.element.currentTime-e)<=this.tuning.dashSeekInSegmentAlwaysSeekDelta?e:Math.max(this.videoBufferManager.findSegmentStartTime(e)??e,this.audioBufferManager?.findSegmentStartTime(e)??e),this.warmUpMediaSourceIfNeeded(i),es(this.element.buffered,i)||await Promise.all([this.videoBufferManager.abort(),this.audioBufferManager?.abort()]),!(0,u.isNullable)(this.element)&&!(0,u.isNullable)(this.videoBufferManager)&&(this.videoBufferManager.maintain(i),this.audioBufferManager?.maintain(i),this.element.currentTime=i/1e3,this.tracer.log("seek",(0,u.flattenObject)({requestedPosition:e,forcePrecise:t,position:i})))}warmUpMediaSourceIfNeeded(e=this.element?.currentTime){(0,u.isNonNullable)(this.element)&&(0,u.isNonNullable)(this.source)&&(0,u.isNonNullable)(e)&&"ended"===this.source?.readyState&&1e3*this.element.duration-e>this.tuning.dash.seekBiasInTheEnd&&this.bufferManagers.forEach((e=>e.warmUpMediaSource()))}get isStreamEnded(){return"ended"===this.source?.readyState}stop(){this.tracer.log("stop"),this.element?.querySelectorAll("source").forEach((e=>{URL.revokeObjectURL(e.src),e.remove()})),this.element=null,this.source=null,this.manifest=null,this.currentVideoRepresentation$.next(void 0),this.videoBufferManager?.destroy(),this.videoBufferManager=null,this.audioBufferManager?.destroy(),this.audioBufferManager=null,this.bufferManagers=[],this.state$.setState("none")}setBufferTarget(e){for(let t of this.bufferManagers)t.setTarget(e)}getStreams(){return this.manifest?.streams}setPreloadOnly(e){for(let t of this.bufferManagers)t.setPreloadOnly(e)}destroy(){this.subscription.unsubscribe(),this.representationSubscription.unsubscribe(),this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),this.destroyController.abort(),this.fetcher.destroy(),this.stop(),"open"===this.source?.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating))&&this.source.endOfStream(),this.source=null,this.tracer.end()}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.error$.subscribe(e("error")))}isManualDecreasePlaybackInLive(){return!(!this.element||!this.isLive$.getValue())&&1-this.element.playbackRate>this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup}normolizeLiveOffset(e){return 1e3*Math.trunc(e/1e3)}async updateLive(){this.isUpdatingLive=!0,this.manifest=await this.updateManifest(),this.manifest&&(this.bufferManagers?.forEach((e=>e.updateLive(this.manifest))),this.liveTextManager?.updateLive(this.manifest)),this.isUpdatingLive=!1}jumpGap(){if(!this.element||!this.videoBufferManager)return;let e=this.videoBufferManager.getBufferedTo();if(null===e)return;let t=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),i=this.isJumpGapAfterSeekLive,r=this.element.currentTime;this.isJumpGapAfterSeekLive&&!t&&this.element.currentTime>e&&(this.isJumpGapAfterSeekLive=!1,this.element.currentTime=0);let a=1e3*this.element.currentTime,s=null,n=this.element.readyState===HTMLMediaElement.HAVE_METADATA?this.tuning.endGapTolerance:0;for(let e of this.bufferManagers)for(let t of e.gaps)(t.persistent||e.playingRepresentation$.getValue()===t.representation)&&t.from-n<=a&&t.to+n>a&&(1e3*this.element.duration-t.to<this.tuning.endGapTolerance?s=1/0:(null===s||t.to>s)&&(s=t.to));if(null!==s){let e=s+10;this.gapWatchdogSubscription.unsubscribe(),this.gapWatchdogActive=!1,e===1/0?this.forceEnded$.next():(this.element.currentTime=e/1e3,this.tracer.log("jumpGap",(0,u.flattenObject)({isJumpGapAfterSeekLive:i,isActiveLowLatency:t,initialCurrentTime:r,jumpTo:e,resultCurrentTime:this.element.currentTime})))}}constructor(e){this.element=null,this.manifestUrlString="",this.source=null,this.manifest=null,this.subscription=new u.Subscription,this.representationSubscription=new u.Subscription,this.state$=new lr("none"),this.currentVideoRepresentation$=new u.ValueSubject(void 0),this.currentVideoRepresentationInit$=new u.ValueSubject(void 0),this.currentAudioRepresentation$=new u.ValueSubject(void 0),this.currentVideoSegmentLength$=new u.ValueSubject(0),this.currentAudioSegmentLength$=new u.ValueSubject(0),this.error$=new u.Subject,this.lastConnectionType$=new u.ValueSubject(void 0),this.lastConnectionReused$=new u.ValueSubject(void 0),this.lastRequestFirstBytes$=new u.ValueSubject(void 0),this.currentLiveTextRepresentation$=new u.ValueSubject(null),this.isLive$=new u.ValueSubject(!1),this.isActiveLive$=new u.ValueSubject(!1),this.isLowLatency$=new u.ValueSubject(!1),this.liveDuration$=new u.ValueSubject(0),this.liveSeekableDuration$=new u.ValueSubject(0),this.liveAvailabilityStartTime$=new u.ValueSubject(0),this.liveStreamStatus$=new u.ValueSubject(void 0),this.bufferLength$=new u.ValueSubject(0),this.liveLatency$=new u.ValueSubject(void 0),this.liveLoadBufferLength$=new u.ValueSubject(0),this.livePositionFromPlayer$=new u.ValueSubject(0),this.currentStallDuration$=new u.ValueSubject(0),this.videoLastDataObtainedTimestamp$=new u.ValueSubject(0),this.fetcherRecoverableError$=new u.Subject,this.fetcherError$=new u.Subject,this.liveStreamEndTimestamp=0,this.isUpdatingLive=!1,this.isJumpGapAfterSeekLive=!1,this.forceEnded$=new u.Subject,this.gapWatchdogActive=!1,this.destroyController=new Ya,this.initManifest=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initManifest"),this.element=e,this.manifestUrlString=sr(t,i,2),this.state$.startTransitionTo("manifest_ready"),this.manifest=yield this.updateManifest(),this.manifest?.streams.video.length?this.state$.setState("manifest_ready"):this.error$.next({id:"NoRepresentations",category:u.ErrorCategory.PARSER,message:"No playable video representations"})}.bind(this)),this.updateManifest=(0,u.abortable)(this.destroyController.signal,async function*(){this.tracer.log("updateManifestStart",{manifestUrl:this.manifestUrlString});let e=yield this.fetcher.fetchManifest(this.manifestUrlString).catch((e=>{!this.manifest&&!this.bufferLength$.getValue()&&this.error$.next({id:"LoadManifest",category:u.ErrorCategory.NETWORK,message:"Failed to load manifest",thrown:e})}));if(!e)return null;let t=null;try{t=((e,t)=>{let i,r={video:[],audio:[],text:[]},a=(new DOMParser).parseFromString(e,"application/xml").children[0],s=Array.from(a.querySelectorAll("MPD > BaseURL").values()).map((e=>e.textContent?.trim()??"")),n=(0,uo.default)(s,0)??"",o="dynamic"===a.getAttribute("type"),l=a.getAttribute("availabilityStartTime"),d=a.getAttribute("publishTime"),c=a.getElementsByTagName("vk:Attrs")[0],h=c?.getElementsByTagName("vk:XLatestSegmentPublishTime")[0].textContent,p=c?.getElementsByTagName("vk:XStreamIsLive")[0].textContent,f=c?.getElementsByTagName("vk:XStreamIsUnpublished")[0].textContent,m=c?.getElementsByTagName("vk:XPlaybackDuration")[0].textContent;o&&(i={availabilityStartTime:l?new Date(l).getTime():0,publishTime:d?new Date(d).getTime():0,latestSegmentPublishTime:h?new Date(h).getTime():0,streamIsAlive:"yes"===p,streamIsUnpublished:"yes"===f});let g,v=a.getAttribute("mediaPresentationDuration"),b=[...a.getElementsByTagName("Period")],_=b.reduce(((e,t)=>({...e,[t.id]:t.children})),{}),y=b.reduce(((e,t)=>({...e,[t.id]:t.getAttribute("duration")})),{});v?g=ko(v):(0,co.default)(y).filter((e=>e)).length&&!o?g=(0,co.default)(y).reduce(((e,t)=>e+(ko(t)??0)),0):m&&(g=parseInt(m,10));let w=0,S=a.getAttribute("profiles")?.split(",")??[];for(let e of b.map((e=>e.id)))for(let i of _[e]){let e=i.getAttribute("id")??"id"+(w++).toString(10),a=i.getAttribute("mimeType")??"",s=i.getAttribute("codecs")??"",o=i.getAttribute("contentType")??a?.split("/")[0],l=i.getAttribute("profiles")?.split(",")??[],d=ho(i.getAttribute("lang")??"")??{},c=i.querySelector("Label")?.textContent?.trim()??void 0,h=i.querySelectorAll("Representation"),p=i.querySelector("SegmentTemplate"),f=i.querySelector("Role")?.getAttribute("value")??void 0,m=o,v={id:e,language:d.language,isDefault:"main"===f,label:c,codecs:s,hdr:"video"===m&&Bs(s),mime:a,representations:[]};for(let e of h){var k,T,E,x,$;let r,h=e.getAttribute("lang")??void 0,f=c??i.getAttribute("label")??e.getAttribute("label")??void 0,b=e.querySelector("BaseURL")?.textContent?.trim()??"",_=new URL(b||n,t).toString(),y=e.getAttribute("mimeType")??a,C=e.getAttribute("codecs")??s??"";if("text"===o){let t=e.getAttribute("id")||"",i=d.privateuse?.includes("x-auto")||t.includes("_auto"),a=e.querySelector("SegmentTemplate");if(a){let s={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},n=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,o=parseInt(a.getAttribute("startNumber")??"",10)??1,l=parseInt(a.getAttribute("timescale")??"",10),u=a.querySelectorAll("SegmentTimeline S")??[],d=a.getAttribute("media");if(!d)continue;let c=[],h=0,p="",f=0,m=o,v=0;for(let e of u){let t=parseInt(e.getAttribute("d")??"",10),i=parseInt(e.getAttribute("r")??"",10)||0,r=parseInt(e.getAttribute("t")??"",10);v=Number.isFinite(r)?r:v;let a=t/l*1e3,n=v/l*1e3;for(let e=0;e<i+1;e++){let i=To(d,{...s,segmentNumber:m.toString(10),segmentTime:(v+e*t).toString(10)}),r=(n??0)+e*a,o=r+a;m++,c.push({time:{from:r,to:o},url:i})}v+=(i+1)*t,h+=(i+1)*a}f=v/l*1e3,p=To(d,{...s,segmentNumber:m.toString(10),segmentTime:v.toString(10)}),r={id:t,kind:"text",segmentReference:{type:"template",baseUrl:_,segmentTemplateUrl:d,initUrl:"",totalSegmentsDurationMs:h,segments:c,nextSegmentBeyondManifest:{time:{from:f,to:1/0},url:p},timescale:l},profiles:[],duration:g,bitrate:n,mime:"",codecs:"",width:0,height:0,isAuto:i}}else r={id:t,isAuto:i,kind:"text",url:_}}else{let t,a=e.getAttribute("contentType")??y?.split("/")[0]??o,s=i.getAttribute("profiles")?.split(",")??[],n=parseInt(e.getAttribute("width")??"",10),d=parseInt(e.getAttribute("height")??"",10),c=parseInt(e.getAttribute("bandwidth")??"",10)/1e3,h=e.getAttribute("frameRate")??"",f=e.getAttribute("quality")??void 0,v=h?Ns(h):void 0,b=`${e.getAttribute("id")??"id"+(w++).toString(10)}@${"video"===a?`${d}p`:"audio"===a?`${c}Kbps`:C}`,k=[...S,...l,...s],T=e.querySelector("SegmentBase"),E=e.querySelector("SegmentTemplate")??p;if(T){let i=e.querySelector("SegmentBase Initialization")?.getAttribute("range")??"",[r,a]=i.split("-").map((e=>parseInt(e,10))),s={from:r,to:a},n=e.querySelector("SegmentBase")?.getAttribute("indexRange"),[o,l]=n?n.split("-").map((e=>parseInt(e,10))):[];t={type:"byteRange",url:_,initRange:s,indexRange:n?{from:o,to:l}:void 0}}else{if(!E)throw new ReferenceError("Unknown MPD segment referencing type");{let i={representationId:e.getAttribute("id")??void 0,bandwidth:e.getAttribute("bandwidth")??void 0},r=parseInt(E.getAttribute("timescale")??"",10),a=E.getAttribute("initialization")??"",s=E.getAttribute("media"),n=parseInt(E.getAttribute("startNumber")??"",10)??1,o=To(a,i);if(!s)throw new ReferenceError("No media attribute in SegmentTemplate");let l=E.querySelectorAll("SegmentTimeline S")??[],d=[],c=0,h="",p=0;if(l.length){let e=n,t=0;for(let a of l){let n=parseInt(a.getAttribute("d")??"",10),o=parseInt(a.getAttribute("r")??"",10)||0,l=parseInt(a.getAttribute("t")??"",10);t=Number.isFinite(l)?l:t;let u=n/r*1e3,h=t/r*1e3;for(let r=0;r<o+1;r++){let a=To(s,{...i,segmentNumber:e.toString(10),segmentTime:(t+r*n).toString(10)}),o=(h??0)+r*u,l=o+u;e++,d.push({time:{from:o,to:l},url:a})}t+=(o+1)*n,c+=(o+1)*u}p=t/r*1e3,h=To(s,{...i,segmentNumber:e.toString(10),segmentTime:t.toString(10)})}else if((0,u.isNonNullable)(g)){let e=parseInt(E.getAttribute("duration")??"",10)/r*1e3,t=Math.ceil(g/e),a=0;for(let r=1;r<t;r++){let t=To(s,{...i,segmentNumber:r.toString(10),segmentTime:a.toString(10)});d.push({time:{from:a,to:a+e},url:t}),a+=e}p=a,h=To(s,{...i,segmentNumber:t.toString(10),segmentTime:a.toString(10)})}t={type:"template",baseUrl:_,segmentTemplateUrl:s,initUrl:o,totalSegmentsDurationMs:c,segments:d,nextSegmentBeyondManifest:{time:{from:p,to:1/0},url:h},timescale:r}}}if(!a||!y)continue;let x={video:"video",audio:"audio",text:"text"}[a];if(!x)continue;m||(m=x),r={id:b,kind:x,segmentReference:t,profiles:k,duration:g,bitrate:c,mime:y,codecs:C,width:n,height:d,fps:v,quality:f}}(k=v).language||(k.language=h),(T=v).label||(T.label=f),(E=v).mime||(E.mime=y),(x=v).codecs||(x.codecs=C),($=v).hdr||($.hdr="video"===m&&Bs(C)),v.representations.push(r)}if(m){let e=r[m].find((e=>e.id===v.id));if(e&&v.representations.every((e=>yo(e.segmentReference))))for(let t of e.representations){let e=v.representations.find((e=>e.id===t.id))?.segmentReference,i=t.segmentReference;i.segments.push(...e.segments),i.nextSegmentBeyondManifest=e.nextSegmentBeyondManifest}else r[m].push(v)}}return{duration:g,streams:r,baseUrls:s,live:i}})(e??"",this.manifestUrlString)}catch(t){let i=Ja(e)??{id:"ManifestParsing",category:u.ErrorCategory.PARSER,message:"Failed to parse MPD manifest",thrown:t};this.error$.next(i)}if(!t)return null;let i=(e,t,i)=>!!(this.element?.canPlayType?.(t)&&Lr()?.isTypeSupported?.(`${t}; codecs="${i}"`)||"text"===e);if(t.live){this.isLive$.next(!!t.live);let{availabilityStartTime:e,latestSegmentPublishTime:i,streamIsUnpublished:r,streamIsAlive:a}=t.live,s=(t.duration??0)/1e3;this.liveSeekableDuration$.next(-1*s),this.liveDuration$.next((i-e)/1e3),this.liveAvailabilityStartTime$.next(t.live.availabilityStartTime);let n="active";a||(n=r?"unpublished":"unexpectedly_down"),this.liveStreamStatus$.next(n)}let r={text:t.streams.text,video:[],audio:[]};for(let e of["video","audio"]){let a=t.streams[e].filter((({mime:t,codecs:r})=>i(e,t,r))),s=new Set(a.map((({codecs:e})=>e))),n=_n(s);if(n&&(r[e]=a.filter((({codecs:e})=>e.startsWith(n)))),"video"===e){let e=this.tuning.preferHDR,t=r.video.some((e=>e.hdr)),i=r.video.some((e=>!e.hdr));Ur.display.isHDR&&e&&t?r.video=r.video.filter((e=>e.hdr)):i&&(r.video=r.video.filter((e=>!e.hdr)))}}let a={...t,streams:r};return this.tracer.log("updateManifestEnd",(0,u.flattenObject)(a)),a}.bind(this)),this.initRepresentations=(0,u.abortable)(this.destroyController.signal,async function*(e,t,i){this.tracer.log("initRepresentationsStart",(0,u.flattenObject)({initialVideo:e,initialAudio:t,sourceHls:i})),(0,u.assertNonNullable)(this.manifest),(0,u.assertNonNullable)(this.element),this.representationSubscription.unsubscribe(),this.representationSubscription=new u.Subscription,this.state$.startTransitionTo("representations_ready");let r=e=>{this.representationSubscription.add((0,u.fromEvent)(e,"error").pipe((0,u.filter)((e=>!!this.element?.played.length))).subscribe((e=>{this.error$.next({id:"VideoSource",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Unexpected video source error",thrown:e})})))};this.source=this.tuning.useManagedMediaSource?Ir():new MediaSource;let a=document.createElement("source");if(r(a),a.src=URL.createObjectURL(this.source),this.element.appendChild(a),this.tuning.useManagedMediaSource&&Mr())if(i){let e=document.createElement("source");r(e),e.type="application/x-mpegurl",e.src=i.url,this.element.appendChild(e)}else this.element.disableRemotePlayback=!0;this.isActiveLive$.next(this.isLive$.getValue());let s={fetcher:this.fetcher,tuning:this.tuning,getCurrentPosition:()=>this.element?1e3*this.element.currentTime:void 0,isActiveLowLatency:()=>this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),manifest:this.manifest},n=this.manifest.streams.video.reduce(((e,t)=>[...e,...t.representations]),[]);if(this.videoBufferManager=new $o("video",this.source,n,s),this.bufferManagers=[this.videoBufferManager],(0,u.isNonNullable)(t)){let e=this.manifest.streams.audio.reduce(((e,t)=>[...e,...t.representations]),[]);this.audioBufferManager=new $o("audio",this.source,e,s),this.bufferManagers.push(this.audioBufferManager)}Po.isSupported(this.manifest.streams.text)&&!this.isLowLatency$.getValue()&&(this.liveTextManager=new Po(this.manifest.streams.text,s)),this.representationSubscription.add(this.fetcher.lastConnectionType$.subscribe(this.lastConnectionType$)),this.representationSubscription.add(this.fetcher.lastConnectionReused$.subscribe(this.lastConnectionReused$)),this.representationSubscription.add(this.fetcher.lastRequestFirstBytes$.subscribe(this.lastRequestFirstBytes$));let o=()=>{this.stallWatchdogSubscription?.unsubscribe(),this.currentStallDuration$.next(0)};if(this.representationSubscription.add((0,u.merge)(...Mo.map((e=>(0,u.fromEvent)(this.element,e)))).pipe((0,u.map)((e=>this.element?ja(this.element.buffered,1e3*this.element.currentTime):0)),(0,u.filterChanged)(),(0,u.tap)((e=>{e>this.tuning.dash.bufferEmptinessTolerance&&o()}))).subscribe(this.bufferLength$)),this.representationSubscription.add((0,u.merge)((0,u.fromEvent)(this.element,"ended"),this.forceEnded$).subscribe((()=>{o()}))),this.isLive$.getValue()){this.subscription.add(this.liveDuration$.pipe((0,u.filterChanged)()).subscribe((e=>this.liveStreamEndTimestamp=(0,u.now)()))),this.subscription.add((0,u.fromEvent)(this.element,"pause").subscribe((()=>{this.livePauseWatchdogSubscription=(0,u.interval)(1e3).subscribe((e=>{let t=nr(this.manifestUrlString,2);this.manifestUrlString=sr(this.manifestUrlString,t+1e3,2),"active"===this.liveStreamStatus$.getValue()&&this.updateManifest()})),this.subscription.add(this.livePauseWatchdogSubscription)}))).add((0,u.fromEvent)(this.element,"play").subscribe((e=>this.livePauseWatchdogSubscription?.unsubscribe()))),this.representationSubscription.add((0,u.combine)({isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.map)((({isActiveLive:e,isLowLatency:t})=>e&&t)),(0,u.filterChanged)()).subscribe((e=>{this.isManualDecreasePlaybackInLive()||hn(this.element,1)}))),this.representationSubscription.add((0,u.combine)({bufferLength:this.bufferLength$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).pipe((0,u.filter)((({bufferLength:e,isActiveLive:t,isLowLatency:i})=>t&&i&&!!e))).subscribe((({bufferLength:e})=>this.liveBuffer.next(e)))),this.representationSubscription.add(this.videoBufferManager.currentLowLatencySegmentLength$.subscribe((e=>{if(!this.isActiveLive$.getValue()&&!this.isLowLatency$.getValue()&&!e)return;let t=this.liveSeekableDuration$.getValue()-e/1e3;this.liveSeekableDuration$.next(Math.max(t,-1*this.tuning.dashCmafLive.maxLiveDuration)),this.liveDuration$.next(this.liveDuration$.getValue()+e/1e3)}))),this.representationSubscription.add((0,u.combine)({isLive:this.isLive$,rtt:this.throughputEstimator.rtt$,bufferLength:this.bufferLength$,segmentServerLatency:this.videoBufferManager.currentLiveSegmentServerLatency$}).pipe((0,u.filter)((({isLive:e})=>e)),(0,u.filterChanged)(((e,t)=>t.bufferLength<e.bufferLength)),(0,u.map)((({rtt:e,bufferLength:t,segmentServerLatency:i})=>(e/2+t+i+nr(this.manifestUrlString,2))/1e3))).subscribe(this.liveLatency$)),this.representationSubscription.add((0,u.combine)({liveBuffer:this.liveBuffer.smoothed$,isActiveLive:this.isActiveLive$,isLowLatency:this.isLowLatency$}).subscribe((({liveBuffer:e,isActiveLive:t,isLowLatency:i})=>{if(!i||!t)return;let r=this.tuning.dashCmafLive.lowLatency.maxTargetOffset,a=this.tuning.dashCmafLive.lowLatency.maxTargetOffsetDeviation,s=this.tuning.dashCmafLive.lowLatency.playbackCatchupSpeedup,n=e-r;if(this.isManualDecreasePlaybackInLive())return;let o=1;Math.abs(n)>a&&(o=1+Math.sign(n)*s),hn(this.element,o)}))),this.representationSubscription.add(this.bufferLength$.subscribe((e=>{let t=0;if(e){let e=1e3*(this.element?.currentTime??0);t=Math.min(...this.bufferManagers.map((t=>t.getLiveSegmentsToLoadState(this.manifest)?.to??e)))-e}this.liveLoadBufferLength$.getValue()!==t&&this.liveLoadBufferLength$.next(t)})));let e=0;this.representationSubscription.add((0,u.combine)({liveLoadBufferLength:this.liveLoadBufferLength$,bufferLength:this.bufferLength$}).pipe((0,u.throttle)(1e3)).subscribe((async({liveLoadBufferLength:t,bufferLength:i})=>{if(!this.element||this.isUpdatingLive)return;let r=this.element.playbackRate,a=nr(this.manifestUrlString,2),s=1e3*Math.abs(this.livePositionFromPlayer$.getValue()),n=Math.min(s,this.tuning.dashCmafLive.normalizedTargetMinBufferSize*r),o=this.tuning.dashCmafLive.normalizedActualBufferOffset*r,l=this.tuning.dashCmafLive.normalizedLiveMinBufferSize*r,u=isFinite(t)?t:i,d=this.isActiveLive$.getValue()&&this.isLowLatency$.getValue(),c=s<=this.tuning.live.activeLiveDelay;this.isActiveLive$.next(c);let h="none";if(d?h="active_low_latency":this.isLowLatency$.getValue()&&c?(this.bufferManagers.forEach((e=>e.proceedLowLatencyLive())),h="active_low_latency"):0!==a&&u<n?h="live_forward_buffering":u<n+l&&(h="live_with_target_offset"),isFinite(t)&&(e=t>e?t:e),"live_forward_buffering"===h||"live_with_target_offset"===h){let i=e-(n+o),s=this.normolizeLiveOffset(Math.trunc(a+i/r)),l=Math.abs(s-a),u=0;!t||l<=this.tuning.dashCmafLive.offsetCalculationError?u=a:s>0&&l>this.tuning.dashCmafLive.offsetCalculationError&&(u=s),this.manifestUrlString=sr(this.manifestUrlString,u,2)}("live_with_target_offset"===h||"live_forward_buffering"===h)&&(e=0,await this.updateLive())}),(e=>{this.error$.next({id:"updateLive",category:u.ErrorCategory.VIDEO_PIPELINE,thrown:e,message:"Failed to update live with subscription"})})))}let l=(0,u.merge)(...this.bufferManagers.map((e=>e.fullyBuffered$))).pipe((0,u.map)((()=>this.bufferManagers.every((e=>e.fullyBuffered$.getValue()))))),d=(0,u.merge)(...this.bufferManagers.map((e=>e.onLastSegment$))).pipe((0,u.map)((()=>this.bufferManagers.some((e=>e.onLastSegment$.getValue()))))),c=(0,u.combine)({allBuffersFull:l,someBufferEnded:d}).pipe((0,u.filterChanged)(),(0,u.map)((({allBuffersFull:e,someBufferEnded:t})=>e&&t)),(0,u.filter)((e=>e)));if(this.representationSubscription.add((0,u.merge)(this.forceEnded$,c).subscribe((()=>{if(this.source&&"open"===this.source.readyState&&Array.from(this.source.sourceBuffers).every((e=>!e.updating)))try{this.source?.endOfStream()}catch(e){this.error$.next({id:"EndOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to end MediaSource stream",thrown:e})}}))),this.representationSubscription.add((0,u.merge)(...this.bufferManagers.map((e=>e.error$))).subscribe(this.error$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentation$.subscribe(this.currentVideoRepresentation$)),this.representationSubscription.add(this.videoBufferManager.playingRepresentationInit$.subscribe(this.currentVideoRepresentationInit$)),this.representationSubscription.add(this.videoBufferManager.currentSegmentLength$.subscribe(this.currentVideoSegmentLength$)),this.audioBufferManager&&(this.representationSubscription.add(this.audioBufferManager.playingRepresentation$.subscribe(this.currentAudioRepresentation$)),this.representationSubscription.add(this.audioBufferManager.currentSegmentLength$.subscribe(this.currentAudioSegmentLength$))),this.liveTextManager&&this.representationSubscription.add(this.liveTextManager.currentRepresentation$.subscribe(this.currentLiveTextRepresentation$)),"open"!==this.source.readyState){let e=this.tuning.dash.sourceOpenTimeout>=0;yield new Promise((t=>{e&&(this.timeoutSourceOpenId=setTimeout((()=>{"open"!==this.source?.readyState?this.error$.next({id:"OpenOfStream",category:u.ErrorCategory.VIDEO_PIPELINE,message:"Failed to open MediaSource",thrown:new Error("Timeout reject when wait sourceopen event"),traceAsLog:!0}):t()}),this.tuning.dash.sourceOpenTimeout)),this.source?.addEventListener("sourceopen",(()=>{this.timeoutSourceOpenId&&clearTimeout(this.timeoutSourceOpenId),t()}),{once:!0})}))}if(!this.isLive$.getValue()){let e=[this.manifest.duration??0,...(0,Rn.default)((0,Rn.default)([...this.manifest.streams.audio,...this.manifest.streams.video],(e=>e.representations)),(e=>{let t=[];return e.duration&&t.push(e.duration),yo(e.segmentReference)&&e.segmentReference.totalSegmentsDurationMs&&t.push(e.segmentReference.totalSegmentsDurationMs),t}))];this.source.duration=Math.max(...e)/1e3}this.audioBufferManager&&(0,u.isNonNullable)(t)?yield Promise.all([this.videoBufferManager.startWith(e),this.audioBufferManager.startWith(t)]):yield this.videoBufferManager.startWith(e),this.state$.setState("representations_ready"),this.tracer.log("initRepresentationsEnd")}.bind(this)),this.tick=()=>{if(!this.element||!this.videoBufferManager||"open"!==this.source?.readyState)return;let e=1e3*this.element.currentTime;this.videoBufferManager.maintain(e),this.audioBufferManager?.maintain(e),this.liveTextManager?.maintain(e),(this.videoBufferManager.gaps.length||this.audioBufferManager?.gaps.length)&&!this.gapWatchdogActive&&(this.gapWatchdogActive=!0,this.gapWatchdogSubscription=(0,u.interval)(this.tuning.gapWatchdogInterval).subscribe((()=>this.jumpGap()),(e=>{this.error$.next({id:"GapWatchdog",category:u.ErrorCategory.WTF,message:"Error handling gaps",thrown:e})})),this.subscription.add(this.gapWatchdogSubscription))},this.throughputEstimator=e.throughputEstimator,this.tuning=e.tuning,this.tracer=e.tracer.createComponentTracer(this.constructor.name),this.fetcher=new Co({throughputEstimator:this.throughputEstimator,requestQuic:this.tuning.requestQuick,compatibilityMode:e.compatibilityMode,tracer:this.tracer,useEnableSubtitlesParam:e.tuning.useEnableSubtitlesParam}),this.subscription.add(this.fetcher.recoverableError$.subscribe(this.fetcherRecoverableError$)),this.subscription.add(this.fetcher.error$.subscribe(this.fetcherError$)),this.liveBuffer=cn.getLiveBufferSmoothedValue(this.tuning.dashCmafLive.lowLatency.maxTargetOffset,{...e.tuning.dashCmafLive.lowLatency.bufferEstimator}),this.initTracerSubscription()}},Ro=class{connect({observableVideo:e,video:t}){let i=e=>{let t=e.target;this.pipSize$.next({width:t.width,height:t.height})};this.subscription.add((0,u.observeElementSize)(t).subscribe(this.videoSize$)).add(e.enterPip$.subscribe((({pictureInPictureWindow:e})=>{this.pipSize$.next({width:e.width,height:e.height}),e.addEventListener("resize",i),this.pictureInPictureWindowRemoveEventListener=()=>{e.removeEventListener("resize",i)}}))).add(e.leavePip$.subscribe((()=>{this.pictureInPictureWindowRemoveEventListener()}))).add((0,u.combine)({videoSize:this.videoSize$,pipSize:this.pipSize$,inPip:e.inPiP$}).pipe((0,u.map)((({videoSize:e,inPip:t,pipSize:i})=>t?i:e))).subscribe(this.elementSize$))}getValue(){return this.elementSize$.getValue()}subscribe(e,t){return this.elementSize$.subscribe(e,t)}getObservable(){return this.elementSize$}destroy(){this.pictureInPictureWindowRemoveEventListener(),this.subscription.unsubscribe()}constructor(){this.subscription=new u.Subscription,this.pipSize$=new u.ValueSubject(void 0),this.videoSize$=new u.ValueSubject(void 0),this.elementSize$=new u.ValueSubject(void 0),this.pictureInPictureWindowRemoveEventListener=u.noop}},Do=class{getProviderSubscriptionInfo(){let{output:e,desiredState:t}=this.params,i=Fr(this.video);this.subscription.add((()=>i.destroy()));let r=this.constructor.name,a=t=>{e.error$.next({id:r,category:u.ErrorCategory.WTF,message:`${r} internal logic error`,thrown:t})};return{output:e,desiredState:t,observableVideo:i,genericErrorListener:a,connect:(e,t)=>this.subscription.add(e.subscribe(t,a))}}subscribe(){let{output:e,desiredState:t,observableVideo:i,genericErrorListener:r,connect:a}=this.getProviderSubscriptionInfo();this.subscription.add(this.params.output.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>{this.droppedFramesManager.connect({logger:this.params.dependencies.logger,video:this.video,droppedFramesChecker:this.params.tuning.droppedFramesChecker,isAuto:this.params.desiredState.autoVideoTrackSwitching,playing$:i.playing$,pause$:i.pause$,tracks:e})})));let s=this.params.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>"none"!==e.to.state)),(0,u.filterChanged)());this.stallsManager.init({isSeeked$:s,currentStallDuration$:this.player.currentStallDuration$,videoLastDataObtainedTimestamp$:this.player.videoLastDataObtainedTimestamp$,throughput$:this.params.dependencies.throughputEstimator.throughput$,rtt$:this.params.dependencies.throughputEstimator.rtt$,tuning:this.params.tuning.stallsManager,abrParams:this.params.tuning.autoTrackSelection,isBuffering$:i.isBuffering$,looped$:i.looped$,playing$:i.playing$}),a(i.ended$,e.endedEvent$),a(i.looped$,e.loopedEvent$),a(i.error$,e.error$),a(i.isBuffering$,e.isBuffering$),a(i.currentBuffer$,e.currentBuffer$),a(i.playing$,e.firstFrameEvent$),a(i.canplay$,e.canplay$),a(i.inPiP$,e.inPiP$),a(i.inFullscreen$,e.inFullscreen$),a(i.loadedMetadata$,e.loadedMetadataEvent$),a(this.player.error$,e.error$),a(this.player.fetcherRecoverableError$,e.fetcherRecoverableError$),a(this.player.fetcherError$,e.fetcherError$),a(this.player.lastConnectionType$,e.httpConnectionType$),a(this.player.lastConnectionReused$,e.httpConnectionReused$),a(this.player.isLive$,e.isLive$),a(this.player.lastRequestFirstBytes$.pipe((0,u.filter)(u.isNonNullable),(0,u.once)()),e.firstBytesEvent$),a(this.stallsManager.severeStallOccurred$,e.severeStallOccurred$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(i.looped$.subscribe((()=>this.player.warmUpMediaSourceIfNeeded()),r)),this.subscription.add(i.seeked$.subscribe(e.seekedEvent$,r)),this.subscription.add(vr(this.video,t.isLooped,r)),this.subscription.add(br(this.video,t.volume,i.volumeState$,r)),this.subscription.add(i.volumeState$.subscribe(this.params.output.volume$,r)),this.subscription.add(_r(this.video,t.playbackRate,i.playbackRateState$,r)),this.elementSizeManager.connect({video:this.video,observableVideo:i}),a(Ba(this.video,{threshold:this.params.tuning.autoTrackSelection.activeVideoAreaThreshold}),e.elementVisible$),this.subscription.add(i.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing"),this.scene3D&&this.scene3D.play()}),r)).add(i.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),r)).add(i.canplay$.subscribe((()=>{"playing"===this.videoState.getState()&&this.playIfAllowed()}),r)),this.subscription.add(this.player.state$.stateChangeEnded$.subscribe((({to:e})=>{if("manifest_ready"===e){this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map;let e=this.player.getStreams();if((0,u.assertNonNullable)(e,"Manifest not loaded or empty"),!this.params.tuning.isAudioDisabled){let t=[];for(let i of e.audio){t.push(vo(i));let e=[];for(let t of i.representations){let r=mo(t);e.push(r),this.audioTracksMap.set(r,{stream:i,representation:t})}this.audioStreamsMap.set(i,e)}this.params.output.availableAudioStreams$.next(t)}let t=[];for(let i of e.video){t.push(bo(i));let e=[];for(let t of i.representations){let r=fo({...t,streamId:i.id});r&&(e.push(r),this.videoTracksMap.set(r,{stream:i,representation:t}))}this.videoStreamsMap.set(i,e)}this.params.output.availableVideoStreams$.next(t);for(let t of e.text)for(let e of t.representations){let i=go(t,e);this.textTracksMap.set(i,{stream:t,representation:e})}this.params.output.availableVideoTracks$.next(Array.from(this.videoTracksMap.keys())),this.params.output.availableAudioTracks$.next(Array.from(this.audioTracksMap.keys())),this.params.output.isAudioAvailable$.next(!!this.audioTracksMap.size),this.audioTracksMap.size&&this.textTracksMap.size&&this.params.desiredState.internalTextTracks.startTransitionTo(Array.from(this.textTracksMap.keys()))}else"representations_ready"===e&&(this.videoState.setState("ready"),this.player.initBuffer())}),r));let{vktvAbrThrottle:n}=this.params.tuning.dash,o=n&&(e=>{let t=!1,i=(0,u.throttleFn)((()=>{t=!0}),e);return()=>{try{return i(),t}finally{t=!1}}})(n)||null;this.subscription.add((0,u.merge)(this.player.currentStallDuration$,this.player.state$.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.transitionStarted$,this.params.dependencies.throughputEstimator.rttAdjustedThroughput$,t.autoVideoTrackLimits.stateChangeStarted$,this.elementSizeManager.getObservable(),this.params.output.elementVisible$,this.droppedFramesManager.onDroopedVideoFramesLimit$,(0,u.fromEvent)(this.video,"progress")).pipe((0,u.filter)((()=>this.videoTracksMap.size>0))).subscribe((async()=>{let e=this.player.state$.getState(),i=this.player.state$.getTransition();if("manifest_ready"!==e&&"running"!==e||i||"running"===e&&o&&!o())return;t.autoVideoTrackSwitching.getTransition()&&t.autoVideoTrackSwitching.setState(t.autoVideoTrackSwitching.getState()),this.selectVideoAudioRepresentations();let{video:r,audio:a}=this.selectedRepresentations;if(!r)return;let s=So(this.videoTracksMap.keys(),(e=>this.videoTracksMap.get(e)?.representation.id===r.id));(0,u.isNonNullable)(s)&&(this.stallsManager.lastVideoTrackSelected=s);let n=this.params.desiredState.autoVideoTrackLimits.getTransition();if(n&&this.params.output.autoVideoTrackLimits$.next(n.to),"manifest_ready"===e)await this.player.initRepresentations(r.id,a?.id,this.params.sourceHls);else if(await this.player.switchRepresentation("video",r.id),a){let e=!!t.audioStream.getTransition();await this.player.switchRepresentation("audio",a.id,e)}}),r)),this.subscription.add(t.cameraOrientation.stateChangeEnded$.subscribe((({to:e})=>{this.scene3D&&e&&this.scene3D.pointCameraTo(e.x,e.y)}))),this.subscription.add(this.elementSizeManager.subscribe((e=>{this.scene3D&&e&&this.scene3D.setViewportSize(e.width,e.height)}))),this.subscription.add(this.player.currentVideoRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=So(this.videoTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return e.currentVideoTrack$.next(void 0),void e.currentVideoStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.videoStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.videoStream.setState(s.to),e.currentVideoTrack$.next(r),e.currentVideoStream$.next(bo(a))}),r)),this.subscription.add(this.player.currentAudioRepresentation$.pipe((0,u.filterChanged)()).subscribe((t=>{let i=So(this.audioTracksMap.entries(),(([,{representation:e}])=>e.id===t));if(!i)return void e.currentAudioStream$.next(void 0);let[r,{stream:a}]=i,s=this.params.desiredState.audioStream.getTransition();s&&s.to&&s.to.id===a.id&&this.params.desiredState.audioStream.setState(s.to),e.currentAudioStream$.next(vo(a))}),r)),this.subscription.add(this.player.currentVideoRepresentationInit$.subscribe((t=>{if(t?.is3dVideo&&this.params.tuning.spherical?.enabled)try{this.init3DScene(t),e.is3DVideo$.next(!0)}catch(t){e.warning$.next({id:"DashProvider",message:`DashProvider could not initialize 3D-scene: ${t}`})}else this.destroy3DScene(),this.params.tuning.spherical?.enabled&&e.is3DVideo$.next(!1)}),r)),this.subscription.add(this.player.currentVideoSegmentLength$.subscribe(e.currentVideoSegmentLength$,r)),this.subscription.add(this.player.currentAudioSegmentLength$.subscribe(e.currentAudioSegmentLength$,r)),this.textTracksManager.connect(this.video,t,e);let l=t.playbackState.stateChangeStarted$.pipe((0,u.map)((({to:e})=>"ready"===e)),(0,u.filterChanged)());this.subscription.add((0,u.merge)(l,t.autoVideoTrackSwitching.stateChangeStarted$,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>{let e=t.autoVideoTrackSwitching.getState(),i="ready"===t.playbackState.getState()?this.params.tuning.dash.forwardBufferTargetPreload:e?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;this.player.setBufferTarget(i)}))),this.subscription.add((0,u.merge)(l,this.player.state$.stateChangeEnded$,(0,u.observableFrom)(["init"])).subscribe((()=>this.player.setPreloadOnly("ready"===t.playbackState.getState()))));let d=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(d.subscribe(this.syncPlayback,r))}selectVideoAudioRepresentations(){if(this.player.isStreamEnded)return;let e=this.params.tuning.useNewAutoSelectVideoTrack?da:ua,t=this.params.tuning.useNewAutoSelectVideoTrack?ba:va,i=this.params.tuning.useNewAutoSelectVideoTrack?ma:ga,{desiredState:r,output:a}=this.params,s=r.autoVideoTrackSwitching.getState(),n=r.videoTrack.getState()?.id,o=So(this.videoTracksMap.keys(),(e=>e.id===n)),l=a.currentVideoTrack$.getValue(),u=r.videoStream.getState()??(o&&this.videoTracksMap.get(o)?.stream)??1===this.videoStreamsMap.size?this.videoStreamsMap.keys().next().value:void 0;if(!u)return;let d=So(this.videoStreamsMap.keys(),(e=>e.id===u.id)),c=d&&this.videoStreamsMap.get(d);if(!c)return;let h,p=ja(this.video.buffered,1e3*this.video.currentTime);h=this.player.isActiveLive$.getValue()?this.player.isLowLatency$.getValue()?this.params.tuning.dashCmafLive.lowLatency.maxTargetOffset:this.params.tuning.dashCmafLive.normalizedLiveMinBufferSize:this.player.isLive$.getValue()?this.params.tuning.dashCmafLive.normalizedTargetMinBufferSize:s?this.params.tuning.dash.forwardBufferTargetAuto:this.params.tuning.dash.forwardBufferTargetManual;let f=(1e3*this.video.duration||1/0)-1e3*this.video.currentTime,m=Math.min(p/Math.min(h,f||1/0),1),g=r.audioStream.getState()??(1===this.audioStreamsMap.size?this.audioStreamsMap.keys().next().value:void 0),v=g?.id&&So(this.audioStreamsMap.keys(),(e=>e.id===g.id))||this.audioStreamsMap.keys().next().value,b=0;if(v){if(o&&!s){let t=e(o,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}if(l){let t=e(l,c,this.audioStreamsMap.get(v)??[],this.params.tuning.autoTrackSelection.minVideoAudioRatio);b=Math.max(b,t?.bitrate??-1/0)}}let _=o;(s||!_)&&(_=i(c,{container:this.elementSizeManager.getValue(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),tuning:this.stallsManager.abrTuningParams,limits:this.params.desiredState.autoVideoTrackLimits.getState(),reserve:b,forwardBufferHealth:m,current:l,visible:this.params.output.elementVisible$.getValue(),history:this.videoTrackSwitchHistory,playbackRate:this.video.playbackRate,droppedVideoMaxQualityLimit:this.droppedFramesManager.droppedVideoMaxQualityLimit,stallsVideoMaxQualityLimit:this.stallsManager.videoMaxQualityLimit,stallsPredictedThroughput:this.stallsManager.predictedThroughput,abrLogger:this.params.dependencies.abrLogger}));let y=v&&t(_,c,this.audioStreamsMap.get(v)??[],{estimatedThroughput:this.params.dependencies.throughputEstimator.rttAdjustedThroughput$.getValue(),stallsPredictedThroughput:this.stallsManager.predictedThroughput,tuning:this.stallsManager.abrTuningParams,forwardBufferHealth:m,history:this.audioTrackSwitchHistory,playbackRate:this.video.playbackRate,abrLogger:this.params.dependencies.abrLogger}),w=this.videoTracksMap.get(_)?.representation,S=y&&this.audioTracksMap.get(y)?.representation;w&&S?(this.selectedRepresentations.video=w,this.selectedRepresentations.audio=S):w&&!S&&0===this.audioTracksMap.size&&(this.selectedRepresentations.video=w,this.selectedRepresentations.audio=null)}prepare(e=0){this.player.initManifest(this.video,this.params.source.url,e)}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}destroy(){this.subscription.unsubscribe(),this.droppedFramesManager.destroy(),this.stallsManager.destroy(),this.elementSizeManager.destroy(),this.destroy3DScene(),this.textTracksManager.destroy(),this.player.destroy(),this.params.output.element$.next(void 0),this.params.output.currentVideoStream$.next(void 0),fr(this.video),this.tracer.end()}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.droppedFramesManager=new Da,this.stallsManager=new An,this.elementSizeManager=new Ro,this.videoTracksMap=new Map,this.audioTracksMap=new Map,this.textTracksMap=new Map,this.videoStreamsMap=new Map,this.audioStreamsMap=new Map,this.videoTrackSwitchHistory=new aa,this.audioTrackSwitchHistory=new aa,this.selectedRepresentations={audio:null,video:null},this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.seekState.getState();if(!this.videoState.getTransition()){if("requested"===r.state&&"paused"!==i?.to&&"stopped"!==e&&"stopped"!==t&&this.seek(r.position,r.forcePrecise),"stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.player.stop(),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));switch(e){case"stopped":return this.videoState.startTransitionTo("ready"),void this.prepare();case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"ready"===i?.to&&or(this.params.desiredState.playbackState,"ready"));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===t&&this.video.paused?this.playIfAllowed():"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}},this.init3DScene=e=>{if(this.scene3D)return;this.scene3D=new En(this.params.container,this.video,{fov:this.params.tuning.spherical.fov,orientation:this.params.tuning.spherical.orientation||{x:e.projectionData?.pose.yaw||0,y:e.projectionData?.pose.pitch||0,z:e.projectionData?.pose.roll||0},rotationSpeed:this.params.tuning.spherical.rotationSpeed,maxYawAngle:this.params.tuning.spherical.maxYawAngle,rotationSpeedCorrection:this.params.tuning.spherical.rotationSpeedCorrection,degreeToPixelCorrection:this.params.tuning.spherical.degreeToPixelCorrection,speedFadeTime:this.params.tuning.spherical.speedFadeTime,speedFadeThreshold:this.params.tuning.spherical.speedFadeThreshold});let t=this.elementSizeManager.getValue();t&&this.scene3D.setViewportSize(t.width,t.height)},this.destroy3DScene=()=>{this.scene3D&&(this.scene3D.destroy(),this.scene3D=void 0)},this.textTracksManager=new Sr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name),this.params.output.element$.next(this.video),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.isLive$.next(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.player=new Io({throughputEstimator:this.params.dependencies.throughputEstimator,tuning:this.params.tuning,compatibilityMode:this.params.source.compatibilityMode,tracer:this.tracer}),this.subscribe()}},Oo=class extends Do{subscribe(){super.subscribe();let{output:e,observableVideo:t,connect:i}=this.getProviderSubscriptionInfo();i(t.timeUpdate$,e.position$),i(t.durationChange$,e.duration$)}seek(e,t){this.params.output.willSeekEvent$.next(),this.player.seek(e,t)}},Bo=class extends Do{subscribe(){super.subscribe();let e=-1,{output:t,observableVideo:i,desiredState:r,connect:a}=this.getProviderSubscriptionInfo();this.params.output.position$.next(0),this.params.output.isLive$.next(!0),a(i.timeUpdate$,t.liveBufferTime$),a(this.player.liveSeekableDuration$,t.duration$),a(this.player.liveLatency$,t.liveLatency$);let s=new u.ValueSubject(1);a(i.playbackRateState$,s),this.subscription.add(this.params.output.position$.subscribe(this.player.livePositionFromPlayer$)).add(r.isLowLatency.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.player.isLowLatency$)).add((0,u.combine)({liveBufferTime:t.liveBufferTime$,liveAvailabilityStartTime:this.player.liveAvailabilityStartTime$}).pipe((0,u.map)((({liveBufferTime:e,liveAvailabilityStartTime:t})=>e&&t?e+t:void 0))).subscribe(t.liveTime$)).add(this.player.liveStreamStatus$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>t.isLiveEnded$.next("active"!==e&&0===t.position$.getValue())))).add((0,u.combine)({liveDuration:this.player.liveDuration$,liveStreamStatus:this.player.liveStreamStatus$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filter)((({liveStreamStatus:e,liveDuration:t})=>"active"===e&&!!t))).subscribe((({liveDuration:i,playbackRate:r})=>{let a=t.liveBufferTime$.getValue(),s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;s||r<1-n||this.video.paused||(0,u.isNullable)(a)||(e=i-a)}))).add((0,u.combine)({time:t.liveBufferTime$,liveDuration:this.player.liveDuration$,playbackRate:(0,u.merge)(i.playbackRateState$,new u.ValueSubject(1))}).pipe((0,u.filterChanged)(((e,t)=>"active"===this.player.liveStreamStatus$.getValue()?e.liveDuration===t.liveDuration:e.time===t.time))).subscribe((({time:i,liveDuration:r,playbackRate:a})=>{let s=t.position$.getValue(),{playbackCatchupSpeedup:n}=this.params.tuning.dashCmafLive.lowLatency;if(!s&&!this.video.paused&&a>=1-n||(0,u.isNullable)(i)||(0,u.isNullable)(r))return;let o=-1*(r-i-e);t.position$.next(Math.min(o,0))}))).add(this.player.currentLiveTextRepresentation$.subscribe((e=>{if(e){let t=(({language:e,label:t,id:i,url:r,isAuto:a})=>({id:i,url:r,isAuto:a,type:"internal",language:e,label:t}))(e);this.params.output.availableTextTracks$.next([t])}})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=Math.trunc(t/1e3<=Math.abs(this.params.output.duration$.getValue())?t:0);this.player.seekLive(i).then((()=>{this.params.output.position$.next(e/1e3)}))}constructor(e){super(e),this.textTracksManager.destroy()}},No="X-Playback-Duration",Vo=async e=>{let t=await Ga(e),i=await t.text(),r=/#EXT-X-VK-PLAYBACK-DURATION:(\d+)/m.exec(i)?.[1];return r?parseInt(r,10):t.headers.has(No)?parseInt(t.headers.get(No),10):void 0},Uo=v(mt(),1),Fo=e=>{let t=null;if(e.QUALITY&&(t=jr(e.QUALITY)),!t&&e.RESOLUTION){let[i,r]=e.RESOLUTION.split("x").map((e=>parseInt(e,10)));t=(0,u.videoSizeToQuality)({width:i,height:r})}return t??null},jo=0,zo=async(e,t=e,i,r)=>{let a=await(await Ga(e,r)).text();jo+=1;try{let{qualityManifests:e,textTracks:i}=((e,t)=>{let i=e.split("\n"),r=[],a=[];for(let e=0;e<i.length;e++){let s=i[e],n=s.match(/^#EXT-X-STREAM-INF:(.+)/),o=s.match(/^#EXT-X-MEDIA:TYPE=SUBTITLES,(.+)/);if(n||o){if(n){let a,s=(0,Uo.default)(n[1].split(",").map((e=>e.split("=")))),o=s.QUALITY??`stream-${s.BANDWIDTH}`,l=Fo(s);s.BANDWIDTH&&(a=parseInt(s.BANDWIDTH,10)/1e3||void 0),!a&&s["AVERAGE-BANDWIDTH"]&&(a=parseInt(s["AVERAGE-BANDWIDTH"],10)/1e3||void 0);let u,d=s["FRAME-RATE"]?parseFloat(s["FRAME-RATE"]):void 0;if(s.RESOLUTION){let[e,t]=s.RESOLUTION.split("x").map((e=>parseInt(e,10)));e&&t&&(u={width:e,height:t})}let c=new URL(i[++e],t).toString();l&&r.push({id:o,quality:l,url:c,bandwidth:a,size:u,fps:d})}if(o){let e=(0,Uo.default)(o[1].split(",").map((e=>{let t=e.indexOf("=");return[e.substring(0,t),e.substring(t+1)]})).map((([e,t])=>[e,t.replace(/^"|"$/g,"")]))),t=e.URI?.replace(/playlist$/,"subtitles.vtt"),i=e.LANGUAGE,r=e.NAME;t&&i&&a.push({type:"internal",id:i,label:r,language:i,url:t,isAuto:!1})}}}if(!r.length)throw new Error("Empty manifest");return{qualityManifests:r,textTracks:a}})(a,t);return{qualityManifests:e,textTracks:i}}catch{if(jo<=i.manifestRetryMaxCount)return await(e=>new Promise((t=>{setTimeout((()=>{t()}),e)})))((0,u.getExponentialDelay)(jo-1,{start:i.manifestRetryInterval,max:i.manifestRetryMaxInterval})),zo(e,t,i)}return{qualityManifests:[],textTracks:[]}},Wo=zo,qo=class{destroy(){this.subscription.unsubscribe(),this.abortControllers.destroy.abort()}async prepare(e){try{let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),this.prepareUrl=t.toString();let{textTracks:i}=await this.fetchManifestData();await this.processTextTracks(i,this.params.sourceUrl)}catch(e){this.error("prepare",e)}}async processTextTracks(e,t){try{let i=await this.parseTextTracks(e,t);i&&(this.currentTextTrackData=i)}catch(e){this.error("processTextTracks",e)}}async parseTextTracks(e,t){for(let i of e){let e=new URL(i.url,t).toString(),r=await(await Ga(e,{signal:this.abortControllers.destroy.signal})).text();return{textTrack:i,playlist:this.parsePlaylist(r,e)}}}parsePlaylist(e,t){let i={mediaSequence:0,programDateTime:"",segments:[],targetDuration:0,vkPlaybackDuration:0,segmentStartTime:0,vkStartTime:""},r=e.split("\n"),a=0;for(let e=0;e<r.length;++e){let s=r[e];switch(!0){case s.startsWith("#EXTINF:"):{let n=r[++e],o=new URL(n,t).toString(),l=1e3*Number(this.extractPlaylistRowValue("#EXTINF:",s));if(i.segments.push({time:{from:a,to:a+l},url:o}),a+=l,!i.segmentStartTime){let e=new Date(i.vkStartTime).valueOf(),t=new Date(i.programDateTime).valueOf();i.segmentStartTime=t-e}break}case s.startsWith("#EXT-X-TARGETDURATION:"):i.targetDuration=Number(this.extractPlaylistRowValue("#EXT-X-TARGETDURATION:",s));break;case s.startsWith("#EXT-X-MEDIA-SEQUENCE:"):i.mediaSequence=Number(this.extractPlaylistRowValue("#EXT-X-MEDIA-SEQUENCE:",s));break;case s.startsWith("#EXT-X-VK-PLAYBACK-DURATION:"):i.vkPlaybackDuration=Number(this.extractPlaylistRowValue("#EXT-X-VK-PLAYBACK-DURATION:",s));break;case s.startsWith("#EXT-X-PROGRAM-DATE-TIME:"):{let e=this.extractPlaylistRowValue("#EXT-X-PROGRAM-DATE-TIME:",s);i.programDateTime=e;let t=new Date(e);t.setMilliseconds(0),a=t.valueOf();break}case s.startsWith("#EXT-X-VK-START-TIME:"):i.vkStartTime=this.extractPlaylistRowValue("#EXT-X-VK-START-TIME:",s)}}return i}extractPlaylistRowValue(e,t){return"#EXTINF:"===e?t.substring(e.length,t.length-1):t.substring(e.length)}processLiveTime(e){if((0,u.isNonNullable)(e)&&this.currentTextTrackData){let{segments:t}=this.currentTextTrackData.playlist,{from:i}=t[0].time,{to:r}=t[t.length-1].time;if(e<i||e>r)return;r-e<this.params.downloadThreshold&&this.fetchNextManifestData();for(let i of t)if(i.time.from<=e&&i.time.to>=e){this.availableTextTracks$.next([{...this.currentTextTrackData.textTrack,url:i.url,isAuto:!0}]);break}}}async fetchNextManifestData(){try{if(this.abortControllers.nextManifest)return;this.abortControllers.nextManifest=new Ya;let{textTracks:e}=await this.fetchManifestData(),t=await this.parseTextTracks(e,this.params.sourceUrl);this.currentTextTrackData&&t&&(this.currentTextTrackData.playlist.segments=t.playlist.segments)}catch(e){this.error("fetchNextManifestData",e)}finally{this.abortControllers.nextManifest=null}}async fetchManifestData(){let e=this.prepareUrl??this.params.sourceUrl;return await this.params.fetchManifestData(e,{signal:this.abortControllers.destroy.signal})}error(e,t){this.error$.next({id:"[LiveTextManager][HLS_LIVE_CMAF]",category:u.ErrorCategory.WTF,thrown:t,message:e})}constructor(e,t,i,r,a){this.subscription=new u.Subscription,this.abortControllers={destroy:new Ya,nextManifest:null},this.prepareUrl=void 0,this.currentTextTrackData=null,this.availableTextTracks$=new u.ValueSubject(null),this.getCurrentTime$=new u.ValueSubject(null),this.error$=new u.Subject,this.params={fetchManifestData:i,sourceUrl:r,downloadThreshold:a},this.subscription.add(e.pipe((0,u.throttle)(1e3)).subscribe((e=>{this.processLiveTime(e)}))),this.getCurrentTime$.next((()=>this.currentTextTrackData?this.currentTextTrackData.playlist.segmentStartTime/1e3+t.currentTime:0))}},Ho=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&!r&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsLiveProvider",category:u.ErrorCategory.WTF,message:"HlsLiveProvider internal logic error",thrown:t})},r=Fr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.ended$,e.endedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(_r(this.video,t.playbackRate,r.playbackRateState$,i)),a(Ba(this.video),e.elementVisible$),this.liveTextManager?(a(this.liveTextManager.getCurrentTime$,this.params.output.getCurrentTime$),a(this.liveTextManager.error$,this.params.output.error$)):this.textTracksManager&&this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.liveTextManager&&this.subscription.add(this.liveTextManager.availableTextTracks$.subscribe((e=>{e&&this.params.output.availableTextTracks$.next(e)}))),this.subscription.add(this.maxSeekBackTime$.pipe((0,u.filterChanged)(),(0,u.map)((e=>-e/1e3))).subscribe(this.params.output.duration$,i)),this.subscription.add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,u.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(_a(t.url)))}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),e&&"requested"===e.state&&this.seek(e.position)}),i)),this.subscription.add(r.loadedData$.subscribe((()=>{let e=this.video?.getStartDate?.()?.getTime();this.manifestStartTime$.next(e||void 0)}),i)),this.subscription.add((0,u.combine)({startTime:this.manifestStartTime$.pipe((0,u.filter)(u.isNonNullable)),currentTime:r.timeUpdate$}).subscribe((({startTime:e,currentTime:t})=>this.params.output.liveTime$.next(e+1e3*t)),i)),this.subscription.add(this.manifests$.pipe((0,u.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i));let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager?.destroy(),this.liveTextManager?.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,u.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}let a="HLS_LIVE_CMAF"===this.params.format?2:0,s=sr(r.toString(),this.liveOffset.getTotalOffset(),a);this.liveTextManager?.prepare(s),this.video.setAttribute("src",s),this.video.load(),Vo(s).then((e=>{if((0,u.isNullable)(e)){let e=this.params.source.maxSeekBackTime??this.maxSeekBackTime$.getValue();((0,u.isNullable)(e)||!isFinite(e))&&Ga(s).then((e=>e.text())).then((e=>{let t=/#EXT-X-STREAM-INF[^\n]+\n(.+)/m.exec(e)?.[1];if(t){let e=new URL(t,s).toString();Vo(e).then((e=>{(0,u.isNullable)(e)||this.maxSeekBackTime$.next(e)}))}})).catch((()=>{}))}else this.maxSeekBackTime$.next(e)}))}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next();let t=-e,i=t<this.maxSeekBackTime$.getValue()?t:0;this.liveOffset.resetTo(i),this.params.output.position$.next(-i/1e3),this.params.output.seekedEvent$.next()}generateLiveUrl(){let e=sr(this.params.source.url);if(this.params.tuning.useHlsLiveNewTextManager){let t=new URL(e);t.searchParams.set("enable-subtitles","yes"),e=t.toString()}return e}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.textTracksManager=null,this.liveTextManager=null,this.manifests$=new u.ValueSubject([]),this.liveOffset=new kr,this.manifestStartTime$=new u.ValueSubject(void 0),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();return this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e),this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:-this.liveOffset.getTotalOffset(),forcePrecise:!0}))}if("paused"!==i?.to&&"requested"===n.state)return this.videoState.startTransitionTo("ready"),this.seek(n.position&&n.position-this.liveOffset.getTotalPausedTime()),void this.prepare();switch(e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),this.liveOffset.pause(),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.liveOffset.pause(),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":if("playing"===t)if(this.videoState.startTransitionTo("playing"),this.liveOffset.getTotalPausedTime()<this.params.config.maxPausedTime&&this.liveOffset.getTotalOffset()<this.maxSeekBackTime$.getValue())this.liveOffset.resume(),this.playIfAllowed(),this.params.output.position$.next(-this.liveOffset.getTotalOffset()/1e3);else{let e=this.liveOffset.getTotalOffset();e>=this.maxSeekBackTime$.getValue()&&(e=0,this.liveOffset.resetTo(e)),this.liveOffset.resume(),this.params.output.position$.next(-e/1e3),this.prepare()}else"paused"===i?.to&&(or(this.params.desiredState.playbackState,"paused"),this.liveOffset.pause());return;case"changing_manifest":break;default:return(0,u.assertNever)(e)}},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:u.VideoQuality.INVARIANT,url:this.params.source.url};let t=(e,t)=>Wo(e,this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount},t);this.params.tuning.useHlsLiveNewTextManager?this.liveTextManager=new qo(this.params.output.liveTime$,this.video,t,this.params.source.url,this.params.tuning.hlsLiveNewTextManagerDownloadThreshold):this.textTracksManager=new Sr(e.source.url),t(this.generateLiveUrl()).then((({qualityManifests:e,textTracks:t})=>{0===e.length&&this.params.output.error$.next({id:"HlsLiveProviderInternal:empty_manifest",category:u.ErrorCategory.WTF,message:"HlsLiveProvider: there are no qualities in manifest"}),this.liveTextManager?.processTextTracks(t,this.params.source.url),this.manifests$.next([this.masterManifest,...e])})).catch((e=>{this.params.output.error$.next({id:"ExtractHlsQualities",category:u.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e})})),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.maxSeekBackTime$=new u.ValueSubject(e.source.maxSeekBackTime??1/0),this.subscribe()}},Ko=class{selectManifest(){let{autoVideoTrackSwitching:e,videoTrack:t}=this.params.desiredState,i=e.getState(),r=t.getTransition(),a=r?.to?.id??t.getState()?.id??"master",s=this.manifests$.getValue();if(!s.length)return;let n=i?"master":a;return i&&(!r||!r.from)&&t.startTransitionTo(this.masterManifest),s.find((e=>e.id===n))}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"HlsProvider",category:u.ErrorCategory.WTF,message:"HlsProvider internal logic error",thrown:t})},r=Fr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t));if(a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(vr(this.video,t.isLooped,i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(_r(this.video,t.playbackRate,r.playbackRateState$,i)),this.textTracksManager.connect(this.video,t,e),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready"),"playing"===this.videoState.getState()&&this.playIfAllowed()}),i).add(r.loadedMetadata$.subscribe((()=>{let e=this.params.desiredState.seekState.getState(),t=this.videoState.getTransition(),i=this.params.desiredState.videoTrack.getTransition(),r=this.params.desiredState.autoVideoTrackSwitching.getTransition();if(i&&(0,u.isNonNullable)(i.to)){let e=i.to.id;this.params.desiredState.videoTrack.setState(i.to);let t=this.manifests$.getValue().find((t=>t.id===e));t&&(this.params.output.currentVideoTrack$.next(t),this.params.output.hostname$.next(_a(t.url)))}let a=this.params.desiredState.playbackRate.getState(),s=this.params.output.element$.getValue()?.playbackRate;if(a!==s){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(a),e.playbackRate=a)}r&&this.params.desiredState.autoVideoTrackSwitching.setState(r.to),t&&"changing_manifest"===t.from&&this.videoState.setState(t.to),"requested"===e.state&&this.seek(e.position)}),i))),this.subscription.add(this.manifests$.pipe((0,u.map)((e=>e.map((({id:e,quality:t,size:i,bandwidth:r,fps:a})=>({id:e,quality:t,size:i,fps:a,bitrate:r})))))).subscribe(this.params.output.availableVideoTracks$,i)),!Ur.device.isIOS||!this.params.tuning.useNativeHLSTextTracks){let{textTracks:e}=this.video;this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"addtrack"),(0,u.fromEvent)(e,"removetrack"),(0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).subscribe((()=>{for(let t=0;t<e.length;t++)e[t].mode="hidden"}),i))}let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.seekState.stateChangeEnded$,t.videoTrack.stateChangeStarted$,t.autoVideoTrackSwitching.stateChangeStarted$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,this.manifests$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.selectManifest();if((0,u.isNullable)(e))return;let t=this.params.desiredState.autoVideoTrackLimits.getTransition(),i=this.params.desiredState.autoVideoTrackLimits.getState(),r=new URL(e.url);if((t||i)&&e.id===this.masterManifest.id){let{max:e,min:a}=t?.to??i??{};for(let[t,i]of[[e,"mq"],[a,"lq"]]){let e=String(parseFloat(t||""));i&&t&&r.searchParams.set(i,e)}}this.video.setAttribute("src",r.toString()),this.video.load()}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.manifests$=new u.ValueSubject([]),this.syncPlayback=()=>{if(!this.manifests$.getValue().length)return;let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition(),r=this.params.desiredState.videoTrack.getTransition(),a=this.params.desiredState.autoVideoTrackSwitching.getTransition(),s=this.params.desiredState.autoVideoTrackLimits.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let n=this.params.desiredState.seekState.getState();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r||a||s){let e=this.videoState.getState();this.videoState.setState("changing_manifest"),this.videoState.startTransitionTo(e);let{currentTime:t}=this.video;return this.prepare(),s&&this.params.output.autoVideoTrackLimits$.next(s.to),void("none"===n.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*t,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===n.state&&this.seek(n.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));case"changing_manifest":break;default:return(0,u.assertNever)(e)}},this.textTracksManager=new Sr(e.source.url),this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),this.masterManifest={id:"master",quality:u.VideoQuality.INVARIANT,url:this.params.source.url},this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),Wo(sr(this.params.source.url),this.params.source.url,{manifestRetryInterval:this.params.tuning.manifestRetryInterval,manifestRetryMaxInterval:this.params.tuning.manifestRetryMaxInterval,manifestRetryMaxCount:this.params.tuning.manifestRetryMaxCount}).then((({qualityManifests:e,textTracks:t})=>{this.manifests$.next([this.masterManifest,...e]),this.params.tuning.useNativeHLSTextTracks||this.params.desiredState.internalTextTracks.startTransitionTo(t)}),(e=>this.params.output.error$.next({id:"ExtractHlsQualities",category:u.ErrorCategory.NETWORK,message:"Error fetching manifest and extracting qualities",thrown:e}))),this.subscribe()}},Qo=v(Oe(),1),Go=v(ri(),1),Yo=v(oi(),1),Xo=class{subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"MpegProvider",category:u.ErrorCategory.WTF,message:"MpegProvider internal logic error",thrown:t})},r=Fr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.position$),a(r.durationChange$,e.duration$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(r.loadedMetadata$,e.firstBytesEvent$),a(r.loadedMetadata$,e.loadedMetadataEvent$),a(r.playing$,e.firstFrameEvent$),a(r.canplay$,e.canplay$),a(r.seeked$,e.seekedEvent$),a(r.inPiP$,e.inPiP$),a(r.inFullscreen$,e.inFullscreen$),a(this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>e.to))),this.params.output.playbackState$),this.subscription.add(vr(this.video,t.isLooped,i)),this.subscription.add(br(this.video,t.volume,r.volumeState$,i)),this.subscription.add(r.volumeState$.subscribe(this.params.output.volume$,i)),this.subscription.add(_r(this.video,t.playbackRate,r.playbackRateState$,i)),a(Ba(this.video),e.elementVisible$),this.subscription.add(r.playing$.subscribe((()=>{this.videoState.setState("playing"),or(t.playbackState,"playing")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused"),or(t.playbackState,"paused")}),i)).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready");let e=this.params.desiredState.videoTrack.getTransition();if(e&&(0,u.isNonNullable)(e.to)){this.params.desiredState.videoTrack.setState(e.to),this.params.output.currentVideoTrack$.next(this.trackUrls[e.to.id].track);let t=this.params.desiredState.playbackRate.getState(),i=this.params.output.element$.getValue()?.playbackRate;if(t!==i){let e=this.params.output.element$.getValue();e&&(this.params.desiredState.playbackRate.setState(t),e.playbackRate=t)}}"playing"===this.videoState.getState()&&this.playIfAllowed()}),i)),this.textTracksManager.connect(this.video,t,e);let s=(0,u.merge)(t.playbackState.stateChangeStarted$,t.videoTrack.stateChangeStarted$,t.seekState.stateChangeEnded$,t.autoVideoTrackLimits.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0));this.subscription.add(s.subscribe(this.syncPlayback,i))}destroy(){this.subscription.unsubscribe(),this.textTracksManager.destroy(),this.trackUrls={},this.params.output.element$.next(void 0),fr(this.video)}prepare(){let e=this.params.desiredState.videoTrack.getState()?.id;(0,u.assertNonNullable)(e,"MpegProvider: track is not selected");let{url:t}=this.trackUrls[e];(0,u.assertNonNullable)(t,`MpegProvider: No url for ${e}`),this.params.tuning.requestQuick&&(t=Js(t)),this.video.setAttribute("src",t),this.video.load(),this.params.output.hostname$.next(_a(t))}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}seek(e){this.params.output.willSeekEvent$.next(),this.video.currentTime=e/1e3}handleQualityLimitTransition(e){this.params.output.autoVideoTrackLimits$.next(e);let t=e=>{this.params.output.currentVideoTrack$.next(e),this.params.desiredState.videoTrack.startTransitionTo(e)},i=e=>{let i=ma(s,{container:this.video.getBoundingClientRect(),panelSize:this.params.panelSize,estimatedThroughput:this.params.dependencies.throughputEstimator.throughput$.getValue(),tuning:this.params.tuning.autoTrackSelection,forwardBufferHealth:0,limits:e,abrLogger:this.params.dependencies.abrLogger});t(i)},r=this.params.output.currentVideoTrack$.getValue()?.quality,a=!(!e.max&&!e.min),s=(0,Go.default)(this.trackUrls).map((e=>e.track));if(!r||!a||Jr(e,s[0].quality,(0,Yo.default)(s,-1)?.quality))return void i();let n=!e.max||(0,u.isLowerOrEqual)(r,e.max),o=!e.min||(0,u.isHigherOrEqual)(r,e.min);n&&o||i(e)}constructor(e){this.subscription=new u.Subscription,this.videoState=new lr("stopped"),this.trackUrls={},this.textTracksManager=new Sr,this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.removeAttribute("src"),this.video.load(),this.params.output.position$.next(0),this.params.output.duration$.next(1/0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.autoVideoTrackLimits.getTransition(),a=this.params.desiredState.videoTrack.getTransition(),s=this.params.desiredState.seekState.getState();if(!r||"ready"===e||a){if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(a){let{currentTime:e}=this.video;return this.prepare(),void("none"===s.state&&this.params.desiredState.seekState.setState({state:"requested",position:1e3*e,forcePrecise:!0}))}switch("paused"!==i?.to&&"requested"===s.state&&this.seek(s.position),e){case"ready":return void("ready"===t?or(this.params.desiredState.playbackState,"ready"):"paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}}else this.handleQualityLimitTransition(r.to)},this.params=e,this.video=pr(e.container,e.tuning),this.params.output.element$.next(this.video),(0,Qo.default)(this.params.source).reverse().forEach((([e,t],i)=>{let r=i.toString(10);this.trackUrls[r]={track:{quality:e,id:r},url:t}})),this.params.output.isLive$.next(!1),this.params.output.availableVideoTracks$.next((0,Go.default)(this.trackUrls).map((({track:e})=>e))),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.desiredState.autoVideoTrackSwitching.setState(!1),this.params.output.autoVideoTrackLimitingAvailable$.next(!0),this.subscribe()}},Zo=["stun:videostun.mycdn.me:80"],Jo=()=>null,el=class{onStart(e){try{this.externalStartCallback=e}catch(e){this.handleSystemError(e)}}onStop(e){try{this.externalStopCallback=e}catch(e){this.handleSystemError(e)}}onError(e){try{this.externalErrorCallback=e}catch(e){this.handleSystemError(e)}}connect(){this.connectWS()}disconnect(){try{this.externalStopCallback(),this.closeConnections()}catch(e){this.handleSystemError(e)}}connectWS(){this.ws||(this.ws=new WebSocket(this.serverUrl),this.ws.onopen=this.onSocketOpen.bind(this),this.ws.onmessage=this.onSocketMessage.bind(this),this.ws.onclose=this.onSocketClose.bind(this),this.ws.onerror=this.onSocketError.bind(this))}onSocketOpen(){this.handleLogin()}onSocketClose(e){try{if(!this.ws)return;this.ws=null,e.code>1e3?(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():this.scheduleRetry()):this.externalStopCallback()}catch(e){this.handleRTCError(e)}}onSocketError(e){try{this.externalErrorCallback(new Error(e.toString()))}catch(e){this.handleRTCError(e)}}onSocketMessage(e){try{let t=this.parseMessage(e.data);switch(t.type){case"JOIN":case"CALL_JOIN":this.handleJoinMessage(t);break;case"UPDATE":this.handleUpdateMessage(t);break;case"STATUS":this.handleStatusMessage(t)}}catch(e){this.handleRTCError(e)}}handleJoinMessage(e){switch(e.inviteType){case"ANSWER":this.handleAnswer(e.sdp);break;case"CANDIDATE":this.handleCandidate(e.candidate)}}handleStatusMessage(e){if("UNPUBLISHED"===e.status)this.handleUnpublished()}async handleUpdateMessage(e){try{let t=await this.createOffer();this.peerConnection&&await this.peerConnection.setLocalDescription(t),this.handleAnswer(e.sdp)}catch(e){this.handleRTCError(e)}}async handleLogin(){try{let e={iceServers:[{urls:Zo}]};this.peerConnection=new RTCPeerConnection(e),this.peerConnection.ontrack=this.onPeerConnectionStream.bind(this),this.peerConnection.onicecandidate=this.onPeerConnectionIceCandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this.onPeerConnectionIceConnectionStateChange.bind(this);let t=await this.createOffer();await this.peerConnection.setLocalDescription(t),this.send({type:this.signalingType,inviteType:"OFFER",streamKey:this.streamKey,sdp:t.sdp,callSupport:!1})}catch(e){this.handleRTCError(e)}}async handleAnswer(e){try{this.peerConnection&&await this.peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){this.handleRTCError(e)}}async handleCandidate(e){if(e)try{this.peerConnection&&await this.peerConnection.addIceCandidate(e)}catch(e){this.handleRTCError(e)}}handleUnpublished(){try{this.closeConnections(),this.externalStopCallback()}catch(e){this.handleRTCError(e)}}handleSystemError(e){this.options.errorChanel&&this.options.errorChanel.next({id:"webrtc-provider-error",category:u.ErrorCategory.WTF,message:e.message})}async onPeerConnectionStream(e){let t=e.streams[0];this.stream&&this.stream.id===t.id||(this.stream=t,this.externalStartCallback(this.stream))}onPeerConnectionIceCandidate(e){e.candidate&&this.send({type:this.signalingType,inviteType:"CANDIDATE",candidate:e.candidate})}onPeerConnectionIceConnectionStateChange(){if(this.peerConnection){let e=this.peerConnection.iceConnectionState;["failed","closed"].indexOf(e)>-1&&(this.retryCount++,this.retryCount>this.options.maxRetryNumber?this.handleNetworkError():(this.closeConnections(),this.scheduleRetry()))}}async createOffer(){if(!this.peerConnection)throw new Error("Can not create offer - no peer connection instance ");let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,voiceActivityDetection:!1}),t=e.sdp||"";if(!/^a=rtpmap:\d+ H264\/\d+$/m.test(t))throw new Error("No h264 codec support error");return e}handleRTCError(e){try{this.externalErrorCallback(e||new Error("RTC connection error"))}catch(e){this.handleSystemError(e)}}handleNetworkError(){try{this.externalErrorCallback(new Error("Network error"))}catch(e){this.handleSystemError(e)}}send(e){this.ws&&this.ws.send(JSON.stringify(e))}parseMessage(e){try{return JSON.parse(e)}catch{throw new Error("Can not parse socket message")}}closeConnections(){let e=this.ws;e&&(this.ws=null,e.close(1e3)),this.removePeerConnection()}removePeerConnection(){let e=this.peerConnection;e&&(this.peerConnection=null,e.close(),e.ontrack=null,e.onicecandidate=null,e.oniceconnectionstatechange=null,e=null)}scheduleRetry(){this.retryTimeout=setTimeout(this.connectWS.bind(this),1e3)}normalizeOptions(e={}){let t={stunServerList:Zo,maxRetryNumber:3,errorChanel:null};return e.stunServerList&&(t.stunServerList=e.stunServerList),e.maxRetryNumber&&e.maxRetryNumber>0&&(t.maxRetryNumber=e.maxRetryNumber),t}constructor(e,t){this.ws=null,this.peerConnection=null,this.serverUrl="",this.streamKey="",this.stream=null,this.signalingType="JOIN",this.retryCount=0,this.externalStartCallback=Jo,this.externalStopCallback=Jo,this.externalErrorCallback=Jo,this.options=this.normalizeOptions(t);let i=e.split("/");this.serverUrl=i.slice(0,i.length-1).join("/"),this.streamKey=i[i.length-1]}},tl=class{destroy(){this.subscription.unsubscribe(),this.liveStreamClient.disconnect(),this.params.output.element$.next(void 0),fr(this.video)}subscribe(){let{output:e,desiredState:t}=this.params,i=t=>{e.error$.next({id:"WebRTCLiveProvider",category:u.ErrorCategory.WTF,message:"WebRTCLiveProvider internal logic error",thrown:t})};this.subscription.add((0,u.merge)(this.videoState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,type:"start"})))),this.videoState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,type:"end"}))))).subscribe((({transition:e,type:t})=>{this.log({message:`[videoState change] ${t}: ${JSON.stringify(e)}`})})));let r=Fr(this.video);this.subscription.add((()=>r.destroy()));let a=(e,t)=>this.subscription.add(e.subscribe(t,i));a(r.timeUpdate$,e.liveTime$),a(r.ended$,e.endedEvent$),a(r.looped$,e.loopedEvent$),a(r.error$,e.error$),a(r.isBuffering$,e.isBuffering$),a(r.currentBuffer$,e.currentBuffer$),a(Ba(this.video),this.params.output.elementVisible$),this.subscription.add(r.durationChange$.subscribe((t=>{e.duration$.next(t===1/0?0:t)}))).add(r.canplay$.subscribe((()=>{"ready"===this.videoState.getTransition()?.to&&this.videoState.setState("ready")}),i)).add(r.pause$.subscribe((()=>{this.videoState.setState("paused")}),i)).add(r.playing$.subscribe((()=>{this.videoState.setState("playing")}),i)).add(r.error$.subscribe(e.error$)).add(this.maxSeekBackTime$.subscribe(this.params.output.duration$)).add(br(this.video,t.volume,r.volumeState$,i)).add(r.volumeState$.subscribe(e.volume$,i)).add(this.videoState.stateChangeEnded$.subscribe((i=>{switch(i.to){case"stopped":e.position$.next(0),e.duration$.next(0),t.playbackState.setState("stopped");break;case"ready":break;case"paused":t.playbackState.setState("paused");break;case"playing":t.playbackState.setState("playing");break;default:return(0,u.assertNever)(i.to)}}),i)).add((0,u.merge)(t.playbackState.stateChangeStarted$,this.videoState.stateChangeEnded$,(0,u.observableFrom)(["init"])).pipe((0,u.debounce)(0)).subscribe(this.syncPlayback.bind(this),i)),this.subscription.add(t.isLooped.stateChangeStarted$.subscribe((()=>t.isLooped.setState(!1)),i)),this.subscription.add(t.autoVideoTrackSwitching.stateChangeStarted$.subscribe((()=>t.autoVideoTrackSwitching.setState(!1)),i))}onLiveStreamStart(e){this.params.output.element$.next(this.video),this.params.output.duration$.next(0),this.params.output.position$.next(0),this.params.output.isLive$.next(!0),this.params.output.canChangePlaybackSpeed$.next(!1),this.params.output.hostname$.next(_a(this.params.source.url)),this.params.output.autoVideoTrackLimitingAvailable$.next(!1),this.params.output.availableVideoTracks$.next([]),this.params.output.availableAudioTracks$.next([]),this.params.output.isAudioAvailable$.next(!0),this.params.output.currentVideoTrack$.next({id:"webrtc",quality:u.VideoQuality.INVARIANT}),this.video.srcObject=e,or(this.params.desiredState.playbackState,"playing")}onLiveStreamStop(){this.videoState.startTransitionTo("stopped"),this.syncPlayback(),this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.params.output.endedEvent$.next()}onLiveStreamError(e){this.onLiveStreamStop(),this.params.output.error$.next({id:"WebRTC stream runtime error",category:u.ErrorCategory.EXTERNAL_API,message:e.message,thrown:e})}playIfAllowed(){ka(this.video,(()=>{this.params.output.soundProhibitedEvent$.next()})).then((e=>{e||(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused",!0))}),(e=>this.params.output.error$.next({id:"ForcePlay",message:"play() failed even with workarounds",category:u.ErrorCategory.DOM,thrown:e})))}prepare(){this.liveStreamClient.connect()}constructor(e){this.videoState=new lr("stopped"),this.maxSeekBackTime$=new u.ValueSubject(0),this.syncPlayback=()=>{let e=this.videoState.getState(),t=this.params.desiredState.playbackState.getState(),i=this.params.desiredState.playbackState.getTransition();if("stopped"===t)return void("stopped"!==e&&(this.videoState.startTransitionTo("stopped"),this.video.pause(),this.video.srcObject=null,this.params.output.position$.next(0),this.params.output.duration$.next(0),this.params.output.currentBuffer$.next(void 0),this.params.output.hostname$.next(void 0),this.videoState.setState("stopped"),or(this.params.desiredState.playbackState,"stopped",!0)));if(this.videoState.getTransition())return;let r=this.params.desiredState.videoTrack.getTransition();if("stopped"===e)return this.videoState.startTransitionTo("ready"),void this.prepare();if(r)this.prepare();else switch(e){case"ready":return void("paused"===t?(this.videoState.setState("paused"),or(this.params.desiredState.playbackState,"paused")):"playing"===t&&(this.videoState.startTransitionTo("playing"),this.playIfAllowed()));case"playing":return void("paused"===t?(this.videoState.startTransitionTo("paused"),this.video.paused?this.videoState.setState("paused"):this.video.pause()):"playing"===i?.to&&or(this.params.desiredState.playbackState,"playing"));case"paused":return void("playing"===t?(this.videoState.startTransitionTo("playing"),this.playIfAllowed()):"paused"===i?.to&&or(this.params.desiredState.playbackState,"paused"));default:return(0,u.assertNever)(e)}},this.subscription=new u.Subscription,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("WebRTCLiveProvider"),this.video=pr(e.container,e.tuning),this.liveStreamClient=new el(this.params.source.url,{maxRetryNumber:this.params.tuning.webrtc.connectionRetryMaxNumber,errorChanel:this.params.output.error$}),this.liveStreamClient.onStart(this.onLiveStreamStart.bind(this)),this.liveStreamClient.onStop(this.onLiveStreamStop.bind(this)),this.liveStreamClient.onError(this.onLiveStreamError.bind(this)),this.params.output.availableTextTracks$.next([]),this.params.desiredState.internalTextTracks.setState([]),this.subscribe()}},il=class{next(){this.current=this.iterator.next()}getValue(){if(this.current.done)throw new Error("Iterable is completed");return this.current.value}isCompleted(){return!!this.current.done}constructor(e){this.iterator=e[Symbol.iterator](),this.next()}};var rl=(r=class e{subscribe(e){Ur.browser.isSafari&&"MPEG"!==e||this.subscriptions.add((0,u.combine)({video:this.providerOutput.element$,playbackState:this.providerOutput.playbackState$,volume:this.providerOutput.volume$}).pipe((0,u.filter)((({playbackState:e,video:t,volume:{muted:i,volume:r}})=>"playing"===e&&!!t&&!i&&!!r)),(0,u.once)()).subscribe((({video:e})=>{this.initAudioContextOnce(e).then((e=>{e||this.destroy()})).catch((e=>{this.handleError(e),this.destroy()}))})))}static isSupported(){return"AudioContext"in window&&"GainNode"in window&&"MediaElementAudioSourceNode"in window}async initAudioContextOnce(e){let{volumeMultiplier:t}=this,i=new(window.AudioContext||window.webkitAudioContext);this.audioContext=i;let r=i.createGain();if(this.gainNode=r,r.gain.value=t,r.connect(i.destination),"suspended"===i.state&&(await i.resume(),this.destroyController.signal.aborted))return!1;let a=i.createMediaElementSource(e);return this.mediaElementSource=a,a.connect(r),!0}cleanup(){this.mediaElementSource&&(this.mediaElementSource.disconnect(),this.mediaElementSource=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null)}destroy(){this.destroyController.abort(),this.subscriptions.unsubscribe(),this.cleanup()}handleError(t){this.volumeMultiplierError$.next({id:e.errorId,category:u.ErrorCategory.VIDEO_PIPELINE,message:t?.message??`${e.errorId} exception`,thrown:t})}constructor(e,t,i,r){this.providerOutput=e,this.provider$=t,this.volumeMultiplierError$=i,this.volumeMultiplier=r,this.destroyController=new Ya,this.subscriptions=new u.Subscription,this.audioContext=null,this.gainNode=null,this.mediaElementSource=null,this.subscriptions.add(this.provider$.pipe((0,u.filter)((e=>!!e.type)),(0,u.once)()).subscribe((({type:e})=>this.subscribe(e))))}},r.errorId="VolumeMultiplierManager",r),al={chunkDuration:5e3,maxParallelRequests:5},sl=class{init(){this.subscription.add(this.initProviderErrorHandling()),this.subscription.add(this.params.dependencies.chromecastInitializer.connection$.subscribe((()=>{this.reinitProvider()})))}destroy(){this.destroyProvider(),this.current$.next({type:void 0}),this.subscription.unsubscribe(),this.volumeMultiplierManager?.destroy(),this.volumeMultiplierManager=null,this.tracer.end()}initProvider(){let e,t=this.chooseDestination(),i=this.chooseFormat(t);if((0,u.isNullable)(i))this.handleNoFormatsError(t);else{try{e=this.createProvider(t,i)}catch(e){this.providerError$.next({id:"ProviderNotConstructed",category:u.ErrorCategory.WTF,message:"Failed to create provider",thrown:e})}e?this.current$.next({type:i,provider:e,destination:t}):this.current$.next({type:void 0})}}reinitProvider(){this.tracer.log("reinitProvider"),this.destroyProvider(),this.initProvider()}switchToNextProvider(e){this.tracer.log("switchToNextProvider",{destination:e}),this.destroyProvider(),this.failoverIndex=void 0,this.skipFormat(e),this.initProvider()}destroyProvider(){let e=this.current$.getValue().provider;if(!e)return;this.log({message:"destroyProvider"}),this.tracer.log("destroyProvider"),e.destroy();let t=1e3*this.providerOutput.position$.getValue(),i=this.params.desiredState.seekState.getState(),r="none"!==i.state;if(this.params.desiredState.seekState.setState({state:"requested",position:r?i.position:t,forcePrecise:!!r&&i.forcePrecise}),e.scene3D){let t=e.scene3D.getCameraRotation();this.params.desiredState.cameraOrientation.setState({x:t.x,y:t.y})}let a=this.providerOutput.isBuffering$;a.getValue()||a.next(!0)}createProvider(e,t){switch(this.log({message:`createProvider: ${e}:${t}`}),this.tracer.log("createProvider",{destination:e,format:t}),e){case"SCREEN":return this.createScreenProvider(t);case"CHROMECAST":return this.createChromecastProvider(t);default:return(0,u.assertNever)(e)}}createScreenProvider(e){let{sources:t,container:i,desiredState:r,panelSize:a}=this.params,s=this.providerOutput,n={container:i,source:null,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning,panelSize:a};switch(e){case"DASH_SEP":case"DASH_WEBM":case"DASH_WEBM_AV1":case"DASH_ONDEMAND":case"DASH_STREAMS":{let i=this.applyFailoverHost(t[e]),r=this.applyFailoverHost(t.HLS_ONDEMAND||t.HLS);return(0,u.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new Oo({...n,source:i,sourceHls:r}):new Mn({...n,source:i,sourceHls:r})}case"DASH_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),this.params.tuning.useNewDashProvider?new Bo({...n,source:i}):new In({...n,source:i})}case"HLS":case"HLS_ONDEMAND":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Ko({...n,source:i})}case"HLS_LIVE":case"HLS_LIVE_CMAF":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Ho({...n,source:i,config:{maxPausedTime:this.params.tuning.live.maxPausedTime},format:e})}case"MPEG":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Xo({...n,source:i})}case"DASH_LIVE":{let i=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(i),new Ua({...n,source:i,config:{...al,maxPausedTime:this.params.tuning.live.maxPausedTime}})}case"WEB_RTC_LIVE":{let a=this.applyFailoverHost(t[e]);return(0,u.assertNonNullable)(a),new tl({container:i,source:a,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}case"DASH":case"DASH_LIVE_WEBM":throw new Error(`${e} is no longer supported`);default:return(0,u.assertNever)(e)}}createChromecastProvider(e){let{sources:t,container:i,desiredState:r,meta:a}=this.params,s=this.providerOutput,n=this.params.dependencies.chromecastInitializer.connection$.getValue();return(0,u.assertNonNullable)(n),new ur({connection:n,meta:a,container:i,source:t,format:e,desiredState:r,output:s,dependencies:this.params.dependencies,tuning:this.params.tuning})}chooseDestination(){return this.params.dependencies.chromecastInitializer.connection$.getValue()?"CHROMECAST":"SCREEN"}chooseFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.isCompleted()?void 0:this.screenFormatsIterator.getValue();case"CHROMECAST":return this.chromecastFormatsIterator.isCompleted()?void 0:this.chromecastFormatsIterator.getValue();default:return(0,u.assertNever)(e)}}skipFormat(e){switch(e){case"SCREEN":return this.screenFormatsIterator.next();case"CHROMECAST":return this.chromecastFormatsIterator.next();default:return(0,u.assertNever)(e)}}handleNoFormatsError(e){switch(e){case"SCREEN":return this.noAvailableProvidersError$.next(this.params.tuning.forceFormat),void this.current$.next({type:void 0});case"CHROMECAST":return void this.params.dependencies.chromecastInitializer.disconnect();default:return(0,u.assertNever)(e)}}applyFailoverHost(e){if(void 0===this.failoverIndex)return e;let t=this.params.failoverHosts[this.failoverIndex];if(!t)return e;let i=e=>{let i=new URL(e);return i.host=t,i.toString()};if(void 0===e)return e;if("type"in e){if("raw"===e.type)return e;if("url"===e.type)return{...e,url:i(e.url)}}return(0,rr.default)((0,ir.default)(e).map((([e,t])=>[e,i(t)])))}initProviderErrorHandling(){let e=new u.Subscription,t=!1,i=0;return e.add((0,u.merge)(this.providerOutput.error$.pipe((0,u.filter)((e=>!this.params.tuning.ignoreAudioRendererError||!e.message||!/AUDIO_RENDERER_ERROR/gi.test(e.message)))),(r={desiredPlaybackState$:this.params.desiredState.playbackState,maxTransitionInterval:this.params.tuning.maxPlaybackTransitionInterval,position$:this.providerOutput.position$,providerChanged$:this.current$},new u.Observable((e=>{let t=new u.Subscription,i=r.desiredPlaybackState$.stateChangeStarted$.pipe((0,u.map)((({from:e,to:t})=>`${e}-${t}`))),a=r.desiredPlaybackState$.stateChangeEnded$,s=r.providerChanged$.pipe((0,u.map)((({type:e})=>void 0!==e))),n=new u.Subject,o=0,l="unknown";return t.add(i.subscribe((e=>{o&&window.clearTimeout(o),l=e,o=window.setTimeout((()=>n.next(e)),r.maxTransitionInterval)}))),t.add(a.subscribe((()=>{window.clearTimeout(o),l="unknown",o=0}))),t.add(s.subscribe((e=>{o&&(window.clearTimeout(o),o=0,e&&(o=window.setTimeout((()=>n.next(l)),r.maxTransitionInterval)))}))),t.add(n.subscribe(e)),()=>{window.clearTimeout(o),t.unsubscribe()}}))).pipe((0,u.map)((e=>({id:`ProviderHangup:${e}`,category:u.ErrorCategory.WTF,message:`A ${e} transition failed to complete within reasonable time`}))))).subscribe(this.providerError$)),e.add(this.providerOutput.fetcherError$.subscribe(this.providerError$)),e.add(this.current$.subscribe((()=>{t=!1;let i=this.params.desiredState.playbackState.transitionEnded$.pipe((0,u.filter)((({to:e})=>"playing"===e)),(0,u.once)()).subscribe((()=>t=!0));e.add(i)}))),e.add(this.providerError$.subscribe((e=>{let r=this.current$.getValue().destination,a={error:e,currentDestination:r};if("CHROMECAST"===r)this.destroyProvider(),this.params.dependencies.chromecastInitializer.stopMedia().then((()=>this.switchToNextProvider("SCREEN")),(()=>this.params.dependencies.chromecastInitializer.disconnect()));else{let s=e.category===u.ErrorCategory.NETWORK,n=e.category===u.ErrorCategory.FATAL,o=this.params.failoverHosts.length>0&&(void 0===this.failoverIndex||this.failoverIndex<this.params.failoverHosts.length-1),l=i<this.params.tuning.providerErrorLimit&&!n,d=o&&!n&&(s&&t||!l);a={...a,isNetworkError:s,isFatalError:n,haveFailoverHost:o,tryFailover:d,canReinitProvider:l},l?(i++,this.reinitProvider()):d?(this.failoverIndex=void 0===this.failoverIndex?0:this.failoverIndex+1,this.reinitProvider()):(i=0,this.switchToNextProvider(r??"SCREEN"))}e.traceAsLog?this.tracer.log("providerInfo",(0,u.flattenObject)(a)):this.tracer.error("providerError",(0,u.flattenObject)(a))}))),e;var r}constructor(e){this.current$=new u.ValueSubject({type:void 0}),this.providerError$=new u.Subject,this.noAvailableProvidersError$=new u.Subject,this.volumeMultiplierError$=new u.Subject,this.providerOutput={position$:new u.ValueSubject(0),duration$:new u.ValueSubject(1/0),volume$:new u.ValueSubject({muted:!1,volume:1}),availableVideoStreams$:new u.ValueSubject([]),currentVideoStream$:new u.ValueSubject(void 0),availableVideoTracks$:new u.ValueSubject([]),currentVideoTrack$:new u.ValueSubject(void 0),availableAudioStreams$:new u.ValueSubject([]),currentAudioStream$:new u.ValueSubject(void 0),availableAudioTracks$:new u.ValueSubject([]),currentVideoSegmentLength$:new u.ValueSubject(0),currentAudioSegmentLength$:new u.ValueSubject(0),isAudioAvailable$:new u.ValueSubject(!0),autoVideoTrackLimitingAvailable$:new u.ValueSubject(!1),autoVideoTrackLimits$:new u.ValueSubject(void 0),currentBuffer$:new u.ValueSubject(void 0),isBuffering$:new u.ValueSubject(!0),error$:new u.Subject,fetcherError$:new u.Subject,fetcherRecoverableError$:new u.Subject,warning$:new u.Subject,willSeekEvent$:new u.Subject,soundProhibitedEvent$:new u.Subject,seekedEvent$:new u.Subject,loopedEvent$:new u.Subject,endedEvent$:new u.Subject,firstBytesEvent$:new u.Subject,loadedMetadataEvent$:new u.Subject,firstFrameEvent$:new u.Subject,canplay$:new u.Subject,isLive$:new u.ValueSubject(void 0),isLiveEnded$:new u.ValueSubject(null),isLowLatency$:new u.ValueSubject(!1),canChangePlaybackSpeed$:new u.ValueSubject(!0),liveTime$:new u.ValueSubject(void 0),liveBufferTime$:new u.ValueSubject(void 0),liveLatency$:new u.ValueSubject(void 0),severeStallOccurred$:new u.Subject,availableTextTracks$:new u.ValueSubject([]),currentTextTrack$:new u.ValueSubject(void 0),hostname$:new u.ValueSubject(void 0),httpConnectionType$:new u.ValueSubject(void 0),httpConnectionReused$:new u.ValueSubject(void 0),inPiP$:new u.ValueSubject(!1),inFullscreen$:new u.ValueSubject(!1),element$:new u.ValueSubject(void 0),elementVisible$:new u.ValueSubject(!0),availableSources$:new u.ValueSubject(void 0),is3DVideo$:new u.ValueSubject(!1),playbackState$:new u.ValueSubject(""),getCurrentTime$:new u.ValueSubject(null)},this.subscription=new u.Subscription,this.volumeMultiplierManager=null,this.params=e,this.log=this.params.dependencies.logger.createComponentLog("ProviderContainer"),this.tracer=e.dependencies.tracer.createComponentTracer(this.constructor.name);let t=((e,{useManagedMediaSource:t,useOldMSEDetection:i})=>{let{containers:r,protocols:a,codecs:s,nativeHlsSupported:n}=Ur.video,o=(s.h264||s.h265)&&s.aac,l=a.mse&&(!i||!!window.MediaStreamTrack)||a.mms&&t;return e.filter((e=>{switch(e){case"DASH_SEP":case"DASH_LIVE":case"DASH_ONDEMAND":return l&&r.mp4&&o;case"DASH_WEBM":return l&&r.webm&&s.vp9&&s.opus;case"DASH_WEBM_AV1":return l&&r.webm&&s.av1&&s.opus;case"DASH_STREAMS":return l&&(r.mp4&&o||r.webm&&(s.vp9||s.av1)&&(s.opus||s.aac));case"DASH_LIVE_CMAF":return l&&r.mp4&&o&&r.cmaf;case"HLS":case"HLS_ONDEMAND":case"HLS_LIVE":case"HLS_LIVE_CMAF":return n;case"MPEG":return r.mp4;case"DASH":case"DASH_LIVE_WEBM":return!1;case"WEB_RTC_LIVE":return a.webrtc&&a.ws&&s.h264&&(r.mp4||r.webm);default:return(0,u.assertNever)(e)}}))})([...vn(this.params.tuning),...gn(this.params.tuning)],this.params.tuning).filter((t=>(0,u.isNonNullable)(e.sources[t]))),{forceFormat:i,formatsToAvoid:r}=this.params.tuning,a=[];a=i?[i]:r.length?[...t.filter((e=>!(0,tr.default)(r,e))),...t.filter((e=>(0,tr.default)(r,e)))]:t,this.log({message:`Selected formats: ${a.join(" > ")}`}),this.tracer.log("Selected formats",(0,u.flattenObject)(a)),this.screenFormatsIterator=new il(a);let s=[...bn(!0),...bn(!1)];this.chromecastFormatsIterator=new il(s.filter((t=>(0,u.isNonNullable)(e.sources[t])))),this.providerOutput.availableSources$.next(e.sources);let{volumeMultiplier:n=1,tuning:{useVolumeMultiplier:o}}=this.params;o&&1!==n&&rl.isSupported()&&(this.volumeMultiplierManager=new rl(this.providerOutput,this.current$,this.volumeMultiplierError$,n))}},nl="one_video_throughput",ol="one_video_rtt",ll=window.navigator.connection,ul=()=>{let e=ll?.downlink;if((0,u.isNonNullable)(e)&&10!==e)return 1e3*e},dl=()=>{let e=ll?.rtt;if((0,u.isNonNullable)(e)&&3e3!==e)return e},cl=(e,t,i)=>{let r=8*i;return r/(r/e+t)},hl=class e{destroy(){this.concurrentDownloads.clear(),this.subscription.unsubscribe()}trackXHR(e){let t=0,i=(0,u.now)(),r=new u.Subscription;switch(this.subscription.add(r),this.concurrentDownloads.add(e),e.readyState){case 4:break;case 3:case 2:r.add((0,u.fromEvent)(e,"progress").pipe((0,u.once)()).subscribe((e=>{t=e.loaded,i=(0,u.now)()})));break;case 1:case 0:r.add((0,u.fromEvent)(e,"loadstart").subscribe((()=>{t=0,i=(0,u.now)()})))}r.add((0,u.fromEvent)(e,"loadend").subscribe((a=>{if(200===e.status){let e=a.loaded,r=(0,u.now)(),s=e-t,n=r-i;this.addRawSpeed(s,n,1)}this.concurrentDownloads.delete(e),r.unsubscribe()})))}trackStream(e,t=!1){let i=e.getReader();if(!i)return void e.cancel("Could not get reader");let r=0,a=(0,u.now)(),s=0,n=(0,u.now)(),o=t=>{this.concurrentDownloads.delete(e),i.releaseLock(),e.cancel(`Throughput Estimator error: ${t}`).catch((()=>{}))},l=async({done:d,value:c})=>{if(d)!t&&this.addRawSpeed(r,(0,u.now)()-a,1),this.concurrentDownloads.delete(e);else if(c){if(t){let e=(0,u.now)();if(e-n>this.tuningConfig.lowLatency.continuesByteSequenceInterval||e-a>this.tuningConfig.lowLatency.maxLastEvaluationTimeout){let e=n-a;e&&this.addRawSpeed(s,e,1,t),s=c.byteLength,a=(0,u.now)()}else s+=c.byteLength;n=(0,u.now)()}else r+=c.byteLength,s+=c.byteLength,s>=this.tuningConfig.streamMinSampleSize&&(0,u.now)()-n>=this.tuningConfig.streamMinSampleTime&&(this.addRawSpeed(s,(0,u.now)()-n,this.concurrentDownloads.size),s=0,n=(0,u.now)());await(i?.read().then(l,o))}};this.concurrentDownloads.add(e),i?.read().then(l,o)}addRawSpeed(t,i,r=1,a=!1){if(e.sanityCheck(t,i,a)){let e=8*t/i;this.throughput.next(e*r)}}addRawThroughput(e){this.throughput.next(e)}addRawRtt(e){this.rtt.next(e)}static sanityCheck(e,t,i=!1){let r=8*e/t;return!(!r||!isFinite(r)||r>1e6||r<30||i&&e<1e4||!i&&e<10240||!i&&t<=20)}static load(e){let t=u.safeStorage.get(e);if((0,u.isNonNullable)(t))return parseInt(t,10)??void 0}constructor(t){this.subscription=new u.Subscription,this.concurrentDownloads=new Set,this.tuningConfig=t;let i=e.load(nl)||(t.useBrowserEstimation?ul():void 0)||5e3,r=e.load(ol)??(t.useBrowserEstimation?dl():void 0)??0;if(this.throughput$=new u.ValueSubject(i),this.rtt$=new u.ValueSubject(r),this.rttAdjustedThroughput$=new u.ValueSubject(cl(i,r,t.rttPenaltyRequestSize)),this.throughput=cn.getSmoothedValue(i,-1,t),this.rtt=cn.getSmoothedValue(r,1,t),t.useBrowserEstimation){let e=()=>{let e=ul();e&&this.throughput.next(e);let t=dl();(0,u.isNonNullable)(t)&&this.rtt.next(t)};ll&&"onchange"in ll&&this.subscription.add((0,u.fromEvent)(ll,"change").subscribe(e)),e()}this.subscription.add(this.throughput.smoothed$.subscribe((e=>{u.safeStorage.set(nl,e.toFixed(0))}))),this.subscription.add(this.rtt.smoothed$.subscribe((e=>{u.safeStorage.set(ol,e.toFixed(0))}))),this.subscription.add(this.throughput.debounced$.subscribe(this.throughput$)),this.subscription.add(this.rtt.debounced$.subscribe(this.rtt$)),this.subscription.add((0,u.combine)({throughput:this.throughput.smoothed$,rtt:this.rtt.smoothed$}).pipe((0,u.map)((({throughput:e,rtt:i})=>cl(e,i,t.rttPenaltyRequestSize))),(0,u.filter)((e=>{let i=this.rttAdjustedThroughput$.getValue()||0;return Math.abs(e-i)/i>=t.changeThreshold}))).subscribe(this.rttAdjustedThroughput$))}},pl={configName:["core"],throughputEstimator:{type:"EmaAndMa",emaAlphaSlow:.2,emaAlphaFast:.7,emaAlpha:.45,basisTrendChangeCount:10,changeThreshold:.05,useBrowserEstimation:!0,rttPenaltyRequestSize:1048576,streamMinSampleSize:10240,streamMinSampleTime:300,deviationDepth:20,deviationFactor:.5,lowLatency:{continuesByteSequenceInterval:50,maxLastEvaluationTimeout:300}},autoTrackSelection:{maxBitrateFactorAtEmptyBuffer:4,bitrateFactorAtEmptyBuffer:2.8,minBitrateFactorAtEmptyBuffer:1.5,bitrateAudioFactorAtEmptyBuffer:10,maxBitrateFactorAtFullBuffer:3,bitrateFactorAtFullBuffer:2,minBitrateFactorAtFullBuffer:1,bitrateAudioFactorAtFullBuffer:7,minVideoAudioRatio:5,minAvailableThroughputAudioRatio:5,usePixelRatio:!0,pixelRatioMultiplier:void 0,pixelRatioLogBase:3,pixelRatioLogCoefficients:[1,0,1],limitByContainer:!0,maxContainerSizeFactor:2,containerSizeFactor:1.3,minContainerSizeFactor:1,lazyQualitySwitch:!0,minBufferToSwitchUp:.4,considerPlaybackRate:!1,trackCooldownIncreaseQuality:15e3,trackCooldownDecreaseQuality:3e3,backgroundVideoQualityLimit:u.VideoQuality.Q_4320P,activeVideoAreaThreshold:.1,highQualityLimit:u.VideoQuality.Q_720P,trafficSavingLimit:u.VideoQuality.Q_480P},stallsManager:{enabled:!1,stallDurationNoDataBeforeQualityDecrease:500,stallDurationToBeCount:100,stallCountBeforeQualityDecrease:3,resetQualityRestrictionTimeout:1e4,ignoreStallsOnSeek:!1,stallsMetricsHistoryLength:5,maxPossibleStallDuration:3e4,minTvtToBeCounted:5,maxTvtToBeCounted:10800,targetStallsDurationPerTvt:1,deviationStallsDurationPerTvt:.5,criticalStallsDurationPerTvt:6,abrAdjustingSpeed:.1,emaAlpha:.6,useTotalStallsDurationPerTvt:!0,useAverageStallsDurationPerTvt:!0,useEmaStallsDurationPerTvt:!0},droppedFramesChecker:{enabled:!1,percentLimit:.1,checkTime:1e3,countLimit:3,tickCountAfterQualityChange:5,qualityUpWaitingTime:5e3,minQualityBanLimit:u.VideoQuality.Q_480P},dash:{forwardBufferTarget:6e4,forwardBufferTargetAuto:6e4,forwardBufferTargetManual:3e5,forwardBufferTargetPreload:5e3,seekBiasInTheEnd:2e3,maxSegmentDurationLeftToSelectNextSegment:3e3,minSafeBufferThreshold:.5,bufferPruningSafeZone:1e3,segmentRequestSize:1048576,representationSwitchForwardBufferGap:3e3,crashOnStallTimeout:25e3,crashOnStallTWithoutDataTimeout:5e3,enableSubSegmentBufferFeeding:!0,bufferEmptinessTolerance:100,useFetchPriorityHints:!0,enableBaseUrlSupport:!0,maxSegmentRetryCount:5,sourceOpenTimeout:1e3,vktvAbrThrottle:0,timeupdateEventTickThrottle:300},dashCmafLive:{maxActiveLiveOffset:1e4,normalizedTargetMinBufferSize:6e4,normalizedLiveMinBufferSize:5e3,normalizedActualBufferOffset:1e4,offsetCalculationError:3e3,maxLiveDuration:7200,lowLatency:{maxTargetOffset:3e3,maxTargetOffsetDeviation:250,playbackCatchupSpeedup:.05,isActiveOnDefault:!1,bufferEstimator:{emaAlpha:.45,changeThreshold:.05,deviationDepth:20,deviationFactor:.5,extremumInterval:5}}},live:{minBuffer:3e3,minBufferSegments:3,lowLatencyMinBuffer:1e3,lowLatencyMinBufferSegments:1,isLiveCatchUpMode:!1,lowLatencyActiveLiveDelay:3e3,activeLiveDelay:5e3,maxPausedTime:5e3},downloadBackoff:{bufferThreshold:100,start:100,factor:2,max:3e3,random:.1},enableWakeLock:!0,enableTelemetryAtStart:!1,forceFormat:void 0,formatsToAvoid:[],disableChromecast:!1,chromecastReceiverId:"07A4434E",useWebmBigRequest:!1,webmCodec:"vp9",androidPreferredFormat:"dash",preferCMAF:!1,preferWebRTC:!1,preferMultiStream:!1,preferHDR:!1,bigRequestMinInitSize:51200,bigRequestMinDataSize:1048576,stripRangeHeader:!0,flushShortLoopedBuffers:!0,insufficientBufferRuleMargin:1e4,seekNearDurationBias:1,dashSeekInSegmentDurationThreshold:18e4,dashSeekInSegmentAlwaysSeekDelta:1e4,endGapTolerance:300,stallIgnoreThreshold:33,gapWatchdogInterval:50,requestQuick:!1,useHlsJs:!1,useNativeHLSTextTracks:!1,useManagedMediaSource:!0,useNewSwitchTo:!1,useNewDashProvider:!1,useNewAutoSelectVideoTrack:!1,useSafariEndlessRequestBugfix:!0,useRefactoredSearchGap:!1,isAudioDisabled:!1,autoplayOnlyInActiveTab:!0,dynamicImportTimeout:5e3,maxPlaybackTransitionInterval:2e4,providerErrorLimit:3,manifestRetryInterval:300,manifestRetryMaxInterval:1e4,manifestRetryMaxCount:10,audioVideoSyncRate:20,webrtc:{connectionRetryMaxNumber:3},spherical:{enabled:!1,fov:{x:135,y:76},rotationSpeed:45,maxYawAngle:175,rotationSpeedCorrection:10,degreeToPixelCorrection:5,speedFadeTime:2e3,speedFadeThreshold:50},useVolumeMultiplier:!1,ignoreAudioRendererError:!1,useEnableSubtitlesParam:!1,useOldMSEDetection:!1,useHlsLiveNewTextManager:!1,exposeInternalsToGlobal:!1,hlsLiveNewTextManagerDownloadThreshold:4e3,disableYandexPiP:!1,asyncResolveClientChecker:!1,autostartOnlyIfVisible:!1},fl=({seekState:e,position$:t})=>(0,u.merge)(e.stateChangeEnded$.pipe((0,u.map)((({to:e})=>"none"===e.state?void 0:(e.position??NaN)/1e3)),(0,u.filter)(u.isNonNullable)),t.pipe((0,u.filter)((()=>"none"===e.getState().state)))),ml=class{initVideo(e){this.config=e,this.internalsExposure?.expose({config:e,logger:this.logger,tuning:this.tuning}),this.setMuted(this.tuning.isAudioDisabled);let t=()=>{let{container:t,...i}=e;this.tracer.log("initVideo",(0,u.flattenObject)(i)),this.domContainer=(e=>{let t="string"==typeof e.container?document.getElementById(e.container):e.container;return(0,u.assertNonNullable)(t,`Wrong container or containerId {${e.container}}`),t})(e),this.chromecastInitializer.contentId=e.meta?.videoId,this.providerContainer=new sl({sources:e.sources,meta:e.meta??{},failoverHosts:e.failoverHosts??[],container:this.domContainer,desiredState:this.desiredState,dependencies:{throughputEstimator:this.throughputEstimator,chromecastInitializer:this.chromecastInitializer,tracer:this.tracer,logger:this.logger,abrLogger:this.abrLogger},tuning:this.tuning,volumeMultiplier:e.volumeMultiplier,panelSize:e.panelSize}),this.initProviderContainerSubscription(this.providerContainer),this.initStartingVideoTrack(this.providerContainer),this.initTracerSubscription(),this.providerContainer.init(),this.setLiveLowLatency(this.tuning.dashCmafLive.lowLatency.isActiveOnDefault),this.initDebugTelemetry(),this.initWakeLock(),this.playerInited.next(!0)},i=()=>{this.tuning.autostartOnlyIfVisible&&window.requestAnimationFrame?this.playerInitRequest=window.requestAnimationFrame((()=>t())):t()},r=()=>{this.tuning.asyncResolveClientChecker?Ur.isInited$.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{console.log("Core SDK async start"),i()})):i()};return this.isNotActiveTabCase()?(this.tracer.log("request play from hidden tab"),(0,u.fromEvent)(document,"visibilitychange").pipe((0,u.once)()).subscribe(r)):r(),this}destroy(){this.tracer.log("destroy"),window.clearTimeout(this.hasLiveOffsetByPausedTimer),this.playerInitRequest&&window.cancelAnimationFrame(this.playerInitRequest),this.events.willDestruct$.next(),this.stop(),this.providerContainer?.destroy(),this.throughputEstimator.destroy(),this.chromecastInitializer.destroy(),this.subscription.unsubscribe(),this.tracer.end(),this.internalsExposure?.destroy()}prepare(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("prepare",{currentPlayBackState:e.getState()}),"stopped"===e.getState()&&e.startTransitionTo("ready")}))),this}play(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("play",{currentPlayBackState:e.getState()}),"playing"!==e.getState()&&e.startTransitionTo("playing")}))),this}pause(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("pause",{currentPlayBackState:e.getState()}),"paused"!==e.getState()&&e.startTransitionTo("paused")}))),this}stop(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.desiredState.playbackState;this.tracer.log("stop",{currentPlayBackState:e.getState()}),"stopped"!==e.getState()&&e.startTransitionTo("stopped")}))),this}seekTime(e,t=!0){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.info.duration$.getValue(),r=this.info.isLive$.getValue(),a=e;e>=i&&!r&&(a=i-this.tuning.seekNearDurationBias),this.tracer.log("seekTime",{duration:i,isLive:r,time:e,calculatedTime:a,forcePrecise:t}),Number.isFinite(a)&&(this.events.willSeek$.next({from:this.getExactTime(),to:a}),this.desiredState.seekState.setState({state:"requested",position:1e3*a,forcePrecise:t}))}))),this}seekPercent(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.info.duration$.getValue();this.tracer.log("seekPercent",{percent:e,duration:t}),isFinite(t)&&this.seekTime(Math.abs(t)*e,!1)}))),this}setVolume(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.desiredState.volume,r=i.getTransition()?.to.muted??this.info.muted$.getValue(),a=t??(this.tuning.isAudioDisabled||r);this.tracer.log("setVolume",{volume:e,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue(),muted:a}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setVolume(e):i.startTransitionTo({volume:e,muted:a})}))),this}setMuted(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.desiredState.volume,i=this.tuning.isAudioDisabled||e,r=t.getTransition()?.to.volume??this.info.volume$.getValue();this.tracer.log("setMuted",{isMuted:e,nextMuted:i,volume:r,isAudioDisabled:this.tuning.isAudioDisabled,chromecastState:this.chromecastInitializer.castState$.getValue()}),"CONNECTED"===this.chromecastInitializer.castState$.getValue()?this.chromecastInitializer.setMuted(i):t.startTransitionTo({volume:r,muted:i})}))),this}setVideoStream(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.desiredState.videoStream.startTransitionTo(e)}))),this}setAudioStream(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.desiredState.audioStream.startTransitionTo(e)}))),this}setQuality(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{(0,u.assertNonNullable)(this.providerContainer);let t=this.providerContainer.providerOutput.availableVideoTracks$.getValue();this.tracer.log("setQuality",{isDelayed:0===t.length,quality:e}),void 0===this.desiredState.videoTrack.getState()&&void 0===this.desiredState.videoTrack.getPrevState()&&0===t.length?this.wasSetStartedQuality?this.providerContainer.providerOutput.availableVideoTracks$.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((t=>{this.setVideoTrackIdByQuality(t,e)})):this.explicitInitialQuality=e:t.length>0&&this.setVideoTrackIdByQuality(t,e)}))),this}setAutoQuality(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setAutoQuality",{enable:e}),this.desiredState.autoVideoTrackSwitching.startTransitionTo(e)}))),this}setAutoQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setAutoQualityLimits",(0,u.flattenObject)(e)),this.desiredState.autoVideoTrackLimits.startTransitionTo(e)}))),this}setPredefinedQualityLimits(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{if(this.info.predefinedQualityLimitType$.getValue()===e)return this;let t,{highQualityLimit:i,trafficSavingLimit:r}=this.tuning.autoTrackSelection;switch(e){case"high_quality":t={min:i,max:void 0};break;case"traffic_saving":t={max:r,min:void 0};break;default:t={max:void 0,min:void 0}}this.setAutoQualityLimits(t)}))),this}setPlaybackRate(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{(0,u.assertNonNullable)(this.providerContainer);let t=this.providerContainer?.providerOutput.element$.getValue();this.tracer.log("setPlaybackRate",{playbackRate:e,isVideoElementAvailable:!!t}),t&&(this.desiredState.playbackRate.setState(e),t.playbackRate=e)}))),this}setExternalTextTracks(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{e.length&&this.tracer.log("setExternalTextTracks",(0,u.flattenObject)(e)),this.desiredState.externalTextTracks.startTransitionTo(e.map((e=>({type:"external",...e}))))}))),this}selectTextTrack(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{((e,t,i,r)=>{void 0!==e&&void 0===t.getState()&&void 0===t.getPrevState()&&0===i?.getValue().length?i.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((i=>{i.find(r)&&t.startTransitionTo(e)})):(void 0===e||i?.getValue().find(r))&&t.startTransitionTo(e)})(e,this.desiredState.currentTextTrack,this.providerContainer?.providerOutput.availableTextTracks$,(t=>t.id===e)),this.tracer.log("selectTextTrack",{textTrackId:e})}))),this}setTextTrackCueSettings(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setTextTrackCueSettings",{...e}),this.desiredState.textTrackCuesSettings.startTransitionTo(e)}))),this}setLiveLowLatency(e){let t=this.info.isLive$.getValue(),i=this.desiredState.isLowLatency.getState();return t&&i!==e?(this.tracer.log("live switch to low latency "+e),this.desiredState.isLowLatency.setState(e),this.seekTime(0)):this}setLooped(e){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{this.tracer.log("setLooped",{isLooped:e}),this.desiredState.isLooped.startTransitionTo(e)}))),this}toggleChromecast(){this.tracer.log("toggleChromecast"),this.chromecastInitializer.toggleConnection()}startCameraManualRotation(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.getScene3D();this.tracer.log("startCameraManualRotation",{isScene3DAvailable:!!i,mx:e,my:t}),i&&i.startCameraManualRotation(e,t)}))),this}stopCameraManualRotation(e=!1){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let t=this.getScene3D();this.tracer.log("stopCameraManualRotation",{isScene3DAvailable:!!t,immediate:e}),t&&t.stopCameraManualRotation(e)}))),this}moveCameraFocusPX(e,t){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let i=this.getScene3D();if(this.tracer.log("moveCameraFocusPX",{isScene3DAvailable:!!i,dxpx:e,dypx:t}),i){let r=i.getCameraRotation(),a=i.pixelToDegree({x:e,y:t});this.desiredState.cameraOrientation.setState({x:r.x+a.x,y:r.y+a.y})}}))),this}holdCamera(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>e)),(0,u.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.holdCamera()}))),this}releaseCamera(){return this.subscription.add(this.playerInited.pipe((0,u.filter)((e=>!!e)),(0,u.once)()).subscribe((()=>{let e=this.getScene3D();e&&e.releaseCamera()}))),this}getExactTime(){if(!this.providerContainer)return 0;let e=this.providerContainer.providerOutput.element$.getValue();if((0,u.isNullable)(e))return this.info.position$.getValue();let t=this.desiredState.seekState.getState(),i="none"===t.state?void 0:t.position;return(0,u.isNonNullable)(i)?i/1e3:e.currentTime}getAllLogs(){return this.logger.getAllLogs()}getScene3D(){let e=this.providerContainer?.current$.getValue();if(e?.provider?.scene3D)return e.provider.scene3D}setIntrinsicVideoSize(...e){let t={width:e.reduce(((e,{width:t})=>e||t||0),0),height:e.reduce(((e,{height:t})=>e||t||0),0)};t.width&&t.height&&this.info.intrinsicVideoSize$.next({width:t.width,height:t.height})}initDesiredStateSubscriptions(){this.subscription.add((0,u.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,u.map)((e=>e.to))).subscribe(this.info.playbackState$)).add(this.desiredState.isLooped.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.isLooped$)).add(this.desiredState.playbackRate.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.currentPlaybackRate$)).add(this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe(this.info.isAutoQualityEnabled$)).add(this.desiredState.autoVideoTrackLimits.stateChangeEnded$.pipe((0,u.map)((e=>e.to))).subscribe((e=>{this.info.autoQualityLimits$.next(e);let{highQualityLimit:t,trafficSavingLimit:i}=this.tuning.autoTrackSelection;this.info.predefinedQualityLimitType$.next(Xr(e,t,i))}))),this.subscription.add(this.desiredState.playbackState.stateChangeStarted$.pipe((0,u.filter)((({from:e})=>"stopped"===e)),(0,u.once)()).subscribe((()=>{this.initedAt=(0,u.now)(),this.events.inited$.next()}))).add(this.desiredState.playbackState.stateChangeEnded$.subscribe((e=>{switch(e.to){case"ready":this.events.ready$.next();break;case"playing":this.isPlaybackStarted||this.events.started$.next(),this.isPlaybackStarted=!0,this.events.playing$.next();break;case"paused":this.events.paused$.next();break;case"stopped":this.events.stopped$.next()}}))).add(this.desiredState.playbackState.stateChangeStarted$.subscribe((e=>{switch(e.to){case"paused":this.events.willPause$.next();break;case"playing":this.isPlaybackStarted?this.events.willResume$.next():this.events.willStart$.next();break;case"stopped":this.events.willStop$.next()}})))}initProviderContainerSubscription(e){this.subscription.add(e.providerOutput.willSeekEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("willSeekEvent",(0,u.flattenObject)(e)),"requested"===e.state?this.desiredState.seekState.setState({...e,state:"applying"}):this.events.managedError$.next({id:`WillSeekIn${e.state}`,category:u.ErrorCategory.WTF,message:"Received unexpeceted willSeek$"})}))).add(e.providerOutput.soundProhibitedEvent$.pipe((0,u.once)()).subscribe(this.events.autoplaySoundProhibited$)).add(e.providerOutput.severeStallOccurred$.subscribe(this.events.severeStallOccured$)).add(e.providerOutput.seekedEvent$.subscribe((()=>{let e=this.desiredState.seekState.getState();this.tracer.log("seekedEvent",(0,u.flattenObject)(e)),"applying"===e.state&&(this.desiredState.seekState.setState({state:"none"}),this.events.seeked$.next())}))).add(e.current$.pipe((0,u.map)((e=>e.type))).subscribe(this.info.currentFormat$)).add(e.current$.pipe((0,u.map)((e=>e.destination)),(0,u.filterChanged)()).subscribe((()=>this.isPlaybackStarted=!1))).add(e.providerOutput.availableVideoStreams$.subscribe(this.info.availableVideoStreams$)).add((0,u.combine)({availableVideoTracks:e.providerOutput.availableVideoTracks$,currentVideoStream:e.providerOutput.currentVideoStream$}).pipe((0,u.map)((({availableVideoTracks:e,currentVideoStream:t})=>e.filter((e=>!t||t.id===e.streamId)).map((({quality:e})=>e)).sort(((e,t)=>(0,u.isInvariantQuality)(e)?1:(0,u.isInvariantQuality)(t)?-1:(0,u.isHigher)(t,e)?1:-1))))).subscribe(this.info.availableQualities$)).add(e.providerOutput.availableVideoTracks$.subscribe((e=>{let t={};for(let i of e)i.fps&&(t[i.quality]=i.fps);this.info.availableQualitiesFps$.next(t)}))).add(e.providerOutput.availableAudioStreams$.subscribe(this.info.availableAudioStreams$)).add(e.providerOutput.currentVideoStream$.subscribe(this.info.currentVideoStream$)).add(e.providerOutput.currentAudioStream$.subscribe(this.info.currentAudioStream$)).add(e.providerOutput.availableAudioTracks$.subscribe(this.info.availableAudioTracks$)).add(e.providerOutput.isAudioAvailable$.pipe((0,u.filterChanged)()).subscribe(this.info.isAudioAvailable$)).add(e.providerOutput.currentVideoTrack$.pipe((0,u.filter)((e=>(0,u.isNonNullable)(e)))).subscribe((e=>{this.info.currentQuality$.next(e?.quality),this.info.videoBitrate$.next(e?.bitrate)}))).add(e.providerOutput.currentVideoSegmentLength$.pipe((0,u.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentVideoSegmentLength$)).add(e.providerOutput.currentAudioSegmentLength$.pipe((0,u.filterChanged)(((e,t)=>Math.round(e)===Math.round(t)))).subscribe(this.info.currentAudioSegmentLength$)).add(e.providerOutput.hostname$.pipe((0,u.filterChanged)()).subscribe(this.info.hostname$)).add(e.providerOutput.httpConnectionType$.pipe((0,u.filterChanged)()).subscribe(this.info.httpConnectionType$)).add(e.providerOutput.httpConnectionReused$.pipe((0,u.filterChanged)()).subscribe(this.info.httpConnectionReused$)).add(e.providerOutput.currentTextTrack$.subscribe(this.info.currentTextTrack$)).add(e.providerOutput.availableTextTracks$.subscribe(this.info.availableTextTracks$)).add(e.providerOutput.autoVideoTrackLimitingAvailable$.subscribe(this.info.autoQualityLimitingAvailable$)).add(e.providerOutput.autoVideoTrackLimits$.subscribe((e=>{this.desiredState.autoVideoTrackLimits.setState(e??{})}))).add(e.providerOutput.currentBuffer$.pipe((0,u.map)((e=>e?{start:e.from,end:e.to}:{start:0,end:0}))).subscribe(this.info.currentBuffer$)).add(e.providerOutput.duration$.subscribe(this.info.duration$)).add(e.providerOutput.isBuffering$.subscribe(this.info.isBuffering$)).add(e.providerOutput.isLive$.subscribe(this.info.isLive$)).add(e.providerOutput.isLiveEnded$.pipe((0,u.tap)((e=>e&&this.stop()))).subscribe(this.info.isLiveEnded$)).add(e.providerOutput.canChangePlaybackSpeed$.subscribe(this.info.canChangePlaybackSpeed$)).add(e.providerOutput.liveTime$.subscribe(this.info.liveTime$)).add(e.providerOutput.liveBufferTime$.subscribe(this.info.liveBufferTime$)).add(e.providerOutput.liveLatency$.subscribe(this.info.liveLatency$)).add((0,u.combine)({hasLiveOffsetByPaused:(0,u.merge)(this.desiredState.playbackState.stateChangeStarted$,this.desiredState.playbackState.forceChanged$).pipe((0,u.map)((e=>e.to)),(0,u.filterChanged)(),(0,u.map)((e=>"paused"===e))),isLowLatency:e.providerOutput.isLowLatency$}).subscribe((({hasLiveOffsetByPaused:e,isLowLatency:t})=>{window.clearTimeout(this.hasLiveOffsetByPausedTimer),e?this.hasLiveOffsetByPausedTimer=window.setTimeout((()=>{this.hasLiveOffsetByPaused.next(!0)}),this.getActiveLiveDelay(t)):this.hasLiveOffsetByPaused.next(!1)}))).add((0,u.combine)({atLiveEdge:(0,u.combine)({isLive:e.providerOutput.isLive$,isLowLatency:e.providerOutput.isLowLatency$,position:fl({seekState:this.desiredState.seekState,position$:e.providerOutput.position$})}).pipe((0,u.map)((({isLive:e,position:t,isLowLatency:i})=>{let r=this.getActiveLiveDelay(i);return e&&Math.abs(t)<r/1e3})),(0,u.filterChanged)(),(0,u.tap)((e=>e&&this.setPlaybackRate(1)))),hasPausedTimeoutCase:this.hasLiveOffsetByPaused}).pipe((0,u.map)((({atLiveEdge:e,hasPausedTimeoutCase:t})=>e&&!t))).subscribe(this.info.atLiveEdge$)).add((0,u.combine)({isLive:e.providerOutput.isLive$,position:e.providerOutput.position$,duration:e.providerOutput.duration$}).pipe((0,u.map)((({isLive:e,position:t,duration:i})=>e&&1e3*(Math.abs(i)-Math.abs(t))<this.tuning.live.activeLiveDelay)),(0,u.filterChanged)(),(0,u.tap)((e=>e&&this.setPlaybackRate(1)))).subscribe(this.info.atLiveDurationEdge$)).add(e.providerOutput.volume$.pipe((0,u.map)((e=>e.muted)),(0,u.filterChanged)()).subscribe(this.info.muted$)).add(e.providerOutput.volume$.pipe((0,u.map)((e=>e.volume)),(0,u.filterChanged)()).subscribe(this.info.volume$)).add(fl({seekState:this.desiredState.seekState,position$:e.providerOutput.position$}).subscribe(this.info.position$)).add((0,u.merge)(e.providerOutput.endedEvent$.pipe((0,u.mapTo)(!0)),e.providerOutput.seekedEvent$.pipe((0,u.mapTo)(!1))).pipe((0,u.filterChanged)()).subscribe(this.info.isEnded$)).add(e.providerOutput.endedEvent$.subscribe(this.events.ended$)).add(e.providerOutput.loopedEvent$.subscribe(this.events.looped$)).add(e.providerError$.subscribe(this.events.managedError$)).add(e.providerOutput.fetcherRecoverableError$.subscribe(this.events.fetcherRecoverableError$)).add(e.providerOutput.fetcherError$.subscribe(this.events.fatalError$)).add(e.volumeMultiplierError$.subscribe(this.events.managedError$)).add(e.noAvailableProvidersError$.pipe((0,u.map)((e=>({id:e?`No${e}`:"NoProviders",category:u.ErrorCategory.VIDEO_PIPELINE,message:e?`${e} was forced but failed or not available`:"No suitable providers or all providers failed"})))).subscribe(this.events.fatalError$)).add(e.providerOutput.element$.subscribe(this.experimental.element$)).add(e.providerOutput.getCurrentTime$.subscribe(this.experimental.getCurrentTime$)).add(e.providerOutput.firstBytesEvent$.pipe((0,u.once)(),(0,u.map)((e=>e??(0,u.now)()-this.initedAt))).subscribe(this.events.firstBytes$)).add(e.providerOutput.loadedMetadataEvent$.subscribe(this.events.loadedMetadata$)).add(e.providerOutput.firstFrameEvent$.pipe((0,u.once)(),(0,u.map)((()=>(0,u.now)()-this.initedAt))).subscribe(this.events.firstFrame$)).add(e.providerOutput.canplay$.pipe((0,u.once)(),(0,u.map)((()=>(0,u.now)()-this.initedAt))).subscribe(this.events.canplay$)).add(this.throughputEstimator.throughput$.subscribe(this.info.throughputEstimation$)).add(this.throughputEstimator.rtt$.subscribe(this.info.rttEstimation$)).add(e.providerOutput.availableSources$.subscribe(this.info.availableSources$));let t=new u.ValueSubject(!1);this.subscription.add(e.providerOutput.seekedEvent$.subscribe((()=>t.next(!1)))).add(e.providerOutput.willSeekEvent$.subscribe((()=>t.next(!0))));let i=new u.ValueSubject(!0);this.subscription.add(e.current$.subscribe((()=>i.next(!0)))).add(this.desiredState.playbackState.stateChangeEnded$.pipe((0,u.filter)((({to:e})=>"playing"===e)),(0,u.once)()).subscribe((()=>i.next(!1))));let r=0,a=(0,u.merge)(e.providerOutput.isBuffering$,t,i).pipe((0,u.map)((()=>{let r=e.providerOutput.isBuffering$.getValue(),a=t.getValue()||i.getValue();return r&&!a})),(0,u.filterChanged)());this.subscription.add(a.subscribe((e=>{e?r=window.setTimeout((()=>this.info.isStalled$.next(!0)),this.tuning.stallIgnoreThreshold):(window.clearTimeout(r),this.info.isStalled$.next(!1))}))),this.subscription.add((0,u.merge)(e.providerOutput.canplay$,e.providerOutput.firstFrameEvent$,e.providerOutput.firstBytesEvent$).subscribe((()=>{let t=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.videoWidth,height:t?.videoHeight})}))).add(e.providerOutput.currentVideoTrack$.subscribe((t=>{let i=e.providerOutput.element$.getValue();this.setIntrinsicVideoSize({width:t?.size?.width,height:t?.size?.height},{width:i?.videoWidth,height:i?.videoHeight})}))).add(e.providerOutput.is3DVideo$.subscribe(this.info.is3DVideo$)),this.subscription.add((0,u.merge)(e.providerOutput.inPiP$,e.providerOutput.inFullscreen$,e.providerOutput.element$,e.providerOutput.elementVisible$,this.chromecastInitializer.castState$).subscribe((()=>{let t,i=e.providerOutput.inPiP$.getValue(),r=e.providerOutput.inFullscreen$.getValue(),a=e.providerOutput.element$.getValue(),s=e.providerOutput.elementVisible$.getValue();t="CONNECTED"===this.chromecastInitializer.castState$.getValue()?"second_screen":a?s?i?"pip":r?"fullscreen":"inline":"invisible":"none",this.info.surface$.getValue()!==t&&this.info.surface$.next(t)})))}initChromecastSubscription(){this.subscription.add(this.chromecastInitializer.castState$.subscribe(this.info.chromecastState$)),this.subscription.add(this.chromecastInitializer.connection$.pipe((0,u.map)((e=>e?.castDevice.friendlyName))).subscribe(this.info.chromecastDeviceName$)),this.subscription.add(this.chromecastInitializer.errorEvent$.subscribe(this.events.managedError$))}initStartingVideoTrack(e){let t=new u.Subscription;this.subscription.add(t),this.subscription.add(e.current$.pipe((0,u.filterChanged)(((e,t)=>e.provider===t.provider))).subscribe((()=>{t.unsubscribe(),t.add(e.providerOutput.availableVideoTracks$.pipe((0,u.filter)((e=>e.length>0)),(0,u.once)()).subscribe((e=>{this.setStartingVideoTrack(e)})))})))}setStartingVideoTrack(e){let t;this.wasSetStartedQuality=!0;let i=this.explicitInitialQuality??this.info.currentQuality$.getValue();i&&(t=e.find((({quality:e})=>e===i)),t||this.setAutoQuality(!0)),t||(t=ma(e,{container:this.domContainer.getBoundingClientRect(),panelSize:this.config.panelSize,estimatedThroughput:this.throughputEstimator.throughput$.getValue(),tuning:this.tuning.autoTrackSelection,limits:this.desiredState.autoVideoTrackLimits.getState(),playbackRate:this.info.currentPlaybackRate$.getValue(),forwardBufferHealth:0,abrLogger:this.abrLogger})),this.desiredState.videoTrack.startTransitionTo(t),this.info.currentQuality$.next(t.quality),this.info.videoBitrate$.next(t.bitrate)}initLogs(){this.subscription.add((0,u.merge)(this.desiredState.videoTrack.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"quality",type:"start"})))),this.desiredState.videoTrack.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"quality",type:"end"})))),this.desiredState.autoVideoTrackSwitching.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"start"})))),this.desiredState.autoVideoTrackSwitching.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"autoQualityEnabled",type:"end"})))),this.desiredState.seekState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"seekState",type:"start"})))),this.desiredState.seekState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"seekState",type:"end"})))),this.desiredState.playbackState.stateChangeStarted$.pipe((0,u.map)((e=>({transition:e,entity:"playbackState",type:"start"})))),this.desiredState.playbackState.stateChangeEnded$.pipe((0,u.map)((e=>({transition:e,entity:"playbackState",type:"end"}))))).pipe((0,u.map)((e=>({component:"desiredState",message:`[${e.entity} change] ${e.type}: ${JSON.stringify(e.transition)}`})))).subscribe(this.logger.log)),this.subscription.add(this.logger.log$.subscribe(this.events.log$))}initDebugTelemetry(){let e=this.providerContainer?.providerOutput;(0,u.assertNonNullable)(this.providerContainer),(0,u.assertNonNullable)(e),Kr={},this.experimental.enableDebugTelemetry$.next(this.tuning.enableTelemetryAtStart),[this.experimental.enableDebugTelemetry$.subscribe((e=>{Hr=e})),this.providerContainer.current$.subscribe((({type:e})=>Gr("provider",e))),e.duration$.subscribe((e=>Gr("duration",e))),e.availableVideoTracks$.pipe((0,u.filter)((e=>!!e.length)),(0,u.once)()).subscribe((e=>Gr("tracks",e))),this.events.fatalError$.subscribe(new Yr("fatalError")),this.events.managedError$.subscribe(new Yr("managedError")),e.position$.subscribe(new Yr("position")),e.currentVideoTrack$.pipe((0,u.map)((e=>e?.quality))).subscribe(new Yr("quality")),this.info.currentBuffer$.subscribe(new Yr("buffer")),e.isBuffering$.subscribe(new Yr("isBuffering"))].forEach((e=>this.subscription.add(e))),Gr("codecs",Ur.video.supportedCodecs)}initTracerSubscription(){let e=(0,u.getTraceSubscriptionMethod)(this.tracer.log.bind(this.tracer)),t=(0,u.getTraceSubscriptionMethod)(this.tracer.error.bind(this.tracer));this.subscription.add(this.info.playbackState$.subscribe(e("playbackState"))).add(this.info.isLooped$.subscribe(e("isLooped"))).add(this.info.currentPlaybackRate$.pipe((0,u.filterChanged)()).subscribe(e("currentPlaybackRate"))).add(this.info.isAutoQualityEnabled$.subscribe(e("isAutoQualityEnabled"))).add(this.info.autoQualityLimits$.subscribe(e("autoQualityLimits"))).add(this.info.currentFormat$.subscribe(e("currentFormat"))).add(this.info.availableQualities$.subscribe(e("availableQualities"))).add(this.info.availableQualitiesFps$.subscribe(e("availableQualitiesFps"))).add(this.info.availableAudioTracks$.subscribe(e("availableAudioTracks"))).add(this.info.isAudioAvailable$.subscribe(e("isAudioAvailable"))).add((0,u.combine)({currentQuality:this.info.currentQuality$,videoBitrate:this.info.videoBitrate$}).pipe((0,u.filter)((({currentQuality:e,videoBitrate:t})=>!!e&&!!t)),(0,u.filterChanged)(((e,t)=>e.currentQuality===t.currentQuality))).subscribe(e("currentVideoTrack"))).add(this.info.currentVideoSegmentLength$.pipe((0,u.filter)((e=>e>0)),(0,u.filterChanged)()).subscribe(e("currentVideoSegmentLength"))).add(this.info.currentAudioSegmentLength$.pipe((0,u.filter)((e=>e>0)),(0,u.filterChanged)()).subscribe(e("currentAudioSegmentLength"))).add(this.info.hostname$.subscribe(e("hostname"))).add(this.info.currentTextTrack$.subscribe(e("currentTextTrack"))).add(this.info.availableTextTracks$.subscribe(e("availableTextTracks"))).add(this.info.autoQualityLimitingAvailable$.subscribe(e("autoQualityLimitingAvailable"))).add((0,u.combine)({currentBuffer:this.info.currentBuffer$.pipe((0,u.filter)((e=>e.end>0)),(0,u.filterChanged)(((e,t)=>e.end===t.end&&e.start===t.start))),position:this.info.position$.pipe((0,u.filterChanged)())}).pipe((0,u.throttle)(1e3)).subscribe(e("currentBufferAndPosition"))).add(this.info.duration$.pipe((0,u.filterChanged)()).subscribe(e("duration"))).add(this.info.isBuffering$.subscribe(e("isBuffering"))).add(this.info.isLive$.pipe((0,u.filterChanged)()).subscribe(e("isLive"))).add(this.info.canChangePlaybackSpeed$.pipe((0,u.filterChanged)()).subscribe(e("canChangePlaybackSpeed"))).add((0,u.combine)({liveTime:this.info.liveTime$,liveBufferTime:this.info.liveBufferTime$,position:this.info.position$}).pipe((0,u.filter)((({liveTime:e,liveBufferTime:t})=>!!e&&!!t)),(0,u.throttle)(1e3)).subscribe(e("liveBufferAndPosition"))).add(this.info.atLiveEdge$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("atLiveEdge"))).add(this.info.atLiveDurationEdge$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("atLiveDurationEdge"))).add(this.info.muted$.pipe((0,u.filterChanged)()).subscribe(e("muted"))).add(this.info.volume$.pipe((0,u.filterChanged)()).subscribe(e("volume"))).add(this.info.isEnded$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("isEnded"))).add(this.info.availableSources$.subscribe(e("availableSources"))).add((0,u.combine)({throughputEstimation:this.info.throughputEstimation$,rtt:this.info.rttEstimation$}).pipe((0,u.filter)((({throughputEstimation:e,rtt:t})=>!!e&&!!t)),(0,u.throttle)(3e3)).subscribe(e("throughputEstimation"))).add(this.info.isStalled$.subscribe(e("isStalled"))).add(this.info.is3DVideo$.pipe((0,u.filterChanged)(),(0,u.filter)((e=>!0===e))).subscribe(e("is3DVideo"))).add(this.info.surface$.subscribe(e("surface"))).add(this.events.ended$.subscribe(e("ended"))).add(this.events.looped$.subscribe(e("looped"))).add(this.events.managedError$.subscribe(t("managedError"))).add(this.events.fatalError$.subscribe(t("fatalError"))).add(this.events.firstBytes$.subscribe(e("firstBytes"))).add(this.events.firstFrame$.subscribe(e("firstFrame"))).add(this.events.canplay$.subscribe(e("canplay")))}initWakeLock(){if(!window.navigator.wakeLock||!this.tuning.enableWakeLock)return;let e,t=()=>{e?.release(),e=void 0},i=async()=>{t(),e=await window.navigator.wakeLock.request("screen").catch((e=>{e instanceof DOMException&&"NotAllowedError"===e.name||this.events.managedError$.next({id:"WakeLock",category:u.ErrorCategory.DOM,message:String(e)})}))};this.subscription.add((0,u.merge)((0,u.fromEvent)(document,"visibilitychange"),(0,u.fromEvent)(document,"fullscreenchange"),this.desiredState.playbackState.stateChangeEnded$).subscribe((()=>{let r="visible"===document.visibilityState,a="playing"===this.desiredState.playbackState.getState();r&&a?!!e&&!e?.released||i():t()}))).add(this.events.willDestruct$.subscribe(t))}setVideoTrackIdByQuality(e,t){let i=e.find((e=>e.quality===t));this.tracer.log("setVideoTrackIdByQuality",(0,u.flattenObject)({quality:t,availableTracks:(0,u.flattenObject)(e),track:(0,u.flattenObject)(i),isAutoQuality:!i})),i?this.desiredState.videoTrack.startTransitionTo(i):this.setAutoQuality(!0)}getActiveLiveDelay(e=!1){return e?this.tuning.live.lowLatencyActiveLiveDelay:this.tuning.live.activeLiveDelay}isNotActiveTabCase(){return document.hidden&&this.tuning.autoplayOnlyInActiveTab&&!Oa()}constructor(e={configName:[]},t=u.TracerFactory.createRootTracer(!1)){if(this.subscription=new u.Subscription,this.logger=new u.Logger,this.abrLogger=this.logger.createComponentLog("ABR"),this.internalsExposure=null,this.isPlaybackStarted=!1,this.hasLiveOffsetByPaused=new u.ValueSubject(!1),this.hasLiveOffsetByPausedTimer=0,this.playerInitRequest=0,this.playerInited=new u.ValueSubject(!1),this.wasSetStartedQuality=!1,this.desiredState={playbackState:new lr("stopped"),seekState:new lr({state:"none"}),volume:new lr({volume:1,muted:!1}),videoTrack:new lr(void 0),videoStream:new lr(void 0),audioStream:new lr(void 0),autoVideoTrackSwitching:new lr(!0),autoVideoTrackLimits:new lr({}),isLooped:new lr(!1),isLowLatency:new lr(!1),playbackRate:new lr(1),externalTextTracks:new lr([]),internalTextTracks:new lr([]),currentTextTrack:new lr(void 0),textTrackCuesSettings:new lr({}),cameraOrientation:new lr({x:0,y:0})},this.info={playbackState$:new u.ValueSubject(void 0),position$:new u.ValueSubject(0),duration$:new u.ValueSubject(1/0),muted$:new u.ValueSubject(!1),volume$:new u.ValueSubject(1),availableVideoStreams$:new u.ValueSubject([]),currentVideoStream$:new u.ValueSubject(void 0),availableQualities$:new u.ValueSubject([]),availableQualitiesFps$:new u.ValueSubject({}),currentQuality$:new u.ValueSubject(void 0),isAutoQualityEnabled$:new u.ValueSubject(!0),autoQualityLimitingAvailable$:new u.ValueSubject(!1),autoQualityLimits$:new u.ValueSubject({}),predefinedQualityLimitType$:new u.ValueSubject("unknown"),availableAudioStreams$:new u.ValueSubject([]),currentAudioStream$:new u.ValueSubject(void 0),availableAudioTracks$:new u.ValueSubject([]),isAudioAvailable$:new u.ValueSubject(!0),currentPlaybackRate$:new u.ValueSubject(1),currentBuffer$:new u.ValueSubject({start:0,end:0}),isBuffering$:new u.ValueSubject(!0),isStalled$:new u.ValueSubject(!1),isEnded$:new u.ValueSubject(!1),isLooped$:new u.ValueSubject(!1),isLive$:new u.ValueSubject(void 0),isLiveEnded$:new u.ValueSubject(null),canChangePlaybackSpeed$:new u.ValueSubject(void 0),atLiveEdge$:new u.ValueSubject(void 0),atLiveDurationEdge$:new u.ValueSubject(void 0),liveTime$:new u.ValueSubject(void 0),liveBufferTime$:new u.ValueSubject(void 0),liveLatency$:new u.ValueSubject(void 0),currentFormat$:new u.ValueSubject(void 0),availableTextTracks$:new u.ValueSubject([]),currentTextTrack$:new u.ValueSubject(void 0),throughputEstimation$:new u.ValueSubject(void 0),rttEstimation$:new u.ValueSubject(void 0),videoBitrate$:new u.ValueSubject(void 0),hostname$:new u.ValueSubject(void 0),httpConnectionType$:new u.ValueSubject(void 0),httpConnectionReused$:new u.ValueSubject(void 0),surface$:new u.ValueSubject("none"),chromecastState$:new u.ValueSubject("NOT_AVAILABLE"),chromecastDeviceName$:new u.ValueSubject(void 0),intrinsicVideoSize$:new u.ValueSubject(void 0),availableSources$:new u.ValueSubject(void 0),is3DVideo$:new u.ValueSubject(!1),currentVideoSegmentLength$:new u.ValueSubject(0),currentAudioSegmentLength$:new u.ValueSubject(0)},this.events={inited$:new u.Subject,ready$:new u.Subject,started$:new u.Subject,playing$:new u.Subject,paused$:new u.Subject,stopped$:new u.Subject,willStart$:new u.Subject,willResume$:new u.Subject,willPause$:new u.Subject,willStop$:new u.Subject,willDestruct$:new u.Subject,watchCoverageRecord$:new u.Subject,watchCoverageLive$:new u.Subject,managedError$:new u.Subject,fatalError$:new u.Subject,fetcherRecoverableError$:new u.Subject,ended$:new u.Subject,looped$:new u.Subject,seeked$:new u.Subject,willSeek$:new u.Subject,autoplaySoundProhibited$:new u.Subject,firstBytes$:new u.Subject,loadedMetadata$:new u.Subject,firstFrame$:new u.Subject,canplay$:new u.Subject,log$:new u.Subject,fetcherError$:new u.Subject,severeStallOccured$:new u.Subject},this.experimental={element$:new u.ValueSubject(void 0),tuningConfigName$:new u.ValueSubject([]),enableDebugTelemetry$:new u.ValueSubject(!1),dumpTelemetry:Qr,getCurrentTime$:new u.ValueSubject(null)},this.initLogs(),this.tuning=(i=e,{...(0,u.fillWithDefault)(i,pl),configName:[...i.configName??[],...pl.configName]}),this.tracer=t,this.experimental.tuningConfigName$.next(this.tuning.configName),this.chromecastInitializer=new Ji({receiverApplicationId:e.chromecastReceiverId,isDisabled:e.disableChromecast,dependencies:{logger:this.logger}}),this.throughputEstimator=new hl(this.tuning.throughputEstimator),e.exposeInternalsToGlobal&&(this.internalsExposure=new u.InternalsExposure("CORE"),this.internalsExposure.expose({player:this})),this.initChromecastSubscription(),this.initDesiredStateSubscriptions(),Proxy&&Reflect)return new Proxy(this,{get:(e,t,i)=>{let r=Reflect.get(e,t,i);return"function"!=typeof r?r:(...i)=>{try{return r.apply(e,i)}catch(e){let r=i.map((e=>JSON.stringify(e,((e,t)=>{let i=typeof t;return(0,Zi.default)(["number","string","boolean"],i)?t:null===t?null:`<${i}>`})))),a=`Player.${String(t)}`,s=`Exception calling ${a} (${r.join(", ")})`;throw this.events.fatalError$.next({id:a,category:u.ErrorCategory.WTF,message:s,thrown:e}),e}}}});var i}}},319340:(e,t,i)=>{var r;i.d(t,{ErrorCategory:()=>Gi,InterfaceLanguage:()=>dr,InternalsExposure:()=>pr,Logger:()=>St,Observable:()=>yt,Subject:()=>wt,Subscription:()=>gt,SubscriptionRemovable:()=>xi,TracerFactory:()=>vi,VERSION:()=>mt,ValueSubject:()=>bi,VideoQuality:()=>qt,abortable:()=>At,addScript:()=>$t,assertNever:()=>vt,assertNonNullable:()=>kt,assertNotEmptyArray:()=>xt,checkNever:()=>bt,clearVideoElement:()=>ui,cloneDeepWith:()=>ni,combine:()=>yi,createURL:()=>ci,debounce:()=>Ci,debounceFn:()=>ai,detectEmbed:()=>Wt,devNull:()=>fr,fillWithDefault:()=>ri,filter:()=>Ii,filterChanged:()=>Bi,flattenObject:()=>li,fromEvent:()=>Ei,getExponentialDelay:()=>Pt,getHighestQuality:()=>Xt,getTraceSubscriptionMethod:()=>hi,interval:()=>ki,isHigher:()=>Kt,isHigherOrEqual:()=>Qt,isInvariantQuality:()=>ii,isLower:()=>Gt,isLowerOrEqual:()=>Yt,isNonNullable:()=>Tt,isNullable:()=>Et,isValidURL:()=>di,loadVKLangPack:()=>or,map:()=>Ui,mapTo:()=>ji,merge:()=>wi,noop:()=>_t,now:()=>Ct,observableFrom:()=>Ti,observeElementSize:()=>oi,once:()=>zi,safeStorage:()=>Lt,skip:()=>Hi,tap:()=>Wi,throttle:()=>Li,throttleFn:()=>si,timeout:()=>Si,videoHeightToQuality:()=>Jt,videoQualityToHeight:()=>ti,videoSizeToQuality:()=>ei});var a=Object.create,s=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,l=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty,d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,t)=>{for(var i in t)s(e,i,{get:t[i],enumerable:!0})},h=(e,t,i)=>(i=null!=e?a(l(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of o(t))!u.call(e,a)&&a!==i&&s(e,a,{get:()=>t[a],enumerable:!(r=n(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:s(i,"default",{value:e,enumerable:!0}),e)),p=d(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),f=d(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),m=d(((e,t)=>{var i=f();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),g=d(((e,t)=>{var i=m(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),v=d(((e,t)=>{var i=m(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),b=d(((e,t)=>{var i=v(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),_=d(((e,t)=>{var i=b(),r=v();t.exports=function(e){if("Function"===i(e))return r(e)}})),y=d(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),w=d(((e,t)=>{var i=f();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),S=d(((e,t)=>{var i=m(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),k=d((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),T=d(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),E=d(((e,t)=>{var i=v(),r=f(),a=b(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),x=d(((e,t)=>{t.exports=function(e){return null==e}})),$=d(((e,t)=>{var i=x(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),C=d(((e,t)=>{var i=E(),r=$();t.exports=function(e){return i(r(e))}})),A=d(((e,t)=>{var i=y();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),P=d(((e,t)=>{t.exports={}})),L=d(((e,t)=>{var i=P(),r=p(),a=y(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),M=d(((e,t)=>{var i=v();t.exports=i({}.isPrototypeOf)})),I=d(((e,t)=>{var i=p().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),R=d(((e,t)=>{var i,r,a=p(),s=I(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),D=d(((e,t)=>{var i=R(),r=f(),a=p().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),O=d(((e,t)=>{var i=D();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),B=d(((e,t)=>{var i=L(),r=y(),a=M(),s=O(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),N=d(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),V=d(((e,t)=>{var i=y(),r=N(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),U=d(((e,t)=>{var i=V(),r=x();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),F=d(((e,t)=>{var i=S(),r=y(),a=A(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),j=d(((e,t)=>{t.exports=!0})),z=d(((e,t)=>{var i=p(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),W=d(((e,t)=>{var i=j(),r=p(),a=z(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),q=d(((e,t)=>{var i=W();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),H=d(((e,t)=>{var i=$(),r=Object;t.exports=function(e){return r(i(e))}})),K=d(((e,t)=>{var i=v(),r=H(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),Q=d(((e,t)=>{var i=v(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),G=d(((e,t)=>{var i=p(),r=q(),a=K(),s=Q(),n=D(),o=O(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),Y=d(((e,t)=>{var i=S(),r=A(),a=B(),s=U(),n=F(),o=G(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),X=d(((e,t)=>{var i=Y(),r=B();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),Z=d(((e,t)=>{var i=p(),r=A(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),J=d(((e,t)=>{var i=w(),r=f(),a=Z();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),ee=d((e=>{var t=w(),i=S(),r=k(),a=T(),s=C(),n=X(),o=K(),l=J(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),te=d(((e,t)=>{var i=f(),r=y(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),ie=d(((e,t)=>{var i=_(),r=V(),a=m(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),re=d(((e,t)=>{var i=w(),r=f();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),ae=d(((e,t)=>{var i=A(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),se=d((e=>{var t=w(),i=J(),r=re(),a=ae(),s=X(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),ne=d(((e,t)=>{var i=w(),r=se(),a=T();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),oe=d(((e,t)=>{var i=p(),r=g(),a=_(),s=y(),n=ee().f,o=te(),l=P(),u=ie(),d=ne(),c=K();W();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,_,y,w=e.target,S=e.global,k=e.stat,T=e.proto,E=S?i:k?i[w]:i[w]&&i[w].prototype,x=S?l:l[w]||d(l,w,{})[w],$=x.prototype;for(m in t)p=!(r=o(S?m:w+(k?".":"#")+m,e.forced))&&E&&c(E,m),v=x[m],p&&(e.dontCallGetSet?b=(y=n(E,m))&&y.value:b=E[m]),g=p&&b?b:t[m],(r||T||typeof v!=typeof g)&&(_=e.bind&&p?u(g,i):e.wrap&&p?h(g):T&&s(g)?a(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(_,"sham",!0),d(x,m,_),T&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&$&&(r||!$[m])&&d($,m,g)))}})),le=d(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),ue=d(((e,t)=>{var i=le();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),de=d(((e,t)=>{var i=ue(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),ce=d(((e,t)=>{var i=de();t.exports=function(e){return i(e.length)}})),he=d(((e,t)=>{t.exports=function(){}})),pe=d((()=>{var e=oe(),t=H(),i=ce(),r=ue(),a=he();e({target:"Array",proto:!0},{at:function(e){var a=t(this),s=i(a),n=r(e),o=n>=0?n:s+n;return o<0||o>=s?void 0:a[o]}}),a("at")})),fe=d(((e,t)=>{var i=L();t.exports=i})),me=d(((e,t)=>{pe();var i=fe();t.exports=i("Array","at")})),ge=d(((e,t)=>{var i=me();t.exports=i})),ve=d(((e,t)=>{var i=ge();t.exports=i})),be=d(((e,t)=>{var i=q(),r=Q(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),_e=d(((e,t)=>{var i=f();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),ye=d(((e,t)=>{var i=K(),r=y(),a=H(),s=be(),n=_e(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),we=d(((e,t)=>{var i=ue(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),Se=d(((e,t)=>{var i=C(),r=we(),a=ce(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),ke=d(((e,t)=>{t.exports={}})),Te=d(((e,t)=>{var i=v(),r=K(),a=C(),s=Se().indexOf,n=ke(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),Ee=d(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),xe=d(((e,t)=>{var i=Te(),r=Ee();t.exports=Object.keys||function(e){return i(e,r)}})),$e=d(((e,t)=>{var i=w(),r=f(),a=v(),s=ye(),n=xe(),o=C(),l=a(k().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ce=d((()=>{var e=oe(),t=$e().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Ae=d(((e,t)=>{Ce();var i=P();t.exports=i.Object.entries})),Pe=d(((e,t)=>{var i=Ae();t.exports=i})),Le=d(((e,t)=>{var i=Pe();t.exports=i})),Me=d((()=>{var e=oe(),t=Se().includes,i=f(),r=he();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Ie=d(((e,t)=>{Me();var i=fe();t.exports=i("Array","includes")})),Re=d(((e,t)=>{var i=Ie();t.exports=i})),De=d(((e,t)=>{var i=Re();t.exports=i})),Oe=d(((e,t)=>{t.exports={}})),Be=d(((e,t)=>{var i=p(),r=y(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),Ne=d(((e,t)=>{var i,r,a,s,n,o=Be(),l=p(),u=A(),d=ne(),c=K(),h=W(),f=be(),m=ke(),g="Object already initialized",v=l.TypeError,b=l.WeakMap;o||h.state?((s=h.state||(h.state=new b)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new v(g);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(m[n=f("state")]=!0,i=function(e,t){if(c(e,n))throw new v(g);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new v("Incompatible receiver, "+e+" required");return i}}}})),Ve=d(((e,t)=>{var i=w(),r=K(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Ue=d((e=>{var t=w(),i=re(),r=se(),a=ae(),s=C(),n=xe();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),Fe=d(((e,t)=>{var i=L();t.exports=i("document","documentElement")})),je=d(((e,t)=>{var i,r=ae(),a=Ue(),s=Ee(),n=ke(),o=Fe(),l=Z(),u=be(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete g[d][s[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:a.f(i,t)}})),ze=d(((e,t)=>{var i=ne();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),We=d(((e,t)=>{var i,r,a,s=f(),n=y(),o=A(),l=je(),u=ye(),d=ze(),c=G(),h=j(),p=c("iterator"),m=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):m=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:m}})),qe=d(((e,t)=>{var i={};i[G()("toStringTag")]="z",t.exports="[object z]"===String(i)})),He=d(((e,t)=>{var i=qe(),r=y(),a=b(),s=G()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Ke=d(((e,t)=>{var i=qe(),r=He();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Qe=d(((e,t)=>{var i=qe(),r=se().f,a=ne(),s=K(),n=Ke(),o=G()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),Ge=d(((e,t)=>{var i=We().IteratorPrototype,r=je(),a=T(),s=Qe(),n=Oe(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),Ye=d(((e,t)=>{var i=v(),r=V();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Xe=d(((e,t)=>{var i=A();t.exports=function(e){return i(e)||null===e}})),Ze=d(((e,t)=>{var i=Xe(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),Je=d(((e,t)=>{var i=Ye(),r=A(),a=$(),s=Ze();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),et=d(((e,t)=>{var i=oe(),r=S(),a=j(),s=Ve(),n=y(),o=Ge(),l=ye(),u=Je(),d=Qe(),c=ne(),h=ze(),p=G(),f=Oe(),m=We(),g=s.PROPER,v=s.CONFIGURABLE,b=m.IteratorPrototype,_=m.BUGGY_SAFARI_ITERATORS,w=p("iterator"),k="keys",T="values",E="entries",x=function(){return this};t.exports=function(e,t,s,p,m,y,S){o(s,t,p);var $,C,A,P=function(e){if(e===m&&D)return D;if(!_&&e&&e in I)return I[e];switch(e){case k:case T:case E:return function(){return new s(this,e)}}return function(){return new s(this)}},L=t+" Iterator",M=!1,I=e.prototype,R=I[w]||I["@@iterator"]||m&&I[m],D=!_&&R||P(m),O="Array"===t&&I.entries||R;if(O&&(($=l(O.call(new e)))!==Object.prototype&&$.next&&(!a&&l($)!==b&&(u?u($,b):n($[w])||h($,w,x)),d($,L,!0,!0),a&&(f[L]=x))),g&&m===T&&R&&R.name!==T&&(!a&&v?c(I,"name",T):(M=!0,D=function(){return r(R,this)})),m)if(C={values:P(T),keys:y?D:P(k),entries:P(E)},S)for(A in C)(_||M||!(A in I))&&h(I,A,C[A]);else i({target:t,proto:!0,forced:_||M},C);return(!a||S)&&I[w]!==D&&h(I,w,D,{name:m}),f[t]=D,C}})),tt=d(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),it=d(((e,t)=>{var i=C(),r=he(),a=Oe(),s=Ne(),n=se().f,o=et(),l=tt(),u=j(),d=w(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),rt=d(((e,t)=>{var i=G(),r=Oe(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),at=d(((e,t)=>{var i=He(),r=U(),a=x(),s=Oe(),n=G()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),st=d(((e,t)=>{var i=S(),r=V(),a=ae(),s=N(),n=at(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),nt=d(((e,t)=>{var i=S(),r=ae(),a=U();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),ot=d(((e,t)=>{var i=ie(),r=S(),a=ae(),s=N(),n=rt(),o=ce(),l=M(),u=st(),d=at(),c=nt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,_,y,w,S,k=m&&m.that,T=!(!m||!m.AS_ENTRIES),E=!(!m||!m.IS_RECORD),x=!(!m||!m.IS_ITERATOR),$=!(!m||!m.INTERRUPTED),C=i(t,k),A=function(e){return g&&c(g,"normal",e),new p(!0,e)},P=function(e){return T?(a(e),$?C(e[0],e[1],A):C(e[0],e[1])):$?C(e,A):C(e)};if(E)g=e.iterator;else if(x)g=e;else{if(!(v=d(e)))throw new h(s(e)+" is not iterable");if(n(v)){for(b=0,_=o(e);_>b;b++)if((y=P(e[b]))&&l(f,y))return y;return new p(!1)}g=u(e,v)}for(w=E?e.next:g.next;!(S=r(w,g)).done;){try{y=P(S.value)}catch(e){c(g,"throw",e)}if("object"==typeof y&&y&&l(f,y))return y}return new p(!1)}})),lt=d(((e,t)=>{var i=w(),r=se(),a=T();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),ut=d((()=>{var e=oe(),t=ot(),i=lt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),dt=d(((e,t)=>{it(),ut();var i=P();t.exports=i.Object.fromEntries})),ct=d(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),ht=d((()=>{it();var e,t=ct(),i=p(),r=Qe(),a=Oe();for(e in t)r(i[e],e),a[e]=a.Array})),pt=d(((e,t)=>{var i=dt();ht(),t.exports=i})),ft=d(((e,t)=>{var i=pt();t.exports=i})),mt="1.0.62",gt=class{unsubscribe(){let e=this.subscriptions;this.subscriptions=[],e.forEach((e=>{"function"==typeof e?e():e.unsubscribe()}))}add(e){return this.subscriptions.push(e),this}constructor(){this.subscriptions=[]}},vt=e=>{throw new Error(`${e} is value of unexpected type`)},bt=e=>{},_t=()=>{},yt=class{subscribe(e,t){let i;i=t?"function"==typeof t?{next:t,error:_t}:{next:e=>t.next(e),error:e=>t.error?.(e)}:{next:_t,error:_t};let r,a="function"==typeof e?{next:t=>{try{let r=e(t);r instanceof Promise&&r.catch((e=>i.next(e)))}catch(e){i.next(e)}},error:e=>i.next(e)}:{next:t=>e.next(t),error:t=>e.error?e.error(t):i.next(t)};try{r=this._subscribe(a)}catch(e){a.error?.(e)}return(new gt).add((()=>{switch(a.next=_t,a.error=_t,typeof r){case"function":return void r();case"object":return void r.unsubscribe();case"undefined":return;default:return vt(r)}}))}pipe(...e){return e.reduce(((e,t)=>t(e)),this)}_subscribe(e){}constructor(e){e&&(this._subscribe=e)}},wt=class extends yt{next(e){this.subscribers.forEach((t=>t.next(e)))}error(e){this.subscribers.forEach((t=>t.error?.(e)))}_subscribe(e){let t=this.keyCounter++;return this.subscribers.set(t,e),(new gt).add((()=>this.subscribers.delete(t)))}constructor(){super(),this.keyCounter=0,this.subscribers=new Map}},St=class{createCustomLog(e){return(...t)=>{let i;try{i=e(...t)}catch{i={message:"error in `createCustomLog`",component:"Logger"}}this.log(i)}}createComponentLog(e){return this.createCustomLog((t=>({component:e,...t})))}constructor(){this.log$=new wt,this.logs=[],this.log=e=>{let t={...e,timestamp:Date.now()};this.logs.push(t),this.log$.next(t)},this.getAllLogs=()=>this.logs}};function kt(e,t='Assertion "value is not nullable" failed'){if(null==e)throw new Error(t)}function Tt(e){return typeof e<"u"&&null!==e}function Et(e){return null==e}function xt(e,t){if(!e?.length)throw new Error(t)}var $t=(e,t,i)=>new Promise(((r,a)=>{t.addEventListener("abort",(()=>{l(),u.remove()}));let s,n=()=>{l(),a("error")},o=()=>{l(),r()},l=()=>{s&&clearTimeout(s),u.removeEventListener("load",o),u.removeEventListener("error",n)};i&&(s=window.setTimeout((()=>{l(),a("timeout")}),i));let u=document.createElement("script");u.addEventListener("load",o),u.addEventListener("error",n),u.src=e,document.head.appendChild(u)})),Ct="function"==typeof window.performance?.now?()=>window.performance.now():()=>Date.now(),At=(e,t)=>async(...i)=>{let r,a=t(...i),s=e.aborted;for(;!s&&!e.aborted;)try{let e=await a.next(r);s=e.done??!1,r=e.value}catch(e){await a.throw(e)}return r},Pt=(e,{start:t=0,factor:i=2,max:r=1/0,min:a=t,random:s=0}={})=>{let n=t;return n*=i**e,n*=Math.random()*s*2-s+1,n=Math.round(n),n=Math.min(n,r),n=Math.max(n,a),n},Lt={};c(Lt,{clear:()=>jt,get:()=>Nt,has:()=>Ut,isPersistent:()=>Bt,remove:()=>Ft,set:()=>Vt});var Mt,It,Rt,Dt=`vk-videoplayer-dummy-key-${Math.random()}`,Ot=()=>{if(void 0!==It)return It;try{localStorage.setItem(Dt,"test"),localStorage.removeItem(Dt),It=0}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;try{sessionStorage.getItem(Dt),It=1}catch(e){if(!(e instanceof DOMException||e instanceof TypeError))throw e;It=2}}return 2===It&&(Mt=new Map),It},Bt=()=>0===Ot(),Nt=e=>{let t=Ot();switch(t){case 0:return localStorage.getItem(e)??void 0;case 1:return sessionStorage.getItem(e)??void 0;case 2:return Mt?.get(e);default:vt(t)}},Vt=(e,t)=>{let i=Ot();switch(i){case 0:try{localStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 1:try{sessionStorage.setItem(e,t)}catch(e){if(!(e instanceof DOMException))throw e;console.error(e)}break;case 2:return void Mt?.set(e,t);default:vt(i)}},Ut=e=>{let t=Ot();switch(t){case 0:return e in localStorage;case 1:return e in sessionStorage;case 2:return Mt?.has(e)??!1;default:return vt(t),!1}},Ft=e=>{let t=Ot();switch(t){case 0:return localStorage.removeItem(e);case 1:return sessionStorage.removeItem(e);case 2:return void Mt?.delete(e);default:vt(t)}},jt=()=>{let e=Ot();switch(e){case 0:return localStorage.clear();case 1:return sessionStorage.clear();case 2:return Mt?.clear();default:vt(e)}},zt=h(ve(),1),Wt=()=>{let e,t=[];try{e=window.self!==window.top}catch(t){t instanceof DOMException&&"SecurityError"===t.name?e=!0:(e=!1,console.error(t))}try{window.location.ancestorOrigins&&(t=[...window.location.ancestorOrigins])}catch(e){console.error(e)}try{!t.length&&document.referrer&&(t=[new URL(document.referrer).origin])}catch(e){console.error(e)}return{isEmbed:e,origins:t,topOrigin:(0,zt.default)(t,-1),immediateOrigin:(0,zt.default)(t,0)}},qt=((Rt=qt||{}).INVARIANT="Invariant quality",Rt.Q_144P="144p",Rt.Q_240P="240p",Rt.Q_360P="360p",Rt.Q_480P="480p",Rt.Q_576P="576p",Rt.Q_720P="720p",Rt.Q_1080P="1080p",Rt.Q_1440P="1440p",Rt.Q_2160P="2160p",Rt.Q_4320P="4320p",Rt),Ht={"144p":{width:256,height:144},"240p":{width:428,height:240},"360p":{width:640,height:360},"480p":{width:856,height:480},"576p":{width:1024,height:576},"720p":{width:1280,height:720},"1080p":{width:1920,height:1080},"1440p":{width:2560,height:1440},"2160p":{width:3840,height:2160},"4320p":{width:7680,height:4320}},Kt=(e,t)=>Ht[e].height>Ht[t].height,Qt=(e,t)=>Ht[e].height>=Ht[t].height,Gt=(e,t)=>Ht[e].height<Ht[t].height,Yt=(e,t)=>Ht[e].height<=Ht[t].height,Xt=e=>e.sort(((e,t)=>e===t?0:"Invariant quality"===e?1:"Invariant quality"===t?-1:Gt(e,t)?1:-1))[0],Zt=Object.keys(Ht).sort(((e,t)=>Gt(e,t)?-1:1)),Jt=(e,t=.02)=>[...Zt].find((i=>Ht[i].height*(1+t)>=e)),ei=({width:e,height:t})=>{let i=Math.min(e,t),r=Math.max(e,t);return Zt.find((e=>{let t=Ht[e];return t.width>=r&&t.height>=i}))},ti=e=>Ht[e].height,ii=e=>"Invariant quality"===e;var ri=(e,t)=>{let i={};for(let r of Object.keys(t)){let a=t[r],s=e[r];Array.isArray(a)&&Array.isArray(s)?i[r]=s:i[r]="object"==typeof a&&"object"==typeof s?ri(s,a):r in e?s:a}return i};function ai(e,t=0,i){let r,a,s,n,o,l,u=0,d=!1,c=!1,h=!0,p=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;function f(t){let i=r,s=a;return r=a=void 0,u=t,n=e.apply(s,i),n}function m(e,t){return p?(o&&window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function g(e){let i=e-l;return void 0===l||i>=t||i<0||c&&e-u>=s}function v(){let e=Date.now();if(g(e))return b(e);o=m(v,function(e){let i=e-u,r=t-(e-l);return c?Math.min(r,s-i):r}(e))}function b(e){return o=void 0,h&&r?f(e):(r=a=void 0,n)}function _(...e){let i=Date.now(),s=g(i);if(r=e,a=this,l=i,s){if(void 0===o)return function(e){return u=e,o=m(v,t),d?f(e):n}(l);if(c)return o=m(v,t),f(l)}return void 0===o&&(o=m(v,t)),n}return i&&(d=!!i.leading,c="maxWait"in i,s=i?.maxWait?Math.max(+i?.maxWait||0,t):s,h="trailing"in i?!!i.trailing:h),_.cancel=function(){var e;void 0!==o&&(e=o,p?window.cancelAnimationFrame(e):clearTimeout(e)),u=0,r=l=a=o=void 0},_.flush=function(){return void 0===o?n:b(Date.now())},_.pending=function(){return void 0!==o},_}var si=(e,t=0,i)=>ai(e,t,{leading:!0,trailing:!0,...i,maxWait:t}),ni=(e,t)=>{if(null===e||"object"!=typeof e)return e;let i=Array.isArray(e)?[]:{};for(let r in e){if("function"==typeof t){let a=t(e[r],r,e,i);if(void 0!==a){i[r]=a;continue}}"object"==typeof e[r]?i[r]=ni(e[r],t):i[r]=e[r]}return i},oi=(e,t=300)=>new yt((i=>{let{width:r,height:a}=e.getBoundingClientRect();if(i.next({width:r,height:a}),!window.ResizeObserver)return;let s=new ResizeObserver(si((e=>{let t,r,a=e[0];a&&(a.contentBoxSize&&a.contentBoxSize[0]?(r=a.contentBoxSize[0].blockSize,t=a.contentBoxSize[0].inlineSize):a.contentRect&&(t=a.contentRect.width,r=a.contentRect.height),Tt(t)&&Tt(r)&&i.next({width:t,height:r}))}),t));return s.observe(e),()=>s.disconnect()})),li=(e,t=6,i=".")=>{let r={};for(let a in e)if(e.hasOwnProperty(a)&&!(e[a]instanceof HTMLElement)&&t)if("object"==typeof e[a]&&null!==e[a]){let s=li(e[a],t-1);for(let e in s)s.hasOwnProperty(e)&&(r[a+i+e]=s[e])}else r[a]=e[a];return r},ui=e=>{e.removeAttribute("src"),e.load()},di=e=>{let t;try{t=new URL(e)}catch{return!1}return"https:"===t.protocol},ci=e=>{try{return new URL(e)}catch{return null}},hi=e=>t=>i=>{let r="object"==typeof i;null==i||r&&!Object.keys(i).length||e(t,r?li(i):{value:i})},pi=(e={})=>{let t=e=>{let t=e;return void 0===e?t="undefined":null===e?t="null":("number"==typeof e||"boolean"==typeof e)&&(t=e.toString()),t},i={};for(let r in e)Array.isArray(e[r])?i[r]=e[r].map(t):i[r]=t(e[r]);return i},fi=(r=class e{init({name:t,getParentContext:i},r){this.span=e.rootTracer.startSpan(t,{startTime:r},i?.()),this.context=e.dynamicImports.opentelemetryApi.trace.setSpan(e.dynamicImports.opentelemetryApi.context.active(),this.span)}async loadOpentelemetry(){if("not_started"===e.dynamicImportStatus){e.dynamicImportStatus="in_progress";try{let t=new Promise(((e,t)=>setTimeout(t,this.dynamicImportTimeout))),r=Promise.all([Promise.all([i.e(7272),i.e(874)]).then(i.bind(i,590874)),Promise.all([i.e(7272),i.e(5817)]).then(i.bind(i,625817)),i.e(8240).then(i.bind(i,758240))]),[a,s,n]=await Promise.race([r,t]);e.dynamicImports={opentelemetryApi:a,opentelemetrySdk:s,tracer:n},e.dynamicImportStatus="completed"}catch{e.dynamicImportStatus="failed"}}}isComponentTracerNotInitialized(){return Et(this.span)}log(e,t){let i=Date.now();this.initPromise.then((r=>this.span.addEvent(e,{...pi(t),type:"log"},i)))}error(e,t){let i=Date.now();this.initPromise.then((r=>this.span.addEvent(e,{...pi(t),type:"error"},i)))}critical(e,t){let i=Date.now();this.initPromise.then((r=>this.span.addEvent(e,{...pi(t),type:"critical"},i)))}createComponentTracer(t){let i=new e({name:t,getParentContext:()=>this.context});return this.childTracers.push(i),i}end(){this.initPromise.then((e=>{this.childTracers.forEach((e=>e.end())),this.span.end()}))}constructor({name:t,getParentContext:i}){if(this.dynamicImportTimeout=5e3,this.childTracers=[],"failed"===e.dynamicImportStatus)return this;"not_started"===e.dynamicImportStatus&&(e.dynamicImportPromise=this.loadOpentelemetry());let r=Date.now();this.initPromise=e.dynamicImportPromise.then((()=>this.init({name:t,getParentContext:i},r)))}},r.dynamicImportStatus="not_started",r),mi=class extends fi{init({name:e,getParentContext:t},i){let r=fi.dynamicImports.tracer.initTracerOpenTelemetry({serviceName:"videoplayer-sdk-web",appToken:"L9SBoka6ZWk4xPjaK7tmfSfYvMhcge7nvGDjpdMmscb",spanLimits:{attributeCountLimit:1/0,eventCountLimit:1/0,attributePerEventCountLimit:1/0}}).getProvider(),a=new fi.dynamicImports.tracer.TracerMemorySpanExporter;this.spanExporter=a,r.addSpanProcessor(new fi.dynamicImports.tracer.TracerAllSpansProcessor({startedSpansExporter:a})),fi.rootTracer=r.getTracer("sdk-videoplayer-tracer"),super.init({name:e,getParentContext:t},i)}getFinishedSpans(){if(!this.isComponentTracerNotInitialized())return this.spanExporter?.getJsonData()}getTraceId(){return this.isComponentTracerNotInitialized()?"":this.span.spanContext().traceId}constructor(){super({name:"Root"})}},gi=class e{log(e,t){}error(e,t){}critical(e,t){}createComponentTracer(t){return new e({name:t})}end(){}getFinishedSpans(){}getTraceId(){return this.fakeTraceId}constructor(e){}},vi=class{static createRootTracer(e=!1){return e?new mi:new gi}},bi=class extends wt{next(e){super.next(this.value=e)}error(e){super.error(this.value=e)}getValue(){return this.value}_subscribe(e){let t=super._subscribe(e);return e.next(this.value),t}constructor(e){super(),this.value=e}},_i=h(Le(),1);function yi(e){return new yt((t=>{let i={},r=Object.keys(e).length;return(0,_i.default)(e).reduce(((e,[a,s])=>e.add(s.subscribe((e=>a=>{e in i||r--,i[e]=a,0===r&&t.next(i)})(a)))),new gt)}))}function wi(...e){return new yt((t=>e.reduce(((e,i)=>e.add(i.subscribe(t))),new gt)))}var Si=e=>new yt((t=>{let i=window.setTimeout((()=>{try{t.next()}catch(e){if(!t.error)throw e;t.error(e)}}),e);return()=>window.clearTimeout(i)})),ki=e=>new yt((t=>{let i=window.setInterval((()=>t.next()),e);return()=>{i&&(window.clearInterval(i),i=void 0)}})),Ti=e=>new yt((t=>{e.forEach((e=>t.next(e)))})),Ei=(e,t)=>new yt((i=>{let r=e=>i.next(e);return e.addEventListener(t,r),()=>e.removeEventListener(t,r)})),xi=class extends gt{remove(e){this.subscriptions=this.subscriptions.filter((t=>t!==e))}};var $i={leading:!1,trailing:!0};function Ci(e,t=$i){return i=>new yt((r=>i.subscribe(new Ai(r,e,t))))}var Ai=class{next(e){this.lastValue=e,Tt(this.timeout)?window.clearTimeout(this.timeout):this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{if(this.config.trailing)try{this.destination.next(this.lastValue)}catch(e){if(!this.destination.error)throw e;this.destination.error(e)}this.timeout=void 0}),this.time)}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}},Pi={leading:!0,trailing:!1};function Li(e,t=Pi){return i=>new yt((r=>i.subscribe(new Mi(r,e,t))))}var Mi=class{next(e){this.lastValue=e,Et(this.timeout)&&(this.config.leading&&this.destination.next(e),this.timeout=window.setTimeout((()=>{this.config.trailing&&this.destination.next(this.lastValue),this.timeout=void 0}),this.time))}error(e){this.destination.error?.(e)}constructor(e,t,i){this.destination=e,this.time=t,this.config=i}};function Ii(e){return t=>new yt((i=>t.subscribe(new Ri(i,e))))}var Ri=class{next(e){let t;try{t=this.predicate(e)}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t}},Di=h(De(),1),Oi=(e,t)=>e instanceof Object&&t instanceof Object?((e,t)=>{let i=(e,t)=>{let i=Object.keys(e);for(let r in t)if(!(0,Di.default)(i,r)||t[r]!==e[r])return!1;return!0};return i(e,t)&&i(t,e)})(e,t):e===t;function Bi(e=Oi){return t=>new yt((i=>t.subscribe(new Vi(i,e))))}var Ni={},Vi=class{next(e){let t;try{t=this.lastValue===Ni||!this.predicate(this.lastValue,e),this.lastValue=e instanceof Object?{...e}:e}catch(e){throw this.error(e),e}t&&this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.predicate=t,this.lastValue=Ni}};function Ui(e){return t=>new yt((i=>t.subscribe(new Fi(i,e))))}var Fi=class{next(e){let t;try{t=this.mapper(e)}catch(e){throw this.error(e),e}this.destination.next(t)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.mapper=t}};function ji(e){return Ui((()=>e))}function zi(){return e=>new yt((t=>{let i=!1,r=!1,a=e.subscribe((e=>{i||(i=!0,t.next(e)),r&&a.unsubscribe()}),(e=>{i=!0,t.error?.(e),r&&a.unsubscribe()}));return r=!0,i&&a.unsubscribe(),a}))}function Wi(e){return t=>new yt((i=>t.subscribe(new qi(i,e))))}var qi=class{next(e){try{this.effect(e)}catch(e){throw this.error(e),e}this.destination.next(e)}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.effect=t}};function Hi(e){return t=>new yt((i=>t.subscribe(new Qi(i,e))))}var Ki,Qi=class{next(e){0===this.count?this.destination.next(e):this.count--}error(e){this.destination.error?.(e)}constructor(e,t){this.destination=e,this.count=t,t<0&&this.destination.error?.(new Error("Count can not be less than zero"))}},Gi=((Ki=Gi||{}).NETWORK="network",Ki.VIDEO_PIPELINE="video_pipeline",Ki.EXTERNAL_API="external_api",Ki.PARSER="parser",Ki.DOM="dom",Ki.WTF="wtf",Ki.FATAL="fatal",Ki),Yi=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Xi=class extends Yi{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Yi.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Zi=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Xi,writable:!0,configurable:!0})}};function Ji(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Zi.prototype[Symbol.toStringTag]="AbortController",Xi.prototype[Symbol.toStringTag]="AbortSignal");var er,tr="fetch"in window&&Ji({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),ir=tr?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Ji({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,rr=tr?ir.fetch:window.fetch,ar=(tr?ir.Request:window.Request,tr||window.AbortController,tr||window.AbortSignal,h(Le(),1)),sr=h(ft(),1),nr=(e=>(e.Armenian="58",e.Azerbaijani="57",e.Belarusian="114",e.English="3",e.Kazakh="97",e.Portuguese="73",e.Russian="0",e.Spanish="4",e.Ukrainian="1",e.Uzbek="65",e.Vietnamese="75",e))(nr||{}),or=async(e,t,i)=>{let r=new URL("https://vk.com/js/lang-pack.js");r.searchParams.set("format","json"),r.searchParams.set("name",t),void 0!==e&&r.searchParams.set("lang",e);let a=await(await rr(r.toString())).json();return lr(a,i)},lr=(e,t)=>(0,sr.default)((0,ar.default)(e.keys).map((([e,i])=>[e.substring(`${t}_`.length),ur(i)]))),ur=e=>Array.isArray(e)?e[0]:e,dr=((er=dr||{}).RU="ru",er.EN="en",er),cr={UI:"__vkVideoPlayer",CORE:"__vkVideoCore"},hr=(()=>{let e=0;return()=>{let t=e;return e=(e+1)%Number.MAX_SAFE_INTEGER,t}})(),pr=class{getWindowObject(){let e=this.key();return window[e]?.[this.id]??{}}initWindowObjects(){let e=this.key();window[e]||(window[e]={}),window[e][this.id]={}}expose(e){Object.assign(this.getWindowObject(),e)}destroy(){let e=this.key();window&&window[e]&&window[e][this.id]&&(delete window[e][this.id],Object.keys(window[e]).length||delete window[e])}key(){let{type:e}=this;return cr[e]}constructor(e){this.id=hr(),this.type=e,this.initWindowObjects()}},fr={};c(fr,{create:()=>gr,destroy:()=>vr,push:()=>br,subscribe:()=>_r});var mr=new Map,gr=(e,t)=>mr.set(e,t??[]),vr=e=>mr.delete(e),br=(e,t)=>{let i=mr.get(e);i&&("function"==typeof i?i(t):i.push(t))},_r=(e,t)=>{let i=mr.get(e);if(i){if(i&&Array.isArray(i))for(let e of i)t(e);mr.set(e,t)}}},424814:(e,t,i)=>{i.d(t,{ApiEnv:()=>di,InteractiveInterfaceClick:()=>mi,OneStat:()=>er,SeekAction:()=>fi,VERSION:()=>yi});var r,a,s,n,o,l,u=i(319340),d=i(99758),c=Object.create,h=Object.defineProperty,p=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty,v=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),b=(e,t,i)=>(i=null!=e?c(m(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let a of f(t))!g.call(e,a)&&a!==i&&h(e,a,{get:()=>t[a],enumerable:!(r=p(t,a))||r.enumerable});return e})(!t&&e&&e.__esModule?i:h(i,"default",{value:e,enumerable:!0}),e)),_=v(((e,t)=>{var i=function(e){return e&&e.Math===Math&&e};t.exports=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof global&&global)||i("object"==typeof e&&e)||function(){return this}()||Function("return this")()})),y=v(((e,t)=>{t.exports=function(e){try{return!!e()}catch{return!0}}})),w=v(((e,t)=>{var i=y();t.exports=!i((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))})),S=v(((e,t)=>{var i=w(),r=Function.prototype,a=r.apply,s=r.call;t.exports="object"==typeof Reflect&&Reflect.apply||(i?s.bind(a):function(){return s.apply(a,arguments)})})),k=v(((e,t)=>{var i=w(),r=Function.prototype,a=r.call,s=i&&r.bind.bind(a,a);t.exports=i?s:function(e){return function(){return a.apply(e,arguments)}}})),T=v(((e,t)=>{var i=k(),r=i({}.toString),a=i("".slice);t.exports=function(e){return a(r(e),8,-1)}})),E=v(((e,t)=>{var i=T(),r=k();t.exports=function(e){if("Function"===i(e))return r(e)}})),x=v(((e,t)=>{var i="object"==typeof document&&document.all;t.exports=typeof i>"u"&&void 0!==i?function(e){return"function"==typeof e||e===i}:function(e){return"function"==typeof e}})),$=v(((e,t)=>{var i=y();t.exports=!i((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))})),C=v(((e,t)=>{var i=w(),r=Function.prototype.call;t.exports=i?r.bind(r):function(){return r.apply(r,arguments)}})),A=v((e=>{var t={}.propertyIsEnumerable,i=Object.getOwnPropertyDescriptor,r=i&&!t.call({1:2},1);e.f=r?function(e){var t=i(this,e);return!!t&&t.enumerable}:t})),P=v(((e,t)=>{t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}})),L=v(((e,t)=>{var i=k(),r=y(),a=T(),s=Object,n=i("".split);t.exports=r((function(){return!s("z").propertyIsEnumerable(0)}))?function(e){return"String"===a(e)?n(e,""):s(e)}:s})),M=v(((e,t)=>{t.exports=function(e){return null==e}})),I=v(((e,t)=>{var i=M(),r=TypeError;t.exports=function(e){if(i(e))throw new r("Can't call method on "+e);return e}})),R=v(((e,t)=>{var i=L(),r=I();t.exports=function(e){return i(r(e))}})),D=v(((e,t)=>{var i=x();t.exports=function(e){return"object"==typeof e?null!==e:i(e)}})),O=v(((e,t)=>{t.exports={}})),B=v(((e,t)=>{var i=O(),r=_(),a=x(),s=function(e){return a(e)?e:void 0};t.exports=function(e,t){return arguments.length<2?s(i[e])||s(r[e]):i[e]&&i[e][t]||r[e]&&r[e][t]}})),N=v(((e,t)=>{var i=k();t.exports=i({}.isPrototypeOf)})),V=v(((e,t)=>{var i=_().navigator,r=i&&i.userAgent;t.exports=r?String(r):""})),U=v(((e,t)=>{var i,r,a=_(),s=V(),n=a.process,o=a.Deno,l=n&&n.versions||o&&o.version,u=l&&l.v8;u&&(r=(i=u.split("."))[0]>0&&i[0]<4?1:+(i[0]+i[1])),!r&&s&&((!(i=s.match(/Edge\/(\d+)/))||i[1]>=74)&&((i=s.match(/Chrome\/(\d+)/))&&(r=+i[1]))),t.exports=r})),F=v(((e,t)=>{var i=U(),r=y(),a=_().String;t.exports=!!Object.getOwnPropertySymbols&&!r((function(){var e=Symbol("symbol detection");return!a(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&i&&i<41}))})),j=v(((e,t)=>{var i=F();t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator})),z=v(((e,t)=>{var i=B(),r=x(),a=N(),s=j(),n=Object;t.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=i("Symbol");return r(t)&&a(t.prototype,n(e))}})),W=v(((e,t)=>{var i=String;t.exports=function(e){try{return i(e)}catch{return"Object"}}})),q=v(((e,t)=>{var i=x(),r=W(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a function")}})),H=v(((e,t)=>{var i=q(),r=M();t.exports=function(e,t){var a=e[t];return r(a)?void 0:i(a)}})),K=v(((e,t)=>{var i=C(),r=x(),a=D(),s=TypeError;t.exports=function(e,t){var n,o;if("string"===t&&r(n=e.toString)&&!a(o=i(n,e))||r(n=e.valueOf)&&!a(o=i(n,e))||"string"!==t&&r(n=e.toString)&&!a(o=i(n,e)))return o;throw new s("Can't convert object to primitive value")}})),Q=v(((e,t)=>{t.exports=!0})),G=v(((e,t)=>{var i=_(),r=Object.defineProperty;t.exports=function(e,t){try{r(i,e,{value:t,configurable:!0,writable:!0})}catch{i[e]=t}return t}})),Y=v(((e,t)=>{var i=Q(),r=_(),a=G(),s="__core-js_shared__",n=t.exports=r[s]||a(s,{});(n.versions||(n.versions=[])).push({version:"3.38.0",mode:i?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.0/LICENSE",source:"https://github.com/zloirock/core-js"})})),X=v(((e,t)=>{var i=Y();t.exports=function(e,t){return i[e]||(i[e]=t||{})}})),Z=v(((e,t)=>{var i=I(),r=Object;t.exports=function(e){return r(i(e))}})),J=v(((e,t)=>{var i=k(),r=Z(),a=i({}.hasOwnProperty);t.exports=Object.hasOwn||function(e,t){return a(r(e),t)}})),ee=v(((e,t)=>{var i=k(),r=0,a=Math.random(),s=i(1..toString);t.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++r+a,36)}})),te=v(((e,t)=>{var i=_(),r=X(),a=J(),s=ee(),n=F(),o=j(),l=i.Symbol,u=r("wks"),d=o?l.for||l:l&&l.withoutSetter||s;t.exports=function(e){return a(u,e)||(u[e]=n&&a(l,e)?l[e]:d("Symbol."+e)),u[e]}})),ie=v(((e,t)=>{var i=C(),r=D(),a=z(),s=H(),n=K(),o=te(),l=TypeError,u=o("toPrimitive");t.exports=function(e,t){if(!r(e)||a(e))return e;var o,d=s(e,u);if(d){if(void 0===t&&(t="default"),o=i(d,e,t),!r(o)||a(o))return o;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),n(e,t)}})),re=v(((e,t)=>{var i=ie(),r=z();t.exports=function(e){var t=i(e,"string");return r(t)?t:t+""}})),ae=v(((e,t)=>{var i=_(),r=D(),a=i.document,s=r(a)&&r(a.createElement);t.exports=function(e){return s?a.createElement(e):{}}})),se=v(((e,t)=>{var i=$(),r=y(),a=ae();t.exports=!i&&!r((function(){return 7!==Object.defineProperty(a("div"),"a",{get:function(){return 7}}).a}))})),ne=v((e=>{var t=$(),i=C(),r=A(),a=P(),s=R(),n=re(),o=J(),l=se(),u=Object.getOwnPropertyDescriptor;e.f=t?u:function(e,t){if(e=s(e),t=n(t),l)try{return u(e,t)}catch{}if(o(e,t))return a(!i(r.f,e,t),e[t])}})),oe=v(((e,t)=>{var i=y(),r=x(),a=/#|\.prototype\./,s=function(e,t){var a=o[n(e)];return a===u||a!==l&&(r(t)?i(t):!!t)},n=s.normalize=function(e){return String(e).replace(a,".").toLowerCase()},o=s.data={},l=s.NATIVE="N",u=s.POLYFILL="P";t.exports=s})),le=v(((e,t)=>{var i=E(),r=q(),a=w(),s=i(i.bind);t.exports=function(e,t){return r(e),void 0===t?e:a?s(e,t):function(){return e.apply(t,arguments)}}})),ue=v(((e,t)=>{var i=$(),r=y();t.exports=i&&r((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))})),de=v(((e,t)=>{var i=D(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not an object")}})),ce=v((e=>{var t=$(),i=se(),r=ue(),a=de(),s=re(),n=TypeError,o=Object.defineProperty,l=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",c="writable";e.f=t?r?function(e,t,i){if(a(e),t=s(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&c in i&&!i[c]){var r=l(e,t);r&&r[c]&&(e[t]=i.value,i={configurable:d in i?i[d]:r[d],enumerable:u in i?i[u]:r[u],writable:!1})}return o(e,t,i)}:o:function(e,t,r){if(a(e),t=s(t),a(r),i)try{return o(e,t,r)}catch{}if("get"in r||"set"in r)throw new n("Accessors not supported");return"value"in r&&(e[t]=r.value),e}})),he=v(((e,t)=>{var i=$(),r=ce(),a=P();t.exports=i?function(e,t,i){return r.f(e,t,a(1,i))}:function(e,t,i){return e[t]=i,e}})),pe=v(((e,t)=>{var i=_(),r=S(),a=E(),s=x(),n=ne().f,o=oe(),l=O(),u=le(),d=he(),c=J();Y();var h=function(e){var t=function(i,a,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,a)}return new e(i,a,s)}return r(e,this,arguments)};return t.prototype=e.prototype,t};t.exports=function(e,t){var r,p,f,m,g,v,b,_,y,w=e.target,S=e.global,k=e.stat,T=e.proto,E=S?i:k?i[w]:i[w]&&i[w].prototype,x=S?l:l[w]||d(l,w,{})[w],$=x.prototype;for(m in t)p=!(r=o(S?m:w+(k?".":"#")+m,e.forced))&&E&&c(E,m),v=x[m],p&&(e.dontCallGetSet?b=(y=n(E,m))&&y.value:b=E[m]),g=p&&b?b:t[m],(r||T||typeof v!=typeof g)&&(_=e.bind&&p?u(g,i):e.wrap&&p?h(g):T&&s(g)?a(g):g,(e.sham||g&&g.sham||v&&v.sham)&&d(_,"sham",!0),d(x,m,_),T&&(c(l,f=w+"Prototype")||d(l,f,{}),d(l[f],m,g),e.real&&$&&(r||!$[m])&&d($,m,g)))}})),fe=v(((e,t)=>{var i=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(e){var t=+e;return(t>0?r:i)(t)}})),me=v(((e,t)=>{var i=fe();t.exports=function(e){var t=+e;return t!=t||0===t?0:i(t)}})),ge=v(((e,t)=>{var i=me(),r=Math.max,a=Math.min;t.exports=function(e,t){var s=i(e);return s<0?r(s+t,0):a(s,t)}})),ve=v(((e,t)=>{var i=me(),r=Math.min;t.exports=function(e){var t=i(e);return t>0?r(t,9007199254740991):0}})),be=v(((e,t)=>{var i=ve();t.exports=function(e){return i(e.length)}})),_e=v(((e,t)=>{var i=R(),r=ge(),a=be(),s=function(e){return function(t,s,n){var o=i(t),l=a(o);if(0===l)return!e&&-1;var u,d=r(n,l);if(e&&s!=s){for(;l>d;)if((u=o[d++])!=u)return!0}else for(;l>d;d++)if((e||d in o)&&o[d]===s)return e||d||0;return!e&&-1}};t.exports={includes:s(!0),indexOf:s(!1)}})),ye=v(((e,t)=>{t.exports=function(){}})),we=v((()=>{var e=pe(),t=_e().includes,i=y(),r=ye();e({target:"Array",proto:!0,forced:i((function(){return!Array(1).includes()}))},{includes:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}}),r("includes")})),Se=v(((e,t)=>{var i=B();t.exports=i})),ke=v(((e,t)=>{we();var i=Se();t.exports=i("Array","includes")})),Te=v(((e,t)=>{var i=ke();t.exports=i})),Ee=v(((e,t)=>{var i=Te();t.exports=i})),xe=v((()=>{})),$e=v(((e,t)=>{var i=_(),r=V(),a=T(),s=function(e){return r.slice(0,e.length)===e};t.exports=s("Bun/")?"BUN":s("Cloudflare-Workers")?"CLOUDFLARE":s("Deno/")?"DENO":s("Node.js/")?"NODE":i.Bun&&"string"==typeof Bun.version?"BUN":i.Deno&&"object"==typeof Deno.version?"DENO":"process"===a(i.process)?"NODE":i.window&&i.document?"BROWSER":"REST"})),Ce=v(((e,t)=>{var i=$e();t.exports="NODE"===i})),Ae=v(((e,t)=>{var i=he();t.exports=function(e,t,r,a){return a&&a.enumerable?e[t]=r:i(e,t,r),e}})),Pe=v(((e,t)=>{var i=k(),r=q();t.exports=function(e,t,a){try{return i(r(Object.getOwnPropertyDescriptor(e,t)[a]))}catch{}}})),Le=v(((e,t)=>{var i=D();t.exports=function(e){return i(e)||null===e}})),Me=v(((e,t)=>{var i=Le(),r=String,a=TypeError;t.exports=function(e){if(i(e))return e;throw new a("Can't set "+r(e)+" as a prototype")}})),Ie=v(((e,t)=>{var i=Pe(),r=D(),a=I(),s=Me();t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=i(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,n){return a(i),s(n),r(i)&&(t?e(i,n):i.__proto__=n),i}}():void 0)})),Re=v(((e,t)=>{var i={};i[te()("toStringTag")]="z",t.exports="[object z]"===String(i)})),De=v(((e,t)=>{var i=Re(),r=x(),a=T(),s=te()("toStringTag"),n=Object,o="Arguments"===a(function(){return arguments}());t.exports=i?a:function(e){var t,i,l;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch{}}(t=n(e),s))?i:o?a(t):"Object"===(l=a(t))&&r(t.callee)?"Arguments":l}})),Oe=v(((e,t)=>{var i=Re(),r=De();t.exports=i?{}.toString:function(){return"[object "+r(this)+"]"}})),Be=v(((e,t)=>{var i=Re(),r=ce().f,a=he(),s=J(),n=Oe(),o=te()("toStringTag");t.exports=function(e,t,l,u){var d=l?e:e&&e.prototype;d&&(s(d,o)||r(d,o,{configurable:!0,value:t}),u&&!i&&a(d,"toString",n))}})),Ne=v(((e,t)=>{var i=ce();t.exports=function(e,t,r){return i.f(e,t,r)}})),Ve=v(((e,t)=>{var i=B(),r=Ne(),a=te(),s=$(),n=a("species");t.exports=function(e){var t=i(e);s&&t&&!t[n]&&r(t,n,{configurable:!0,get:function(){return this}})}})),Ue=v(((e,t)=>{var i=N(),r=TypeError;t.exports=function(e,t){if(i(t,e))return e;throw new r("Incorrect invocation")}})),Fe=v(((e,t)=>{var i=k(),r=x(),a=Y(),s=i(Function.toString);r(a.inspectSource)||(a.inspectSource=function(e){return s(e)}),t.exports=a.inspectSource})),je=v(((e,t)=>{var i=k(),r=y(),a=x(),s=De(),n=B(),o=Fe(),l=function(){},u=n("Reflect","construct"),d=/^\s*(?:class|function)\b/,c=i(d.exec),h=!d.test(l),p=function(e){if(!a(e))return!1;try{return u(l,[],e),!0}catch{return!1}},f=function(e){if(!a(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!c(d,o(e))}catch{return!0}};f.sham=!0,t.exports=!u||r((function(){var e;return p(p.call)||!p(Object)||!p((function(){e=!0}))||e}))?f:p})),ze=v(((e,t)=>{var i=je(),r=W(),a=TypeError;t.exports=function(e){if(i(e))return e;throw new a(r(e)+" is not a constructor")}})),We=v(((e,t)=>{var i=de(),r=ze(),a=M(),s=te()("species");t.exports=function(e,t){var n,o=i(e).constructor;return void 0===o||a(n=i(o)[s])?t:r(n)}})),qe=v(((e,t)=>{var i=B();t.exports=i("document","documentElement")})),He=v(((e,t)=>{var i=k();t.exports=i([].slice)})),Ke=v(((e,t)=>{var i=TypeError;t.exports=function(e,t){if(e<t)throw new i("Not enough arguments");return e}})),Qe=v(((e,t)=>{var i=V();t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(i)})),Ge=v(((e,t)=>{var i,r,a,s,n=_(),o=S(),l=le(),u=x(),d=J(),c=y(),h=qe(),p=He(),f=ae(),m=Ke(),g=Qe(),v=Ce(),b=n.setImmediate,w=n.clearImmediate,k=n.process,T=n.Dispatch,E=n.Function,$=n.MessageChannel,C=n.String,A=0,P={},L="onreadystatechange";c((function(){i=n.location}));var M=function(e){if(d(P,e)){var t=P[e];delete P[e],t()}},I=function(e){return function(){M(e)}},R=function(e){M(e.data)},D=function(e){n.postMessage(C(e),i.protocol+"//"+i.host)};(!b||!w)&&(b=function(e){m(arguments.length,1);var t=u(e)?e:E(e),i=p(arguments,1);return P[++A]=function(){o(t,void 0,i)},r(A),A},w=function(e){delete P[e]},v?r=function(e){k.nextTick(I(e))}:T&&T.now?r=function(e){T.now(I(e))}:$&&!g?(s=(a=new $).port2,a.port1.onmessage=R,r=l(s.postMessage,s)):n.addEventListener&&u(n.postMessage)&&!n.importScripts&&i&&"file:"!==i.protocol&&!c(D)?(r=D,n.addEventListener("message",R,!1)):r=L in f("script")?function(e){h.appendChild(f("script"))[L]=function(){h.removeChild(this),M(e)}}:function(e){setTimeout(I(e),0)}),t.exports={set:b,clear:w}})),Ye=v(((e,t)=>{var i=_(),r=$(),a=Object.getOwnPropertyDescriptor;t.exports=function(e){if(!r)return i[e];var t=a(i,e);return t&&t.value}})),Xe=v(((e,t)=>{var i=function(){this.head=null,this.tail=null};i.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},t.exports=i})),Ze=v(((e,t)=>{var i=V();t.exports=/ipad|iphone|ipod/i.test(i)&&typeof Pebble<"u"})),Je=v(((e,t)=>{var i=V();t.exports=/web0s(?!.*chrome)/i.test(i)})),et=v(((e,t)=>{var i,r,a,s,n,o,l,u=_(),d=Ye(),c=le(),h=Ge().set,p=Xe(),f=Qe(),m=Ze(),g=Je(),v=Ce(),b=u.MutationObserver||u.WebKitMutationObserver,y=u.document,w=u.process,S=u.Promise,k=d("queueMicrotask");k||(o=new p,l=function(){var e,t;for(v&&(e=w.domain)&&e.exit();t=o.get();)try{t()}catch(e){throw o.head&&i(),e}e&&e.enter()},f||v||g||!b||!y?!m&&S&&S.resolve?((s=S.resolve(void 0)).constructor=S,n=c(s.then,s),i=function(){n(l)}):v?i=function(){w.nextTick(l)}:(h=c(h,u),i=function(){h(l)}):(r=!0,a=y.createTextNode(""),new b(l).observe(a,{characterData:!0}),i=function(){a.data=r=!r}),k=function(e){o.head||i(),o.add(e)}),t.exports=k})),tt=v(((e,t)=>{t.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch{}}})),it=v(((e,t)=>{t.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}})),rt=v(((e,t)=>{var i=_(),r=x(),a=i.WeakMap;t.exports=r(a)&&/native code/.test(String(a))})),at=v(((e,t)=>{var i=X(),r=ee(),a=i("keys");t.exports=function(e){return a[e]||(a[e]=r(e))}})),st=v(((e,t)=>{t.exports={}})),nt=v(((e,t)=>{var i,r,a,s,n,o=rt(),l=_(),u=D(),d=he(),c=J(),h=Y(),p=at(),f=st(),m="Object already initialized",g=l.TypeError,v=l.WeakMap;o||h.state?((s=h.state||(h.state=new v)).get=s.get,s.has=s.has,s.set=s.set,i=function(e,t){if(s.has(e))throw new g(m);return t.facade=e,s.set(e,t),t},r=function(e){return s.get(e)||{}},a=function(e){return s.has(e)}):(f[n=p("state")]=!0,i=function(e,t){if(c(e,n))throw new g(m);return t.facade=e,d(e,n,t),t},r=function(e){return c(e,n)?e[n]:{}},a=function(e){return c(e,n)}),t.exports={set:i,get:r,has:a,enforce:function(e){return a(e)?r(e):i(e,{})},getterFor:function(e){return function(t){var i;if(!u(t)||(i=r(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return i}}}})),ot=v(((e,t)=>{var i=_();t.exports=i.Promise})),lt=v(((e,t)=>{var i=_(),r=ot(),a=x(),s=oe(),n=Fe(),o=te(),l=$e(),u=Q(),d=U(),c=r&&r.prototype,h=o("species"),p=!1,f=a(i.PromiseRejectionEvent),m=s("Promise",(function(){var e=n(r),t=e!==String(r);if(!t&&66===d||u&&(!c.catch||!c.finally))return!0;if(!d||d<51||!/native code/.test(e)){var i=new r((function(e){e(1)})),a=function(e){e((function(){}),(function(){}))};if((i.constructor={})[h]=a,!(p=i.then((function(){}))instanceof a))return!0}return!(t||"BROWSER"!==l&&"DENO"!==l||f)}));t.exports={CONSTRUCTOR:m,REJECTION_EVENT:f,SUBCLASSING:p}})),ut=v(((e,t)=>{var i=q(),r=TypeError,a=function(e){var t,a;this.promise=new e((function(e,i){if(void 0!==t||void 0!==a)throw new r("Bad Promise constructor");t=e,a=i})),this.resolve=i(t),this.reject=i(a)};t.exports.f=function(e){return new a(e)}})),dt=v((()=>{var e,t,i,r=pe(),a=Q(),s=Ce(),n=_(),o=C(),l=Ae(),u=Ie(),d=Be(),c=Ve(),h=q(),p=x(),f=D(),m=Ue(),g=We(),v=Ge().set,b=et(),y=tt(),w=it(),S=Xe(),k=nt(),T=ot(),E=lt(),$=ut(),A="Promise",P=E.CONSTRUCTOR,L=E.REJECTION_EVENT,M=E.SUBCLASSING,I=k.getterFor(A),R=k.set,O=T&&T.prototype,B=T,N=O,V=n.TypeError,U=n.document,F=n.process,j=$.f,z=j,W=!!(U&&U.createEvent&&n.dispatchEvent),H="unhandledrejection",K=function(e){var t;return!(!f(e)||!p(t=e.then))&&t},G=function(e,t){var i,r,a,s=t.value,n=1===t.state,l=n?e.ok:e.fail,u=e.resolve,d=e.reject,c=e.domain;try{l?(n||(2===t.rejection&&ee(t),t.rejection=1),!0===l?i=s:(c&&c.enter(),i=l(s),c&&(c.exit(),a=!0)),i===e.promise?d(new V("Promise-chain cycle")):(r=K(i))?o(r,i,u,d):u(i)):d(s)}catch(e){c&&!a&&c.exit(),d(e)}},Y=function(e,t){e.notified||(e.notified=!0,b((function(){for(var i,r=e.reactions;i=r.get();)G(i,e);e.notified=!1,t&&!e.rejection&&Z(e)})))},X=function(e,t,i){var r,a;W?((r=U.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),n.dispatchEvent(r)):r={promise:t,reason:i},!L&&(a=n["on"+e])?a(r):e===H&&y("Unhandled promise rejection",i)},Z=function(e){o(v,n,(function(){var t,i=e.facade,r=e.value;if(J(e)&&(t=w((function(){s?F.emit("unhandledRejection",r,i):X(H,i,r)})),e.rejection=s||J(e)?2:1,t.error))throw t.value}))},J=function(e){return 1!==e.rejection&&!e.parent},ee=function(e){o(v,n,(function(){var t=e.facade;s?F.emit("rejectionHandled",t):X("rejectionhandled",t,e.value)}))},te=function(e,t,i){return function(r){e(t,r,i)}},ie=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Y(e,!0))},re=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new V("Promise can't be resolved itself");var r=K(t);r?b((function(){var i={done:!1};try{o(r,t,te(re,i,e),te(ie,i,e))}catch(t){ie(i,t,e)}})):(e.value=t,e.state=1,Y(e,!1))}catch(t){ie({done:!1},t,e)}}};if(P&&(N=(B=function(t){m(this,N),h(t),o(e,this);var i=I(this);try{t(te(re,i),te(ie,i))}catch(e){ie(i,e)}}).prototype,(e=function(e){R(this,{type:A,done:!1,notified:!1,parent:!1,reactions:new S,rejection:!1,state:0,value:void 0})}).prototype=l(N,"then",(function(e,t){var i=I(this),r=j(g(this,B));return i.parent=!0,r.ok=!p(e)||e,r.fail=p(t)&&t,r.domain=s?F.domain:void 0,0===i.state?i.reactions.add(r):b((function(){G(r,i)})),r.promise})),t=function(){var t=new e,i=I(t);this.promise=t,this.resolve=te(re,i),this.reject=te(ie,i)},$.f=j=function(e){return e===B||undefined===e?new t(e):z(e)},!a&&p(T)&&O!==Object.prototype)){i=O.then,M||l(O,"then",(function(e,t){var r=this;return new B((function(e,t){o(i,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete O.constructor}catch{}u&&u(O,N)}r({global:!0,constructor:!0,wrap:!0,forced:P},{Promise:B}),d(B,A,!1,!0),c(A)})),ct=v(((e,t)=>{t.exports={}})),ht=v(((e,t)=>{var i=te(),r=ct(),a=i("iterator"),s=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||s[a]===e)}})),pt=v(((e,t)=>{var i=De(),r=H(),a=M(),s=ct(),n=te()("iterator");t.exports=function(e){if(!a(e))return r(e,n)||r(e,"@@iterator")||s[i(e)]}})),ft=v(((e,t)=>{var i=C(),r=q(),a=de(),s=W(),n=pt(),o=TypeError;t.exports=function(e,t){var l=arguments.length<2?n(e):t;if(r(l))return a(i(l,e));throw new o(s(e)+" is not iterable")}})),mt=v(((e,t)=>{var i=C(),r=de(),a=H();t.exports=function(e,t,s){var n,o;r(e);try{if(!(n=a(e,"return"))){if("throw"===t)throw s;return s}n=i(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw s;if(o)throw n;return r(n),s}})),gt=v(((e,t)=>{var i=le(),r=C(),a=de(),s=W(),n=ht(),o=be(),l=N(),u=ft(),d=pt(),c=mt(),h=TypeError,p=function(e,t){this.stopped=e,this.result=t},f=p.prototype;t.exports=function(e,t,m){var g,v,b,_,y,w,S,k=m&&m.that,T=!(!m||!m.AS_ENTRIES),E=!(!m||!m.IS_RECORD),x=!(!m||!m.IS_ITERATOR),$=!(!m||!m.INTERRUPTED),C=i(t,k),A=function(e){return g&&c(g,"normal",e),new p(!0,e)},P=function(e){return T?(a(e),$?C(e[0],e[1],A):C(e[0],e[1])):$?C(e,A):C(e)};if(E)g=e.iterator;else if(x)g=e;else{if(!(v=d(e)))throw new h(s(e)+" is not iterable");if(n(v)){for(b=0,_=o(e);_>b;b++)if((y=P(e[b]))&&l(f,y))return y;return new p(!1)}g=u(e,v)}for(w=E?e.next:g.next;!(S=r(w,g)).done;){try{y=P(S.value)}catch(e){c(g,"throw",e)}if("object"==typeof y&&y&&l(f,y))return y}return new p(!1)}})),vt=v(((e,t)=>{var i,r,a=te()("iterator"),s=!1;try{i=0,(r={next:function(){return{done:!!i++}},return:function(){s=!0}})[a]=function(){return this},Array.from(r,(function(){throw 2}))}catch{}t.exports=function(e,t){try{if(!t&&!s)return!1}catch{return!1}var i=!1;try{var r={};r[a]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i}})),bt=v(((e,t)=>{var i=ot(),r=vt(),a=lt().CONSTRUCTOR;t.exports=a||!r((function(e){i.all(e).then(void 0,(function(){}))}))})),_t=v((()=>{var e=pe(),t=C(),i=q(),r=ut(),a=it(),s=gt();e({target:"Promise",stat:!0,forced:bt()},{all:function(e){var n=this,o=r.f(n),l=o.resolve,u=o.reject,d=a((function(){var r=i(n.resolve),a=[],o=0,d=1;s(e,(function(e){var i=o++,s=!1;d++,t(r,n,e).then((function(e){s||(s=!0,a[i]=e,--d||l(a))}),u)})),--d||l(a)}));return d.error&&u(d.value),o.promise}})})),yt=v((()=>{var e,t=pe(),i=Q(),r=lt().CONSTRUCTOR,a=ot(),s=B(),n=x(),o=Ae(),l=a&&a.prototype;t({target:"Promise",proto:!0,forced:r,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&n(a)&&(e=s("Promise").prototype.catch,l.catch!==e&&o(l,"catch",e,{unsafe:!0}))})),wt=v((()=>{var e=pe(),t=C(),i=q(),r=ut(),a=it(),s=gt();e({target:"Promise",stat:!0,forced:bt()},{race:function(e){var n=this,o=r.f(n),l=o.reject,u=a((function(){var r=i(n.resolve);s(e,(function(e){t(r,n,e).then(o.resolve,l)}))}));return u.error&&l(u.value),o.promise}})})),St=v((()=>{var e=pe(),t=ut();e({target:"Promise",stat:!0,forced:lt().CONSTRUCTOR},{reject:function(e){var i=t.f(this);return(0,i.reject)(e),i.promise}})})),kt=v(((e,t)=>{var i=de(),r=D(),a=ut();t.exports=function(e,t){if(i(e),r(t)&&t.constructor===e)return t;var s=a.f(e);return(0,s.resolve)(t),s.promise}})),Tt=v((()=>{var e=pe(),t=B(),i=Q(),r=ot(),a=lt().CONSTRUCTOR,s=kt(),n=t("Promise"),o=i&&!a;e({target:"Promise",stat:!0,forced:i||a},{resolve:function(e){return s(o&&this===n?r:this,e)}})})),Et=v((()=>{dt(),_t(),yt(),wt(),St(),Tt()})),xt=v((()=>{var e,t=pe(),i=Q(),r=ot(),a=y(),s=B(),n=x(),o=We(),l=kt(),u=Ae(),d=r&&r.prototype;t({target:"Promise",proto:!0,real:!0,forced:!!r&&a((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=o(this,s("Promise")),i=n(e);return this.then(i?function(i){return l(t,e()).then((function(){return i}))}:e,i?function(i){return l(t,e()).then((function(){throw i}))}:e)}}),!i&&n(r)&&(e=s("Promise").prototype.finally,d.finally!==e&&u(d,"finally",e,{unsafe:!0}))})),$t=v(((e,t)=>{xe(),Et(),xt();var i=Se();t.exports=i("Promise","finally")})),Ct=v(((e,t)=>{var i=$t();t.exports=i})),At=v(((e,t)=>{var i=Ct();t.exports=i})),Pt=v(((e,t)=>{var i=y();t.exports=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))})),Lt=v(((e,t)=>{var i=J(),r=x(),a=Z(),s=at(),n=Pt(),o=s("IE_PROTO"),l=Object,u=l.prototype;t.exports=n?l.getPrototypeOf:function(e){var t=a(e);if(i(t,o))return t[o];var s=t.constructor;return r(s)&&t instanceof s?s.prototype:t instanceof l?u:null}})),Mt=v(((e,t)=>{var i=k(),r=J(),a=R(),s=_e().indexOf,n=st(),o=i([].push);t.exports=function(e,t){var i,l=a(e),u=0,d=[];for(i in l)!r(n,i)&&r(l,i)&&o(d,i);for(;t.length>u;)r(l,i=t[u++])&&(~s(d,i)||o(d,i));return d}})),It=v(((e,t)=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]})),Rt=v(((e,t)=>{var i=Mt(),r=It();t.exports=Object.keys||function(e){return i(e,r)}})),Dt=v(((e,t)=>{var i=$(),r=y(),a=k(),s=Lt(),n=Rt(),o=R(),l=a(A().f),u=a([].push),d=i&&r((function(){var e=Object.create(null);return e[2]=2,!l(e,2)})),c=function(e){return function(t){for(var r,a=o(t),c=n(a),h=d&&null===s(a),p=c.length,f=0,m=[];p>f;)r=c[f++],(!i||(h?r in a:l(a,r)))&&u(m,e?[r,a[r]]:a[r]);return m}};t.exports={entries:c(!0),values:c(!1)}})),Ot=v((()=>{var e=pe(),t=Dt().entries;e({target:"Object",stat:!0},{entries:function(e){return t(e)}})})),Bt=v(((e,t)=>{Ot();var i=O();t.exports=i.Object.entries})),Nt=v(((e,t)=>{var i=Bt();t.exports=i})),Vt=v(((e,t)=>{var i=Nt();t.exports=i})),Ut=v(((e,t)=>{var i=$(),r=J(),a=Function.prototype,s=i&&Object.getOwnPropertyDescriptor,n=r(a,"name"),o=n&&"something"===function(){}.name,l=n&&(!i||i&&s(a,"name").configurable);t.exports={EXISTS:n,PROPER:o,CONFIGURABLE:l}})),Ft=v((e=>{var t=$(),i=ue(),r=ce(),a=de(),s=R(),n=Rt();e.f=t&&!i?Object.defineProperties:function(e,t){a(e);for(var i,o=s(t),l=n(t),u=l.length,d=0;u>d;)r.f(e,i=l[d++],o[i]);return e}})),jt=v(((e,t)=>{var i,r=de(),a=Ft(),s=It(),n=st(),o=qe(),l=ae(),u=at(),d="prototype",c="script",h=u("IE_PROTO"),p=function(){},f=function(e){return"<"+c+">"+e+"</"+c+">"},m=function(e){e.write(f("")),e.close();var t=e.parentWindow.Object;return e=null,t},g=function(){try{i=new ActiveXObject("htmlfile")}catch{}g=typeof document<"u"?document.domain&&i?m(i):function(){var e,t=l("iframe"),i="java"+c+":";return t.style.display="none",o.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(f("document.F=Object")),e.close(),e.F}():m(i);for(var e=s.length;e--;)delete g[d][s[e]];return g()};n[h]=!0,t.exports=Object.create||function(e,t){var i;return null!==e?(p[d]=r(e),i=new p,p[d]=null,i[h]=e):i=g(),void 0===t?i:a.f(i,t)}})),zt=v(((e,t)=>{var i,r,a,s=y(),n=x(),o=D(),l=jt(),u=Lt(),d=Ae(),c=te(),h=Q(),p=c("iterator"),f=!1;[].keys&&("next"in(a=[].keys())?(r=u(u(a)))!==Object.prototype&&(i=r):f=!0),!o(i)||s((function(){var e={};return i[p].call(e)!==e}))?i={}:h&&(i=l(i)),n(i[p])||d(i,p,(function(){return this})),t.exports={IteratorPrototype:i,BUGGY_SAFARI_ITERATORS:f}})),Wt=v(((e,t)=>{var i=zt().IteratorPrototype,r=jt(),a=P(),s=Be(),n=ct(),o=function(){return this};t.exports=function(e,t,l,u){var d=t+" Iterator";return e.prototype=r(i,{next:a(+!u,l)}),s(e,d,!1,!0),n[d]=o,e}})),qt=v(((e,t)=>{var i=pe(),r=C(),a=Q(),s=Ut(),n=x(),o=Wt(),l=Lt(),u=Ie(),d=Be(),c=he(),h=Ae(),p=te(),f=ct(),m=zt(),g=s.PROPER,v=s.CONFIGURABLE,b=m.IteratorPrototype,_=m.BUGGY_SAFARI_ITERATORS,y=p("iterator"),w="keys",S="values",k="entries",T=function(){return this};t.exports=function(e,t,s,p,m,E,x){o(s,t,p);var $,C,A,P=function(e){if(e===m&&D)return D;if(!_&&e&&e in I)return I[e];switch(e){case w:case S:case k:return function(){return new s(this,e)}}return function(){return new s(this)}},L=t+" Iterator",M=!1,I=e.prototype,R=I[y]||I["@@iterator"]||m&&I[m],D=!_&&R||P(m),O="Array"===t&&I.entries||R;if(O&&(($=l(O.call(new e)))!==Object.prototype&&$.next&&(!a&&l($)!==b&&(u?u($,b):n($[y])||h($,y,T)),d($,L,!0,!0),a&&(f[L]=T))),g&&m===S&&R&&R.name!==S&&(!a&&v?c(I,"name",S):(M=!0,D=function(){return r(R,this)})),m)if(C={values:P(S),keys:E?D:P(w),entries:P(k)},x)for(A in C)(_||M||!(A in I))&&h(I,A,C[A]);else i({target:t,proto:!0,forced:_||M},C);return(!a||x)&&I[y]!==D&&h(I,y,D,{name:m}),f[t]=D,C}})),Ht=v(((e,t)=>{t.exports=function(e,t){return{value:e,done:t}}})),Kt=v(((e,t)=>{var i=R(),r=ye(),a=ct(),s=nt(),n=ce().f,o=qt(),l=Ht(),u=Q(),d=$(),c="Array Iterator",h=s.set,p=s.getterFor(c);t.exports=o(Array,"Array",(function(e,t){h(this,{type:c,target:i(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=void 0,l(void 0,!0);switch(e.kind){case"keys":return l(i,!1);case"values":return l(t[i],!1)}return l([i,t[i]],!1)}),"values");var f=a.Arguments=a.Array;if(r("keys"),r("values"),r("entries"),!u&&d&&"values"!==f.name)try{n(f,"name",{value:"values"})}catch{}})),Qt=v(((e,t)=>{var i=$(),r=ce(),a=P();t.exports=function(e,t,s){i?r.f(e,t,a(0,s)):e[t]=s}})),Gt=v((()=>{var e=pe(),t=gt(),i=Qt();e({target:"Object",stat:!0},{fromEntries:function(e){var r={};return t(e,(function(e,t){i(r,e,t)}),{AS_ENTRIES:!0}),r}})})),Yt=v(((e,t)=>{Kt(),Gt();var i=O();t.exports=i.Object.fromEntries})),Xt=v(((e,t)=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}})),Zt=v((()=>{Kt();var e,t=Xt(),i=_(),r=Be(),a=ct();for(e in t)r(i[e],e),a[e]=a.Array})),Jt=v(((e,t)=>{var i=Yt();Zt(),t.exports=i})),ei=v(((e,t)=>{var i=Jt();t.exports=i})),ti=v(((e,t)=>{var i=De(),r=String;t.exports=function(e){if("Symbol"===i(e))throw new TypeError("Cannot convert a Symbol value to a string");return r(e)}})),ii=v(((e,t)=>{var i=me(),r=ti(),a=I(),s=RangeError;t.exports=function(e){var t=r(a(this)),n="",o=i(e);if(o<0||o===1/0)throw new s("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(n+=t);return n}})),ri=v(((e,t)=>{var i=k(),r=ve(),a=ti(),s=ii(),n=I(),o=i(s),l=i("".slice),u=Math.ceil,d=function(e){return function(t,i,s){var d,c,h=a(n(t)),p=r(i),f=h.length,m=void 0===s?" ":a(s);return p<=f||""===m?h:((c=o(m,u((d=p-f)/m.length))).length>d&&(c=l(c,0,d)),e?h+c:c+h)}};t.exports={start:d(!1),end:d(!0)}})),ai=v(((e,t)=>{var i=V();t.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(i)})),si=v((()=>{var e=pe(),t=ri().start;e({target:"String",proto:!0,forced:ai()},{padStart:function(e){return t(this,e,arguments.length>1?arguments[1]:void 0)}})})),ni=v(((e,t)=>{si();var i=Se();t.exports=i("String","padStart")})),oi=v(((e,t)=>{var i=ni();t.exports=i})),li=v(((e,t)=>{var i=oi();t.exports=i})),ui=b(Ee(),1),di=((s=di||{}).PROD="prod",s.VK_ALIAS="vk_alias",s.VIDEOTEST="videotest",s.TEST="test",s.OKCDN="okcdn",s.AUTO="auto",s),ci=((a=ci||{}).Q144P="mobile",a.Q240P="lowest",a.Q360P="low",a.Q480P="medium",a.Q720P="high",a.Q1080P="fullhd",a.Q1440P="quadhd",a.Q2160P="ultrahd",a.UNKNOWN="unknown",a),hi=((r=hi||{}).MP4="mp4",r.DASH="dash",r.DASH_SEP="dash_sep",r.ONDEMAND_DASH="ondemand_dash",r.HLS="hls",r.ONDEMAND_HLS="ondemand_hls",r.WEBM="webm",r.AV1="av1",r.ONDEMAND_DASH_LIVE="ondemand_dash_live",r.ONDEMAND_HLS_LIVE="ondemand_hls_live",r.WEBRTC="webrtc",r.UNKNOWN="unknown",r.RTMP="rtmp",r),pi=((n=pi||{}).HTTP1="http1",n.HTTP2="http2",n.HTTP3="http3",n),fi=((l=fi||{}).SLIDER="slider",l.DOUBLE_TAP="double_tap",l.TIME_CODE="time_code",l.EPISODE="episode",l.REWIND="rewind",l.LIVE="live",l.UNKNOWN="unknown",l),mi=((o=mi||{}).GRAPH_SHOW="iGraphShow",o.GRAPH_HIDE="iGraphHide",o.NEXT_AREA="iNextChapterArea",o.NEXT_BUTTON="iNextChapterBtn",o.WATCH_AGAIN="iWatchAgainBtn",o),gi={action_play:"ap",action_play_interactive:"api",first_bytes:"fb",player_ready:"pr",first_frame:"ff",seek:"sk",watch_coverage_record:"wr",watch_coverage_live:"wl",empty_buffer:"eb",action_stop:"as",close_at_empty_buffer:"cb",content_error:"er",player_interface_click:"pc",next_movie:"nm",track_switch:"ts",failover:"fo",quality:"qt"},vi={vsid:"si",isid:"is",vid:"vi",place:"pl",quality:"qt",cdn_host:"ch",stat_type:"st",param:"pm",vk_app_id:"va",track_code:"tc",connection_type:"cnt",connection_reused:"cr",cached_data:"cd",live:"lv",muted:"mu",mode:"mo",subtitles:"sb",failover:"fo",download_speed:"ds",manual_quality:"mq",ref_domain:"rd",direct_url:"du"},bi={unknown:"un",mobile:"m",lowest:"ls",low:"l",medium:"md",high:"h",fullhd:"f",quadhd:"q",ultrahd:"u"},_i={pip:"pi",fullscreen:"fs",external:"ex",prefetch:"pr",airplay:"ap",chromecast:"cc",invisible:"iv"},yi="1.0.80",wi={prod:"https://api.ok.ru",vk_alias:"https://api.mycdn.me",videotest:"https://videotestapi.ok.ru/api",test:"https://apitest.ok.ru",okcdn:"https://api.okcdn.ru",auto:""},Si={apiEnv:"vk_alias",apiKey:"CIOPGQJGDIHBABABA",requestRetryCount:1,firstFlushTime:5e3,flushDebounceTime:1e4,flushMaxWait:6e4,storageExpiration:1296e5,watchCoverageInterval:15e3,disabledOperations:["quality"],disabledCustomFields:[],shorten:!0,maxLoops:100,embedUrlParams:[],useBeacon:!0,synchronizeTime:!0,debugLog:!1,clearStorageAtUnload:!0,useVKComIsMobileLogic:!1,backoff:{start:1e3,factor:1.5,max:3e5,random:.1}};var ki=b(At(),1),Ti=b(Vt(),1),Ei=b(ei(),1),xi=e=>{let{operation:t,custom:i}=e,r=(0,Ei.default)((0,Ti.default)(i).map((([e,t])=>{let i=t;return t&&("mode"===e?i=_i[t]??t:"quality"===e&&(i=bi[t]??t)),[vi[e]??e,i]})));return{...e,operation:gi[t]??t,custom:r}},$i=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,Ci=class{async authorize(e){return this.authToken=e??await this.refreshAuthToken(),this._authorizeWithBackoff()}logBeacon(e){let t=this.createLogParams(e),i=this.sessionKey;i&&(this.params.apiTransport.sendBeacon("log.externalLog",t,i)||this.logRequest(e).catch((()=>{})))}async logRequest(e){let t="log.externalLog",i=this.createLogParams(e),r=this.sessionKey??await this._authorizeWithBackoff();if(!r)return;let a=async(e,s=this.params.config.requestRetryCount)=>{try{return await this.params.apiTransport.sendRequest(t,i,r)}catch(i){if(!i||!("error_code"in i))return void this.params.error$.next({id:"logRequestUnknown",category:u.ErrorCategory.NETWORK,message:`Unknown ${t} error`,thrown:i});let r=i?.error_code;switch(r){case 102:case 103:case 104:return this.authorized$.next(!1),this.sessionKey=await this._authorizeWithBackoff(),s>0?a(e,s-1):void 0;case 401:return this.authorized$.next(!1),this.authToken=await this.refreshAuthToken(),this.sessionKey=await this._authorizeWithBackoff(),s>0?a(e,s-1):void 0;default:return void this.params.error$.next({id:`LogRequest#${r}`,category:u.ErrorCategory.EXTERNAL_API,message:`${t} error`,data:i})}}};return a(e)}destroy(){window.clearTimeout(this.backoffTimeoutId),this.backoffTimeoutId=0}async refreshAuthToken(){if(this.params.refreshAuthToken)return this.refreshAuthTokenPromise||(this.refreshAuthTokenPromise=(0,ki.default)(this.params.refreshAuthToken(),(()=>{this.refreshAuthTokenPromise=void 0}))),this.refreshAuthTokenPromise}createLogParams(e){let t="WEB",i=!1,r=`@vkontakte/videoplayer-statistics:${yi}`;if(this.params.config.useVKComIsMobileLogic){let{appVersion:e}=window.navigator;i=$i.test(e)}else this.params.mobile&&(i=!0);return i&&(t="M_WEB"),this.params.vktvVersion&&(t="SMART_TV",r=this.params.vktvVersion),{collector:"ok.mobile.apps.video",data:JSON.stringify({application:r,platform:t,items:this.params.config.shorten?e.map(xi):e})}}_authorizeWithBackoff(){if(!this.consequentAuthErrors)return this._authorize();let e=(0,u.getExponentialDelay)(this.consequentAuthErrors,this.params.config.backoff);return new Promise((t=>{this.backoffTimeoutId||(this.backoffTimeoutId=window.setTimeout((()=>{(0,ki.default)(this._authorize().then(t).catch((e=>this.params.error$.next({id:"AuthorizeBackoff",category:u.ErrorCategory.NETWORK,message:"Otherwise unhandled error in authorization",thrown:e}))),(()=>this.backoffTimeoutId=0))}),e))}))}async _authorize(){if(this.authorizePromise)return this.authorizePromise;this.sessionKey=void 0,this.authorized$.next(!1);let e={session_data:{version:2,device_id:this.params.deviceId,client_version:yi.split("-")[0],client_type:"SDK_JS"}};return void 0!==this.authToken&&(e.session_data.auth_token=this.authToken,e.session_data.version=3),this.authorizePromise=(0,ki.default)(this.params.apiTransport.sendRequest("auth.anonymLogin",e).then((e=>((!e||!e.session_key)&&this.params.error$.next({id:"AuthorizeFailed",category:u.ErrorCategory.EXTERNAL_API,message:"No session key",data:e}),this.sessionKey=e?.session_key??void 0,this.sessionKey))).catch((async e=>{this.sessionKey=void 0;let t=e?.error_code;if(401===t)return this.authToken=await this.refreshAuthToken(),this._authorizeWithBackoff();t?this.params.error$.next({id:`Authorize#${t}`,category:u.ErrorCategory.EXTERNAL_API,message:"authorize error",data:e}):this.params.error$.next({id:"AuthorizeUnknown",category:u.ErrorCategory.NETWORK,message:"authorize error",thrown:e})})),(()=>{this.authorizePromise=void 0,this.consequentAuthErrors=this.sessionKey?0:this.consequentAuthErrors+1,this.authorized$.next(void 0!==this.sessionKey)})),this.authorizePromise}constructor(e){this.consequentAuthErrors=0,this.authorized$=new u.ValueSubject(!1),this.params=e}},Ai=class{addEventListener(e,t,i){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:i})}removeEventListener(e,t){if(!(e in this.listeners))return;let i=this.listeners[e];for(let e=0,r=i.length;e<r;e++)if(i[e].callback===t)return void i.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return;let t=this.listeners[e.type].slice();for(let i=0,r=t.length;i<r;i++){let r=t[i];try{r.callback.call(this,e)}catch(e){Promise.resolve().then((()=>{throw e}))}r.options&&r.options.once&&this.removeEventListener(e.type,r.callback)}return!e.defaultPrevented}constructor(){Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}},Pi=class extends Ai{toString(){return"[object AbortSignal]"}dispatchEvent(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),super.dispatchEvent(e)}constructor(){super(),this.listeners||Ai.call(this),Object.defineProperty(this,"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(this,"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(this,"reason",{value:void 0,writable:!0,configurable:!0})}},Li=class{abort(e){let t;try{t=new Event("abort")}catch{typeof document<"u"?document.createEvent?(t=document.createEvent("Event"),t.initEvent("abort",!1,!1)):(t=document.createEventObject(),t.type="abort"):t={type:"abort",bubbles:!1,cancelable:!1}}let i=e;if(void 0===i)if(typeof document>"u")i=new Error("This operation was aborted"),i.name="AbortError";else try{i=new DOMException("signal is aborted without reason")}catch{i=new Error("This operation was aborted"),i.name="AbortError"}this.signal.reason=i,this.signal.dispatchEvent(t)}toString(){return"[object AbortController]"}constructor(){Object.defineProperty(this,"signal",{value:new Pi,writable:!0,configurable:!0})}};function Mi(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}typeof Symbol<"u"&&Symbol.toStringTag&&(Li.prototype[Symbol.toStringTag]="AbortController",Pi.prototype[Symbol.toStringTag]="AbortSignal");var Ii="fetch"in window&&Mi({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}),Ri=Ii?function(e){"function"==typeof e&&(e={fetch:e});let{fetch:t,Request:i=t.Request,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a=!1}=e;if(!Mi({fetch:t,Request:i,AbortController:r,__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL:a}))return{fetch:t,Request:s};let s=i;(s&&!s.prototype.hasOwnProperty("signal")||a)&&(s=function(e,t){let r;t&&t.signal&&(r=t.signal,delete t.signal);let a=new i(e,t);return r&&Object.defineProperty(a,"signal",{writable:!1,enumerable:!1,configurable:!0,value:r}),a},s.prototype=i.prototype);let n=t;return{fetch:(e,t)=>{let i=s&&s.prototype.isPrototypeOf(e)?e.signal:t?t.signal:void 0;if(i){let r;try{r=new DOMException("Aborted","AbortError")}catch{r=new Error("Aborted"),r.name="AbortError"}if(i.aborted)return Promise.reject(r);let a=new Promise(((e,t)=>{i.addEventListener("abort",(()=>t(r)),{once:!0})}));return t&&t.signal&&delete t.signal,Promise.race([a,n(e,t)])}return n(e,t)},Request:s}}({fetch:window.fetch,Request:window.Request,AbortController:window.AbortController}):void 0,Di=Ii?Ri.fetch:window.fetch,Oi=(Ii?Ri.Request:window.Request,Ii||window.AbortController,Ii||window.AbortSignal,b(Ee(),1)),Bi=b(Vt(),1),Ni=class{async resolveApiBaseUrl(){if("auto"!==this.apiEnv||this.isApiBaseUrlFetched)return this.apiBaseUrl;try{let e=atob("aHR0cHM6Ly9kbnMuZ29vZ2xlL3Jlc29sdmU/bmFtZT12aWRlby5fZW5kcG9pbnQub2sucnUmdHlwZT1UWFQ="),t=(await(await Di(e,{method:"GET",mode:"cors",cache:"no-cache"})).json())?.Answer[0]?.data;if(!t)throw new Error("Wrong DNS response");return t}catch(e){return this.params.error$.next({id:"OneStat:ApiTransport:resolveApiBaseUrl",category:u.ErrorCategory.NETWORK,message:"Unhandled resolve api base url error",thrown:e}),wi.vk_alias}finally{this.isApiBaseUrlFetched=!0}}sendBeacon(e,t,i){if(!window.Blob||!window.navigator.sendBeacon)return!1;let r=this._prepareQueryParams({method:e,queryParams:t,sessionKey:i}),a=new window.Blob([r.toString()],{type:"application/x-www-form-urlencoded"});try{return window.navigator.sendBeacon(`${this.apiBaseUrl}/fb.do`,a)}catch(i){this.params.error$.next({id:"OneStat:ApiTransport:sendBeacon",category:u.ErrorCategory.NETWORK,message:"Unhandled beacon error",thrown:i,data:{method:e,params:t}})}return!1}async sendRequest(e,t,i){let r=(0,u.now)(),a=a=>{a instanceof TypeError&&(0,Oi.default)(["Failed to fetch","NetworkError when attempting to fetch resource."],a.message)?this.params.error$.next({id:"Network",category:u.ErrorCategory.NETWORK,message:"Request failed",thrown:a}):this.params.error$.next({id:"OneStat:ApiTransport:sendRequest",category:u.ErrorCategory.NETWORK,message:"Unhandled request error",thrown:a,data:{method:e,params:t,sessionKey:i,time:(0,u.now)()-r}})};return this.apiBaseUrl=await this.resolveApiBaseUrl(),Di(`${this.apiBaseUrl}/fb.do`,{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:this._prepareQueryParams({method:e,queryParams:t,sessionKey:i})}).then((e=>{let t=0===Number(e.headers.get("content-length")),i=new Date(e.headers.get("date")??"").getTime(),s=(0,u.now)()-r;if(isFinite(i)&&this.timeSynchronisation?.addServerTime(i,s),!t)return e.json().then((e=>Object.prototype.hasOwnProperty.call(e,"error_msg")?Promise.reject(e):e),a)}),a)}_prepareQueryParams(e){let t=new URLSearchParams({format:"JSON",method:e.method,application_key:this.apiKey});return void 0!==e.sessionKey&&t.append("session_key",e.sessionKey),(0,Bi.default)(e.queryParams).forEach((([e,i])=>t.append(e,"string"==typeof i?i:JSON.stringify(i)))),t}constructor(e){this.params=e,this.apiKey=e.config.apiKey,this.apiEnv=e.config.apiEnv,this.apiBaseUrl=wi[this.apiEnv],this.timeSynchronisation=e.timeSynchronisation,this.isApiBaseUrlFetched=!1}},Vi=b(Ee(),1),Ui=b(Vt(),1),Fi="onestat_events",ji=e=>t=>t.timestamp+e>=(0,u.now)(),zi=class{safeFlush(){try{this.flush()}catch(e){this.error$.next({id:"LoggerError",category:u.ErrorCategory.WTF,message:e?String(e):"Unknown logger error",thrown:e})}}readFromStorage(){let e=u.safeStorage.get(Fi);try{return e?JSON.parse(e):{}}catch{}return{}}addToStorage(e){if(!this.userSalt)return void this.unsaltedStorage.push(e);let t=this.readFromStorage(),i=(t[this.userSalt]??[]).filter(ji(this.params.config.storageExpiration));u.safeStorage.set(Fi,JSON.stringify({...t,[this.userSalt]:[...i,e]}))}getFromStorage(){return this.userSalt?(this.readFromStorage()[this.userSalt]??[]).filter(ji(this.params.config.storageExpiration)):this.unsaltedStorage}markStorageSent(){if(!this.userSalt)return void(this.unsaltedStorage=[]);let e=this.readFromStorage();delete e[this.userSalt],u.safeStorage.set(Fi,JSON.stringify(e))}housekeepStorage(){let e=this.readFromStorage();for(let[t,i]of(0,Ui.default)(e)){let r=i.filter(ji(this.params.config.storageExpiration));r.length?e[t]=r:delete e[t],this.loggerDebugLog({message:`${i.length} retrieved from storage, ${r.length} of them actual`})}u.safeStorage.set(Fi,JSON.stringify(e))}log(e){this.addToStorage(e),!this.isPaused&&(this.isUrgent(e)?this.flush():this.lastVsid!==e.custom.vsid?this.firstFlush():this.debouncedFlush(),this.lastVsid=e.custom.vsid)}flush({wantBeacon:e,clearStorage:t}={wantBeacon:!1,clearStorage:!0}){let i=this.getFromStorage();0!==i.length&&(this.api.authorized$.getValue()?(e&&this.params.config.useBeacon?(this.loggerDebugLog({message:`Flushing ${i.length} events through beacon`}),this.api.logBeacon(i)):(this.loggerDebugLog({message:`Flushing ${i.length} events`}),this.api.logRequest(i)),t&&this.markStorageSent()):this.api.authorize(),this.firstFlush.cancel(),this.debouncedFlush.cancel())}pause(){this.isPaused=!0,this.debouncedFlush.cancel()}resume(){this.isPaused=!1,this.debouncedFlush()}destroy(){this.subscription.unsubscribe(),this.firstFlush.cancel(),this.debouncedFlush.cancel()}constructor(e){this.unsaltedStorage=[],this.isPaused=!1,this.isUrgent=e=>{let{operation:t}=e;return(0,Vi.default)(["action_play","watch_coverage_record","watch_coverage_live"],t)},this.params=e,this.api=e.api,this.error$=e.error$,this.userSalt=e.userSalt,this.loggerDebugLog=e.debugLogger.createComponentLog("stat logger"),this.firstFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.firstFlushTime,{maxWait:this.params.config.firstFlushTime});let t=u.safeStorage.isPersistent()?this.params.config.flushMaxWait:0;this.debouncedFlush=(0,u.debounceFn)((()=>this.safeFlush()),this.params.config.flushDebounceTime,{maxWait:t}),this.subscription=this.api.authorized$.subscribe((e=>{e&&this.debouncedFlush()})),this.housekeepStorage()}},Wi=e=>e&&{[d.HttpConnectionType.HTTP1]:"http1",[d.HttpConnectionType.HTTP2]:"http2",[d.HttpConnectionType.QUIC]:"http3"}[e],qi=e=>{if(void 0!==e)switch(e){case d.VideoFormat.MPEG:return"mp4";case d.VideoFormat.DASH:case d.VideoFormat.DASH_LIVE:case d.VideoFormat.DASH_STREAMS:return"dash";case d.VideoFormat.DASH_SEP:return"dash_sep";case d.VideoFormat.DASH_ONDEMAND:return"ondemand_dash";case d.VideoFormat.DASH_WEBM:case d.VideoFormat.DASH_LIVE_WEBM:return"webm";case d.VideoFormat.DASH_WEBM_AV1:return"av1";case d.VideoFormat.DASH_LIVE_CMAF:return"ondemand_dash_live";case d.VideoFormat.HLS:case d.VideoFormat.HLS_LIVE:return"hls";case d.VideoFormat.HLS_ONDEMAND:return"ondemand_hls";case d.VideoFormat.HLS_LIVE_CMAF:return"ondemand_hls_live";case d.VideoFormat.WEB_RTC_LIVE:return"webrtc";default:return(0,u.assertNever)(e)}},Hi=e=>{if(void 0!==e)switch(e){case d.Surface.NONE:case d.Surface.INLINE:return;case d.Surface.FULLSCREEN:return"fullscreen";case d.Surface.SECOND_SCREEN:return"chromecast";case d.Surface.PIP:return"pip";case d.Surface.INVISIBLE:return"invisible";default:return(0,u.assertNever)(e)}},Ki=e=>{switch(e){case"slow-2g":case"2g":return"poor";case"3g":return"good";case"4g":return"excellent"}},Qi=class{getOffset(){return this.offset??0}setOffset(e){this.offset=e}now(){return Date.now()+(this.offset??0)}date(e=new Date){return e.setTime(e.getTime()+(this.offset??0)),e}addServerTime(e,t){let i=e-Date.now()-t/2;Math.abs(i)<1e3?this.offset=0:void 0===this.offset?this.offset=Math.round(i):this.offset=Math.round(.2*i+.8*this.offset)}constructor(e){this.offset=void 0,this.offset=e}},Gi=b(li(),1),Yi="_one-stat_",Xi=`${Yi}uuid`,Zi=`${Yi}deviceId`,Ji=()=>{let e=new u.Subscription;return{subscription:e,subscribe:(t,i)=>{t&&e.add(t.subscribe(i))}}},er=class{updateContext(e){this.statContext={...this.statContext,...e}}attachTo(e){let t,i=new u.Subscription,r=(e,t)=>i.add(e.subscribe(t));r(e.events.willStart$,(()=>{let t=e.info.position$.getValue();this.logActionPlay({position:t}),this.statContext.projectId&&this.logActionPlayInteractive()})),r(e.events.looped$,(()=>{this.resetViewSession(),++this.loopCounter>this.config.maxLoops&&(this.disabled=!0),this.logActionPlay({position:e.info.position$.getValue()})})),r(e.events.seeked$,(()=>{this.logSeek({action:this.seekAction$.getValue(),time:e.info.position$.getValue()}),this.seekAction$.next("unknown")})),r(e.events.paused$,(()=>{this.logPause({position:e.info.position$.getValue()})})),r(e.events.willResume$,(()=>{this.logPlay()})),r(e.events.started$,(()=>{this.statContext.clip&&this.logWatchCoverageRecord({start:0,end:0})})),r(e.events.playing$,(()=>{this.logPlaying()})),r(((e,t)=>new u.Observable((i=>{let r,a=new u.Subscription,s=(0,u.merge)((0,u.fromEvent)(window,"beforeunload"),e.events.willDestruct$),n=new u.ValueSubject(void 0);a.add(e.info.isLive$.pipe((0,u.filterChanged)()).subscribe((t=>{r&&(r.unsubscribe(),n.next(void 0)),r=t?e.info.liveTime$.pipe((0,u.map)((e=>e&&e/1e3))).subscribe(n):e.info.position$.subscribe(n),a.add(r)})));let{playing$:o,paused$:l}=e.events,c=e.events.willSeek$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),h=e.events.seeked$.pipe((0,u.filter)((()=>e.info.playbackState$.getValue()===d.PlaybackState.PLAYING))),p=!1,f=new u.Subject;a.add(c.subscribe((()=>{p||f.next(),p=!0}))),a.add(h.subscribe((()=>p=!1)));let m,g=new u.Subject,v=new u.Subject,b=(0,u.merge)(o,h,g),_=(0,u.merge)(l,f,s,e.events.looped$,v),y=()=>{v.next(),g.next()};if(a.add(b.subscribe((()=>m=n.getValue()))),a.add(_.subscribe((()=>{let e=n.getValue();(0,u.isNullable)(m)||m===e||(0,u.isNullable)(e)||(i.next({from:m,to:e}),m=void 0)}))),t.forceInterval&&isFinite(t.forceInterval)){let e=0;a.add(b.subscribe((()=>e=window.setTimeout(y,t.forceInterval)))),a.add(_.subscribe((()=>window.clearTimeout(e))))}return a})))(e,{forceInterval:this.config.watchCoverageInterval}),(t=>{let i=e.info.isLive$.getValue(),r=e.info.atLiveEdge$.getValue(),a={start:parseFloat(t.from.toFixed(3)),end:parseFloat(t.to.toFixed(3))};if(r){let t=e.info.liveLatency$.getValue()??0,i=e.info.currentBuffer$.getValue()?.end??0,r=e.info.liveBufferTime$.getValue()??0,s=Math.round(1e3*(t-(i-r))),n=Math.round(1e3*t);s&&n&&(a.latency=s,a.bufferLatency=n)}i?this.logWatchCoverageLive(a):this.logWatchCoverageRecord(a)})),r(e.info.isStalled$,(e=>{e?t=(0,u.now)():((0,u.isNonNullable)(t)&&this.logEmptyBuffer({duration:(0,u.now)()-t}),t=void 0)}));let a=!1;i.add(e.events.fatalError$.pipe((0,u.once)()).subscribe((()=>a=!0))),r(e.events.willStop$,(()=>{if(e.info.isStalled$.getValue()){let e=(0,u.isNonNullable)(t)?(0,u.now)()-t:void 0;this.logCloseAtEmptyBuffer({duration:e??0}),t=void 0}else a||this.logActionStop()})),r(e.events.managedError$,(({id:e})=>{this.logError({fatal:!1,errorType:e})})),r(e.events.fatalError$,(({id:e})=>{this.logError({fatal:!0,errorType:e})}));let s,n,o,l,c,h=!1;return r(e.events.firstBytes$,(e=>{s=(0,u.now)(),this.logFirstBytes({time:e})})),r(e.events.willStart$,(()=>n=(0,u.now)())),r(e.info.currentBuffer$,(e=>{!h&&e&&e.end-e.start>0&&(0,u.isNonNullable)(s)&&(this.logPlayerReady({duration:(0,u.now)()-s}),h=!0)})),r(e.events.firstFrame$,(()=>{(0,u.isNonNullable)(s)&&!h&&(this.logPlayerReady({duration:(0,u.now)()-s}),h=!0),(0,u.isNonNullable)(n)&&this.logFirstFrame({time:(0,u.now)()-n})})),r(e.info.currentVideoStream$,(e=>{e&&(o&&e.id!==o&&this.logTrackSwitch(e),o=e.id)})),r(e.info.currentAudioStream$,(e=>{e&&(l&&e.id!==l&&this.logTrackSwitch(e),l=e.id)})),r(e.info.atLiveEdge$,(e=>this.updateContext({liveEdge:e}))),r((0,u.combine)({muted:e.info.muted$,volume:e.info.volume$}),(({muted:e,volume:t})=>this.updateContext({audible:!e&&t>0}))),r(e.info.currentQuality$,(e=>{let t=(i=e)&&{[d.VideoQuality.INVARIANT]:"unknown",[d.VideoQuality.Q_144P]:"mobile",[d.VideoQuality.Q_240P]:"lowest",[d.VideoQuality.Q_360P]:"low",[d.VideoQuality.Q_480P]:"medium",[d.VideoQuality.Q_576P]:"unknown",[d.VideoQuality.Q_720P]:"high",[d.VideoQuality.Q_1080P]:"fullhd",[d.VideoQuality.Q_1440P]:"quadhd",[d.VideoQuality.Q_2160P]:"ultrahd",[d.VideoQuality.Q_4320P]:"unknown"}[i];var i;this.updateContext({quality:t}),t&&this.logQuality(t)})),r(e.info.isAutoQualityEnabled$,(e=>this.updateContext({autoQuality:e}))),r(e.info.currentFormat$,(e=>this.updateContext({contentType:qi(e)}))),r(e.info.currentPlaybackRate$,(e=>this.updateContext({rate:e}))),r(e.info.is3DVideo$,(e=>this.updateContext({is3d:e}))),r(e.info.hostname$,(e=>{let t=void 0!==c&&c!==e;this.updateContext({cdnHostname:e,failover:t}),t&&this.logFailover(e),c=e})),r(e.info.throughputEstimation$,(e=>this.updateContext({downloadSpeed:e}))),r(e.info.httpConnectionType$,(e=>{this.statContext.firstConnectionType||this.updateContext({firstConnectionType:Wi(e)}),this.updateContext({connectionType:Wi(e)})})),r(e.info.httpConnectionReused$,(e=>{(0,u.isNullable)(this.statContext.firstConnectionReused)&&this.updateContext({firstConnectionReused:e}),this.updateContext({connectionReused:e})})),r(e.info.surface$,(e=>this.updateContext({mode:Hi(e)}))),r((0,u.combine)({current:e.info.currentTextTrack$,available:e.info.availableTextTracks$}),(({current:e,available:t})=>{let i=t.find((({id:t})=>t===e)),r=i&&(i.isAuto?`${i.language}_auto`:i.language);this.updateContext({subtitles:r?.split(".")[0]})})),this.player=e,this.uiEvents&&this.attachToUi(this.uiEvents),this.resubscribeBeforeunload(),this.subscription.add(i),i}attachToUi(e){this.uiEvents=e;let{subscription:t,subscribe:i}=Ji();return this.player&&(i(e.actionRewind$,(()=>{this.player&&(this.resetViewSession(),this.logActionPlay({position:this.player.info.position$.getValue()}))})),i(e.actionSeek$,this.seekAction$),i(e.inPiP$,(e=>{let t=e?"pip":Hi(this.player?.info.surface$.getValue());this.updateContext({mode:t})})),i(e.inFullscreen$,(e=>{let t=e?"fullscreen":Hi(this.player?.info.surface$.getValue());this.updateContext({mode:t})})),i(e.actionSetSubtitle$,(e=>this.updateContext({subtitles:e.split(".")[0]}))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t)),t}attachToAds(e){let{subscription:t,subscribe:i}=Ji();return i(e.slotRequested$,(()=>this.logAdSlotRequest())),i(e.started$,(e=>this.logAdStarted(e))),i(e.paused$,(()=>this.logAdPaused())),i(e.resumed$,(()=>this.logAdResumed())),i(e.ended$,(()=>this.logAdEnded())),i(e.skipped$,(()=>this.logAdSkipped())),i(e.clicked$,(()=>this.logAdClicked())),i(e.error$,(e=>this.logError({errorType:e,fatal:!1}))),this.resubscribeBeforeunload(),this.subscription.add(t),t}attachToInteractive(e){let{subscription:t,subscribe:i}=Ji();return i(e.click$,(e=>this.logInterfaceClick(e))),i(e.nextMovie$,(e=>this.logNextMovie(e))),this.resubscribeBeforeunload(),this.subscription.add(t),t}authorize(e){return this.api.authorize(e)}pause(){this.logger.pause(),this.oneStatDebugLog({message:"paused"})}resume(){this.logger.resume(),this.oneStatDebugLog({message:"resumed"})}destroy(){this.logger.flush(),this.subscription.unsubscribe(),this.api.destroy(),this.logger.destroy()}resetViewSession(){this.oneStatDebugLog({message:"VSID reset"}),this.vsid$.next((0,Gi.default)(Math.floor(Math.random()*2**32).toString(36),7,"0"))}getDeviceId(){return this.deviceId}setFieldBlacklist(){}logInited(){}logReady(e){this.log({operation:"player_ready",param:String(e.time)})}logStarted(...e){this.logActionPlay(...e)}logPlay(){this.log({operation:"play_toggle"})}logPlaying(){this.log({operation:"playing"})}logPause(e){this.log({operation:"pause",param:String(Math.round(e.position))})}logSeek(e){this.log({operation:"seek",param:e.action,time:e.time})}logFirstBytes(e){this.log({operation:"first_bytes",param:String(e.time)})}logFirstFrame(e){this.log({operation:"first_frame",param:String(e.time)})}logError(e){this.log({operation:"content_error",param:`${e.fatal?"fatal":"recoverable"}_${e.errorType}`})}logWatchCoverageRecord(e){this.log({operation:"watch_coverage_record",param:`${e.start}-${e.end}`},{in_history:this.statContext.inHistory?1:void 0})}logWatchCoverageLive(e){let t=this.timeSynchronisation?.getOffset()??0,i=e.start+t,r=e.end+t;this.log({operation:"watch_coverage_live",param:`${i}-${r}`},{in_history:this.statContext.inHistory?1:void 0,latency:e.latency,buffer_latency:e.bufferLatency})}logEmptyBuffer(e){this.log({operation:"empty_buffer",param:String(e.duration)})}logDownloadSpeed(){}logAdSlotRequest(){this.log({operation:"adv",param:"slot_request"})}logAdStarted(e){this.log({operation:"adv",param:e})}logAdPaused(){this.log({operation:"adv",param:"pause"})}logAdResumed(){this.log({operation:"adv",param:"resume"})}logAdEnded(){this.log({operation:"adv",param:"ended"})}logAdSkipped(){this.log({operation:"adv",param:"skip"})}logAdClicked(){this.log({operation:"adv",param:"click"})}logInterfaceClick(e){this.log({operation:"player_interface_click",param:e})}logNextMovie(e){this.log({operation:"next_movie",param:String(e)})}subscribe(){this.resubscribeBeforeunload();let e=window.navigator.connection;e&&"onchange"in e&&"effectiveType"in e&&this.subscription.add((0,u.merge)((0,u.fromEvent)(e,"change"),(0,u.observableFrom)(["init"])).subscribe((()=>this.updateContext({network:Ki(e.effectiveType)})))),this.config.debugLog&&this.debugLogger.log$.subscribe((e=>{console.debug("%c stat ","background:#fa6470;",`component: ${e.component}.`,e.message)}))}resubscribeBeforeunload(){this.beforeunloadSubscription?.unsubscribe(),this.beforeunloadSubscription=(0,u.fromEvent)(window,"beforeunload").subscribe((()=>this.logger.flush({wantBeacon:!0,clearStorage:this.config.clearStorageAtUnload}))),this.subscription.add(this.beforeunloadSubscription)}logPlayerReady(e){this.log({operation:"player_ready",param:String(Math.round(e.duration))})}logActionPlay(e){this.log({operation:"action_play",param:String(Math.round(e.position))})}logActionPlayInteractive(){this.statContext.projectId&&this.log({operation:"action_play_interactive",param:String(this.statContext.movieId)},{vid:this.statContext.projectId})}logFailover(e){this.log({operation:"failover",param:e})}logCloseAtEmptyBuffer(e){this.log({operation:"close_at_empty_buffer",param:String(Math.round(e.duration))})}logActionStop(){this.log({operation:"action_stop"})}logTrackSwitch(e){this.log({operation:"track_switch",param:e.id})}logQuality(e){this.log({operation:"quality",param:e})}log(e,t={}){if(this.disabled)return void this.oneStatDebugLog({message:`operation ${e.operation} but statistics is disabled`});if((0,ui.default)(this.config.disabledOperations,e.operation))return void this.oneStatDebugLog({message:`operation ${e.operation} but it is disabled`});this.oneStatDebugLog({message:`operation ${e.operation} ${e.param}`});let i=this.createLogItem(e,t);this.logger.log(i)}createLogItem({operation:e,param:t,time:i},r={}){let a=this.timeSynchronisation?.now()??(0,u.now)(),s=this.vsid$.getValue();(0,u.assertNonNullable)(s);let n,o,l=this.isid$.getValue(),d="empty_buffer"===e||"close_at_empty_buffer"===e?this.statContext.connectionType:this.statContext.firstConnectionType,c=this.statContext.firstConnectionReused;if(this.isEmbed||"embed"===this.statContext.place){n=this.embedParent;let e=[...new URLSearchParams(location.search).entries()].filter((([e,t])=>(0,ui.default)(this.config.embedUrlParams,e)));o=new URLSearchParams(e).toString()}else"direct"===this.statContext.place&&(this.statContext.refDomain?n=(0,u.createURL)(this.statContext.refDomain)?.hostname??this.statContext.refDomain:document.referrer&&(n=(0,u.createURL)(document.referrer)?.hostname??document.referrer),o=location.href.substring(0,1024));let h={vsid:s,isid:l,vid:this.statContext.movieId,uid:this.zenUid$.getValue(),ct:this.statContext.contentType,place:this.isEmbed?"embed":this.statContext.place,quality:this.statContext.quality,cdn_host:this.statContext.cdnHostname,stat_type:!0===this.statContext.autoplay?"auto":!1===this.statContext.autoplay?"":void 0,param:t,vk_app_id:this.statContext.vkAppId,track_code:this.statContext.trackCode,connection_type:d,connection_reused:!0===c?1:!1===c?0:void 0,cached_data:!0===this.statContext.cached?1:!1===this.statContext.cached?0:void 0,live:this.statContext.liveEdge?1:void 0,muted:!1===this.statContext.audible?1:void 0,mode:this.statContext.mode,subtitles:this.statContext.subtitles,download_speed:this.statContext.downloadSpeed,manual_quality:this.statContext.autoQuality?void 0:1,ref_domain:n,direct_url:o,rate:1===this.statContext.rate||(0,u.isNullable)(this.statContext.rate)?void 0:this.statContext.rate.toFixed(2),view_360:this.statContext.is3d?1:void 0,aid:this.statContext.albumId,vk_playlist_id:this.statContext.vkPlaylistId,...r};for(let e of this.config.disabledCustomFields)delete h[e];return{operation:e,type:1,time:i,network:this.statContext.network,timestamp:a,custom:h}}constructor(e,t){var i;this.subscription=new u.Subscription,this.debugLogger=new u.Logger,this.oneStatDebugLog=this.debugLogger.createComponentLog("onestat"),this.loopCounter=0,this.disabled=!1,this.vsid$=new u.ValueSubject(void 0),this.isid$=new u.ValueSubject(void 0),this.zenUid$=new u.ValueSubject(void 0),this.seekAction$=new u.ValueSubject("unknown"),this.statContext=e,this.config=(i=t.config??{},(0,u.fillWithDefault)(i,Si)),(0,u.isNonNullable)(t.apiEnv)&&(this.config.apiEnv=t.apiEnv),this.config.synchronizeTime&&(this.timeSynchronisation=new Qi);let r=new u.Subject;this.experimental={error$:r},u.safeStorage.get(Xi)&&u.safeStorage.remove(Xi);let a=u.safeStorage.get(Zi);this.statContext.deviceId?this.deviceId=this.statContext.deviceId:a?this.deviceId=a:(this.deviceId=function(){let e,t,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),r=new Array(36),a=0;for(t=0;t<36;t++)8===t||13===t||18===t||23===t?r[t]="-":14===t?r[t]="4":(a<=2&&(a=33554432+16777216*Math.random()|0),e=15&a,a>>=4,r[t]=i[19===t?3&e|8:e]);return r.join("")}(),u.safeStorage.set(Zi,this.deviceId)),this.resetViewSession(),t.useIsid&&this.isid$.next(t.isid??(0,Gi.default)(Math.floor(Math.random()*2**64).toString(36),13,"0")),this.zenUid$.next(t.zenUid);let s=new Ni({config:this.config,error$:r,timeSynchronisation:this.timeSynchronisation});this.api=new Ci({config:this.config,apiTransport:s,refreshAuthToken:t.refreshAuthToken,mobile:this.statContext.mobile??!1,deviceId:this.deviceId,error$:r,vktvVersion:t.vktvVersion}),this.logger=new zi({config:this.config,debugLogger:this.debugLogger,api:this.api,error$:r,userSalt:t.userSalt});let{isEmbed:n,topOrigin:o}=(0,u.detectEmbed)();this.isEmbed=n,this.embedParent=o?new URL(o).hostname:void 0,this.subscribe()}}},425426:(e,t,i)=>{i.d(t,{VideoFormat:()=>f.VideoFormat});var r,a,s,n,o,l,u,d,c,h=i(434518),p=i(763812),f=i(99758),m=i(319340),g=i(424814),v="[!",b={},_=Symbol(),y=Symbol("filename"),w=(Symbol("hmr"),globalThis.process?.env?.NODE_ENV),S=w&&!w.toLowerCase().startsWith("prod"),k=Symbol("$state"),T=Symbol("$state metadata"),E=Symbol("legacy props"),x=Symbol(""),$=Array.isArray,C=Array.prototype.indexOf,A=Array.from,P=Object.keys,L=Object.defineProperty,M=Object.getOwnPropertyDescriptor,I=Object.getOwnPropertyDescriptors,R=Object.prototype,D=Array.prototype,O=Object.getPrototypeOf;function B(e){return"function"==typeof e}var N=()=>{};function V(e){return e()}function U(e){for(var t=0;t<e.length;t++)e[t]()}var F=[],j=[];function z(){var e=F;F=[],U(e)}function W(e){0===F.length&&queueMicrotask(z),F.push(e)}function q(){var e;F.length>0&&z(),j.length>0&&(e=j,j=[],U(e))}function H(e){return e===this.v}function K(e,t){return e!=e?t==t:e!==t||null!==e&&"object"==typeof e||"function"==typeof e}function Q(e,t){return e!==t}function G(e){return!K(e,this.v)}var Y=!1;var X=new Set,Z=new Map;function J(e){X=e}function ee(e,t){var i={f:0,v:e,reactions:null,equals:H,rv:0,wv:0};return i}function te(e){return function(e){return null!==Ge&&!Ye&&!!(2&Ge.f)&&(null===et?function(e){et=e}([e]):et.push(e)),e}(ee(e))}function ie(e,t=!1){var i;let r=ee(e);return t||(r.equals=G),Y&&null!==ni&&null!==ni.l&&((i=ni.l).s??(i.s=[])).push(r),r}function re(e,t){return null!==Ge&&!Ye&&mi()&&!!(18&Ge.f)&&(null===et||!et.includes(e))&&function(){if(S){let e=new Error("state_unsafe_mutation\nUpdating state inside a derived or a template expression is forbidden. If the value should not be reactive, declare it without `$state`\nhttps://svelte.dev/e/state_unsafe_mutation");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_unsafe_mutation")}(),ae(e,t)}function ae(e,t){if(!e.equals(t)){var i=e.v;if(qe?Z.set(e,t):Z.set(e,i),e.v=t,e.wv=lt(),se(e,2048),mi()&&null!==Ze&&!!(1024&Ze.f)&&!(96&Ze.f)&&(null===rt?function(e){rt=e}([e]):rt.push(e)),S&&X.size>0){let e=Array.from(X);for(let t of e)!!(1024&t.f)&&At(t,4096),ut(t)&&vt(t);X.clear()}}return t}function se(e,t){var i=e.reactions;if(null!==i)for(var r=mi(),a=i.length,s=0;s<a;s++){var n=i[s],o=n.f;if(!(2048&o)&&(r||n!==Ze)){if(S&&262144&o){X.add(n);continue}At(n,t),1280&o&&(2&o?se(n,4096):St(n))}}}function ne(e){var t=2050,i=null!==Ge&&2&Ge.f?Ge:null;null===Ze||null!==i&&256&i.f?t|=256:Ze.f|=1048576;let r={ctx:ni,deps:null,effects:null,equals:H,f:t,fn:e,reactions:null,rv:0,v:null,wv:0,parent:i??Ze};return r}function oe(e){let t=ne(e);return t.equals=G,t}function le(e){var t=e.effects;if(null!==t){e.effects=null;for(var i=0;i<t.length;i+=1)jt(t[i])}}var ue=[];function de(e){var t,i=Ze;if(Je(function(e){for(var t=e.parent;null!==t;){if(!(2&t.f))return t;t=t.parent}return null}(e)),S){let r=X;J(new Set);try{ue.includes(e)&&function(){if(S){let e=new Error("derived_references_self\nA derived value cannot reference itself recursively\nhttps://svelte.dev/e/derived_references_self");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/derived_references_self")}(),ue.push(e),le(e),t=ft(e)}finally{Je(i),J(r),ue.pop()}}else try{le(e),t=ft(e)}finally{Je(i)}return t}function ce(e){var t=de(e);At(e,(nt||256&e.f)&&null!==e.deps?4096:1024),e.equals(t)||(e.v=t,e.wv=lt())}var he="font-weight: bold",pe="font-weight: normal";function fe(e){S?console.warn(`%c[svelte] hydration_mismatch\n%c${e?`Hydration failed because the initial UI does not match what was rendered on the server. The error occurred near ${e}`:"Hydration failed because the initial UI does not match what was rendered on the server"}\nhttps://svelte.dev/e/hydration_mismatch`,he,pe):console.warn("https://svelte.dev/e/hydration_mismatch")}function me(e,t){S?console.warn(`%c[svelte] ownership_invalid_mutation\n%c${e?`${e} mutated a value owned by ${t}. This is strongly discouraged. Consider passing values to child components with \`bind:\`, or use a callback instead`:"Mutating a value outside the component that created it is strongly discouraged. Consider passing values to child components with `bind:`, or use a callback instead"}\nhttps://svelte.dev/e/ownership_invalid_mutation`,he,pe):console.warn("https://svelte.dev/e/ownership_invalid_mutation")}function ge(e){S?console.warn(`%c[svelte] state_proxy_equality_mismatch\n%cReactive \`$state(...)\` proxies and the values they proxy have different identities. Because of this, comparisons with \`${e}\` will produce unexpected results\nhttps://svelte.dev/e/state_proxy_equality_mismatch`,he,pe):console.warn("https://svelte.dev/e/state_proxy_equality_mismatch")}var ve,be,_e,ye,we,Se=!1;function ke(e){Se=e}function Te(e){if(null===e)throw fe(),b;return ve=e}function Ee(){return Te(De(ve))}function xe(e){if(Se){if(null!==De(ve))throw fe(),b;ve=e}}function $e(e=1){if(Se){for(var t=e,i=ve;t--;)i=De(i);ve=i}}function Ce(){for(var e=0,t=ve;;){if(8===t.nodeType){var i=t.data;if("]"===i){if(0===e)return t;e-=1}else("["===i||i===v)&&(e+=1)}var r=De(t);t.remove(),t=r}}function Ae(e,t=null,i){if("object"!=typeof e||null===e||k in e)return e;let r=O(e);if(r!==R&&r!==D)return e;var a,s=new Map,n=$(e),o=ee(0);if(n&&s.set("length",ee(e.length)),S)if(a={parent:t,owners:null},i){let e=i.v?.[T]?.owners;a.owners=e?new Set(e):null}else a.owners=null===t?null!==ni?new Set([ni.function]):null:new Set;return new Proxy(e,{defineProperty(e,t,i){(!("value"in i)||!1===i.configurable||!1===i.enumerable||!1===i.writable)&&function(){if(S){let e=new Error("state_descriptors_fixed\nProperty descriptors defined on `$state` objects must contain `value` and always be `enumerable`, `configurable` and `writable`.\nhttps://svelte.dev/e/state_descriptors_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_descriptors_fixed")}();var r=s.get(t);return void 0===r?(r=ee(i.value),s.set(t,r)):re(r,Ae(i.value,a)),!0},deleteProperty(e,t){var i=s.get(t);if(void 0===i)t in e&&s.set(t,ee(_));else{if(n&&"string"==typeof t){var r=s.get("length"),a=Number(t);Number.isInteger(a)&&a<r.v&&re(r,a)}re(i,_),Pe(o)}return!0},get(t,i,r){if(S&&i===T)return a;if(i===k)return e;var n=s.get(i),o=i in t;if(void 0===n&&(!o||M(t,i)?.writable)&&(n=ee(Ae(o?t[i]:_,a)),s.set(i,n)),void 0!==n){var l=xt(n);if(S){var u=l?.[T];u&&u?.parent!==a&&ei(a,u)}return l===_?void 0:l}return Reflect.get(t,i,r)},getOwnPropertyDescriptor(e,t){var i=Reflect.getOwnPropertyDescriptor(e,t);if(i&&"value"in i){var r=s.get(t);r&&(i.value=xt(r))}else if(void 0===i){var a=s.get(t),n=a?.v;if(void 0!==a&&n!==_)return{enumerable:!0,configurable:!0,value:n,writable:!0}}return i},has(e,t){if(S&&t===T||t===k)return!0;var i=s.get(t),r=void 0!==i&&i.v!==_||Reflect.has(e,t);if((void 0!==i||null!==Ze&&(!r||M(e,t)?.writable))&&(void 0===i&&(i=ee(r?Ae(e[t],a):_),s.set(t,i)),xt(i)===_))return!1;return r},set(e,t,i,r){var l=s.get(t),u=t in e;if(n&&"length"===t)for(var d=i;d<l.v;d+=1){var c=s.get(d+"");void 0!==c?re(c,_):d in e&&(c=ee(_),s.set(d+"",c))}if(void 0===l?(!u||M(e,t)?.writable)&&(re(l=ee(void 0),Ae(i,a)),s.set(t,l)):(u=l.v!==_,re(l,Ae(i,a))),S){var h=i?.[T];h&&h?.parent!==a&&ei(a,h),function(e){if(ai)return;let t=function(){let e=function(){let e=(new Error).stack;if(!e)return null;let t=[];for(let i of e.split("\n")){let e=Yt.exec(i)??Xt.exec(i);e&&t.push({file:e[1],line:+e[2],column:+e[3]})}return t}()?.slice(4);if(!e)return null;for(let t=0;t<e.length;t++){let i=e[t],r=Gt[i.file];if(r)for(let e of r){if(null==e.end)return null;if(e.start.line<i.line&&e.end.line>i.line)return e.component}else if(0===t)return null}return null}();if(t&&!ii(e,t)){let i=ri(e);i[y]!==t[y]?me(t[y],i[y]):me()}}(a)}var p=Reflect.getOwnPropertyDescriptor(e,t);if(p?.set&&p.set.call(r,i),!u){if(n&&"string"==typeof t){var f=s.get("length"),m=Number(t);Number.isInteger(m)&&m>=f.v&&re(f,m+1)}Pe(o)}return!0},ownKeys(e){xt(o);var t=Reflect.ownKeys(e).filter((e=>{var t=s.get(e);return void 0===t||t.v!==_}));for(var[i,r]of s)r.v!==_&&!(i in e)&&t.push(i);return t},setPrototypeOf(){!function(){if(S){let e=new Error("state_prototype_fixed\nCannot set prototype of `$state` object\nhttps://svelte.dev/e/state_prototype_fixed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_prototype_fixed")}()}})}function Pe(e,t=1){re(e,e.v+t)}function Le(e){return null!==e&&"object"==typeof e&&k in e?e[k]:e}function Me(){if(void 0===be){be=window,document,_e=/Firefox/.test(navigator.userAgent);var e=Element.prototype,t=Node.prototype;ye=M(t,"firstChild").get,we=M(t,"nextSibling").get,e.__click=void 0,e.__className=void 0,e.__attributes=null,e.__style=void 0,e.__e=void 0,Text.prototype.__t=void 0,S&&(e.__svelte_meta=null,function(){let e=Array.prototype,t=Array.__svelte_cleanup;t&&t();let{indexOf:i,lastIndexOf:r,includes:a}=e;e.indexOf=function(e,t){let r=i.call(this,e,t);if(-1===r)for(let i=t??0;i<this.length;i+=1)if(Le(this[i])===e){ge("array.indexOf(...)");break}return r},e.lastIndexOf=function(e,t){let i=r.call(this,e,t??this.length-1);if(-1===i)for(let i=0;i<=(t??this.length-1);i+=1)if(Le(this[i])===e){ge("array.lastIndexOf(...)");break}return i},e.includes=function(e,t){let i=a.call(this,e,t);if(!i)for(let t=0;t<this.length;t+=1)if(Le(this[t])===e){ge("array.includes(...)");break}return i},Array.__svelte_cleanup=()=>{e.indexOf=i,e.lastIndexOf=r,e.includes=a}}())}}function Ie(e=""){return document.createTextNode(e)}function Re(e){return ye.call(e)}function De(e){return we.call(e)}function Oe(e,t){if(!Se)return Re(e);var i=Re(ve);if(null===i)i=ve.appendChild(Ie());else if(t&&3!==i.nodeType){var r=Ie();return i?.before(r),Te(r),r}return Te(i),i}function Be(e,t){if(!Se){var i=Re(e);return 8===i.nodeType&&""===i.data?De(i):i}if(t&&3!==ve?.nodeType){var r=Ie();return ve?.before(r),Te(r),r}return ve}function Ne(e,t=1,i=!1){let r=Se?ve:e;for(var a;t--;)a=r,r=De(r);if(!Se)return r;var s=r?.nodeType;if(i&&3!==s){var n=Ie();return null===r?a?.after(n):r.before(n),Te(n),n}return Te(r),r}function Ve(e){e.textContent=""}var Ue=new WeakSet,Fe=!1,je=!1,ze=null,We=!1,qe=!1;function He(e){qe=e}var Ke=[],Qe=[],Ge=null,Ye=!1;function Xe(e){Ge=e}var Ze=null;function Je(e){Ze=e}var et=null;var tt=null,it=0,rt=null;var at=1,st=0,nt=!1,ot=null;function lt(){return++at}function ut(e){var t=e.f;if(2048&t)return!0;if(4096&t){var i=e.deps,r=!!(256&t);if(null!==i){var a,s,n=!!(512&t),o=r&&null!==Ze&&!nt,l=i.length;if(n||o){var u,d=e,c=d.parent;for(a=0;a<l;a++)s=i[a],(n||!s?.reactions?.includes(d))&&((u=s).reactions??(u.reactions=[])).push(d);n&&(d.f^=512),o&&null!==c&&!(256&c.f)&&(d.f^=256)}for(a=0;a<l;a++)if(ut(s=i[a])&&ce(s),s.wv>e.wv)return!0}(!r||null!==Ze&&!nt)&&At(e,1024)}return!1}function dt(e,t){for(var i=t;null!==i;){if(128&i.f)try{return void i.fn(e)}catch{i.f^=128}i=i.parent}throw Fe=!1,e}function ct(e){return!(16384&e.f||null!==e.parent&&128&e.parent.f)}function ht(e,t,i,r){if(Fe){if(null===i&&(Fe=!1),ct(t))throw e;return}if(null!==i&&(Fe=!0),!S||null===r||!(e instanceof Error)||Ue.has(e))return void dt(e,t);Ue.add(e);let a=[],s=t.fn?.name;s&&a.push(s);let n=r;for(;null!==n;){if(S){var o=n.function?.[y];if(o){let e=o.split("/").pop();a.push(e)}}n=n.p}let l=_e?"  ":"\t";L(e,"message",{value:e.message+`\n${a.map((e=>`\n${l}in ${e}`)).join("")}\n`}),L(e,"component_stack",{value:a});let u=e.stack;if(u){let t=u.split("\n"),i=[];for(let e=0;e<t.length;e++){let r=t[e];r.includes("svelte/src/internal")||i.push(r)}L(e,"stack",{value:i.join("\n")})}if(dt(e,t),ct(t))throw e}function pt(e,t,i=!0){var r=e.reactions;if(null!==r)for(var a=0;a<r.length;a++){var s=r[a];2&s.f?pt(s,t,!1):t===s&&(i?At(s,2048):!!(1024&s.f)&&At(s,4096),St(s))}}function ft(e){var t=tt,i=it,r=rt,a=Ge,s=nt,n=et,o=ni,l=Ye,u=e.f;tt=null,it=0,rt=null,nt=!!(256&u)&&(Ye||!We||null===Ge),Ge=96&u?null:e,et=null,oi(e.ctx),Ye=!1,st++;try{var d=(0,e.fn)(),c=e.deps;if(null!==tt){var h,p;if(gt(e,it),null!==c&&it>0)for(c.length=it+tt.length,p=0;p<tt.length;p++)c[it+p]=tt[p];else e.deps=c=tt;if(!nt)for(p=it;p<c.length;p++)((h=c[p]).reactions??(h.reactions=[])).push(e)}else null!==c&&it<c.length&&(gt(e,it),c.length=it);if(mi()&&null!==rt&&!Ye&&null!==c&&!(6146&e.f))for(p=0;p<rt.length;p++)pt(rt[p],e);return null!==a&&(st++,null!==rt&&(null===r?r=rt:r.push(...rt))),d}finally{tt=t,it=i,rt=r,Ge=a,nt=s,et=n,oi(o),Ye=l}}function mt(e,t){let i=t.reactions;if(null!==i){var r=C.call(i,e);if(-1!==r){var a=i.length-1;0===a?i=t.reactions=null:(i[r]=i[a],i.pop())}}null===i&&2&t.f&&(null===tt||!tt.includes(t))&&(At(t,4096),!(768&t.f)&&(t.f^=512),le(t),gt(t,0))}function gt(e,t){var i=e.deps;if(null!==i)for(var r=t;r<i.length;r++)mt(e,i[r])}function vt(e){var t=e.f;if(!(16384&t)){At(e,1024);var i=Ze,r=ni,a=We;if(Ze=e,We=!0,S){var s=li;ui(e.component_function)}try{16&t?function(e){for(var t=e.first;null!==t;){var i=t.next;!(32&t.f)&&jt(t),t=i}}(e):Ft(e),Ut(e);var n=ft(e);e.teardown="function"==typeof n?n:null,e.wv=at;e.deps;S&&Qe.push(e)}catch(t){ht(t,e,i,r||e.ctx)}finally{We=a,Ze=i,S&&ui(s)}}}function bt(){console.error("Last ten effects were: ",Qe.slice(-10).map((e=>e.fn))),Qe=[]}function _t(){try{!function(){if(S){let e=new Error("effect_update_depth_exceeded\nMaximum update depth exceeded. This can happen when a reactive block or effect repeatedly sets a new value. Svelte limits the number of nested updates to prevent infinite loops\nhttps://svelte.dev/e/effect_update_depth_exceeded");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}()}catch(e){if(S&&L(e,"stack",{value:""}),null===ze)throw S&&bt(),e;if(S)try{ht(e,ze,null,null)}catch(e){throw bt(),e}else ht(e,ze,null,null)}}function yt(){var e=We;try{var t=0;for(We=!0;Ke.length>0;){t++>1e3&&_t();var i=Ke,r=i.length;Ke=[];for(var a=0;a<r;a++){wt(kt(i[a]))}}}finally{je=!1,We=e,ze=null,S&&(Qe=[]),Z.clear()}}function wt(e){var t=e.length;if(0!==t)for(var i=0;i<t;i++){var r=e[i];if(!(24576&r.f))try{ut(r)&&(vt(r),null===r.deps&&null===r.first&&null===r.nodes_start&&(null===r.teardown?zt(r):r.fn=null))}catch(e){ht(e,r,null,r.ctx)}}}function St(e){je||(je=!0,queueMicrotask(yt));for(var t=ze=e;null!==t.parent;){var i=(t=t.parent).f;if(96&i){if(!(1024&i))return;t.f^=1024}}Ke.push(t)}function kt(e){for(var t=[],i=e;null!==i;){var r=i.f,a=!!(96&r);if(!(a&&!!(1024&r)||8192&r)){if(4&r)t.push(i);else if(a)i.f^=1024;else{var s=Ge;try{Ge=i,ut(i)&&vt(i)}catch(e){ht(e,i,null,i.ctx)}finally{Ge=s}}var n=i.first;if(null!==n){i=n;continue}}var o=i.parent;for(i=i.next;null===i&&null!==o;)i=o.next,o=o.parent}return t}function Tt(e){var t;for(e&&(je=!0,yt(),t=e()),q();Ke.length>0;)je=!0,yt(),q();return t}async function Et(){await Promise.resolve(),Tt()}function xt(e){var t=!!(2&e.f);if(null!==ot&&ot.add(e),null===Ge||Ye){if(t&&null===e.deps&&null===e.effects){var i=e,r=i.parent;null!==r&&!(256&r.f)&&(i.f^=256)}}else{null!==et&&et.includes(e)&&function(){if(S){let e=new Error("state_unsafe_local_read\nReading state that was created inside the same derived is forbidden. Consider using `untrack` to read locally created state\nhttps://svelte.dev/e/state_unsafe_local_read");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/state_unsafe_local_read")}();var a=Ge.deps;e.rv<st&&(e.rv=st,null===tt&&null!==a&&a[it]===e?it++:null===tt?tt=[e]:(!nt||!tt.includes(e))&&tt.push(e))}return t&&(ut(i=e)&&ce(i)),qe&&Z.has(e)?Z.get(e):e.v}function $t(e){var t=Ye;try{return Ye=!0,e()}finally{Ye=t}}var Ct=-7169;function At(e,t){e.f=e.f&Ct|t}function Pt(e,t=new Set){if(!("object"!=typeof e||null===e||e instanceof EventTarget||t.has(e))){t.add(e),e instanceof Date&&e.getTime();for(let i in e)try{Pt(e[i],t)}catch{}let i=O(e);if(i!==Object.prototype&&i!==Array.prototype&&i!==Map.prototype&&i!==Set.prototype&&i!==Date.prototype){let t=I(i);for(let i in t){let r=t[i].get;if(r)try{r.call(e)}catch{}}}}}function Lt(e){null===Ze&&null===Ge&&function(e){if(S){let t=new Error(`effect_orphan\n\`${e}\` can only be used inside an effect (e.g. during component initialisation)\nhttps://svelte.dev/e/effect_orphan`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_orphan")}(e),null!==Ge&&!!(256&Ge.f)&&null===Ze&&function(){if(S){let e=new Error("effect_in_unowned_derived\nEffect cannot be created inside a `$derived` value that was not itself created inside an effect\nhttps://svelte.dev/e/effect_in_unowned_derived");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}(),qe&&function(e){if(S){let t=new Error(`effect_in_teardown\n\`${e}\` cannot be used inside an effect cleanup function\nhttps://svelte.dev/e/effect_in_teardown`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/effect_in_teardown")}(e)}function Mt(e,t,i,r=!0){var a=Ze;if(S)for(;null!==a&&262144&a.f;)a=a.parent;var s,n={ctx:ni,deps:null,nodes_start:null,nodes_end:null,f:2048|e,first:null,fn:t,last:null,next:null,parent:a,prev:null,teardown:null,transitions:null,wv:0};if(S&&(n.component_function=li),i)try{vt(n),n.f|=32768}catch(e){throw jt(n),e}else null!==t&&St(n);!(i&&null===n.deps&&null===n.first&&null===n.nodes_start&&null===n.teardown&&!(1048704&n.f))&&r&&(null!==a&&function(e,t){var i=t.last;null===i?t.last=t.first=e:(i.next=e,e.prev=i,t.last=e)}(n,a),null!==Ge&&2&Ge.f)&&((s=Ge).effects??(s.effects=[])).push(n);return n}function It(e){let t=Mt(8,null,!1);return At(t,1024),t.teardown=e,t}function Rt(e){Lt("$effect");var t,i=null!==Ze&&!!(32&Ze.f)&&null!==ni&&!ni.m;if(S&&L(e,"name",{value:"$effect"}),!i)return Dt(e);((t=ni).e??(t.e=[])).push({fn:e,effect:Ze,reaction:Ge})}function Dt(e){return Mt(4,e,!1)}function Ot(e){return Mt(8,e,!0)}function Bt(e,t=[],i=ne){let r=t.map(i),a=()=>e(...r.map(xt));return S&&L(a,"name",{value:"{expression}"}),Nt(a)}function Nt(e,t=0){return Mt(24|t,e,!0)}function Vt(e,t=!0){return Mt(40,e,!0,t)}function Ut(e){var t=e.teardown;if(null!==t){let e=qe,i=Ge;He(!0),Xe(null);try{t.call(null)}finally{He(e),Xe(i)}}}function Ft(e,t=!1){var i=e.first;for(e.first=e.last=null;null!==i;){var r=i.next;64&i.f?i.parent=null:jt(i,t),i=r}}function jt(e,t=!0){var i=!1;if((t||524288&e.f)&&null!==e.nodes_start){for(var r=e.nodes_start,a=e.nodes_end;null!==r;){var s=r===a?null:De(r);r.remove(),r=s}i=!0}Ft(e,t&&!i),gt(e,0),At(e,16384);var n=e.transitions;if(null!==n)for(let e of n)e.stop();Ut(e);var o=e.parent;null!==o&&null!==o.first&&zt(e),S&&(e.component_function=null),e.next=e.prev=e.teardown=e.ctx=e.deps=e.fn=e.nodes_start=e.nodes_end=null}function zt(e){var t=e.parent,i=e.prev,r=e.next;null!==i&&(i.next=r),null!==r&&(r.prev=i),null!==t&&(t.first===e&&(t.first=r),t.last===e&&(t.last=i))}function Wt(e,t){var i=[];Ht(e,i,!0),qt(i,(()=>{jt(e),t&&t()}))}function qt(e,t){var i=e.length;if(i>0){var r=()=>--i||t();for(var a of e)a.out(r)}else t()}function Ht(e,t,i){if(!(8192&e.f)){if(e.f^=8192,null!==e.transitions)for(let r of e.transitions)(r.is_global||i)&&t.push(r);for(var r=e.first;null!==r;){var a=r.next;Ht(r,t,!!(!!(65536&r.f)||!!(32&r.f))&&i),r=a}}}function Kt(e){Qt(e,!0)}function Qt(e,t){if(8192&e.f){e.f^=8192,!(1024&e.f)&&(e.f^=1024),ut(e)&&(At(e,2048),St(e));for(var i=e.first;null!==i;){var r=i.next;Qt(i,!!(!!(65536&i.f)||!!(32&i.f))&&t),i=r}if(null!==e.transitions)for(let i of e.transitions)(i.is_global||t)&&i.in()}}var Gt={},Yt=/at (?:.+ \()?(.+):(\d+):(\d+)\)?$/,Xt=/@(.+):(\d+):(\d+)$/;var Zt=Symbol("ADD_OWNER");function Jt(e,t,i=!1,r=!1){if(e&&!i){let i=li,a=e[T];if(a&&!ii(a,i)){let e=ri(a);t&&t[y]!==i[y]&&!r&&function(e,t,i){S?console.warn(`%c[svelte] ownership_invalid_binding\n%c${e} passed a value to ${t} with \`bind:\`, but the value is owned by ${i}. Consider creating a binding between ${i} and ${e}\nhttps://svelte.dev/e/ownership_invalid_binding`,he,pe):console.warn("https://svelte.dev/e/ownership_invalid_binding")}(i[y],t[y],e[y])}}ti(e,t,new Set)}function ei(e,t){if(null!==t.owners)for(;e;){if(null===e.owners){t.owners=null;break}for(let i of e.owners)t.owners.add(i);e=e.parent}}function ti(e,t,i){let r=e?.[T];if(r)"owners"in r&&null!=r.owners&&(t?r.owners.add(t):r.owners=null);else if(e&&"object"==typeof e){if(i.has(e))return;if(i.add(e),Zt in e&&e[Zt])Ot((()=>{e[Zt](t)}));else{var a=O(e);if(a===Object.prototype)for(let r in e)if(Object.getOwnPropertyDescriptor(e,r)?.get){let a=_;Ot((()=>{let s=e[r];a!==s&&(a=s,ti(s,t,i))}))}else ti(e[r],t,i);else if(a===Array.prototype)for(let r=0;r<e.length;r+=1)ti(e[r],t,i)}}}function ii(e,t){return null===e.owners||(e.owners.has(t)||y in t&&[...e.owners].some((e=>e[y]===t[y]))||null!==e.parent&&ii(e.parent,t))}function ri(e){return e?.owners?.values().next().value??ri(e.parent)}var ai=!1;function si(e){if(S){let t=new Error(`lifecycle_outside_component\n\`${e}(...)\` can only be used during component initialisation\nhttps://svelte.dev/e/lifecycle_outside_component`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/lifecycle_outside_component")}var ni=null;function oi(e){ni=e}var li=null;function ui(e){li=e}function di(e){return gi("getContext").get(e)}function ci(e,t){let i=gi("setContext");return S&&$t((()=>Jt(t,null,!0))),i.set(e,t),t}function hi(){return gi("getAllContexts")}function pi(e,t=!1,i){var r=ni={p:ni,c:null,d:!1,e:null,m:!1,s:e,x:null,l:null};Y&&!t&&(ni.l={s:null,u:null,r1:[],r2:ee(!1)}),It((()=>{r.d=!0})),S&&(ni.function=i,li=i)}function fi(e){let t=ni;if(null!==t){void 0!==e&&(t.x=e);let n=t.e;if(null!==n){var i=Ze,r=Ge;t.e=null;try{for(var a=0;a<n.length;a++){var s=n[a];Je(s.effect),Xe(s.reaction),Dt(s.fn)}}finally{Je(i),Xe(r)}}ni=t.p,S&&(li=t.p?.function??null),t.m=!0}return e||{}}function mi(){return!Y||null!==ni&&null===ni.l}function gi(e){var t;return null===ni&&si(e),(t=ni).c??(t.c=new Map(function(e){let t=e.p;for(;null!==t;){let e=t.c;if(null!==e)return e;t=t.p}return null}(ni)||void 0))}var vi=/\r/g;function bi(e){return e.endsWith("capture")&&"gotpointercapture"!==e&&"lostpointercapture"!==e}var _i=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function yi(e){return _i.includes(e)}var wi={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Si(e){return e=e.toLowerCase(),wi[e]??e}var ki=["touchstart","touchmove"];function Ti(e){return ki.includes(e)}var Ei=["textarea","script","style","title"];var xi=new Map;function $i(e,t){if(t){let t=document.body;e.autofocus=!0,W((()=>{document.activeElement===t&&e.focus()}))}}function Ci(e){var t=Ge,i=Ze;Xe(null),Je(null);try{return e()}finally{Xe(t),Je(i)}}var Ai=new Set,Pi=new Set;function Li(e){if(!Se)return;e.onload&&e.removeAttribute("onload"),e.onerror&&e.removeAttribute("onerror");let t=e.__e;void 0!==t&&(e.__e=void 0,queueMicrotask((()=>{e.isConnected&&e.dispatchEvent(t)})))}function Mi(e,t,i,r={}){function a(e){if(r.capture||Di.call(t,e),!e.cancelBubble)return Ci((()=>i?.call(this,e)))}return e.startsWith("pointer")||e.startsWith("touch")||"wheel"===e?W((()=>{t.addEventListener(e,a,r)})):t.addEventListener(e,a,r),a}function Ii(e,t,i,r,a){var s={capture:r,passive:a},n=Mi(e,t,i,s);(t===document.body||t===window||t===document)&&It((()=>{t.removeEventListener(e,n,s)}))}function Ri(e){for(var t=0;t<e.length;t++)Ai.add(e[t]);for(var i of Pi)i(e)}function Di(e){var t=this,i=t.ownerDocument,r=e.type,a=e.composedPath?.()||[],s=a[0]||e.target,n=0,o=e.__root;if(o){var l=a.indexOf(o);if(-1!==l&&(t===document||t===window))return void(e.__root=t);var u=a.indexOf(t);if(-1===u)return;l<=u&&(n=l)}if((s=a[n]||e.target)!==t){L(e,"currentTarget",{configurable:!0,get(){return s||i}});var d=Ge,c=Ze;Xe(null),Je(null);try{for(var h,p=[];null!==s;){var f=s.assignedSlot||s.parentNode||s.host||null;try{var m=s["__"+r];if(null!=m&&(!s.disabled||e.target===s))if($(m)){var[g,...v]=m;g.apply(s,[e,...v])}else m.call(s,e)}catch(e){h?p.push(e):h=e}if(e.cancelBubble||f===t||null===f)break;s=f}if(h){for(let e of p)queueMicrotask((()=>{throw e}));throw h}}finally{e.__root=t,delete e.currentTarget,Xe(d),Je(c)}}}function Oi(e){var t=document.createElement("template");return t.innerHTML=e,t.content}function Bi(e,t){var i=Ze;null===i.nodes_start&&(i.nodes_start=e,i.nodes_end=t)}function Ni(e,t){var i,r=!!(1&t),a=!!(2&t),s=!e.startsWith("<!>");return()=>{if(Se)return Bi(ve,null),ve;void 0===i&&(i=Oi(s?e:"<!>"+e),r||(i=Re(i)));var t=a||_e?document.importNode(i,!0):i.cloneNode(!0);r?Bi(Re(t),t.lastChild):Bi(t,t);return t}}function Vi(e,t,i="svg"){var r,a=!e.startsWith("<!>"),s=!!(1&t),n=`<${i}>${a?e:"<!>"+e}</${i}>`;return()=>{if(Se)return Bi(ve,null),ve;if(!r){var e=Re(Oi(n));if(s)for(r=document.createDocumentFragment();Re(e);)r.appendChild(Re(e));else r=Re(e)}var t=r.cloneNode(!0);s?Bi(Re(t),t.lastChild):Bi(t,t);return t}}function Ui(e=""){if(!Se){var t=Ie(e+"");return Bi(t,t),t}var i=ve;return 3!==i.nodeType&&(i.before(i=Ie()),Te(i)),Bi(i,i),i}function Fi(){if(Se)return Bi(ve,null),ve;var e=document.createDocumentFragment(),t=document.createComment(""),i=Ie();return e.append(t,i),Bi(t,i),e}function ji(e,t){if(Se)return Ze.nodes_end=ve,void Ee();null!==e&&e.before(t)}var zi=!0;function Wi(e){zi=e}function qi(e,t){var i,r=null==t?"":"object"==typeof t?t+"":t;r!==((i=e).__t??(i.__t=e.nodeValue))&&(e.__t=r,e.nodeValue=r+"")}function Hi(e,t){return Gi(e,t)}function Ki(e,t){Me(),t.intro=t.intro??!1;let i=t.target,r=Se,a=ve;try{for(var s=Re(i);s&&(8!==s.nodeType||"["!==s.data);)s=De(s);if(!s)throw b;ke(!0),Te(s),Ee();let r=Gi(e,{...t,anchor:s});if(null===ve||8!==ve.nodeType||"]"!==ve.data)throw fe(),b;return ke(!1),r}catch(r){if(r===b)return!1===t.recover&&function(){if(S){let e=new Error("hydration_failed\nFailed to hydrate the application\nhttps://svelte.dev/e/hydration_failed");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/hydration_failed")}(),Me(),Ve(i),ke(!1),Hi(e,t);throw r}finally{ke(r),Te(a)}}var Qi=new Map;function Gi(e,{target:t,anchor:i,props:r={},events:a,context:s,intro:n=!0}){Me();var o=new Set,l=e=>{for(var i=0;i<e.length;i++){var r=e[i];if(!o.has(r)){o.add(r);var a=Ti(r);t.addEventListener(r,Di,{passive:a});var s=Qi.get(r);void 0===s?(document.addEventListener(r,Di,{passive:a}),Qi.set(r,1)):Qi.set(r,s+1)}}};l(A(Ai)),Pi.add(l);var u=void 0,d=function(e){let t=Mt(64,e,!0);return(e={})=>new Promise((i=>{e.outro?Wt(t,(()=>{jt(t),i(void 0)})):(jt(t),i(void 0))}))}((()=>{var d=i??t.appendChild(Ie());return Vt((()=>{s&&(pi({}),ni.c=s);a&&(r.$$events=a),Se&&Bi(d,null),zi=n,u=e(d,r)||{},zi=!0,Se&&(Ze.nodes_end=ve),s&&fi()})),()=>{for(var e of o){t.removeEventListener(e,Di);var r=Qi.get(e);0==--r?(document.removeEventListener(e,Di),Qi.delete(e)):Qi.set(e,r)}Pi.delete(l),d!==i&&d.parentNode?.removeChild(d)}}));return Yi.set(u,d),u}var Yi=new WeakMap;function Xi(e,t){let i=Yi.get(e);return i?(Yi.delete(e),i(t)):(S&&(S?console.warn("%c[svelte] lifecycle_double_unmount\n%cTried to unmount a component that was not mounted\nhttps://svelte.dev/e/lifecycle_double_unmount",he,pe):console.warn("https://svelte.dev/e/lifecycle_double_unmount")),Promise.resolve())}function Zi(e,t,[i,r]=[0,0]){Se&&0===i&&Ee();var a=e,s=null,n=null,o=_,l=!1;let u=(e,t=!0)=>{l=!0,d(t,e)},d=(e,t)=>{if(o===(o=e))return;let l=!1;if(Se&&-1!==r){if(0===i){let e=a.data;"["===e?r=0:e===v?r=1/0:(r=parseInt(e.substring(1)))!=r&&(r=o?1/0:-1)}!!o===r>i&&(Te(a=Ce()),ke(!1),l=!0,r=-1)}o?(s?Kt(s):t&&(s=Vt((()=>t(a)))),n&&Wt(n,(()=>{n=null}))):(n?Kt(n):t&&(n=Vt((()=>t(a,[i+1,r])))),s&&Wt(s,(()=>{s=null}))),l&&ke(!0)};Nt((()=>{l=!1,t(u),l||d(null,null)}),i>0?65536:0),Se&&(a=ve)}function Ji(e,t,i){Se&&Ee();var r,a=e,s=_,n=mi()?Q:K;Nt((()=>{n(s,s=t())&&(r&&Wt(r),r=Vt((()=>i(a))))})),Se&&(a=ve)}var er,tr=null;function ir(e){tr=e}function rr(e,t){return t}function ar(e,t,i,r,a,s=null){var n=e,o={flags:t,items:new Map,first:null};if(!!(4&t)){var l=e;n=Se?Te(Re(l)):l.appendChild(Ie())}Se&&Ee();var u=null,d=!1,c=oe((()=>{var e=i();return $(e)?e:null==e?[]:A(e)}));Nt((()=>{var e=xt(c),l=e.length;if(d&&0===l)return;d=0===l;let h=!1;Se&&(n.data===v!==(0===l)&&(Te(n=Ce()),ke(!1),h=!0));if(Se){for(var p,f=null,m=0;m<l;m++){if(8===ve.nodeType&&"]"===ve.data){n=ve,h=!0,ke(!1);break}var g=e[m],b=r(g,m);p=nr(ve,o,f,null,g,b,m,a,t,i),o.items.set(b,p),f=p}l>0&&Te(Ce())}Se||function(e,t,i,r,a,s,n){var o,l,u,d,c,h,p=!!(8&a),f=!!(3&a),m=e.length,g=t.items,v=t.first,b=v,_=null,y=[],w=[];if(p)for(h=0;h<m;h+=1)u=e[h],d=s(u,h),void 0!==(c=g.get(d))&&(c.a?.measure(),(l??(l=new Set)).add(c));for(h=0;h<m;h+=1)if(d=s(u=e[h],h),void 0!==(c=g.get(d))){if(f&&sr(c,u,h,a),!!(8192&c.e.f)&&(Kt(c.e),p&&(c.a?.unfix(),(l??(l=new Set)).delete(c))),c!==b){if(void 0!==o&&o.has(c)){if(y.length<w.length){var S,k=w[0];_=k.prev;var T=y[0],E=y[y.length-1];for(S=0;S<y.length;S+=1)or(y[S],k,i);for(S=0;S<w.length;S+=1)o.delete(w[S]);lr(t,T.prev,E.next),lr(t,_,T),lr(t,E,k),b=k,_=E,h-=1,y=[],w=[]}else o.delete(c),or(c,b,i),lr(t,c.prev,c.next),lr(t,c,null===_?t.first:_.next),lr(t,_,c),_=c;continue}for(y=[],w=[];null!==b&&b.k!==d;)!(8192&b.e.f)&&(o??(o=new Set)).add(b),w.push(b),b=b.next;if(null===b)continue;c=b}y.push(c),_=c,b=c.next}else{_=nr(b?b.e.nodes_start:i,t,_,null===_?t.first:_.next,u,d,h,r,a,n),g.set(d,_),y=[],w=[],b=_.next}if(null!==b||void 0!==o){for(var x=void 0===o?[]:A(o);null!==b;)!(8192&b.e.f)&&x.push(b),b=b.next;var $=x.length;if($>0){var C=4&a&&0===m?i:null;if(p){for(h=0;h<$;h+=1)x[h].a?.measure();for(h=0;h<$;h+=1)x[h].a?.fix()}!function(e,t,i,r){for(var a=[],s=t.length,n=0;n<s;n++)Ht(t[n].e,a,!0);var o=s>0&&0===a.length&&null!==i;if(o){var l=i.parentNode;Ve(l),l.append(i),r.clear(),lr(e,t[0].prev,t[s-1].next)}qt(a,(()=>{for(var i=0;i<s;i++){var a=t[i];o||(r.delete(a.k),lr(e,a.prev,a.next)),jt(a.e,!o)}}))}(t,x,C,g)}}p&&W((()=>{if(void 0!==l)for(c of l)c.a?.apply()})),Ze.first=t.first&&t.first.e,Ze.last=_&&_.e}(e,o,n,a,t,r,i),null!==s&&(0===l?u?Kt(u):u=Vt((()=>s(n))):null!==u&&Wt(u,(()=>{u=null}))),h&&ke(!0),xt(c)})),Se&&(n=ve)}function sr(e,t,i,r){!!(1&r)&&ae(e.v,t),2&r?ae(e.i,i):e.i=i}function nr(e,t,i,r,a,s,n,o,l,u){var d=tr,c=!!(1&l),h=c?!(16&l)?ie(a):ee(a):a,p=2&l?ee(n):n;S&&c&&(h.debug=()=>{var e="number"==typeof p?n:p.v;u()[e]});var f={i:p,v:h,k:s,a:null,e:null,prev:i,next:r};tr=f;try{return f.e=Vt((()=>o(e,h,p,u)),Se),f.e.prev=i&&i.e,f.e.next=r&&r.e,null===i?t.first=f:(i.next=f,i.e.next=f.e),null!==r&&(r.prev=f,r.e.prev=f.e),f}finally{tr=d}}function or(e,t,i){for(var r=e.next?e.next.e.nodes_start:i,a=t?t.e.nodes_start:i,s=e.e.nodes_start;s!==r;){var n=De(s);a.before(s),s=n}}function lr(e,t,i){null===t?e.first=i:(t.next=i,t.e.next=i&&i.e),null!==i&&(i.prev=t,i.e.prev=t&&t.e)}function ur(e,t,i){if(!t||t===function(e){let t=5381,i=(e=e.replace(vi,"")).length;for(;i--;)t=(t<<5)-t^e.charCodeAt(i);return(t>>>0).toString(36)}(String(i??"")))return;let r,a=e.__svelte_meta?.loc;a?r=`near ${a.file}:${a.line}:${a.column}`:li?.[y]&&(r=`in ${li[y]}`),function(e){S?console.warn(`%c[svelte] hydration_html_changed\n%c${e?`The value of an \`{@html ...}\` block ${e} changed between server and client renders. The client value will be ignored in favour of the server value`:"The value of an `{@html ...}` block changed between server and client renders. The client value will be ignored in favour of the server value"}\nhttps://svelte.dev/e/hydration_html_changed`,he,pe):console.warn("https://svelte.dev/e/hydration_html_changed")}(function(e){return e?.replace(/\//g,"/​")}(r))}function dr(e,t,i,r,a){var s,n=e,o="";Nt((()=>{o!==(o=t()??"")?(void 0!==s&&(jt(s),s=void 0),""!==o&&(s=Vt((()=>{if(Se){for(var e=ve.data,t=Ee(),s=t;null!==t&&(8!==t.nodeType||""!==t.data);)s=t,t=De(t);if(null===t)throw fe(),b;return S&&!a&&ur(t.parentNode,e,o),Bi(ve,s),void(n=Te(t))}var l=o+"";i?l=`<svg>${l}</svg>`:r&&(l=`<math>${l}</math>`);var u=Oi(l);if((i||r)&&(u=Re(u)),Bi(Re(u),u.lastChild),i||r)for(;Re(u);)n.before(Re(u));else n.before(u)})))):Se&&Ee()}))}function cr(e,t,...i){var r,a=e,s=N;Nt((()=>{s!==(s=t())&&(r&&(jt(r),r=null),S&&null==s&&function(){if(S){let e=new Error("invalid_snippet\nCould not `{@render}` snippet due to the expression being `null` or `undefined`. Consider using optional chaining `{@render snippet?.()}`\nhttps://svelte.dev/e/invalid_snippet");throw e.name="Svelte error",e}throw new Error("https://svelte.dev/e/invalid_snippet")}(),r=Vt((()=>s(a,...i))))}),65536),Se&&(a=ve)}function hr(e,t,i){Se&&Ee();var r,a,s=e;Nt((()=>{r!==(r=t())&&(a&&(Wt(a),a=null),r&&(a=Vt((()=>i(s,r)))))}),65536),Se&&(s=ve)}function pr(e,t,i,r,a,s){let n=Se;Se&&Ee();var o,l,u=S&&s&&ni?.function[y],d=null;Se&&1===ve.nodeType&&(d=ve,Ee());var c,h=Se?ve:e,p=tr;Nt((()=>{let e=t()||null;var n=a?a():i||"svg"===e?"http://www.w3.org/2000/svg":null;if(e!==o){var f=tr;ir(p),c&&(null===e?Wt(c,(()=>{c=null,l=null})):e===l?Kt(c):(jt(c),Wi(!1))),e&&e!==l&&(c=Vt((()=>{if(d=Se?d:n?document.createElementNS(n,e):document.createElement(e),S&&s&&(d.__svelte_meta={loc:{file:u,line:s[0],column:s[1]}}),Bi(d,d),r){Se&&function(e){return Ei.includes(e)}(e)&&d.append(document.createComment(""));var t=Se?Re(d):d.appendChild(Ie());Se&&(null===t?ke(!1):Te(t)),r(d,t)}Ze.nodes_end=d,h.before(d)}))),(o=e)&&(l=o),Wi(!0),ir(f)}}),65536),n&&(ke(!0),Te(h))}var fr=(s=(0,p._)("_t"),n=(0,p._)("_e"),class{$set(e){(0,h._)(this,n)[n].$set(e)}$on(e,t){(0,h._)(this,s)[s][e]=(0,h._)(this,s)[s][e]||[];let i=(...e)=>t.call(this,...e);return(0,h._)(this,s)[s][e].push(i),()=>{(0,h._)(this,s)[s][e]=(0,h._)(this,s)[s][e].filter((e=>e!==i))}}$destroy(){(0,h._)(this,n)[n].$destroy()}constructor(e){Object.defineProperty(this,s,{writable:!0,value:void 0}),Object.defineProperty(this,n,{writable:!0,value:void 0});var t=new Map,i=(e,i)=>{var r=ie(i);return t.set(e,r),r};let r=new Proxy({...e.props||{},$$events:{}},{get(e,r){return xt(t.get(r)??i(r,Reflect.get(e,r)))},has(e,r){return r===E||(xt(t.get(r)??i(r,Reflect.get(e,r))),Reflect.has(e,r))},set(e,r,a){return re(t.get(r)??i(r,a),a),Reflect.set(e,r,a)}});(0,h._)(this,n)[n]=(e.hydrate?Ki:Hi)(e.component,{target:e.target,anchor:e.anchor,props:r,context:e.context,intro:e.intro??!1,recover:e.recover}),(!e?.props?.$$host||!1===e.sync)&&Tt(),(0,h._)(this,s)[s]=r.$$events;for(let e of Object.keys((0,h._)(this,n)[n]))"$set"===e||"$destroy"===e||"$on"===e||L(this,e,{get(){return(0,h._)(this,n)[n][e]},set(t){(0,h._)(this,n)[n][e]=t},enumerable:!0});(0,h._)(this,n)[n].$set=e=>{Object.assign(r,e)},(0,h._)(this,n)[n].$destroy=()=>{Xi((0,h._)(this,n)[n])}}});function mr(e,t){W((()=>{var i=e.getRootNode(),r=i.host?i:i.head??i.ownerDocument.head??er?.parentNode;if(!r?.querySelector("#"+t.hash)){let e=document.createElement("style");e.id=t.hash,e.textContent=t.code,r.appendChild(e),S&&function(e,t){var i=xi.get(e);i||(i=new Set,xi.set(e,i)),i.add(t)}(t.hash,e)}}))}function gr(e){var t,i,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(i=gr(e[t]))&&(r&&(r+=" "),r+=i)}else for(i in e)e[i]&&(r&&(r+=" "),r+=i);return r}function vr(e){return"object"==typeof e?function(){for(var e,t,i=0,r="",a=arguments.length;i<a;i++)(e=arguments[i])&&(t=gr(e))&&(r&&(r+=" "),r+=t);return r}(e):e??""}var br=[..." \t\n\r\f \v\ufeff"];function _r(e,t=!1){var i=t?" !important;":";",r="";for(var a in e){var s=e[a];null!=s&&""!==s&&(r+=" "+a+": "+s+i)}return r}function yr(e){return"-"!==e[0]||"-"!==e[1]?e.toLowerCase():e}function wr(e,t,i,r,a,s){var n=e.__className;if(Se||n!==i){var o=function(e,t,i){var r=null==e?"":""+e;if(t&&(r=r?r+" "+t:t),i)for(var a in i)if(i[a])r=r?r+" "+a:a;else if(r.length)for(var s=a.length,n=0;(n=r.indexOf(a,n))>=0;){var o=n+s;0!==n&&!br.includes(r[n-1])||o!==r.length&&!br.includes(r[o])?n=o:r=(0===n?"":r.substring(0,n))+r.substring(o+1)}return""===r?null:r}(i,r,s);(!Se||o!==e.getAttribute("class"))&&(null==o?e.removeAttribute("class"):t?e.className=o:e.setAttribute("class",o)),e.__className=i}else if(s&&a!==s)for(var l in s){var u=!!s[l];(null==a||u!==!!a[l])&&e.classList.toggle(l,u)}return s}function Sr(e,t={},i,r){for(var a in i){var s=i[a];t[a]!==s&&(null==i[a]?e.style.removeProperty(a):e.style.setProperty(a,s,r))}}function kr(e,t,i,r){var a=e.__style;if(Se||a!==t){var s=function(e,t){if(t){var i,r,a="";if(Array.isArray(t)?(i=t[0],r=t[1]):i=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var s=!1,n=0,o=!1,l=[];i&&l.push(...Object.keys(i).map(yr)),r&&l.push(...Object.keys(r).map(yr));var u=0,d=-1;let t=e.length;for(var c=0;c<t;c++){var h=e[c];if(o?"/"===h&&"*"===e[c-1]&&(o=!1):s?s===h&&(s=!1):"/"===h&&"*"===e[c+1]?o=!0:'"'===h||"'"===h?s=h:"("===h?n++:")"===h&&n--,!o&&!1===s&&0===n)if(":"===h&&-1===d)d=c;else if(";"===h||c===t-1){if(-1!==d){var p=yr(e.substring(u,d).trim());l.includes(p)||(";"!==h&&c++,a+=" "+e.substring(u,c).trim()+";")}u=c+1,d=-1}}}return i&&(a+=_r(i)),r&&(a+=_r(r,!0)),""===(a=a.trim())?null:a}return null==e?null:String(e)}(t,r);(!Se||s!==e.getAttribute("style"))&&(null==s?e.removeAttribute("style"):e.style.cssText=s),e.__style=t}else r&&(Array.isArray(r)?(Sr(e,i?.[0],r[0]),Sr(e,i?.[1],r[1],"important")):Sr(e,i,r));return r}var Tr=Symbol("class"),Er=Symbol("style"),xr=Symbol("is custom element"),$r=Symbol("is html");function Cr(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function Ar(e,t,i,r){var a=Lr(e);Se&&(a[t]=e.getAttribute(t),"src"===t||"srcset"===t||"href"===t&&"LINK"===e.nodeName)?r||function(e,t,i){S&&("srcset"===t&&function(e,t){var i=Dr(e.srcset),r=Dr(t);return r.length===i.length&&r.every((([e,t],r)=>t===i[r][1]&&(Rr(i[r][0],e)||Rr(e,i[r][0]))))}(e,i)||Rr(e.getAttribute(t)??"",i)||function(e,t,i){S?console.warn(`%c[svelte] hydration_attribute_changed\n%cThe \`${e}\` attribute on \`${t}\` changed its value between server and client renders. The client value, \`${i}\`, will be ignored in favour of the server value\nhttps://svelte.dev/e/hydration_attribute_changed`,he,pe):console.warn("https://svelte.dev/e/hydration_attribute_changed")}(t,e.outerHTML.replace(e.innerHTML,e.innerHTML&&"..."),String(i)))}(e,t,i??""):a[t]!==(a[t]=i)&&("loading"===t&&(e[x]=i),null==i?e.removeAttribute(t):"string"!=typeof i&&Ir(e).includes(t)?e[t]=i:e.setAttribute(t,i))}function Pr(e,t,i,r,a=!1){var s,n=Lr(e),o=n[xr],l=!n[$r];let u=Se&&o;u&&ke(!1);var d=t||{},c="OPTION"===e.tagName;for(var h in t)h in i||(i[h]=null);i.class?i.class=vr(i.class):(r||i[Tr])&&(i.class=null),i[Er]&&((s=i).style??(s.style=null));var p=Ir(e);for(let s in i){let u=i[s];if(c&&"value"===s&&null==u)e.value=e.__value="",d[s]=u;else if("class"!==s)if("style"!==s){var f=d[s];if(u!==f){d[s]=u;var m=s[0]+s[1];if("$$"!==m)if("on"===m){let t={},i="$$"+s,r=s.slice(2);var g=yi(r);if(bi(r)&&(r=r.slice(0,-7),t.capture=!0),!g&&f){if(null!=u)continue;e.removeEventListener(r,d[i],t),d[i]=null}if(null!=u)if(g)e[`__${r}`]=u,Ri([r]);else{let a=function(e){d[s].call(this,e)};d[i]=Mi(r,e,a,t)}else g&&(e[`__${r}`]=void 0)}else if("style"===s)Ar(e,s,u);else if("autofocus"===s)$i(e,!!u);else if(o||"__value"!==s&&("value"!==s||null==u))if("selected"===s&&c)Cr(e,u);else{var v=s;l||(v=Si(v));var b="defaultValue"===v||"defaultChecked"===v;if(null!=u||o||b)b||p.includes(v)&&(o||"string"!=typeof u)?e[v]=u:"function"!=typeof u&&Ar(e,v,u,a);else if(n[s]=null,"value"===v||"checked"===v){let i=e,r=void 0===t;if("value"===v){let e=i.defaultValue;i.removeAttribute(v),i.defaultValue=e,i.value=i.__value=r?e:null}else{let e=i.defaultChecked;i.removeAttribute(v),i.defaultChecked=e,i.checked=!!r&&e}}else e.removeAttribute(s)}else e.value=e.__value=u}}else kr(e,u,t?.[Er],i[Er]),d[s]=u,d[Er]=i[Er];else wr(e,"http://www.w3.org/1999/xhtml"===e.namespaceURI,u,r,t?.[Tr],i[Tr]),d[s]=u,d[Tr]=i[Tr]}return u&&ke(!0),d}function Lr(e){var t;return(t=e).__attributes??(t.__attributes={[xr]:e.nodeName.includes("-"),[$r]:"http://www.w3.org/1999/xhtml"===e.namespaceURI})}var Mr=new Map;function Ir(e){var t=Mr.get(e.nodeName);if(t)return t;Mr.set(e.nodeName,t=[]);for(var i,r=e,a=Element.prototype;a!==r;){for(var s in i=I(r))i[s].set&&t.push(s);r=O(r)}return t}function Rr(e,t){return e===t||new URL(e,document.baseURI).href===new URL(t,document.baseURI).href}function Dr(e){return e.split(",").map((e=>e.trim().split(" ").filter(Boolean)))}var Or=()=>performance.now(),Br={tick:e=>requestAnimationFrame(e),now:()=>Or(),tasks:new Set};function Nr(){let e=Br.now();Br.tasks.forEach((t=>{t.c(e)||(Br.tasks.delete(t),t.f())})),0!==Br.tasks.size&&Br.tick(Nr)}function Vr(e,t){Ci((()=>{e.dispatchEvent(new CustomEvent(t))}))}function Ur(e){if("float"===e)return"cssFloat";if("offset"===e)return"cssOffset";if(e.startsWith("--"))return e;let t=e.split("-");return 1===t.length?t[0]:t[0]+t.slice(1).map((e=>e[0].toUpperCase()+e.slice(1))).join("")}function Fr(e){let t={},i=e.split(";");for(let e of i){let[i,r]=e.split(":");if(!i||void 0===r)break;t[Ur(i.trim())]=r.trim()}return t}var jr=e=>e;function zr(e,t,i,r,a){var s=1===r;if(B(t)){var n,o=!1;return W((()=>{if(!o){var l=t({direction:s?"in":"out"});n=zr(e,l,i,r,a)}})),{abort:()=>{o=!0,n?.abort()},deactivate:()=>n.deactivate(),reset:()=>n.reset(),t:()=>n.t()}}if(i?.deactivate(),!t?.duration)return a(),{abort:N,deactivate:N,reset:N,t:()=>r};let{delay:l=0,css:u,tick:d,easing:c=jr}=t;var h=[];if(s&&void 0===i&&(d&&d(0,1),u)){var p=Fr(u(0,1));h.push(p,p)}var f=()=>1-r,m=e.animate(h,{duration:l});return m.onfinish=()=>{var s=i?.t()??1-r;i?.abort();var n=r-s,o=t.duration*Math.abs(n),l=[];if(o>0){var h=!1;if(u)for(var p=Math.ceil(o/16.666666666666668),g=0;g<=p;g+=1){var v=s+n*c(g/p),b=Fr(u(v,1-v));l.push(b),h||(h="hidden"===b.overflow)}h&&(e.style.overflow="hidden"),f=()=>{var e=m.currentTime;return s+n*c(e/o)},d&&function(e){let t;0===Br.tasks.size&&Br.tick(Nr),new Promise((i=>{Br.tasks.add(t={c:e,f:i})}))}((()=>{if("running"!==m.playState)return!1;var e=f();return d(e,1-e),!0}))}(m=e.animate(l,{duration:o,fill:"forwards"})).onfinish=()=>{f=()=>r,d?.(r,1-r),a()}},{abort:()=>{m&&(m.cancel(),m.effect=null,m.onfinish=N)},deactivate:()=>{a=N},reset:()=>{0===r&&d?.(1,0)},t:()=>f()}}var Wr=(o=(0,p._)("_t"),l=(0,p._)("_e"),u=(0,p._)("_i"),d=(0,p._)("_o"),c=class{observe(e,t){var i=(0,h._)(this,o)[o].get(e)||new Set;return i.add(t),(0,h._)(this,o)[o].set(e,i),(0,h._)(this,d)[d]().observe(e,(0,h._)(this,u)[u]),()=>{var i=(0,h._)(this,o)[o].get(e);i.delete(t),0===i.size&&((0,h._)(this,o)[o].delete(e),(0,h._)(this,l)[l].unobserve(e))}}constructor(e){Object.defineProperty(this,d,{value:Sg}),Object.defineProperty(this,o,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:void 0}),Object.defineProperty(this,u,{writable:!0,value:void 0}),(0,h._)(this,o)[o]=new WeakMap,(0,h._)(this,u)[u]=e}},c.entries=new WeakMap,c),qr=new Wr({box:"border-box"});function Hr(e,t,i){var r=qr.observe(e,(()=>i(e[t])));Dt((()=>($t((()=>i(e[t]))),r)))}function Kr(e,t){return e===t||e?.[k]===t}function Qr(e={},t,i,r){return Dt((()=>{var a,s;return Ot((()=>{a=s,s=r?.()||[],$t((()=>{e!==i(...s)&&(t(e,...s),a&&Kr(i(...a),e)&&t(null,...a))}))})),()=>{W((()=>{s&&Kr(i(...s),e)&&t(null,...s)}))}})),e}function Gr(e=!1){let t=ni,i=t.l.u;if(!i)return;let r=()=>function(e){if("object"==typeof e&&e&&!(e instanceof EventTarget))if(k in e)Pt(e);else if(!Array.isArray(e))for(let t in e){let i=e[t];"object"==typeof i&&i&&k in i&&Pt(i)}}(t.s);if(e){let e=0,i={},a=ne((()=>{let r=!1,a=t.s;for(let e in a)a[e]!==i[e]&&(i[e]=a[e],r=!0);return r&&e++,e}));r=()=>xt(a)}i.b.length&&function(e){Lt("$effect.pre"),S&&L(e,"name",{value:"$effect.pre"}),Ot(e)}((()=>{Yr(t,r),U(i.b)})),Rt((()=>{let e=$t((()=>i.m.map(V)));return()=>{for(let t of e)"function"==typeof t&&t()}})),i.a.length&&Rt((()=>{Yr(t,r),U(i.a)}))}function Yr(e,t){if(e.l.s)for(let t of e.l.s)xt(t);t()}if(S){let e=function(e){if(!(e in globalThis)){let t;Object.defineProperty(globalThis,e,{configurable:!0,get:()=>{if(void 0!==t)return t;!function(e){if(S){let t=new Error(`rune_outside_svelte\nThe \`${e}\` rune is only available inside \`.svelte\` and \`.svelte.js/ts\` files\nhttps://svelte.dev/e/rune_outside_svelte`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/rune_outside_svelte")}(e)},set:e=>{t=e}})}};e("$state"),e("$effect"),e("$derived"),e("$inspect"),e("$props"),e("$bindable")}function Xr(e){null===ni&&si("onMount"),Y&&null!==ni.l?function(e){var t,i=e.l;return(t=i).u??(t.u={a:[],b:[],m:[]})}(ni).m.push(e):Rt((()=>{let t=$t(e);if("function"==typeof t)return t}))}function Zr(e){null===ni&&si("onDestroy"),Xr((()=>()=>$t(e)))}function Jr(e,t,i){if(null==e)return t(void 0),i&&i(void 0),N;let r=$t((()=>e.subscribe(t,i)));return r.unsubscribe?()=>r.unsubscribe():r}var ea=[];function ta(e,t){return{subscribe:ia(e,t).subscribe}}function ia(e,t=N){let i=null,r=new Set;function a(t){if(K(e,t)&&(e=t,i)){let t=!ea.length;for(let t of r)t[1](),ea.push(t,e);if(t){for(let e=0;e<ea.length;e+=2)ea[e][0](ea[e+1]);ea.length=0}}}function s(t){a(t(e))}return{set:a,update:s,subscribe:function(n,o=N){let l=[n,o];return r.add(l),1===r.size&&(i=t(a,s)||N),n(e),()=>{r.delete(l),0===r.size&&i&&(i(),i=null)}}}}function ra(e,t,i){let r=!Array.isArray(e),a=r?[e]:e;if(!a.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");let s=t.length<2;return ta(i,((e,i)=>{let n=!1,o=[],l=0,u=N,d=()=>{if(l)return;u();let a=t(r?o[0]:o,e,i);s?e(a):u="function"==typeof a?a:N},c=a.map(((e,t)=>Jr(e,(e=>{o[t]=e,l&=~(1<<t),n&&d()}),(()=>{l|=1<<t}))));return n=!0,d(),function(){U(c),u(),n=!1}}))}function aa(e){let t;return Jr(e,(e=>t=e))(),t}var sa=!1,na=Symbol();function oa(e,t,i){var r,a;let s=(r=i)[a=t]??(r[a]={store:null,source:ie(void 0),unsubscribe:N});if(s.store!==e&&!(na in i))if(s.unsubscribe(),s.store=e??null,null==e)s.source.v=void 0,s.unsubscribe=N;else{var n=!0;s.unsubscribe=Jr(e,(e=>{n?s.source.v=e:re(s.source,e)})),n=!1}return e&&na in i?aa(e):xt(s.source)}function la(){let e={};return[e,function(){It((()=>{for(var t in e)e[t].unsubscribe();L(e,na,{enumerable:!1,value:!0})}))}]}var ua={get(e,t){if(!e.exclude.includes(t))return e.props[t]},set(e,t){return S&&function(e){if(S){let t=new Error(`props_rest_readonly\nRest element properties of \`$props()\` such as \`${e}\` are readonly\nhttps://svelte.dev/e/props_rest_readonly`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_rest_readonly")}(`${e.name}.${String(t)}`),!1},getOwnPropertyDescriptor(e,t){if(!e.exclude.includes(t)&&t in e.props)return{enumerable:!0,configurable:!0,value:e.props[t]}},has(e,t){return!e.exclude.includes(t)&&t in e.props},ownKeys(e){return Reflect.ownKeys(e.props).filter((t=>!e.exclude.includes(t)))}};function da(e,t,i){return new Proxy(S?{props:e,exclude:t,name:i,other:{},to_proxy:[]}:{props:e,exclude:t},ua)}var ca={get(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(B(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r)return r[t]}},set(e,t,i){let r=e.props.length;for(;r--;){let a=e.props[r];B(a)&&(a=a());let s=M(a,t);if(s&&s.set)return s.set(i),!0}return!1},getOwnPropertyDescriptor(e,t){let i=e.props.length;for(;i--;){let r=e.props[i];if(B(r)&&(r=r()),"object"==typeof r&&null!==r&&t in r){let e=M(r,t);return e&&!e.configurable&&(e.configurable=!0),e}}},has(e,t){if(t===k||t===E)return!1;for(let i of e.props)if(B(i)&&(i=i()),null!=i&&t in i)return!0;return!1},ownKeys(e){let t=[];for(let i of e.props){B(i)&&(i=i());for(let e in i)t.includes(e)||t.push(e)}return t}};function ha(...e){return new Proxy({props:e},ca)}function pa(e){return e.ctx?.d??!1}function fa(e,t,i,r){var a,s=!!(1&i),n=!Y||!!(2&i),o=!!(8&i),l=!!(16&i),u=!1;o?[a,u]=function(e){var t=sa;try{return sa=!1,[e(),sa]}finally{sa=t}}((()=>e[t])):a=e[t];var d,c=k in e||E in e,h=o&&(M(e,t)?.set??(c&&t in e&&(i=>e[t]=i)))||void 0,p=r,f=!0,m=!1,g=()=>(m=!0,f&&(f=!1,p=l?$t(r):r),p);if(void 0===a&&void 0!==r&&(h&&n&&function(e){if(S){let t=new Error(`props_invalid_value\nCannot do \`bind:${e}={undefined}\` when \`${e}\` has a fallback value\nhttps://svelte.dev/e/props_invalid_value`);throw t.name="Svelte error",t}throw new Error("https://svelte.dev/e/props_invalid_value")}(t),a=g(),h&&h(a)),n)d=()=>{var i=e[t];return void 0===i?g():(f=!0,m=!1,i)};else{var v=(s?ne:oe)((()=>e[t]));v.f|=131072,d=()=>{var e=xt(v);return void 0!==e&&(p=void 0),void 0===e?p:e}}if(!(4&i))return d;if(h){var b=e.$$legacy;return function(e,t){return arguments.length>0?((!n||!t||b||u)&&h(t?d():e),e):d()}}var _=!1,y=!1,w=ie(a),T=ne((()=>{var e=d(),t=xt(w);return _?(_=!1,y=!0,t):(y=!1,w.v=e)}));return o&&xt(T),s||(T.equals=G),function(e,t){if(null!==ot&&(_=y,d(),xt(w)),arguments.length>0){let i=t?xt(T):n&&o?Ae(e):e;if(!T.equals(i)){if(_=!0,re(w,i),m&&void 0!==p&&(p=i),pa(T))return e;$t((()=>xt(T)))}return e}return pa(T)?T.v:xt(T)}}function ma(e,t,i,r){let a=i[e]?.type;if(t="Boolean"===a&&"boolean"!=typeof t?null!=t:t,!r||!i[e])return t;if("toAttribute"===r)switch(a){case"Object":case"Array":return null==t?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t??null;default:return t}else switch(a){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":default:return t;case"Number":return null!=t?+t:t}}"function"==typeof HTMLElement&&HTMLElement;typeof window<"u"&&((a=(r=window).__svelte??(r.__svelte={})).v??(a.v=new Set)).add("5");var ga,va={isMobile:void 0,debugLog:!1,devNullLog:!1,defaultLanguage:m.InterfaceLanguage.RU,downloadVKLanguages:!0,updateBuiltinLanguages:!0,isSmoothVideoRotate:!0,showSupport:!0,supportLink:"https://vk.com/support?act=new&from=v",showLogo:void 0,logoLink:"https://vk.com/video",logoType:"vk_video",volumeDefault:1,volumeMinRestore:.05,loaderDelay:500,minSubtitlesFontSize:13,autoSubtitlesTimeout:2e3,allowChangingFullscreenTarget:!0,trafficSavingLimit:m.VideoQuality.Q_480P,highQualityLimit:m.VideoQuality.Q_720P,episodeMinWidthPc:8,hideThumbTimerAfterTouch:!0,preventPauseOnVideoClick:!1,sentry:{dsn:"https://e349fd23c68f405388980d0868d0ff27@sentry.mvk.com/126",sampleRate:.01,whiteErrorCategoryList:[],blackErrorCategoryList:[],whiteErrorIdList:[],blackErrorIdList:[]},features:{autoplay:!0,statistics:!0,sentry:!0,preload:!0,subtitles:!0,episodes:!0,fullscreen:!0,timelinePreview:!0,mediaSession:!0,annotations:!0,slots:!0,annotationsInside:!1,pip:!0,dpip:!0,download:!0,liveRewind:!0,playbackRate:!0,trafficSaving:!0,episodesClustering:!0,copyVideoLink:!0,videoRotate:!0,tracer:!1,interactiveGraph:!1,interactiveResponsiveUi:!1,seekToInteractive:!0,interactiveLastFrame:!1,interactiveTextPermanent:!0,interactiveHideTime:!0,interactivePlayPrevChapter:!0,interactiveTimeIndicator:!0,interactiveTimeOpenUri:!1,interactiveAreaControlShadow:!1,interactiveControlsExpectTimeBlinkAnimation:!1,interactiveControlsTapPlace:!1,interactiveControlsFillAnimation:!1,interactiveControlsHideAnimation:!1,thumbTimer:!0,hotKeyMapModal:!0,hotKeyHelpers:!0,saveDebugInfoToFile:!1,saveTraceInfoToFile:!1,additionalButtons:!0,additionalButtonsDesktopControlPanelRight:!0,additionalSettingsMenuItems:!0,additionalContextMenuItems:!0,contextMenuButton:!0,audioLanguages:!1,saveRate:!1,fullscreenInternalTargetPlayerContainer:!1,endScreen:!0,autoplayNext:!0,nextPrevButtons:!0,previewNoEmptySpace:!1,exposeInternalsToGlobal:!1,skipInitialPlaybackRateValue:!1,qualityDetailsSubMenuEnabled:!1,showSlowVideoNotification:!1,forceAutoQualityWhenSevereStallHappens:!1,timeoutShowSlowVideoNotification:0,maxCountShowSlowVideoNotification:1,forcePlayerDisplayBlock:!1,playbackStatusAnimationDuration:1e3,playbackStatusShow:!1,playbackStatusNextVideoShow:!1,playbackStatusNextVideoAnimationDuration:1e3},controls:{showOnStartupAtAutoplay:!0,hideTimeout:500,hideTimeoutMobile:3e3,hideTimeoutInitial:200,hideTimeoutFullscreen:3e3,hideTimeoutCursor:3e3,hideTimeoutTooltips:1e3,collapseMobileUnmute:6e3,hide360IconTimeout:3e3,hideHotKeyHelpers:2e3,playbackRateMin:.25,playbackRateMax:2,playbackRateStep:.25,volumeStepKeyboard:.05,volumeStepWheel:.05,volumeBarTimeout:300,seekStepKeyboard:1e4,seekStepMobile:15e3,seekStepFrame:400},ads:{enable:void 0,initTimeout:2e3,loadTimeout:2e3,runtimeTimeout:5e3,slot:void 0,preview:void 0,isMobileGoToSiteButton:!0,useAdmanFromNPM:!1,volumeMultiplier:1,isVsidOriginal:!1},interactive:{historyMaxLength:100,noInteractionEventTimeout:3e4},view:{timelineSliderColor:null,timelineSliderHandleColor:null,timelineSliderFilledColor:null,timelineSliderLoadedColor:null,volumeSliderColor:null,volumeSliderHandleColor:null,volumeSliderFilledColor:null,controlsTimeColor:null,timelineSliderFilledActiveLiveColor:null,timelineSliderHandleActiveLiveColor:null,buttonColor:null,buttonToggleOnColor:null,focusedColor:null}},ba=()=>di("ui-config"),_a="vk_player_debug_panel_opened",ya="f",wa="k",Sa="c",ka="m",Ta=new Set(["ArrowLeft","ArrowRight","KeyL","KeyJ"]),Ea=new Set(["Tab","Space","ArrowLeft","ArrowRight","ArrowUp","ArrowDown"]),xa=new Set(["ShiftRight","ShiftLeft"]),$a=["TIMELINE"],Ca=[...$a,"GRAPH_BUTTON"],Aa=[...$a,"PLAY_BUTTON"],Pa=[...Ca,"PLAY_BUTTON"],La=((ga=La||{}).XS="xs",ga.S="s",ga.M="m",ga.L="l",ga.XL="xl",ga),Ma={xs:0,s:1,m:2,l:3,xl:4},Ia="prod",Ra="1.1.64",Da=(e,t,i)=>{let r=document.createElement("a");r.href=e,r.download=`${t}.${i}`,r.style.display="none",r.click()},Oa=Symbol("storeContext"),Ba=Symbol("microStoresContext"),Na=()=>{let e=di(Oa);return(0,m.assertNonNullable)(e,"Store context is empty!"),e},Va=()=>{let e=di(Ba);return(0,m.assertNonNullable)(e,"MicroStores context is empty!"),e},Ua=(e,t)=>Fa(e,e.getValue(),t),Fa=(e,t,i)=>ta(t,(t=>{let r=e.subscribe((e=>{t(e),i?.(e)}));return()=>r.unsubscribe()})),ja=class{async download(e){if(this.pendingDownloads.has(e))return null;this.pendingDownloads.add(e);try{let t=await fetch(e,{signal:this.destroyController.signal});if(t.ok)return await t.text();throw t}finally{this.pendingDownloads.delete(e)}}destroy(){this.destroyController.abort(),this.pendingDownloads.clear()}isDestroyed(){return this.destroyController.signal.aborted}constructor(){this.destroyController=new AbortController,this.pendingDownloads=new Set}},za="vk_player_prefer_traffic_saving_enabled",Wa="vk_player_preferred_volume",qa="vk_player_prefer_volume_mute",Ha="vk_player_preferred_quality",Ka="vk_player_preferred_default_quality_settings",Qa="vk_player_preferred_quality_settings_by_video",Ga="vk_player_preferred_stream_language",Ya="vk_player_preferred_rate",Xa="vk_player_preferred_autoplay_next",Za=e=>e>1?1:e<0?0:e,Ja=e=>m.safeStorage.set(Wa,Za(e).toString(10)),es=()=>{let e=m.safeStorage.get(Wa);return(0,m.isNullable)(e)?void 0:Za(parseFloat(e))},ts=(e,t)=>m.safeStorage.set(Ha,JSON.stringify({videoId:e,value:t})),is=()=>m.safeStorage.remove(Ha),rs=e=>{let t=m.safeStorage.get(Ha);if((0,m.isNullable)(t))return;let{videoId:i,value:r}=JSON.parse(t);if(e===i)return r;is()},as=(e,t)=>{t?m.safeStorage.set(e,"true"):m.safeStorage.remove(e)},ss=e=>"true"===m.safeStorage.get(e),ns=e=>as(qa,e),os=e=>as(za,e),ls=()=>ss(za),us=e=>m.safeStorage.set(Ga,e),{getPreferredQualitySettings:ds,migrateSettingsToLegacyWay:cs,savePreferredQualitySettings:hs,savePreferredDefaultQualitySettings:ps,removePreferredQualitySettingsByVideo:fs,getPreferredDefaultQualitySettings:ms}=(()=>{let e=e=>{m.safeStorage.set(Ka,JSON.stringify(e))},t=()=>{try{let e=m.safeStorage.get(Ka);return e?JSON.parse(e):null}catch{return null}},i=e=>{m.safeStorage.set(Qa,JSON.stringify(e))},r=i=>{s(i);let r=i?(()=>{try{let e=m.safeStorage.get(Qa);return e?JSON.parse(e):null}catch{return null}})():null;if(r&&r?.videoId===i)return{...r,appliesTo:"to-video"};r&&a();let n=t();return n?{...n,appliesTo:"as-default"}:(e({type:"auto_quality"}),{type:"auto_quality",appliesTo:"as-default"})},a=()=>{m.safeStorage.remove(Qa)},s=t=>{let r=rs(t);r?i({type:"exact_quality",videoId:t,quality:r}):(ls()&&e({type:"traffic_saving",videoId:t}),os(!1),is())};return{getPreferredQualitySettings:r,migrateSettingsToLegacyWay:e=>{let t=r(e);if(t){switch(t.type){case"traffic_saving":os(!0);break;case"exact_quality":ts(e,t.quality)}a(),m.safeStorage.remove(Ka)}},savePreferredQualitySettings:(t,r="as-default")=>{"exact_quality"===t.type?i(t):"as-default"===r?e(t):i(t)},savePreferredDefaultQualitySettings:e,removePreferredQualitySettingsByVideo:a,getPreferredDefaultQualitySettings:t}})(),gs=Vi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M67 9.489A3.49 3.49 0 0 1 63.511 13 3.493 3.493 0 0 1 60 9.489 3.49 3.49 0 0 1 63.511 6 3.484 3.484 0 0 1 67 9.489m-5.003 0c0 .834.68 1.514 1.514 1.514.812 0 1.492-.68 1.492-1.514 0-.812-.68-1.492-1.492-1.492-.834 0-1.514.68-1.514 1.492" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M26.86 15.183c1.372-.492 2.534-1.711 2.534-3.61C29.394 8.922 27.185 7 24.07 7c-1.965 0-3.573.784-4.67 2.29l-.108.149a1.333 1.333 0 0 0 .268 1.855c.536.402 1.295.343 1.736-.162.09-.102.164-.19.205-.247.594-.81 1.431-1.306 2.5-1.306 1.534 0 2.604.915 2.604 2.251 0 1.36-1.093 2.275-2.651 2.275h-.583a1.231 1.231 0 0 0 0 2.462h.583c1.744 0 2.907.985 2.907 2.392 0 1.453-1.186 2.462-2.884 2.462-1.296 0-2.201-.552-2.883-1.603a10 10 0 0 0-.2-.287 1.403 1.403 0 0 0-2.052-.246c-.494.42-.65 1.13-.305 1.68.072.116.146.227.218.322C20.132 23.137 21.678 24 23.999 24c3.28 0 5.628-2.04 5.628-4.924 0-2.204-1.395-3.4-2.767-3.893"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M37.732 12.675c-.465 0-1 .046-1.511.164l2.584-3.74a1.338 1.338 0 1 0-2.203-1.518l-3.753 5.469c-1.418 2.133-1.837 3.822-1.837 5.276 0 3.47 2.558 5.674 6.186 5.674 3.604 0 6.162-2.392 6.162-5.768 0-3.236-2.349-5.557-5.628-5.557m-.534 8.746c-1.977 0-3.326-1.267-3.326-3.142 0-1.853 1.349-3.142 3.326-3.142 1.953 0 3.302 1.29 3.302 3.142 0 1.875-1.35 3.142-3.302 3.142M58 15.512c0 5.041-2.697 8.441-6.627 8.441s-6.628-3.4-6.628-8.441 2.698-8.442 6.628-8.442S58 10.47 58 15.512m-10.348 0c0 3.564 1.488 5.862 3.72 5.862s3.721-2.298 3.721-5.862-1.488-5.862-3.72-5.862-3.72 2.298-3.72 5.862Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M67 23.5c0-1.318-1.201-3.094-4.199-4.673a1.5 1.5 0 1 1 1.398-2.654C67.452 17.886 70 20.433 70 23.5c0 3.126-2.556 5.554-6.088 7.27-3.633 1.766-8.825 3.062-15.259 3.722a1.5 1.5 0 0 1-.306-2.984c6.248-.641 11.057-1.882 14.253-3.436C65.897 26.47 67 24.8 67 23.5M38.879 35H38c-9.64 0-17.447-1.133-22.9-3.018-2.72-.941-4.94-2.099-6.506-3.468C7.019 27.138 6 25.445 6 23.5c0-1.64.785-3.073 1.908-4.255 1.119-1.179 2.66-2.205 4.42-3.086a1.5 1.5 0 1 1 1.343 2.682c-1.584.793-2.794 1.634-3.588 2.47C9.293 22.143 9 22.873 9 23.5c0 .807.407 1.74 1.568 2.755 1.17 1.022 2.996 2.02 5.513 2.892C21.106 30.885 28.55 32 38 32h.879l-1.44-1.44a1.5 1.5 0 0 1 2.122-2.12l3.999 3.998.01.011a1.5 1.5 0 0 1 .317 1.624 1.5 1.5 0 0 1-.326.488l-4 4a1.5 1.5 0 0 1-2.122-2.122L38.88 35Z"></path><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-opacity=".12" stroke-width=".5" d="m7.908 19.245-.181-.173c1.146-1.206 2.714-2.248 4.49-3.137a1.75 1.75 0 1 1 1.566 3.13c-1.57.786-2.752 1.61-3.519 2.418-.762.802-1.014 1.474-1.014 2.017 0 .713.357 1.583 1.483 2.567 1.136.993 2.93 1.978 5.43 2.843 4.99 1.726 12.403 2.84 21.837 2.84h.275l-1.012-1.013a1.75 1.75 0 1 1 2.474-2.474l4 3.998h0l.012.013s0 0 0 0c.162.165.284.354.368.556q0 0 0 0l-.23.096A1.5 1.5 0 0 1 44 33.5q-.002.306-.113.573L7.907 19.245Zm0 0-.181-.173C6.576 20.284 5.75 21.775 5.75 23.5c0 2.04 1.07 3.796 2.68 5.202 1.599 1.398 3.85 2.569 6.589 3.516C20.506 34.116 28.343 35.25 38 35.25h.275zm29.824-6.82c-.3 0-.63.018-.965.063l2.244-3.247c.728-1.054-.026-2.491-1.306-2.491-.524 0-1.014.258-1.31.69l-3.752 5.468h0l-.002.003c-1.442 2.17-1.879 3.905-1.879 5.415 0 1.8.665 3.288 1.815 4.324 1.147 1.033 2.757 1.6 4.62 1.6 3.727 0 6.413-2.488 6.413-6.018 0-3.377-2.464-5.807-5.878-5.807m25.779.825c2.07 0 3.739-1.67 3.739-3.761 0-2.07-1.67-3.739-3.739-3.739a3.74 3.74 0 0 0-3.761 3.739 3.743 3.743 0 0 0 3.761 3.761m0-2.497a1.267 1.267 0 0 1-1.264-1.264c0-.671.566-1.242 1.264-1.242.674 0 1.242.568 1.242 1.242 0 .698-.57 1.264-1.242 1.264m-33.634 8.323c0-2.043-1.139-3.272-2.388-3.895 1.208-.629 2.155-1.846 2.155-3.609 0-2.82-2.357-4.822-5.575-4.822-2.04 0-3.724.818-4.871 2.392l-.109.149a1.583 1.583 0 0 0 .32 2.203c.635.476 1.542.411 2.074-.197.09-.103.17-.198.219-.264.553-.755 1.318-1.204 2.297-1.204.72 0 1.309.214 1.715.564.403.347.64.84.64 1.437 0 .608-.242 1.107-.653 1.457-.415.353-1.017.568-1.748.568h-.583a1.481 1.481 0 0 0 0 2.962h.583c.826 0 1.493.233 1.948.61.451.375.709.902.709 1.532 0 .654-.265 1.2-.718 1.586-.455.388-1.116.626-1.916.626-.61 0-1.117-.13-1.548-.375s-.801-.614-1.125-1.114a11 11 0 0 0-.206-.296 1.653 1.653 0 0 0-2.417-.292c-.577.49-.774 1.335-.356 2.004.075.119.152.236.23.339.704.945 1.462 1.652 2.352 2.121.892.47 1.9.692 3.094.692 3.383 0 5.877-2.121 5.877-5.174m7.32 2.095c-.934 0-1.7-.299-2.232-.8-.53-.5-.843-1.217-.843-2.092 0-.863.313-1.581.844-2.085s1.298-.807 2.232-.807c.92 0 1.682.303 2.21.807.529.503.842 1.222.842 2.085 0 .875-.314 1.593-.84 2.093-.53.5-1.29.799-2.212.799Zm14.176 3.032c2.044 0 3.772-.887 4.983-2.425 1.208-1.534 1.894-3.703 1.894-6.266s-.686-4.732-1.894-6.266c-1.211-1.539-2.94-2.426-4.983-2.426-2.044 0-3.773.887-4.984 2.426-1.208 1.534-1.894 3.703-1.894 6.266s.686 4.732 1.894 6.266c1.211 1.538 2.94 2.425 4.984 2.425m0-3.08c-1.017 0-1.874-.518-2.487-1.478-.618-.968-.984-2.382-.984-4.133 0-1.752.366-3.166.984-4.133.613-.96 1.47-1.48 2.487-1.48s1.873.52 2.486 1.48c.618.967.984 2.381.984 4.133 0 1.751-.366 3.165-.984 4.133-.613.96-1.47 1.479-2.486 1.479Zm11.312-2.075c2.975 1.567 4.065 3.279 4.065 4.452 0 1.148-.983 2.756-4.259 4.347-3.16 1.536-7.937 2.773-14.17 3.412a1.75 1.75 0 0 0 .358 3.482c6.45-.662 11.673-1.963 15.342-3.746 3.551-1.725 6.229-4.216 6.229-7.495 0-3.213-2.661-5.825-5.935-7.548a1.75 1.75 0 1 0-1.63 3.096"></path></g><defs><filter id="a" width="75" height="44" x=".5" y=".5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_618_12297"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_618_12297" result="shape"></feBlend></filter></defs></svg>');function vs(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=gs();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"76",height:"45",fill:"none","data-testid":"video-360-icon",role:"img",...i}))),ji(e,r)}var bs={auto_quality_invariant:"Авто",auto_quality:"Авто ({actual})",auto_quality_option:"Авто",other_quality:"Другое",high_quality:"Высокое качество",high_quality_description:"Будет использовано больше трафика",auto_quality_limit:"Автоматически",traffic_saving_quality:"Экономия трафика",traffic_saving_quality_description:"Видео грузятся быстрее, но качество ниже",default_quality_for_any_video:"Качество для всех видео",quality_applience:"Качество по умолчанию можно {action}",quality_applience_action:"изменить",menu_quality:"Качество",menu_traffic_saving:"Экономия данных",menu_playback_rate:"Скорость",menu_report:"Сообщить о проблеме",menu_pip:"Картинка в картинке",menu_copy_video_link:"Скопировать ссылку на видео",menu_copy_video_link_with_timestamp:"Скопировать ссылку на кадр",menu_video_rotate:"Повернуть",menu_video_loop_on:"Включить повторение",menu_video_loop_off:"Отключить повторение",menu_chromecast:"Chromecast трансляция",menu_copy_debug:"Копировать данные для диагностики",menu_save_debug:"Сохранить данные для диагностики",menu_debug_overlay:"Техническая информация",menu_copy_embed_code:"Копировать код для встраивания",menu_audio_languages:"Звуковая дорожка",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Дорожка {index}",pip_dummy_title:"Видео воспроизводится в режиме картинка в картинке",submenu_quality:"Качество",submenu_playback_rate:"Скорость",submenu_settings:"Настройки",submenu_traffic_saving:"Экономия данных",submenu_audio_languages:"Звуковая дорожка",mobile_unmute:"Включить звук",playing_ads:"Реклама {timeleft}",skip_ads_now:"Пропустить рекламу",skip_ads_after:"Пропустить {time}с",visit_advertiser:"Перейти на сайт",aria_timeline:"Ползунок временной шкалы",aria_timeline_value:"{position} (общая длительность {duration}",aria_open_settings:"Открыть настройки видеоплеера",doubletap_seek_step:"{seconds} секунд",playback_rate_1:"Обычная",playback_rate:"{multiplier}x",video360:"панорамное видео",subtitles_caption:"Субтитры",subtitles_auto:"{language} (Автоматические)",subtitles_off:"Выкл.",subtitles_auto_caption:"Автоматические субтитры",subtitles_turn_on:"Включить субтитры",subtitles_turn_off:"Выключить субтитры",traffic_saving_off:"Откл.",traffic_saving_on:"Вкл.",traffic_saving_disable:"Отключена",traffic_saving_enable:"Включена",traffic_saving_helper_text:"При включении качество видео будет снижено для экономии трафика",tooltip_button_disabled:"Кнопка недоступна",tooltip_previous:"Предыдущее видео",tooltip_restart:"Начать заново",tooltip_play:"Смотреть",tooltip_pause:"Пауза",tooltip_next:"Следующее видео",tooltip_interactive_go_back:"Вернуться к предыдущей главе",tooltip_interactive_go_back_disabled:"История прохождения недоступна",tooltip_interactive_go_back_disabled_first:"Вы смотрите первую главу",tooltip_interactive_go_back_disabled_limit:"Лимит возвратов исчерпан",tooltip_chapter_without_interactive:"В этой главе нет интерактива",tooltip_interactive_of_chapter_completed:"Интерактивы этой главы уже пройдены",tooltip_interactive_seek:"Перейти к интерактиву",tooltip_interactive_graph_off:"Показать карту сюжета",tooltip_interactive_graph_on:"Скрыть карту сюжета",tooltip_live:"Перемотать на актуальный лайв",tooltip_episodes:"Эпизоды",tooltip_volume:"Включить звук",tooltip_volume_muted:"Выключить звук",tooltip_sound_unavailable:"Звук недоступен",tooltip_subtitles_off:"Включить субтитры",tooltip_subtitles_on:"Выключить субтитры",tooltip_settings_off:"Открыть настройки",tooltip_settings_on:"Закрыть настройки",tooltip_fullscreen_off:"На весь экран",tooltip_fullscreen_on:"Выйти из полноэкранного режима",tooltip_chromecast_off:"Включить Chromecast",tooltip_chromecast_on:"Выключить Chromecast",tooltip_episode_finished:"Вы уже сделали свой выбор",tooltip_episode_unfinished:"Не пройдено",tooltip_disabled_when_interactive:"Интерактив уже идёт",tooltip_disabled_when_graph_on:"Кнопка недоступна во время просмотра карты",tooltip_interactive_interaction_time_indicator:"Нажмите на элемент интерактива",tooltip_vk_logo:"Открыть в VK Видео",tooltip_vk_video_logo:"Перейти в VK Видео",tooltip_autoplay_off:"Включить автовоспроизведение",tooltip_autoplay_on:"Отключить автовоспроизведение",download_video_caption:"Скачать видео",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Быстрые клавиши",hotkey_map_modal_close_btn_text:"Закрыть",hotkey_map_group_title_common:"Общие",hotkey_map_group_title_playback:"Воспроизведение",hotkey_map_group_title_subtitles:"Субтитры",hotkey_map_group_title_episodes:"Эпизоды",hotkey_map_item_mute_description:"Включить или отключить звук",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Увеличить громкость",hotkey_map_item_volume_up_value:"Стрелка вверх",hotkey_map_item_volume_down_description:"Уменьшить громкость",hotkey_map_item_volume_down_value:"Стрелка вниз",hotkey_map_item_pip_description:"Свернуть или развернуть мини-проигрыватель",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Включить или выключить полноэкранный режим",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Скрыть или показать контекстное меню",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Скрыть или показать список горячих клавиш",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Приостановить или продолжить воспроизведение",hotkey_map_item_play_toggle_value:"Пробел (или k)",hotkey_map_item_seek_backward_description:"Перемотать ролик на 10 секунд назад",hotkey_map_item_seek_backward_value:"Стрелка влево (или j)",hotkey_map_item_seek_forward_description:"Перемотать ролик на 10 секунд вперёд",hotkey_map_item_seek_forward_value:"Стрелка вправо (или l)",hotkey_map_item_fast_seek_backward_description:"Ускоренная перемотка назад",hotkey_map_item_fast_seek_backward_value:"Shift + Стрелка влево",hotkey_map_item_fast_seek_forward_description:"Ускоренная перемотка вперёд",hotkey_map_item_fast_seek_forward_value:"Shift + Стрелка вправо",hotkey_map_item_rate_down_description:"Уменьшить скорость воспроизведения",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Увеличить скорость воспроизведения",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Перейти к предыдущему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Перейти к следующему кадру <br />(когда воспроизведение приостановлено)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Перейти к определённому моменту видео <br />(например, при нажатии на цифру «7» ролик будет перемотан до временной отметки, которая соответствует 70% от длительности видео)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Включить или отключить субтитры",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Перейти к предыдущему эпизоду",hotkey_map_item_prev_episode_pc_value:"Ctrl + Стрелка влево",hotkey_map_item_prev_episode_mac_value:"Option + Стрелка влево",hotkey_map_item_next_episode_description:"Перейти к следующему эпизоду",hotkey_map_item_next_episode_pc_value:"Ctrl + Стрелка вправо",hotkey_map_item_next_episode_mac_value:"Option + Стрелка вправо",hotkey_map_item_next_video_description:"Перейти к следующему видео",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Перейти к предыдущему видео",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"дн",waiting_live_hour_value:"ч",waiting_live_minute_value:"мин",waiting_live_second_value:"сек",waiting_live_colon:":",waiting_live_upcoming_title:"Трансляция еще не началась",waiting_live_timer_title:"До начала трансляции осталось",waiting_live_recover_title:"Трансляция приостановлена - она продолжится, когда автор вернётся",waiting_record_title:"Трансляция завершена - запись появится позже",aria_label_video_player:"Видео плеер",aria_label_spherical_control:"Контроллер для сферического видео. Используйте клавиши со стрелками для панорамирования видео.",aria_label_debug_panel:"Область с технической информацией, сделайте скриншот для техподдержки",aria_label_new_tab_alert:"Откроется в новой вкладке.",aria_label_context_menu_open:"Открыть контекстное меню",aria_label_context_menu_close:"Закрыть контекстное меню",aria_label_menu_quality:"Качество: {actual}",aria_label_menu_audio_languages:"Язык аудио: {actual}",aria_label_menu_rate:"Скорость: {actual}",aria_label_menu_subtitle:"Субтитры: {actual}",aria_label_menu_download:"Скачать видео",aria_label_menu_debug_overlay_enable:"Включить отображение технической информации",aria_label_menu_debug_overlay_disable:"Выключить отображение технической информации",aria_label_menu_rotate:"Повернуть видео на 90 градусов",aria_label_menu_loop:"Переключение режима повторения",aria_label_submenu_back:"Вернуться в меню настроек",aria_label_submenu_traffic_saving_off:"Выключить режим экономии данных",aria_label_submenu_traffic_saving_on:"Включить режим экономии данных",end_screen_next_video:"Следующее видео",end_screen_recommended_video:"Рекомендуемое видео",slow_video_notification_button:"Выбрать качество «Авто»",slow_video_notification_force_description:"Видео грузится слишком медленно,\nкачество изменено на «Авто»",slow_video_notification_suggest_description:"Видео загружается слишком медленно -\nпопробуйте изменить качество на «Авто»"},_s={mobile_unmute:"Unmute",auto_quality_invariant:"Auto",auto_quality:"Auto ({actual})",auto_quality_option:"Auto",other_quality:"Other",high_quality:"High quality",high_quality_description:"Uses more data",auto_quality_limit:"Auto",traffic_saving_quality:"Data saving",traffic_saving_quality_description:"Videos load faster but at lower quality",quality_applience:"You can {action} the default quality",quality_applience_action:"change",default_quality_for_any_video:"Quality for all videos",menu_quality:"Quality",menu_playback_rate:"Playback rate",menu_traffic_saving:"Data saving",menu_report:"Report a problem",menu_pip:"Picture in picture",menu_copy_video_link:"Copy video link",menu_copy_video_link_with_timestamp:"Copy link with timestamp",menu_video_rotate:"Rotate",menu_video_loop_on:"Enable loop",menu_video_loop_off:"Disable loop",menu_chromecast:"Chromecast stream",menu_copy_debug:"Copy debug info",menu_save_debug:"Save debug info",menu_debug_overlay:"Tech stats",menu_copy_embed_code:"Copy embed code",menu_audio_languages:"Audio track",audio_stream_display_language_label:"{label} ({language})",audio_stream_display_language_label_index:"{label} {index} ({language})",audio_stream_display_label_index:"{label} {index}",audio_stream_display_language_index:"{language} {index}",audio_stream_display_unknown:"Audio track {index}",pip_dummy_title:"Video plays in picture-in-picture mode",submenu_quality:"Quality",submenu_playback_rate:"Playback rate",submenu_traffic_saving:"Data saving",submenu_settings:"Settings",submenu_audio_languages:"Audio track",playing_ads:"Ads {timeleft}",skip_ads_after:"Skip ads",skip_ads_now:"Skip {time}s",visit_advertiser:"Visit site",aria_timeline:"Time scale slider",aria_timeline_value:"{position} out of {duration}",aria_open_settings:"Open video player settings",doubletap_seek_step:"{seconds} seconds",playback_rate_1:"Normal",playback_rate:"{multiplier}x",video360:"spherical video",subtitles_caption:"Subtitles",subtitles_auto:"{language} (Auto-generated)",subtitles_off:"Off",subtitles_auto_caption:"Auto subtitles",subtitles_turn_on:"Turn on subtitles",subtitles_turn_off:"Turn off subtitles",traffic_saving_off:"Off",traffic_saving_on:"On",traffic_saving_disable:"Disabled",traffic_saving_enable:"Enabled",traffic_saving_helper_text:"When turned on the video quality will be reduced to save data",tooltip_button_disabled:"Button disabled",tooltip_previous:"Previous video",tooltip_restart:"Watch again",tooltip_play:"Play",tooltip_pause:"Pause",tooltip_next:"Next video",tooltip_interactive_go_back:"Back to previous chapter",tooltip_interactive_go_back_disabled:"Interactive history unavailable",tooltip_interactive_go_back_disabled_first:"You're watching the first chapter",tooltip_interactive_go_back_disabled_limit:"Go-back limit exceeded",tooltip_chapter_without_interactive:"This chapter has no interactive segment",tooltip_interactive_of_chapter_completed:"Chapter's interactive segments already watched",tooltip_interactive_seek:"Go to interactive",tooltip_interactive_graph_off:"Show interactive graph",tooltip_interactive_graph_on:"Hide interactive graph",tooltip_live:"Go to the live edge",tooltip_episodes:"Episodes",tooltip_volume:"Turn volume off",tooltip_volume_muted:"Turn volume on",tooltip_sound_unavailable:"Sound unavailable",tooltip_subtitles_off:"Turn subtitles on",tooltip_subtitles_on:"Turn subtitles off",tooltip_settings_off:"Open settings",tooltip_settings_on:"Close settings",tooltip_fullscreen_off:"Enter fullscreen mode",tooltip_fullscreen_on:"Exit fullscreen mode",tooltip_chromecast_off:"Turn Chromecast on",tooltip_chromecast_on:"Turn Chromecast off",tooltip_episode_finished:"You have already viewed interactive episode",tooltip_episode_unfinished:"Interactive episode not finished",tooltip_disabled_when_interactive:"Interactive video in progress",tooltip_disabled_when_graph_on:"Button is disabled when graph is opened",tooltip_interactive_interaction_time_indicator:"Press the interactive element",tooltip_vk_logo:"Open in VK Video",tooltip_vk_video_logo:"Go to VK Video",tooltip_autoplay_off:"Turn autoplay on",tooltip_autoplay_on:"Turn autoplay off",download_video_caption:"Download video",hotkey_helper_current_volume:"{value} %",hotkey_map_modal_title:"Keyboard shortcuts",hotkey_map_modal_close_btn_text:"Close",hotkey_map_group_title_common:"Common",hotkey_map_group_title_playback:"Playback",hotkey_map_group_title_subtitles:"Subtitles",hotkey_map_group_title_episodes:"Episodes",hotkey_map_item_mute_description:"Toggle mute",hotkey_map_item_mute_value:"m",hotkey_map_item_volume_up_description:"Increase volume",hotkey_map_item_volume_up_value:"Arrow up",hotkey_map_item_volume_down_description:"Decrease volume",hotkey_map_item_volume_down_value:"Arrow down",hotkey_map_item_pip_description:"Toggle miniplayer",hotkey_map_item_pip_value:"i",hotkey_map_item_full_screen_description:"Toggle full screen",hotkey_map_item_full_screen_value:"f",hotkey_map_item_show_context_menu_description:"Hide or show context menu",hotkey_map_item_show_context_menu_value:"Shift + !",hotkey_map_item_show_hotkey_map_description:"Hide or show list of hotkeys",hotkey_map_item_show_hotkey_map_value:"Shift + ?",hotkey_map_item_play_toggle_description:"Toggle play/pause",hotkey_map_item_play_toggle_value:"Space (or k)",hotkey_map_item_seek_backward_description:"Rewind 10 seconds",hotkey_map_item_seek_backward_value:"Arrow left (or j)",hotkey_map_item_seek_forward_description:"Forward 10 seconds",hotkey_map_item_seek_forward_value:"Arrow right (or l)",hotkey_map_item_fast_seek_backward_description:"Fast rewind",hotkey_map_item_fast_seek_backward_value:"Shift + Arrow left",hotkey_map_item_fast_seek_forward_description:"Fast forward",hotkey_map_item_fast_seek_forward_value:"Shift + Arrow right",hotkey_map_item_rate_down_description:"Decrease playback rate",hotkey_map_item_rate_down_value:"< (Shift + ,)",hotkey_map_item_rate_up_description:"Increase playback rate",hotkey_map_item_rate_up_value:"> (Shift + .)",hotkey_map_item_prev_frame_description:"Previous frame (while paused)",hotkey_map_item_prev_frame_value:",",hotkey_map_item_next_frame_description:"Next frame (while paused)",hotkey_map_item_next_frame_value:".",hotkey_map_item_jump_seek_description:"Seek to specific point in the video (7 advances to 70% of duration)",hotkey_map_item_jump_seek_value:"0, 1, 2, 3, 4, 5, 6, 7, 8, 9",hotkey_map_item_subtitles_toggle_description:"Toggle captions ON/OFF",hotkey_map_item_subtitles_toggle_value:"c",hotkey_map_item_prev_episode_description:"Seek to previous episode",hotkey_map_item_prev_episode_pc_value:"Ctrl + Arrow left",hotkey_map_item_prev_episode_mac_value:"Option + Arrow left",hotkey_map_item_next_episode_description:"Seek to next episode",hotkey_map_item_next_episode_pc_value:"Ctrl + Arrow right",hotkey_map_item_next_episode_mac_value:"Option + Arrow right",hotkey_map_item_next_video_description:"Next video",hotkey_map_item_next_video_value:"Shift + N",hotkey_map_item_prev_video_description:"Previous video",hotkey_map_item_prev_video_value:"Shift + P",waiting_live_day_value:"d",waiting_live_hour_value:"h",waiting_live_minute_value:"min",waiting_live_second_value:"sec",waiting_live_colon:":",waiting_live_upcoming_title:"The broadcast hasn't started yet",waiting_live_timer_title:"Before the start of the broadcast left",waiting_live_recover_title:"The broadcast has been paused - it will resume when the author returns",waiting_record_title:"The broadcast completed - recording will appear later",aria_label_video_player:"Video player",aria_label_spherical_control:"Spherical video control. Use the arrow keys to pan the video.",aria_label_debug_panel:"Technical information area, take a screenshot for technical support",aria_label_new_tab_alert:"Opens in a new tab.",aria_label_context_menu_open:"Open context menu",aria_label_context_menu_close:"Close context menu",aria_label_menu_quality:"Quality: {actual}",aria_label_menu_audio_languages:"Audio language: {actual}",aria_label_menu_rate:"Rate: {actual}",aria_label_menu_subtitle:"Subtitles: {actual}",aria_label_menu_download:"Download video",aria_label_menu_debug_overlay_enable:"Enable display of technical information",aria_label_menu_debug_overlay_disable:"Disable display of technical information",aria_label_menu_rotate:"Rotate video 90 degrees",aria_label_menu_loop:"Toggle loop",aria_label_submenu_back:"Return to settings menu",aria_label_submenu_traffic_saving_off:"Disable data saving mode",aria_label_submenu_traffic_saving_on:"Enable data saving mode",end_screen_next_video:"Next video",end_screen_recommended_video:"Recommended video",slow_video_notification_button:"Select Auto quality",slow_video_notification_force_description:"The video is loading too slowly,\nso the quality was changed to Auto",slow_video_notification_suggest_description:"The video is loading too slowly.\nTry switching the quality to Auto."},ys=new Map;ys.set(m.InterfaceLanguage.EN,_s),ys.set(m.InterfaceLanguage.RU,bs);var ws,Ss,ks=new Map,Ts=({language:e,pack:t,fallback:i})=>{if(ys.has(e)){let i=ys.get(e);ys.set(e,{...i,...t})}else ys.set(e,t);ks.set(e,i)},Es=e=>ys.has(e),xs=(e,t,i,r)=>{let a=ys.get(e)?.[t];if((0,m.isNullable)(a)){let i=ks.get(e)??r;a=(i?ys.get(i):void 0)?.[t]}return(0,m.isNullable)(a)?t+Object.values(i??{}).join(" "):i?a.replaceAll(/{(\w+?)}/g,((e,t)=>i[t]??"")):a},$s=(e,t)=>{let{interfaceLanguage$:i}=Na(),r=aa(i),a=ba();return xs(r,e,t,a.defaultLanguage)};(Ss=ws||(ws={})).fatal="fatal",Ss.error="error",Ss.warning="warning",Ss.log="log",Ss.info="info",Ss.debug="debug",Ss.critical="critical";var Cs=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,As=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension).*?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js))(?::(\d+))?(?::(\d+))?\s*$/i,Ps=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,Ls="?",Ms=/^(?:(\w+):)\/\/(?:([\w-]+)(?::(\w+))?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Is(e){return(e&&e.message||"No error message").split("\n").filter((e=>!!e))[0]}function Rs(e){try{let t=function(e){if(!e.stack)return null;let t,i,r=[],a=e.stack.split("\n");for(let s=0;s<a.length;++s){if(t=Cs.exec(a[s]))i={filename:t[2]&&0===t[2].indexOf("address at ")?t[2].substr(11):t[2],function:t[1]||Ls,lineno:t[3]?+t[3]:null,colno:t[4]?+t[4]:null};else if(t=Ps.exec(a[s]))i={filename:t[2],function:t[1]||Ls,lineno:+t[3],colno:t[4]?+t[4]:null};else{if(!(t=As.exec(a[s])))continue;0===s&&!t[5]&&void 0!==e.columnNumber&&(r[0].column=e.columnNumber+1),i={filename:t[3],function:t[1]||Ls,lineno:t[4]?+t[4]:null,colno:t[5]?+t[5]:null}}!i.function&&i.lineno&&(i.function=Ls),r.push(i)}return r.length?{value:Is(e),type:e.name,stacktrace:{frames:r.reverse()}}:null}(e);if(t)return t}catch{}return{value:Is(e),type:e&&e.name,stacktrace:{frames:[]}}}var Ds=class{prepare(e){return{...this.getRequestBlank(),exception:{values:[Rs(e)]}}}report(e){this.send(this.prepare(e))}send(e){!this.apiUrl||!e||this.createRequest(e)}createRequest(e){let t=new XMLHttpRequest;t.open("POST",this.apiUrl,!0),t.setRequestHeader("Content-type","application/json"),t.setRequestHeader("X-Sentry-Auth",this.authHeader||""),t.send(JSON.stringify(e))}getRequestBlank(){return{platform:"javascript",event_id:"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),sdk:{name:"micro-sentry.javascript.core",version:"0.0.0"},timestamp:Date.now()/1e3,environment:this.environment}}constructor(e){if(e&&e.dsn){let t=Ms.exec(e.dsn),i=t?t.slice(1):[],r=i[5].split("/"),a=r.slice(0,-1).join("/");this.apiUrl=i[0]+"://"+i[3]+(i[4]?":"+i[4]:"")+(a?"/"+a:"")+"/api/"+r.pop()+"/store/",this.authHeader="Sentry sentry_version=7,sentry_key="+i[1]+(i[2]?",sentry_secret="+i[2]:"")}this.environment=e&&e.environment}};function Os(e,t){return"[object RegExp]"===Object.prototype.toString.call(t)?t.test(e):"string"==typeof t&&-1!==e.indexOf(t)}var Bs,Ns=class e extends Ds{get state(){return this._state}clearState(){this._state={}}setTags(e){return this.setKeyState("tags",{...e}),this}setTag(e,t){return this.extendState({tags:{[e]:t}}),this}setExtra(e,t){return this.extendState({extra:{[e]:t}}),this}setExtras(e){return this.setKeyState("extra",{...e}),this}setUser(e){return this.setKeyState("user",{...e}),this}clone(){let t=new e({...this.options,plugins:[]});return t.extendState(this.state),t}withScope(e){let t=this.clone();e(t),t.destroy(),this.setBreadcrumbs(void 0)}addBreadcrumb(e){this.extendState({breadcrumbs:[{timestamp:Date.now()/1e3,...this.beforeBreadcrumb(e)}]})}setBreadcrumbs(e){this.setKeyState("breadcrumbs",e)}captureMessage(e,t){this.send({...this.getRequestBlank(),message:e,level:t})}destroy(){this.destroyed=!0,this.plugins.forEach((e=>{e.destroy&&e.destroy()}))}isIgnoredError(e){return!!this.ignoreErrors.length&&this.getPossibleEventMessages(e).some((e=>this.ignoreErrors.some((t=>Os(e,t)))))}getRequestBlank(){return{request:{url:this.window.location.toString(),headers:{"User-Agent":this.window.navigator.userAgent}},...super.getRequestBlank(),sdk:{name:"micro-sentry.javascript.browser",version:"0.0.0"},...this.state}}send(e){this.destroyed||this.isDeniedUrl(e)||this.isIgnoredError(e)||(super.send(this.beforeSend({release:this.release,...e})),this.setBreadcrumbs(void 0))}getPossibleEventMessages(e){if(e.message)return[e.message];if(e.exception)try{let{type:t="",value:i=""}=e.exception.values&&e.exception.values[0]||{};return[`${i}`,`${t}: ${i}`]}catch{return[]}return[]}isDeniedUrl(e){if(!this.blacklistUrls.length)return!1;let t=this.getEventFilterUrl(e);return!!t&&this.blacklistUrls.some((e=>Os(t,e)))}getEventFilterUrl(e){try{if(e.exception){let t=e.exception.values&&e.exception.values[0].stacktrace&&e.exception.values[0].stacktrace.frames;return t&&t[t.length-1].filename||null}return null}catch{return null}}extendState(e){this._state=Object.keys(e).reduce(((t,i)=>{let r=this._state[i],a=Array.isArray(r)?r:null,s=e[i],n=Array.isArray(s)?s:null;return{...t,[i]:a||n?[...a||[],...n||[]]:{..."string"!=typeof r?r:{},..."string"!=typeof s?s:{}}}}),this._state)}setKeyState(e,t){this._state[e]=t}constructor(e,t=function(){return window}()){super(e),this.options=e,this.window=t,this.destroyed=!1,this._state={};let{plugins:i=[],beforeSend:r=e=>e,beforeBreadcrumb:a=e=>e,blacklistUrls:s=[],ignoreErrors:n=[],release:o}=this.options||{};this.plugins=i.map((e=>new e(this))),this.beforeSend=r,this.beforeBreadcrumb=a,this.blacklistUrls=s,this.ignoreErrors=n,this.release=o}},Vs=null,Us=class{destroy(){this.sentryClient?.destroy(),this.sentrySubscription?.unsubscribe(),Vs=null}logIError(e,t=!1){e.thrown&&this.report(e.thrown,{fatal:t,errorType:e.id,category:e.category},{message:e.message,errorData:e.data})}report(e,t={},i={}){let{sentryClient:r,context:a,options:s}=this,{sampleRate:n=0,whiteErrorIdList:o,whiteErrorCategoryList:l=[],blackErrorIdList:u,blackErrorCategoryList:d}=s,{errorType:c,category:h}=t;if(!((0,m.isNonNullable)(h)&&d.includes(h)||(0,m.isNonNullable)(c)&&u.includes(c))&&(Math.random()<=n||(0,m.isNonNullable)(h)&&l.includes(h)||(0,m.isNonNullable)(c)&&o.includes(c))){Object.keys(t).length&&r.setTags({version:this.version,...t}),(Object.keys(a).length||Object.keys(i).length)&&r.setExtras({...a,...i});try{c&&r.captureMessage(c,t.fatal?ws.fatal:ws.error),r.report(e)}catch(e){console.error(e)}}}static getInstance(){return Vs}constructor(e,t,i={}){!Vs&&e.dsn&&(this.sentryClient=new Ns({dsn:e.dsn,environment:t.env}),this.version=t.version,this.sentrySubscription=new m.Subscription,this.options=e,this.context=i,Vs=this)}},Fs=((Bs=Fs||{}).Thumb="thumb",Bs.Video="video",Bs.Ads="ads",Bs.Crashed="crashed",Bs.LiveWaitingStart="LiveWaitingStart",Bs.LiveWaitingRecover="LiveWaitingRecover",Bs.LiveWaitingRecord="LiveWaitingRecord",Bs),js=e=>{if(e.requestFullscreen)return e.requestFullscreen();if(e.msRequestFullscreen)return e.msRequestFullscreen();if(e.webkitRequestFullscreen)return e.webkitRequestFullscreen();if(e.mozRequestFullScreen)return e.mozRequestFullScreen();let t=e.querySelector("video");return t?.webkitEnterFullscreen?t.webkitEnterFullscreen():Promise.reject()},zs=e=>e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():Promise.reject(),Ws=()=>{let e=document;return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement},qs=()=>!!Ws(),Hs=e=>{document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e)},Ks=e=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e)},Qs=class{isSupported(){return document.pictureInPictureEnabled}isActive(){return this.isSupported()&&!!document.pictureInPictureElement}setContext(e){this.svelteContext=e}async revealPictureInPicture(){this.isRequested&&(this.unregistryEventHandlers(),await this.request(),this.registryEventHandlers())}async request(){if(this.isSupported()&&!this.isActive())try{await(this.videoElement?.requestPictureInPicture())}catch{this.isRequested=!1}}async remove(){!this.isSupported()||!this.isActive()||await document.exitPictureInPicture()}assignPlayerContainer(e){this.isSupported()&&(this.playerContainer=e)}updateVideoElement(){this.isSupported()&&(this.videoElement=this.playerContainer?.querySelector("video"))}registryEventHandlers(){this.videoElement?.addEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.addEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}registryExternalEventHandlers(e){this.externalEventHandlers={...e}}unregistryEventHandlers(){this.videoElement?.removeEventListener("enterpictureinpicture",this.eventHandlers.enterpictureinpicture),this.videoElement?.removeEventListener("leavepictureinpicture",this.eventHandlers.leavepictureinpicture)}async dispose(){this.unregistryEventHandlers(),await this.remove()}onEnterPictureInPicture(e){let t=e.pictureInPictureWindow;t&&(this.info.isActive$.next(!0),this.isRequested=!0,t.addEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.enterpictureinpicture?.(e))}onLeavePictureInPicture(e){let t=e.pictureInPictureWindow;this.info.isActive$.next(!1),this.isRequested=!1,t?.removeEventListener("resize",this.eventHandlers.resize),this.externalEventHandlers.leavepictureinpicture?.(e),this.playerDummyElement?.$destroy()}onResize(e){this.externalEventHandlers.resize?.(e)}setEnabled(e){this.info.isEnabled$.next(e)}constructor({enabled:e=!0}={enabled:!0}){this.isRequested=!1,this.videoElement=void 0,this.playerContainer=void 0,this.externalEventHandlers={},this.eventHandlers={enterpictureinpicture:this.onEnterPictureInPicture.bind(this),leavepictureinpicture:this.onLeavePictureInPicture.bind(this),resize:(0,m.debounceFn)(this.onResize.bind(this),300)},this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:0},this.info.isEnabled$=new m.ValueSubject(e)}};function Gs(e){return e instanceof Qs}Y=!0;var Ys=(e,t)=>{e.stopPropagation(),t()()},Xs=Ni('<div class="skip svelte-1k4i25s"> <svg class="icon svelte-1k4i25s" width="7" height="12" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M0.263627 0.263605C-0.0878444 0.615078 -0.0878429 1.18493 0.26363 1.5364L4.72723 5.99998L0.263627 10.4636C-0.0878444 10.8151 -0.0878429 11.3849 0.26363 11.7364C0.615103 12.0879 1.18495 12.0879 1.53642 11.7364L6.63642 6.63637C6.98789 6.2849 6.98789 5.71505 6.63642 5.36358L1.53642 0.263602C1.18495 -0.0878686 0.615098 -0.0878673 0.263627 0.263605Z"></path></svg></div>'),Zs=Ni("<div><!></div>"),Js={hash:"svelte-1k4i25s",code:".container.svelte-1k4i25s {position:absolute;top:14px;right:16px;padding:6px 10px;font-size:13px;color:#fff;background:rgba(0, 0, 0, 0.56);border-radius:6px;transition:color .2s;}.container-mobile.svelte-1k4i25s {bottom:14px;top:unset;font-size:15px;max-width:142px;}.icon.svelte-1k4i25s {margin-left:4px;position:relative;top:2px;fill:var(--white);transition:fill .2s;}.skip.svelte-1k4i25s {width:86px;}.skippable.svelte-1k4i25s {cursor:pointer;color:var(--white);}.skippable.svelte-1k4i25s:hover {color:rgba(255, 255, 255, .75);}.skippable.svelte-1k4i25s:hover .icon:where(.svelte-1k4i25s) {fill:rgba(255, 255, 255, .75);}"};Ri(["click"]);var en=Ni('<button class="svelte-1wy3dql"> </button>'),tn={hash:"svelte-1wy3dql",code:"button.svelte-1wy3dql {position:absolute;pointer-events:none;bottom:14px;left:16px;font-size:15px;background:white;border:none;padding:6px 10px;border-radius:6px;color:black;}"};var rn=Ni('<div class="top-gradient-mobile svelte-354ajf"></div>'),an=Ni('<div class="container svelte-354ajf"><!> <video style="width: 100%; height: 100%" playsinline=""></video> <!> <!> <!></div>',2),sn={hash:"svelte-354ajf",code:".container.svelte-354ajf {width:100%;height:100%;}.top-gradient-mobile.svelte-354ajf {position:absolute;width:100%;height:80px;top:0;left:0;pointer-events:none;background:linear-gradient(\n      360deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.05) 12%,\n      rgba(0, 0, 0, 0.15) 25%,\n      rgba(0, 0, 0, 0.3) 45%,\n      rgba(0, 0, 0, 0.4) 57%,\n      rgba(0, 0, 0, 0.5) 77%,\n      rgba(0, 0, 0, 0.55) 88%,\n      rgba(0, 0, 0, 0.65) 100%\n    );}"};function nn(e,t){pi(t,!0),mr(e,sn);let[i,r]=la(),a=()=>oa(y,"$adPlaybackState",i),s=()=>oa(f,"$isMobile",i),n=fa(t,"adsSlotId",3,void 0),o=fa(t,"adsParams",3,void 0),l=fa(t,"adsPreviewParam",3,void 0),u=fa(t,"adsAutoplayParam",3,void 0),d=fa(t,"duration",3,0),c=Na(),h=ba(),p=c.state.isEnded$,f=c.ui.isMobile,g=h.ads.isMobileGoToSiteButton,v=te(void 0),b=te(void 0),_=!1,y=c.ads.playbackState,w=c.ads.canSkip,S=c.ads.position,k=c.ads.secondsToWatchBeforeSkip,T=ne((()=>oa(w,"$canSkipAd",i)&&"inactive"!==a())),E=ne((()=>s()&&"inactive"!==a()&&g));Xr((()=>{let e=c.getAdmanWrapper();if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_mount"],numbers:[(0,m.now)(),n()]}),!n())return void e.onAdmanLoadingError();let t=t=>{e.initAdman(t),_=!0},i=new AbortController,{width:r,height:a}=aa(c.ui.playerSize),s={width:r,height:a,isFullscreen:aa(c.ui.isFullscreen),isAutoplay:u()??aa(c.ui.isAutoplay),adsContainer:xt(v),adsVideoElement:xt(b),slotId:n(),params:o(),previewParam:l(),duration:d()};return window.AdmanHTML?t(s):e.loadAdman(i.signal).then((()=>{t(s)})).catch((()=>{e.onAdmanLoadingError()})),()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_unmount"],numbers:[(0,m.now)(),n()]}),!_&&i.abort()}}));var x=an(),$=Oe(x),C=e=>{ji(e,rn())};Zi($,(e=>{s()&&e(C)}));var A=Ne($,2);Qr(A,(e=>re(b,e)),(()=>xt(b)));var P=Ne(A,2),L=e=>{!function(e,t){pi(t,!0),mr(e,Js);let[i,r]=la(),a=fa(t,"position",3,0),s=fa(t,"secondsToWatchBeforeSkip",3,0),n=fa(t,"skipAd",3,m.noop),o=Na().ui.isMobile,l=ne((()=>a()>0&&a()>=s()));var u=Zs();let d;var c=Oe(u),h=e=>{var t=Xs();t.__click=[Ys,n];var i=Oe(t);$e(),xe(t),Bt((e=>qi(i,`${e??""} `)),[()=>$s("skip_ads_now")]),ji(e,t)},p=e=>{var t=Ui();Bt((e=>qi(t,e)),[()=>$s("skip_ads_after",{time:Math.ceil(s()-a()).toFixed(0)})]),ji(e,t)};Zi(c,(e=>{xt(l)?e(h):e(p,!1)})),xe(u),Bt((e=>d=wr(u,1,"container svelte-1k4i25s",null,d,e)),[()=>({"container-mobile":oa(o,"$isMobile",i),skippable:xt(l)})]),ji(e,u),fi(),r()}(e,{get position(){return oa(S,"$adPosition",i)},get secondsToWatchBeforeSkip(){return oa(k,"$secondsToWatchBeforeSkipAd",i)},get skipAd(){return c.actions.internal.skipAd}})};Zi(P,(e=>{xt(T)&&e(L)}));var M=Ne(P,2),I=e=>{!function(e,t){pi(t,!1);let i=Na();Xr((()=>{i.getAdmanWrapper().startPostroll()})),Gr(),fi()}(0,{})};Zi(M,(e=>{oa(p,"$isVideoEnded",i)&&e(I)}));var R=Ne(M,2),D=e=>{!function(e,t){pi(t,!1),mr(e,tn),Gr();var i=en(),r=Oe(i,!0);xe(i),Bt((e=>qi(r,e)),[()=>$s("visit_advertiser")],oe),ji(e,i),fi()}(e,{})};Zi(R,(e=>{xt(E)&&e(D)})),xe(x),Qr(x,(e=>re(v,e)),(()=>xt(v))),ji(e,x),fi(),r()}var on=e=>{if(!isFinite(e))return"00:00";let t=Math.round(e),i=Math.floor(t/3600);t-=3600*i;let r=Math.floor(t/60);t-=60*r;let a=[r,t].map((e=>String(e).padStart(2,"0"))).join(":");return i>0&&(a=`${i}:${a}`),a},ln=Vi('<svg><!><path fill="none" stroke="var(--btn-color, #fff)" stroke-width="2" d="M6.41 1A6.46 6.46 0 0 0 3 1.55 3.5 3.5 0 0 0 1.55 3 6.46 6.46 0 0 0 1 6.41v7.18A6.46 6.46 0 0 0 1.55 17 3.5 3.5 0 0 0 3 18.45a6.46 6.46 0 0 0 3.41.55h29.18a6.46 6.46 0 0 0 3.41-.55A3.5 3.5 0 0 0 40.45 17a6.46 6.46 0 0 0 .55-3.41V6.41A6.46 6.46 0 0 0 40.45 3 3.5 3.5 0 0 0 39 1.55 6.46 6.46 0 0 0 35.59 1z"></path><path fill="var(--btn-color, #f0f2f5)" fill-rule="evenodd" d="M8 5a1 1 0 0 1 1 1v7h3a1 1 0 0 1 1 .88V14a1 1 0 0 1-1 1H8a1 1 0 0 1-1-.77v-.11A.5.5 0 0 1 7 14V6a1 1 0 0 1 .88-1zm8 0a1 1 0 0 1 1 1v8a1 1 0 0 1-.88 1H16a1 1 0 0 1-1-1V6a1 1 0 0 1 .88-1zm18 0a1 1 0 0 1 1 .88V6a1 1 0 0 1-1 1h-3v2h3a1 1 0 0 1 1 .88V10a1 1 0 0 1-1 1h-3v2h3a1 1 0 0 1 1 .88V14a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-.77v-.11a.5.5 0 0 1 0-.12V6a1 1 0 0 1 .56-.9A1 1 0 0 1 30 5zm-8 0a1 1 0 0 1 1 1v.1a.9.9 0 0 1-.11.35l-2.47 7.57a1.48 1.48 0 0 1-1.32.98h-.2a1.48 1.48 0 0 1-1.31-.95l-2.47-7.57a.9.9 0 0 1-.12-.36V6a1 1 0 0 1 .88-1H20a1 1 0 0 1 1 1v-.1l2 6.4 2-6.4a1 1 0 0 1 1-.9"></path></svg>');var un=Vi('<svg><!><rect width="42" height="20" fill="var(--timeline-slider-filled-active-live-bg, #FF3347)" rx="5"></rect><path fill="#F2F3F5" fill-rule="evenodd" d="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1m7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2zm-8.325 9.31-2.55-7.824a1 1 0 0 1-.117-.363L19 6.1h.005a1 1 0 1 1 1.99-.199L21 5.9l2 6.4 2-6.4h.005a1 1 0 0 1 1.99.2H27l-.008.023a1 1 0 0 1-.118.363l-2.55 7.824a1 1 0 0 1-.95.69h-.748a1 1 0 0 1-.95-.69z" clip-rule="evenodd"></path></svg>');function dn(e,t){let i=fa(t,"isActive",3,!1);var r=Fi(),a=Be(r),s=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=un();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"42",height:"20",fill:"none","aria-hidden":"true","data-testid":"live-active-icon",role:"img",...i}))),ji(e,r)}(e,{})},n=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=ln();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"42",height:"20","aria-hidden":"true","data-testid":"live-icon",role:"img",...i}))),ji(e,r)}(e,{})};Zi(a,(e=>{i()?e(s):e(n,!1)})),ji(e,r)}var cn=Ni('<div class="equalizer svelte-1s15d2i"><div class="col svelte-1s15d2i"></div> <div class="col svelte-1s15d2i"></div> <div class="col svelte-1s15d2i"></div></div>'),hn=Ni('<div class="live-icon svelte-1s15d2i"><!></div>'),pn=Ni('<span class="text svelte-1s15d2i"> </span>'),fn=Ni("<div><!> <!></div>"),mn={hash:"svelte-1s15d2i",code:".wrapper.svelte-1s15d2i {padding:2px 6px;white-space:nowrap;border-radius:4px;background-color:var(--black-alpha-40);transition:visibility var(--controls-transition-duration),\n      opacity var(--controls-transition-duration);}.wrapper.live.svelte-1s15d2i {font-size:0;line-height:20px;height:20px;border-radius:2px;background:var(--red);padding:0 7px;}.equalizer.svelte-1s15d2i {display:inline-block;vertical-align:middle;position:relative;width:10px;height:10px;margin-top:-4px;margin-right:4px;}.live.svelte-1s15d2i .equalizer:where(.svelte-1s15d2i) {margin-top:-2px;}.equalizer.svelte-1s15d2i .col:where(.svelte-1s15d2i) {width:2px;height:10px;margin-right:2px;background:var(--btn-color, --white);position:absolute;bottom:0;transform-origin:50% 100%;\n    animation: 1.5s infinite linear alternate;animation-play-state:paused;}.playing.svelte-1s15d2i .equalizer:where(.svelte-1s15d2i) .col:where(.svelte-1s15d2i) {animation-play-state:running;}.equalizer.svelte-1s15d2i .col:where(.svelte-1s15d2i):nth-child(1) {left:0;\n    animation-name: svelte-1s15d2i-thumb-timer-equalizer-col1;}.equalizer.svelte-1s15d2i .col:where(.svelte-1s15d2i):nth-child(2) {left:3px;\n    animation-name: svelte-1s15d2i-thumb-timer-equalizer-col2;}.equalizer.svelte-1s15d2i .col:where(.svelte-1s15d2i):nth-child(3) {left:6px;\n    animation-name: svelte-1s15d2i-thumb-timer-equalizer-col3;}.live-icon.svelte-1s15d2i {display:inline-block;vertical-align:middle;width:42px;height:20px;margin:0 -7px;}\n\n  @keyframes svelte-1s15d2i-thumb-timer-equalizer-col1 {\n    0% {\n      transform: scaleY(0.1);\n    }\n\n    25% {\n      transform: scaleY(0.8);\n    }\n\n    50% {\n      transform: scaleY(0.4);\n    }\n\n    75% {\n      transform: scaleY(0.6);\n    }\n\n    100% {\n      transform: scaleY(0.1);\n    }\n  }\n\n  @keyframes svelte-1s15d2i-thumb-timer-equalizer-col2 {\n    0% {\n      transform: scaleY(1);\n    }\n\n    25% {\n      transform: scaleY(0.3);\n    }\n\n    50% {\n      transform: scaleY(0.9);\n    }\n\n    75% {\n      transform: scaleY(0.6);\n    }\n\n    100% {\n      transform: scaleY(1);\n    }\n  }\n\n  @keyframes svelte-1s15d2i-thumb-timer-equalizer-col3 {\n    0% {\n      transform: scaleY(0.6);\n    }\n\n    25% {\n      transform: scaleY(0.9);\n    }\n\n    50% {\n      transform: scaleY(0.1);\n    }\n\n    75% {\n      transform: scaleY(0.9);\n    }\n\n    100% {\n      transform: scaleY(0.6);\n    }\n  }.text.svelte-1s15d2i {font-size:13px;line-height:16px;color:var(--controls-time);font-weight:500;}"};function gn(e,t){mr(e,mn);let i=fa(t,"withEqualizer",3,!1),r=fa(t,"isLive",3,!1),a=fa(t,"isPlaying",3,!1);var s=fn();let n;var o=Oe(s),l=e=>{ji(e,cn())};Zi(o,(e=>{i()&&e(l)}));var u=Ne(o,2),d=e=>{var t=hn();dn(Oe(t),{isActive:!0}),xe(t),ji(e,t)},c=e=>{var i=pn(),r=Oe(i,!0);xe(i),Bt((()=>qi(r,t.time))),ji(e,i)};Zi(u,(e=>{r()?e(d):e(c,!1)})),xe(s),Bt((e=>n=wr(s,1,"wrapper svelte-1s15d2i",null,n,e)),[()=>({live:r(),playing:a()})]),ji(e,s)}var vn=Ni('<div role="timer" data-testid="thumb-timer"><!></div>'),bn={hash:"svelte-1b40w20",code:".thumb-timer.svelte-1b40w20 {position:absolute;z-index:var(--thumb-timer-z-index);bottom:0;right:0;margin:8px;transition:visibility var(--controls-transition-duration),\n      opacity var(--controls-transition-duration);}.thumb-timer.hidden.svelte-1b40w20 {visibility:hidden;opacity:0;}"};function _n(e,t){pi(t,!0),mr(e,bn);let i=fa(t,"isHidden",3,!1),r=fa(t,"isLive",3,!1),a=fa(t,"isPlaying",3,!1),s=ne((()=>on(t.duration-t.position)));var n=vn();let o;gn(Oe(n),{get time(){return xt(s)},get isLive(){return r()},get isPlaying(){return a()},withEqualizer:!0}),xe(n),Bt((e=>o=wr(n,1,"thumb-timer svelte-1b40w20",null,o,e)),[()=>({hidden:i()})]),ji(e,n),fi()}var yn=e=>{if(document.queryCommandSupported&&document.queryCommandSupported("copy")){let t=document.createElement("textarea");t.textContent=e,t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t),t.select();try{document.execCommand("copy")}finally{document.body.removeChild(t)}}},wn=e=>{e.stopPropagation(),e.preventDefault()},Sn=e=>"Escape"===e.code,kn=(e,t=[])=>{let i=e.code;return["Enter","Space",...t].includes(i)},Tn=e=>{if((e=>{let t=e.code;return"Tab"===t&&!e.shiftKey||"ArrowDown"===t})(e))return wn(e),void(e=>{let t=e.nextElementSibling;t||(t=e.parentNode?.firstElementChild),t?.focus()})(e.target);(e=>{let t=e.code;return"Tab"===t||"ArrowUp"===t})(e)&&(wn(e),(e=>{let t=e.previousElementSibling;t||(t=e.parentNode?.lastElementChild),t?.focus()})(e.target))},En=e=>!f.clientChecker.device.isAndroid&&0===e?.detail||f.clientChecker.device.isAndroid&&""===e?.pointerType,xn=async(e,t,i)=>{await Et(),e&&!e.classList.contains("opened")&&!t&&aa(i)&&(await Et(),i.set(!1),e.focus())},$n=async(e,t,i)=>{await Et(),e&&t&&i&&e.children[0]?.focus()},Cn=(e,t)=>{Tn(e),Sn(e)&&(wn(e),t())},An=async(e,t)=>{kn(e,["ArrowRight"])&&(wn(e),t())},Pn=(e,t)=>{kn(e)&&(wn(e),t())},Ln=100,Mn=200,In=300,Rn=400,Dn=500,On=600,Bn=700,Nn=800,Vn=900,Un=1e3,Fn=(e,t)=>{Pn(e,(()=>t()))},jn=Ni('<li class="item svelte-1hm4mm9" role="menuitem" tabindex="0"> </li>'),zn={hash:"svelte-1hm4mm9",code:".item.svelte-1hm4mm9 {padding:8px 16px;cursor:pointer;position:relative;display:block;color:rgba(255, 255, 255, 0.72);font-size:13px;line-height:18px;letter-spacing:-0.14px;white-space:nowrap;}.item.svelte-1hm4mm9:hover {background:rgba(66, 66, 66, .5);color:var(--white);}"};Ri(["click","keydown"]);var Wn=(e,t)=>e.weight-t.weight,qn=(e=>(e.OPEN_SUB_MENU="OPEN_SUB_MENU",e.CLICK="CLICK",e.SWITCH="SWITCH",e))(qn||{}),Hn=(e,t)=>{Cn(e,t)},Kn=e=>{e.preventDefault()},Qn=Ni('<ul role="menu" class="svelte-1p5ukkp"></ul>'),Gn={hash:"svelte-1p5ukkp",code:"ul.svelte-1p5ukkp {position:absolute;z-index:var(--context-menu-z-index);border-radius:8px;background:rgba(0, 0, 0, 0.72);transition:visibility .1s,opacity .1s;list-style:none;margin:0;padding:6px 0;max-height:100%;max-width:100%;overflow-x:hidden;overflow-y:auto;}"};function Yn(e,t){pi(t,!0),mr(e,Gn);let[i,r]=la(),a=()=>oa(x,"$isLooped$",i),s=fa(t,"visible",3,!1),n=fa(t,"position",19,(()=>({top:0,left:0}))),o=fa(t,"playerContainerRef",3,void 0),l=fa(t,"controlsContainerRef",3,void 0),u=fa(t,"menuElementRef",15,void 0),d=te(0),c=te(0),h=Na(),{pictureInPicture$:p}=Va(),g=ba(),v=h.ui.contextMenu.visible$,b=h.ui.debugPanelVisible,_=h.ui.additionalContextMenuItems$,y=h.ui.t,w=h.actions.internal.togglePictureInPicture,S=h.state.chromecastState$,k=h.state.isLive$,T=h.state.positionExact$,E=h.state.isInteractive,x=h.state.looped$,{isEnabled$:$,isActive$:C}=p,A=ne((()=>g.features.copyVideoLink&&h.callbacks?.onCopyVideoLink)),P=ne((()=>xt(A)&&!oa(k,"$isLive$",i)&&!E)),L=ne((()=>!!h.callbacks?.onCopyEmbedCodeClicked)),M=ne((()=>oa($,"$isPiPEnabled$",i)&&oa(S,"$chromecastState$",i)!==f.ChromecastState.CONNECTED&&!E)),I=ne((()=>g.features.videoRotate&&!E)),R=ne((()=>g.showSupport&&!oa(C,"$pictureInPictureApiIsActive$",i))),D=ne((()=>g.features.saveTraceInfoToFile)),O=()=>{v.set(!1),t.returnFocus?.()};Rt((()=>{(async()=>{if(u()&&o()&&l()){await Et();let{top:e,left:t,bottom:i,right:r}=n(),a=t??0,s=e??0,h=u().getBoundingClientRect();(0,m.isNullable)(t)&&!(0,m.isNullable)(r)&&(a=r-h.width),(0,m.isNullable)(e)&&!(0,m.isNullable)(i)&&(s=i-h.height),a=Math.max(a,0),s=Math.max(s,0),((e,t)=>{if(!u()||!o()||!l())return;let i=u().getBoundingClientRect(),r=o().getBoundingClientRect();re(d,e-r.left),re(c,t-r.top),xt(d)+i.width>r.width&&re(d,r.width-i.width),xt(c)+i.height>r.height&&re(c,r.height-i.height),re(d,Ae(Math.max(xt(d),0))),re(c,Ae(Math.max(xt(c),0)))})(a,s)}})()}));let B=()=>{h.actions.internal.videoRotate()},N=()=>{(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),h.actions.internal.reportProblem(),h.actions.internal.pause()},V=()=>{let e=h.actions.internal.getDebugTextData();if(g.features.saveDebugInfoToFile){let t=new Blob([...e],{type:"plain/text"}),i=window.URL.createObjectURL(t);Da(i,"vk_player_debug_info","txt")}else yn(h.actions.internal.getDebugTextData())},U=()=>{let e=h.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Da(i,"vk_player_trace_info","json")},F=()=>{b.set(!0)},j=async()=>{try{w()}finally{t.returnFocus?.()}},z=()=>{h.actions.internal.setLooped(!a())},W=()=>{if(xt(L)){let e=h.callbacks?.onCopyEmbedCodeClicked?.();e&&yn(e)}},q=(e=!1)=>{if(h.callbacks?.onCopyVideoLink){let t=h.callbacks?.onCopyVideoLink(e,oa(T,"$positionExact$",i));t&&yn(t)}},H=ne((()=>g.features.saveDebugInfoToFile?y("menu_save_debug"):y("menu_copy_debug"))),K=ne((()=>xt(A)?{id:"copy-link",weight:Ln,label:y("menu_copy_video_link"),onClick:()=>q()}:void 0)),Q=ne((()=>xt(P)?{id:"copy-link-timestamp",weight:Mn,label:y("menu_copy_video_link_with_timestamp"),onClick:()=>q(!0)}:void 0)),G=ne((()=>xt(L)?{id:"copy-embed-code",weight:In,label:y("menu_copy_embed_code"),onClick:W}:void 0)),Y=ne((()=>xt(M)?{id:"pip",weight:Rn,label:y("menu_pip"),onClick:j}:void 0)),X=ne((()=>({id:"video-loop",weight:Dn,label:a()?y("menu_video_loop_off"):y("menu_video_loop_on"),ariaLabel:y("aria_label_menu_loop"),onClick:z}))),Z=ne((()=>xt(I)?{id:"rotate",weight:On,label:y("menu_video_rotate"),ariaLabel:y("aria_label_menu_rotate"),onClick:B}:void 0)),J=ne((()=>xt(R)?{id:"report",weight:Bn,label:y("menu_report"),ariaLabel:`${y("menu_report")}. ${y("aria_label_new_tab_alert")}`,onClick:N}:void 0)),ee=ne((()=>({id:"save-debug",weight:Nn,label:xt(H),onClick:V}))),ie=ne((()=>xt(D)?{id:"save-trace",weight:Vn,label:y("menu_save_debug"),onClick:U}:void 0)),ae=ne((()=>({id:"debug-info",weight:Un,label:y("menu_debug_overlay"),ariaLabel:oa(b,"$debugPanelVisible",i)?y("aria_label_menu_debug_overlay_disable"):y("aria_label_menu_debug_overlay_enable"),onClick:F}))),se=ne((()=>[xt(K),xt(Q),xt(G),xt(Y),xt(X),xt(Z),xt(J),xt(ee),xt(ie),xt(ae),...oa(_,"$additionalContextMenuItems$",i)].filter((e=>!!e)).sort(Wn)));var oe=Fi(),le=Be(oe),ue=e=>{var t=Qn();t.__contextmenu=[Kn],t.__keydown=[Hn,O],ar(t,21,(()=>xt(se)),(e=>e.id),((e,t)=>{!function(e,t){pi(t,!0),mr(e,zn);let i=fa(t,"onClick",3,m.noop),r=fa(t,"closeContextMenu",3,m.noop),a=e=>{e?.stopPropagation(),i()(),r()()};var s=jn();s.__click=a,s.__keydown=[Fn,a];var n=Oe(s,!0);xe(s),Bt((()=>{Ar(s,"aria-label",t.ariaLabel??t.label),Ar(s,"data-testid",t.id),qi(n,t.label)})),ji(e,s),fi()}(e,{get id(){return xt(t).id},get label(){return xt(t).label},get ariaLabel(){return xt(t).ariaLabel},get onClick(){return xt(t).onClick},closeContextMenu:O})})),xe(t),Qr(t,(e=>u(e)),(()=>u())),Bt((()=>kr(t,`top: ${xt(c)??""}px; left: ${xt(d)??""}px;`))),ji(e,t)};Zi(le,(e=>{s()&&e(ue)})),ji(e,oe),fi(),r()}Ri(["contextmenu","keydown"]);var Xn=class{constructor(e){this.value=e,this.next=null}},Zn=class{push(e){let t=new Xn(e);this.top?(this.top.next=t,this.top=t):(this.top=t,this.bottom=t),this.size++,this.size>this.maxSize&&this.bottom&&(this.bottom=this.bottom.next)}getValuesFromBottom(){let e=[],t=this.bottom;for(;t;)e.push(t.value),t=t.next;return e}constructor(e){this.top=null,this.bottom=null,this.size=0,this.maxSize=e}},Jn=Ni('<div class="container svelte-1ssl9eb"><canvas class="svelte-1ssl9eb"></canvas></div>'),eo={hash:"svelte-1ssl9eb",code:".container.svelte-1ssl9eb {display:inline-block;width:120px;height:16px;}canvas.svelte-1ssl9eb {transform:scale(1, -1);margin-top:2px;}"};function to(e,t){pi(t,!0),mr(e,eo);let i=fa(t,"values",19,(()=>[])),r=te(void 0),a=te(null);function s(e,t,i,r,a){0===a&&(a=1),e.fillStyle="#fff",e.fillRect(t,i,r,a)}Xr((()=>{xt(r).width=120,xt(r).height=16,re(a,Ae(xt(r).getContext("2d")))})),Rt((()=>{let e="";if(xt(a)){let t=i()[0];for(let e=1;e<i().length;e++)i()[e]>t&&(t=i()[e]);xt(a).clearRect(0,0,120,16);let r=59;for(let n=i().length-1;n>=0;n--){let o=2*r,l=t>0?i()[n]/t*16:0;s(xt(a),o,0,2,l),e=l+" "+e,r--}}}));var n=Jn();Qr(Oe(n),(e=>re(r,e)),(()=>xt(r))),xe(n),ji(e,n),fi()}var io=(e,t)=>{e.stopPropagation(),m.safeStorage.remove(_a),t.set(!1)},ro=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Video id</div> <span> </span></div>'),ao=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">VSID</div> <span> </span></div>'),so=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Provider</div> <span> </span></div>'),no=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Streams</div> <span> </span></div>'),oo=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Viewport</div> <span> </span></div>'),lo=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Video size</div> <span> </span></div>'),uo=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">CDN host</div> <span> </span></div>'),co=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Volume</div> <span> </span></div>'),ho=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Buffer</div> <span> </span></div>'),po=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Live latency</div> <span> </span></div>'),fo=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Segment</div> <span> </span></div>'),mo=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">Network</div> <!> <span> </span></div>'),go=Ni('<div class="svelte-4deykz"><div class="svelte-4deykz">V bitrate</div> <!> <span> </span></div>'),vo=Ni('<div role="region"><button class="close svelte-4deykz" title="закрыть">[x]</button> <div class="content svelte-4deykz"><div class="svelte-4deykz"><div class="svelte-4deykz">Version</div> <span> </span></div> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <div class="svelte-4deykz"><div class="svelte-4deykz">Dropped</div> <span> </span></div> <!> <!> <div class="svelte-4deykz"><div class="svelte-4deykz">FPS</div> <!> <span> </span></div></div></div>'),bo={hash:"svelte-4deykz",code:".container.svelte-4deykz {background:rgba(28, 28, 28, 0.8);border-radius:4px;color:#fff;left:20px;position:absolute;z-index:var(--debug-panel-z-index);top:45px;min-width:160px;font-size:10px;text-align:left;user-select:text;}.container-mobile.svelte-4deykz {top:16px;left:16px;}button.svelte-4deykz {position:absolute;right:5px;top:3px;cursor:pointer;outline:0;border:none;background-color:transparent;padding:0;color:#fff;}.content.svelte-4deykz {padding:5px;}.content.svelte-4deykz > div:where(.svelte-4deykz) > div:where(.svelte-4deykz) {display:inline-block;text-align:right;width:60px;padding:0 5px;}"};function _o(e,t){pi(t,!0),mr(e,bo);let[i,r]=la(),a=Na(),s=a.ui.debugPanelVisible,n=a.ui.isMobile,o=te(Ae(a.actions.internal.getDebugPanelData())),l=a.actions.internal.getVideoElement(),u=te(0),d=te(0),c=te(0),h=new Zn(60),p=new Zn(60),f=new Zn(60),g=te(Ae([])),v=te(Ae([])),b=te(Ae([])),_=$s("aria_label_debug_panel");Xr((()=>{m.safeStorage.set(_a,"true"),a.actions.internal.startLogging(),l&&(re(d,Ae(l.getVideoPlaybackQuality().droppedVideoFrames)),re(u,Ae(l.getVideoPlaybackQuality().totalVideoFrames)));let e,t=window.setInterval((()=>{re(o,Ae(a.actions.internal.getDebugPanelData()))}),500);return l&&(e=window.setInterval((()=>{if(l){re(d,Ae(l.getVideoPlaybackQuality().droppedVideoFrames));let e=l.getVideoPlaybackQuality().totalVideoFrames;re(c,e-xt(u)),re(u,Ae(e)),h.push(xt(c)),xt(o).speed&&p.push(xt(o).speed),xt(o).bitrate&&f.push(xt(o).bitrate),re(g,Ae(h.getValuesFromBottom())),re(v,Ae(p.getValuesFromBottom())),re(b,Ae(f.getValuesFromBottom()))}}),1e3)),()=>{a.actions.internal.stopLogging(),clearInterval(t),e&&clearInterval(e)}}));var y=vo();let w;Ar(y,"aria-label",_);var S=Oe(y);S.__click=[io,s];var k=Ne(S,2),T=Oe(k),E=Ne(Oe(T),2),x=Oe(E,!0);xe(E),xe(T);var $=Ne(T,2),C=e=>{var t=ro(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).id))),ji(e,t)};Zi($,(e=>{xt(o).id&&e(C)}));var A=Ne($,2),P=e=>{var t=ao(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).vsid))),ji(e,t)};Zi(A,(e=>{xt(o).vsid&&e(P)}));var L=Ne(A,2),M=e=>{var t=so(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).provider))),ji(e,t)};Zi(L,(e=>{xt(o).provider&&e(M)}));var I=Ne(L,2),R=e=>{var t=no(),i=Ne(Oe(t),2),r=Oe(i);xe(i),xe(t),Bt((()=>qi(r,`Video: ${xt(o).videoCodec||""} ${(xt(o).hdr?"(HDR)":"")??""}\n          &\n          Audio: ${xt(o).audioCodec||""} ${(xt(o).audioLanguage?`(${xt(o).audioLanguage})`:"")??""}`))),ji(e,t)};Zi(I,(e=>{(xt(o).videoCodec||xt(o).audioCodec)&&e(R)}));var D=Ne(I,2),O=e=>{var t=oo(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).viewport))),ji(e,t)};Zi(D,(e=>{xt(o).viewport&&e(O)}));var B=Ne(D,2),N=e=>{var t=lo(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).videoSize))),ji(e,t)};Zi(B,(e=>{xt(o).videoSize&&e(N)}));var V=Ne(B,2),U=e=>{var t=uo(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((()=>qi(r,xt(o).cdn))),ji(e,t)};Zi(V,(e=>{xt(o).cdn&&e(U)}));var F=Ne(V,2),j=e=>{var t=co(),i=Ne(Oe(t),2),r=Oe(i);xe(i),xe(t),Bt((()=>qi(r,`${xt(o).volume??""} %`))),ji(e,t)};Zi(F,(e=>{xt(o).volume&&e(j)}));var z=Ne(F,2),W=e=>{var t=ho(),i=Ne(Oe(t),2),r=Oe(i);xe(i),xe(t),Bt((e=>qi(r,`${e??""} s`)),[()=>xt(o).buffer.toFixed(2)]),ji(e,t)};Zi(z,(e=>{xt(o).buffer&&e(W)}));var q=Ne(z,2),H=e=>{var t=po(),i=Ne(Oe(t),2),r=Oe(i);xe(i),xe(t),Bt((e=>qi(r,`${e??""} s`)),[()=>xt(o).liveLatency.toFixed(2)]),ji(e,t)};Zi(q,(e=>{xt(o).liveLatency&&e(H)}));var K=Ne(q,2),Q=e=>{var t=fo(),i=Ne(Oe(t),2),r=Oe(i,!0);xe(i),xe(t),Bt((e=>qi(r,e)),[()=>[{value:xt(o).currentVideoSegmentLength,title:"Video:"},{value:xt(o).currentAudioSegmentLength,title:"Audio:"}].filter((({value:e})=>e)).map((({value:e,title:t})=>`${t} ${((e??0)/1e3).toFixed(2)} s`)).join(" & ")]),ji(e,t)};Zi(K,(e=>{(xt(o).currentVideoSegmentLength||xt(o).currentAudioSegmentLength)&&e(Q)}));var G=Ne(K,2),Y=Ne(Oe(G),2),X=Oe(Y);xe(Y),xe(G);var Z=Ne(G,2),J=e=>{var t=mo(),i=Ne(Oe(t),2);to(i,{get values(){return xt(v)}});var r=Ne(i,2),a=Oe(r);xe(r),xe(t),Bt((e=>qi(a,`${e??""} Kbps`)),[()=>xt(o).speed.toFixed(2)]),ji(e,t)};Zi(Z,(e=>{xt(o).speed&&e(J)}));var ee=Ne(Z,2),ie=e=>{var t=go(),i=Ne(Oe(t),2);to(i,{get values(){return xt(b)}});var r=Ne(i,2),a=Oe(r);xe(r),xe(t),Bt((e=>qi(a,`${e??""} Kbps`)),[()=>xt(o).bitrate.toFixed(2)]),ji(e,t)};Zi(ee,(e=>{xt(o).bitrate&&e(ie)}));var ae=Ne(ee,2),se=Ne(Oe(ae),2);to(se,{get values(){return xt(g)}});var ne=Ne(se,2),oe=Oe(ne,!0);xe(ne),xe(ae),xe(k),xe(y),Bt((e=>{w=wr(y,1,"container svelte-4deykz",null,w,e),qi(x,xt(o).version),qi(X,`${xt(d)??""} / ${xt(u)??""} frames`),qi(oe,xt(c))}),[()=>({"container-mobile":oa(n,"$isMobile",i)})]),ji(e,y),fi(),r()}Ri(["click"]);var yo=(e,t)=>{e.stopPropagation(),t()()},wo=Ni('<div class="close svelte-1ome55p"></div>'),So={hash:"svelte-1ome55p",code:".close.svelte-1ome55p {cursor:pointer;opacity:0.8;transition:opacity 0.2s;position:relative;width:16px;height:16px;}.close.svelte-1ome55p:hover {opacity:1;}.close.svelte-1ome55p:before, .close.svelte-1ome55p:after {position:absolute;left:8px;content:' ';height:16px;width:2px;background-color:var(--white);}.close.svelte-1ome55p:before {transform:rotate(45deg);}.close.svelte-1ome55p:after {transform:rotate(-45deg);}"};function ko(e,t){pi(t,!0),mr(e,So);let i=fa(t,"onClick",3,m.noop);var r=wo();r.__click=[yo,i],ji(e,r),fi()}Ri(["click"]);var To=Ni('<div class="timer svelte-8jhsry"><canvas class="timer-canvas svelte-8jhsry" width="100" height="100"></canvas> <svg class="timer-play-icon svelte-8jhsry" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><g fill-rule="nonzero"><path class="_play" d="m8.13340613 5.10548415 10.49681277 6.24354325c.3559987.2117494.472936.6720001.2611866 1.0279989-.0638111.1072809-.1533894.1969388-.2606135.2608453l-10.4968128 6.256187c-.35581027.2120659-.81616483.095538-1.02823068-.2602722-.06921066-.1161237-.10574852-.2487949-.10574852-.3839792v-12.49973035c0-.41421357.33578644-.75.75-.75.13495801 0 .26741554.03641567.38340613.1054073z" fill="var(--btn-color, #fff)"></path></g></g></svg></div>'),Eo={hash:"svelte-8jhsry",code:".timer.svelte-8jhsry {border-radius:50%;transition:background .2s;background:rgba(31, 31, 31, .65);width:50px;height:50px;display:flex;align-items:center;justify-content:space-around;}.timer.svelte-8jhsry:hover {background:rgba(31, 31, 31, .85)}.timer-canvas.svelte-8jhsry {width:50px;height:50px;position:absolute;}.timer-play-icon.svelte-8jhsry {width:22px;height:26px;}"};function xo(e,t){pi(t,!0),mr(e,Eo);let i,r,a,s=fa(t,"isRunning",3,!0),n=fa(t,"onTimerEnded",3,m.noop),o=te(void 0),l=te(0);Rt((()=>{s()&&(r=Date.now(),re(l,Ae(requestAnimationFrame(d))))}));let u=()=>{xt(l)&&(cancelAnimationFrame(xt(l)),re(l,0))},d=()=>{s()?(a=(Date.now()-r)/5e3,a<1?(i?.clearRect(0,0,100,100),i?.beginPath(),i?.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*a),i?.stroke(),re(l,Ae(requestAnimationFrame(d)))):n()()):u()};Xr((()=>{if(i=xt(o).getContext("2d"),i)return i.lineWidth=6,i.lineCap="round",i.strokeStyle="#fff",()=>{u()}})),Zr((()=>{u()}));var c=To();Qr(Oe(c),(e=>re(o,e)),(()=>xt(o))),$e(2),xe(c),ji(e,c),fi()}var $o=(e,t,i)=>{t(!1),i()},Co=Ni('<div class="overlay svelte-jfbaax"></div> <div class="next-video svelte-jfbaax"><div class="top svelte-jfbaax"><div class="caption svelte-jfbaax"> </div> <!></div> <div class="row svelte-jfbaax"><div class="column svelte-jfbaax"><div class="thumb svelte-jfbaax"><div></div> <!></div></div> <div class="column svelte-jfbaax"><div class="title svelte-jfbaax"> </div></div></div></div>',1),Ao={hash:"svelte-jfbaax",code:".overlay.svelte-jfbaax {width:100%;height:100%;background:rgba(0, 0, 0, 0.72);position:absolute;}.next-video.svelte-jfbaax {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;width:362px;flex-direction:column;}.top.svelte-jfbaax {display:flex;justify-content:space-between;}.caption.svelte-jfbaax {font-size:11px;font-weight:bold;color:var(--white);text-transform:uppercase;opacity:0.8;}.row.svelte-jfbaax {height:102px;background:rgba(48, 48, 48, .8);cursor:pointer;margin-top:6px;display:flex;flex-direction:row;width:100%;}.column.svelte-jfbaax {display:flex;flex-direction:column;flex-basis:50%;}.thumb.svelte-jfbaax {width:100%;height:100%;background:no-repeat center;background-size:cover;display:flex;align-items:center;position:relative;justify-content:space-around;}.thumb-overlay.svelte-jfbaax {width:100%;height:100%;position:absolute;}.thumb-overlay.withOpacity.svelte-jfbaax {background:var(--black);opacity:0.3;}.title.svelte-jfbaax {padding:10px 16px;font-size:12px;font-weight:bold;color:var(--white);line-height:1.6;max-height:52px;overflow:hidden;}"};function Po(e,t){pi(t,!0),mr(e,Ao);let[i,r]=la(),a=()=>oa(n,"$autoplayNextEnabled$",i),s=Na(),n=s.ui.autoplayNextEnabled$,o=s.ui.timerNextVideoRunning$,l=s.actions.internal.nextVideoClick,u=s.actions.internal.nextVideoAnnouncementShow,d=s.actions.internal.nextVideoAnnouncementClick,c=s.actions.internal.nextVideoAnnouncementAuto,h=s.actions.internal.nextVideoAnnouncementCancel,p=()=>{a()&&(l(!1),c())},f=()=>{t.clickCloseIcon(),h()};Xr((()=>{t.isHide||u(),t.isHide&&a()&&(l(!1),c())}));var m=Fi(),g=Be(m),v=e=>{var r=Co(),s=Ne(Be(r),2),n=Oe(s),u=Oe(n),c=Oe(u,!0);xe(u),ko(Ne(u,2),{onClick:f}),xe(n);var h=Ne(n,2);h.__click=[$o,l,d];var m=Oe(h),g=Oe(m),v=Oe(g);let b;var _=Ne(v,2),y=e=>{let t=ne((()=>oa(o,"$timerNextVideoRunning$",i)&&a()));xo(e,{get isRunning(){return xt(t)},onTimerEnded:p})};Zi(_,(e=>{a()&&e(y)})),xe(g),xe(m);var w=Ne(m,2),S=Oe(w),k=Oe(S,!0);xe(S),xe(w),xe(h),xe(s),Bt(((e,i)=>{qi(c,e),kr(g,`background-image: url('${t.thumb}')`),b=wr(v,1,"thumb-overlay svelte-jfbaax",null,b,i),qi(k,t.title)}),[()=>$s("end_screen_next_video"),()=>({withOpacity:a()})]),ji(e,r)};Zi(g,(e=>{t.isHide||e(v)})),ji(e,m),fi(),r()}Ri(["click"]);var Lo=(e,t)=>Math.min(+(e+t).toFixed(2),1),Mo=(e,t)=>Math.max(+(e-t).toFixed(2),0),Io=(e,t,i)=>{let r=Lo(t,i);t<1&&e.actions.internal.setVolume(r)},Ro=(e,t,i)=>{let r=Mo(t,i);t>0&&e.actions.internal.setVolume(r)},Do=({isAudioDisabled:e,audioDisabledHintCallback:t,isAudioAvailable:i,audioIsNotExistHintCallback:r})=>e?(t?.(),!1):!!i||(r?.(),!1),Oo=(e,t)=>{t(e)},Bo=Ni('<div class="keyboard-controls svelte-10kkmxz" tabindex="-1" role="region"><!></div>'),No={hash:"svelte-10kkmxz",code:".keyboard-controls.svelte-10kkmxz {position:absolute;left:0;right:0;top:0;bottom:0;}"};function Vo(e,t){pi(t,!0),mr(e,No);let[i,r]=la(),a=()=>oa(S,"$playbackState$",i),s=()=>oa(k,"$adPlaybackState",i),n=()=>oa($,"$disabledControls$",i),o=()=>oa(T,"$positionExact$",i),l=()=>oa(E,"$duration$",i),u=()=>oa(F,"$isAudioAvailable$",i),d=()=>oa(x,"$volume$",i),c=()=>oa(L,"$availablePlaybackRates$",i),h=()=>oa(P,"$currentPlaybackRate$",i),p=()=>oa(A,"$currentSubtitle$",i),v=fa(t,"nextButtonActive",3,!1),b=fa(t,"prevButtonActive",3,!1),_=Na(),y=ba(),w=_.getLogger().createComponentLog("KeyboardControls component"),S=_.state.playbackState$,k=_.ads.playbackState,T=_.state.positionExact$,E=_.state.duration$,x=_.state.volume$,$=_.ui.controls.disabledControls$,C=_.state.muted$,A=_.state.currentSubtitle$,P=_.state.currentPlaybackRate$,L=_.state.availablePlaybackRates$,M=_.ui.contextMenu.openedByHotKey$,I=_.ui.contextMenu.lastActiveElem$,R=_.ui.contextMenu.visible$,D=_.ui.contextMenu.position$,O=_.state.isEnded$,B=_.ui.overlayContainer$,V=_.callbacks?.onAudioDoesNotExistHint,U=_.callbacks?.onAudioDisabledHint,F=_.state.isAudioAvailable$,j=_.state.isAudioDisabled,z=_.state.isInteractiveTime$,{showInteractiveTimeIndicatorTooltip$:W}=Va(),q=0,H=!0,K=te(void 0),Q=e=>(e!==H&&(H=e,q=0),q+=1,(y.controls.seekStepKeyboard+y.controls.seekStepKeyboard*q)/1e3),G=(e,r=!1)=>{let S=e.target,k=S?.getAttribute("role")?.includes("menuitem"),T=S.classList.contains("btn"),E=e.code;if(T&&"Space"===E)return!1;let x=Ea.has(E);if(k&&x)return!1;let $=!Ta.has(E);if(e.ctrlKey&&$||e.altKey&&$||e.metaKey)return!1;let A=k&&"Escape"===E;xa.has(E)||A||t.hideContextMenu();let P=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,L=t.isAds&&("paused"===s()||"playing"===s()),N=!L&&!n().has("TIMELINE");if(!P&&!L)return!1;w({message:`key down, code: ${E}, isExternal = ${r}`});let F=!1,q=()=>{F=!0,r||e.preventDefault()};switch(E){case"KeyJ":case"ArrowLeft":if(!N)break;if(e.ctrlKey||e.altKey){let e=_.actions.internal.getPrevEpisode();_.actions.internal.seekToPrevEpisode(e),e&&t.showHotKeyHelpers({type:"EPISODE_PREV",text:e.text}),q()}else{let i=e.shiftKey?Q(!1):y.controls.seekStepKeyboard/1e3,r=Math.max(o()-i,0);o()>0&&(_.actions.internal.seekTime(r,g.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"BACKWARD_SEEK",text:i.toString()}),q())}break;case"KeyL":case"ArrowRight":if(!N)break;if(e.ctrlKey||e.altKey){let e=_.actions.internal.getNextEpisode();_.actions.internal.seekToNextEpisode(e),e&&t.showHotKeyHelpers({type:"EPISODE_NEXT",text:e.text}),q()}else{let i=e.shiftKey?Q(!0):y.controls.seekStepKeyboard/1e3,r=Math.min(o()+i,l());Math.round(o())<Math.round(l())&&(_.actions.internal.seekTime(r,g.SeekAction.DOUBLE_TAP),t.showHotKeyHelpers({type:"FORWARD_SEEK",text:i.toString()}),q())}break;case"ArrowUp":if(Do({isAudioDisabled:j,audioDisabledHintCallback:U,isAudioAvailable:u(),audioIsNotExistHintCallback:V})){let e=d(),i=y.controls.volumeStepKeyboard,r=e<=1;if(Io(_,e,i),r){let r=Math.round(100*Lo(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}q();break;case"ArrowDown":if(Do({isAudioDisabled:j,audioDisabledHintCallback:U,isAudioAvailable:u(),audioIsNotExistHintCallback:V})){let e=d(),i=y.controls.volumeStepKeyboard,r=e>=0;if(Ro(_,e,i),r){let r=Math.round(100*Mo(e,i)).toString();t.showHotKeyHelpers({type:"VOLUME",t:{key:"hotkey_helper_current_volume",value:r}})}}q();break;case"Comma":if(e.shiftKey){_.actions.internal.decrementPlaybackRate();let e=c().find((e=>e.value===h()));t.showHotKeyHelpers({type:"RATE_DOWN",text:e?.displayValue}),q()}else{if(L||a()!==f.PlaybackState.PAUSED)break;let e=Math.max(o()-y.controls.seekStepFrame/1e3,0);o()>0&&(t.showHotKeyHelpers({type:"BACKWARD_SEEK"}),_.actions.internal.clearDelayedBufferingCheckTimeout(),_.actions.internal.seekTime(e,g.SeekAction.DOUBLE_TAP),q())}break;case"Period":if(e.shiftKey){_.actions.internal.incrementPlaybackRate();let e=c().find((e=>e.value===h()));t.showHotKeyHelpers({type:"RATE_UP",text:e?.displayValue}),q()}else{if(L||a()!==f.PlaybackState.PAUSED)break;let e=Math.min(o()+y.controls.seekStepFrame/1e3,l());o()<l()&&(t.showHotKeyHelpers({type:"FORWARD_SEEK"}),_.actions.internal.clearDelayedBufferingCheckTimeout(),_.actions.internal.seekTime(e,g.SeekAction.DOUBLE_TAP),q())}break;case"KeyK":case"Space":if(!n().has("PLAY_BUTTON"))if(oa(z,"$isInteractiveTime$",i)&&oa(W,"$showInteractiveTimeIndicatorTooltip$",i)&&W.set(!1),t.fakePlayButtonHandler)t.fakePlayButtonHandler();else{_.actions.internal.togglePlay();let e="PLAY";a()===f.PlaybackState.PAUSED?e="PAUSE":oa(O,"$isEnded$",i)&&(e="REPLAY"),t.showHotKeyHelpers({type:e})}q();break;case"KeyM":Do({isAudioDisabled:j,audioDisabledHintCallback:U,isAudioAvailable:u(),audioIsNotExistHintCallback:V})&&(t.showHotKeyHelpers({type:oa(C,"$muted$",i)?"VOLUME":"MUTE"}),_.actions.internal.toggleMuted()),q();break;case"KeyF":t.toggleFullscreen(),q();break;case"KeyC":_.actions.internal.toggleSubtitle(),"off"!==p().value?t.showHotKeyHelpers({type:"SUBTITLES_ON",text:p()?.displayValue}):t.showHotKeyHelpers({type:"SUBTITLES_OFF"}),q();break;case"KeyI":_.actions.internal.togglePictureInPicture(),q();break;case"Digit1":case"Numpad1":if(e.shiftKey){let e=(e=>{if(!e)return{top:0,left:0};let t=e.getBoundingClientRect(),i=t.left+8;return{bottom:t.bottom+-58,left:i}})(oa(B,"$overlayContainer$",i));D.set(e),I.set(S),M.set(!0),R.set(!0),q();break}t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.1,g.SeekAction.DOUBLE_TAP),q();break;case"Digit2":case"Numpad2":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.2,g.SeekAction.DOUBLE_TAP),q();break;case"Digit3":case"Numpad3":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.3,g.SeekAction.DOUBLE_TAP),q();break;case"Digit4":case"Numpad4":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.4,g.SeekAction.DOUBLE_TAP),q();break;case"Digit5":case"Numpad5":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.5,g.SeekAction.DOUBLE_TAP),q();break;case"Digit6":case"Numpad6":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.6,g.SeekAction.DOUBLE_TAP),q();break;case"Digit7":case"Numpad7":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.7,g.SeekAction.DOUBLE_TAP),q();break;case"Digit8":case"Numpad8":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.8,g.SeekAction.DOUBLE_TAP),q();break;case"Digit9":case"Numpad9":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(.9,g.SeekAction.DOUBLE_TAP),q();break;case"Digit0":case"Numpad0":t.showHotKeyHelpers(),_.actions.internal.seekToPercent(0,g.SeekAction.DOUBLE_TAP),q();break;case"Slash":e.shiftKey&&y.features.hotKeyMapModal&&(t.showKeyMap(),q());break;case"KeyN":e.shiftKey&&v()&&(_.actions.internal.nextVideoClick(),q());break;case"KeyP":e.shiftKey&&b()&&(_.actions.internal.prevVideoClick(),q());break;case"ShiftLeft":case"ShiftRight":q();break;case"Tab":case"Escape":case"Enter":break;default:(0,m.checkNever)(E)}return F},Y=e=>{let i=e.code;if(e.ctrlKey||e.altKey||e.metaKey)return;let r=a()===f.PlaybackState.PLAYING||a()===f.PlaybackState.PAUSED,n=t.isAds&&("paused"===s()||"playing"===s());if(r||n)switch(i){case"ShiftLeft":case"ShiftRight":q=0}},X=$s("aria_label_video_player");var Z=Bo();Z.__keyup=Y,Z.__keydown=[Oo,G],Ar(Z,"aria-label",X),cr(Oe(Z),(()=>t.children??N)),xe(Z),Qr(Z,(e=>re(K,e)),(()=>xt(K))),ji(e,Z);var J=fi({focus:()=>xt(K)?.focus(),handleExternalKeyboardEvent:e=>"keydown"===e.type?G(e,!0):("keyup"===e.type&&Y(e),!1)});return r(),J}Ri(["keyup","keydown"]);var Uo=Ni('<div class="container svelte-1dbnjb1"><div class="dot svelte-1dbnjb1"></div> <div class="dot svelte-1dbnjb1"></div> <div class="dot svelte-1dbnjb1"></div></div>'),Fo={hash:"svelte-1dbnjb1",code:".container.svelte-1dbnjb1 {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);pointer-events:none;display:flex;}.dot.svelte-1dbnjb1:nth-child(1) {animation-delay:calc(0 * 180ms);}.dot.svelte-1dbnjb1:nth-child(2) {animation-delay:calc(1 * 180ms);}.dot.svelte-1dbnjb1:nth-child(3) {animation-delay:calc(2 * 180ms);}\n\n  @keyframes svelte-1dbnjb1-dot_animation {\n    0% {\n      opacity: 0.2;\n    }\n    30% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 0.2;\n    }\n  }.dot.svelte-1dbnjb1 {border-radius:4px;width:8px;height:8px;background:var(--btn-color);animation-duration:750ms;\n    animation-name: svelte-1dbnjb1-dot_animation;animation-iteration-count:infinite;}.dot.svelte-1dbnjb1 + .dot:where(.svelte-1dbnjb1) {margin-left:4px;}"};function jo(e,t){mr(e,Fo);let i=fa(t,"style",3,"");var r=Uo();Bt((()=>kr(r,i()))),ji(e,r)}var zo=Vi('<svg><!><g filter="url(#a)"><path fill="#fff" d="M7.536 6.264a.9.9 0 0 0-1.272 1.272L10.727 12l-4.463 4.464a.9.9 0 0 0 1.272 1.272L12 13.273l4.464 4.463a.9.9 0 1 0 1.272-1.272L13.273 12l4.463-4.464a.9.9 0 1 0-1.272-1.272L12 10.727z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M7.713 6.087a1.15 1.15 0 1 0-1.626 1.626L10.374 12l-4.287 4.287a1.15 1.15 0 0 0 1.626 1.626L12 13.626l4.287 4.287a1.15 1.15 0 0 0 1.626-1.626L13.626 12l4.287-4.287a1.15 1.15 0 1 0-1.626-1.626L12 10.374z"></path></g><defs><filter id="a" width="23" height="23" x=".5" y=".5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2422_111980"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2422_111980" result="shape"></feBlend></filter></defs></svg>');var Wo=e=>{e.stopPropagation()},qo=Ni("<button><!></button>"),Ho={hash:"svelte-wr0kwr",code:".btn.svelte-wr0kwr {padding:8px;margin:0;height:var(--controls-height);display:flex;flex-direction:row;align-items:center;justify-content:center;}\n\n   /* Ниже идут абстрактные и специфик классы для кнопок которые можно передать через параметр className */.w-max.svelte-wr0kwr {width:100%;}.btn--live.svelte-wr0kwr {padding:10px 4px;}.btn-jc-l.svelte-wr0kwr {justify-content:left;}\n\n\n  /* mobile */\n  /* container mobile */.btn-m.svelte-wr0kwr {position:absolute;left:12px;top:50%;transform:translateY(-50%);height:44px;width:44px;border-radius:12px;background-color:rgba(0, 0, 0, 0.56);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;justify-content:center;}.btn-m--play.svelte-wr0kwr {width:var(--big-play-size);height:var(--big-play-size);display:flex;align-items:center;justify-content:center;position:relative;padding:16px;}.btn-m--play.svelte-wr0kwr svg {transform:scale(2);}.btn-m--prev.svelte-wr0kwr,\n  .btn-m--next.svelte-wr0kwr {position:absolute;width:50px;height:50px;}.btn-m--prev.svelte-wr0kwr {right:calc(100% + 35px);}.btn-m--next.svelte-wr0kwr {left:calc(100% + 35px);}.btn.svelte-wr0kwr:disabled {cursor:default;\n    /* нужно для того, чтобы не давать событиям клика отрабатывать на заблоченном элементе */pointer-events:none;}.btn.svelte-wr0kwr:not(.btn-full-opacity):disabled {opacity:0.4;}.btn.svelte-wr0kwr:not(:disabled):hover {opacity:0.8;}.pr-0.svelte-wr0kwr {padding-right:0;}.pl-0.svelte-wr0kwr {padding-left:0;}"};function Ko(e,t){pi(t,!0),mr(e,Ho);let i=fa(t,"className",3,""),r=fa(t,"style",3,""),a=fa(t,"disabled",3,void 0),s=fa(t,"testId",3,void 0),n=fa(t,"ariaHidden",3,void 0),o=fa(t,"ariaLabel",3,void 0),l=fa(t,"ref",15,void 0),u=fa(t,"ariaKeyShortCut",3,void 0),d=fa(t,"ariaExpanded",3,void 0),c=fa(t,"tabIndex",3,0),h=fa(t,"click",3,m.noop),p=fa(t,"focus",3,m.noop),f=fa(t,"blur",3,m.noop),g=ne((()=>h()===m.noop?null:e=>{e.stopPropagation(),h()(e)})),v=ne((()=>p()===m.noop?null:e=>{e.preventDefault(),p()()})),b=ne((()=>f()===m.noop?null:e=>{e.preventDefault(),f()()}));var _=qo();_.__pointerdown=[Wo],_.__click=function(...e){xt(g)?.apply(this,e)},cr(Oe(_),(()=>t.children??N)),xe(_),Qr(_,(e=>l(e)),(()=>l())),Bt((()=>{wr(_,1,`btn ${i()??""}`,"svelte-wr0kwr"),kr(_,r()||null),_.disabled=a()??null,Ar(_,"aria-hidden",n()??null),Ar(_,"aria-label",o()??null),Ar(_,"aria-keyshortcuts",u()??null),Ar(_,"aria-expanded",d()??null),Ar(_,"data-testid",s()??null),Ar(_,"tabindex",c())})),Ii("focus",_,(function(...e){xt(v)?.apply(this,e)})),Ii("blur",_,(function(...e){xt(b)?.apply(this,e)})),ji(e,_),fi()}Ri(["pointerdown","click"]);var Qo=Ni('<div class="modal-header svelte-1witlsj"><h3 class="modal-title svelte-1witlsj"> </h3> <!></div>'),Go=Ni('<div class="modal-overlay svelte-1witlsj"><div class="modal-container svelte-1witlsj"><!> <div class="modal-scroll svelte-1witlsj"><div class="modal-main svelte-1witlsj"><!></div></div></div></div>'),Yo={hash:"svelte-1witlsj",code:".modal-overlay.svelte-1witlsj {position:absolute;top:0;bottom:0;left:0;right:0;background:transparent;display:flex;align-items:center;justify-content:center;}.modal-container.svelte-1witlsj {display:flex;flex-direction:column;width:calc(100% - 32px);max-width:600px;height:calc(100% - 24px);max-height:490px;background:var(--mobile-settings-bg);color:var(--white);border-radius:8px;}.modal-header.svelte-1witlsj {box-sizing:border-box;display:flex;justify-content:space-between;align-items:start;height:40px;padding:8px 10px;border-bottom:1px solid var(--white-alpha-24);}.modal-title.svelte-1witlsj {margin:3px 0 0 6px;color:var(--white);font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:600;line-height:16px;}.modal-scroll.svelte-1witlsj {overflow-y:auto;overflow-x:hidden;margin:8px 4px 8px 0;height:100%;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar {width:8px;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-track {box-shadow:none;background-color:transparent;border-radius:4px;margin-right:2px;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-thumb {min-height:40px;border-radius:5px;background-color:#666;border:1px solid transparent;background-clip:padding-box;}.modal-scroll.svelte-1witlsj::-webkit-scrollbar-thumb:hover {background-color:#777;}.modal-main.svelte-1witlsj {margin:-8px -4px 0 0;}"};function Xo(e,t){pi(t,!0),mr(e,Yo);let i=fa(t,"showHeader",3,!0),r=fa(t,"showCloseCross",3,!0),a=$s("hotkey_map_modal_close_btn_text");var s=Go(),n=Oe(s),o=Oe(n),l=e=>{var i=Qo(),s=Oe(i),n=Oe(s,!0);xe(s);var o=Ne(s,2),l=e=>{Ko(e,{get click(){return t.onClose},testId:"close-modal",style:"padding: 0; height: 24px; width: 24px",ariaLabel:a,children:(e,t)=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=zo();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"cross-icon",role:"img",...i}))),ji(e,r)}(e,{})},$$slots:{default:!0}})};Zi(o,(e=>{r()&&e(l)})),xe(i),Bt((()=>qi(n,t.title))),ji(e,i)};Zi(o,(e=>{i()&&e(l)}));var u=Ne(o,2),d=Oe(u);cr(Oe(d),(()=>t.children??N)),xe(d),xe(u),xe(n),xe(s),ji(e,s),fi()}var Zo=new Set(["BR"]),Jo=Ni('<li class="hot-key-map-item svelte-quklnq"><span class="hot-key-map-item-description svelte-quklnq"><!></span> <span class="hot-key-map-item-value svelte-quklnq"> </span></li>'),el=Ni('<div class="hot-key-map-group svelte-quklnq"><h5 class="hot-key-map-group-title svelte-quklnq"> </h5> <ul class="hot-key-map-group-items svelte-quklnq"></ul></div>'),tl=Ni('<div class="hot-key-map svelte-quklnq"></div>'),il={hash:"svelte-quklnq",code:".hot-key-map.svelte-quklnq {color:var(--black);box-sizing:border-box;overflow-x:hidden;}.hot-key-map-group.svelte-quklnq {border-bottom:1px solid var(--white-alpha-24);margin:0 20px 0 16px;}.hot-key-map-group.svelte-quklnq:last-child {border-bottom:none;}.hot-key-map-group-title.svelte-quklnq {color:var(--white);font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:600;line-height:16px;}.hot-key-map-group-title.svelte-quklnq,\n  .hot-key-map-item.svelte-quklnq {padding:12px 0;margin:0;width:100%;}.hot-key-map-group-items.svelte-quklnq {box-sizing:border-box;list-style:none;padding:0;margin:0;}.hot-key-map-item.svelte-quklnq {box-sizing:border-box;display:flex;justify-content:space-between;align-items:center;--videoplayer-hotkey-item-value-width: 156px;--videoplayer-hotkey-item-value-padding-left: 24px;}.hot-key-map-item-description.svelte-quklnq {color:var(--white-alpha-72);width:calc(100% - var(--videoplayer-hotkey-item-value-width) - var(--videoplayer-hotkey-item-value-padding-left));max-width:388px;}.hot-key-map-item-value.svelte-quklnq {color:var(--white);width:var(--videoplayer-hotkey-item-value-width);padding-left:var(--videoplayer-hotkey-item-value-padding-left);letter-spacing:-0.14px;}.hot-key-map-item-description.svelte-quklnq,\n  .hot-key-map-item-value.svelte-quklnq {font-feature-settings:'clig' off, 'liga' off;font-size:13px;font-style:normal;font-weight:400;line-height:16px;}"};function rl(e,t){pi(t,!1),mr(e,il);let[i,r]=la(),a=()=>oa(n,"$data",i),s=Na(),{data:n,show:o}=s.ui.modals.hotKeyMap;Gr(),Xo(e,{get title(){return a().title},onClose:()=>{o.set(!1)},children:(e,t)=>{var i=tl();ar(i,5,(()=>a().groups),(({title:e,items:t})=>e),((e,t)=>{var i=el(),r=Oe(i),a=Oe(r,!0);xe(r);var s=Ne(r,2);ar(s,5,(()=>xt(t).items),(({description:e,value:t})=>t),((e,t)=>{var i=Jo(),r=Oe(i);dr(Oe(r),(()=>(e=>{let t=document.createElement("DIV");t.innerHTML=e;let i=t.querySelectorAll("*"),r=i.length;for(;r--;){let e=i[r],t=e.tagName;Zo.has(t)||e.parentElement?.removeChild(e)}return t.innerHTML})(xt(t).description)),!1,!1),xe(r);var a=Ne(r,2),s=Oe(a,!0);xe(a),xe(i),Bt((()=>qi(s,xt(t).value))),ji(e,i)})),xe(s),xe(i),Bt((()=>qi(a,xt(t).title))),ji(e,i)})),xe(i),ji(e,i)},$$slots:{default:!0}}),fi(),r()}var al=Ni('<div class="pillow svelte-1oe0j8n"><!></div>'),sl={hash:"svelte-1oe0j8n",code:".pillow.svelte-1oe0j8n {background-color:#679FF8;color:var(--white);font-size:6px;font-weight:600;-webkit-font-smoothing:antialiased;padding:2px 4px;border-radius:12px;}"};var nl=Vi('<svg><!><path fill="currentColor" d="M5.517 5c.325 0 .516-.198.516-.536v-.97l.492-.517 1.46 1.74c.16.205.304.283.516.283A.49.49 0 0 0 9 4.501c0-.14-.068-.287-.222-.478l-1.47-1.73L8.818.868C8.949.731 9 .618 9 .475A.474.474 0 0 0 8.515 0c-.171 0-.301.065-.445.222L6.064 2.25h-.03V.54c0-.342-.192-.54-.517-.54s-.516.198-.516.54v3.924c0 .338.191.536.516.536"></path><path fill="currentColor" fill-rule="evenodd" d="m2.551 1.052-1.51 2.052h1.51zM3.5 3.104V.832c0-.81-1.089-1.14-1.556-.48L.139 2.821a.75.75 0 0 0 .612 1.183h1.8v.55c0 .248.25.45.499.45a.45.45 0 0 0 .45-.45v-.55h.052a.45.45 0 0 0 0-.9z" clip-rule="evenodd"></path></svg>');function ol(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=nl();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),ji(e,r)}var ll=Vi('<svg><!><path fill="currentColor" d="M5.513 5c.323 0 .513-.198.513-.537v-.97l.49-.516L7.99 4.715c.16.205.302.284.513.284A.49.49 0 0 0 9 4.5c0-.14-.068-.287-.22-.478L7.293 2.293 8.82.868C8.949.731 9 .618 9 .475A.473.473 0 0 0 8.517 0c-.17 0-.299.065-.441.222L6.056 2.25h-.03V.54c0-.342-.19-.54-.513-.54S5 .198 5 .54v3.923c0 .339.19.537.513.537"></path><path fill="currentColor" fill-rule="evenodd" d="M2 0q-.53 0-.952.173a1.5 1.5 0 0 0-.654.484q-.23.312-.23.71c0 .423.208.756.613.995a1.46 1.46 0 0 0-.547.44q-.23.305-.23.71 0 .432.252.778l.001.001q.26.336.712.523Q1.418 5.001 2 5q.582 0 1.035-.186.451-.187.705-.524.26-.346.26-.777 0-.406-.23-.711a1.45 1.45 0 0 0-.552-.44c.409-.235.618-.569.618-.994a1.14 1.14 0 0 0-.238-.711 1.44 1.44 0 0 0-.653-.484A2.4 2.4 0 0 0 2 0m-.573.964C1.563.86 1.75.804 2 .804s.434.055.564.16h.001a.51.51 0 0 1 .204.43.52.52 0 0 1-.204.437c-.13.105-.315.161-.565.161s-.437-.056-.573-.161a.52.52 0 0 1-.203-.437q.002-.276.203-.43m-.345 2.522c0-.217.08-.381.233-.503.16-.122.385-.188.685-.188s.522.066.677.188q.24.181.24.503a.63.63 0 0 1-.24.523c-.155.122-.377.188-.677.188s-.524-.065-.684-.187a.64.64 0 0 1-.234-.524" clip-rule="evenodd"></path></svg>');function ul(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=ll();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),ji(e,r)}var dl=Vi('<svg><!><path fill="currentColor" d="M5.516 5h1.107C8.103 5 9 4.065 9 2.5S8.103 0 6.623 0H5.516C5.191 0 5 .2 5 .537V4.46c0 .342.191.54.516.54m.516-.854V.852H6.5C7.41.852 8 1.468 8 2.5c0 1.066-.577 1.646-1.5 1.646zM.516 5c.325 0 .516-.198.516-.536V2.922h1.936v1.542c0 .338.191.536.516.536S4 4.802 4 4.464V.54C4 .198 3.809 0 3.484 0s-.516.198-.516.54v1.531H1.032V.54C1.032.198.841 0 .516 0S0 .198 0 .54v3.989C0 4.867.191 5 .516 5"></path></svg>');function cl(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=dl();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"5",fill:"none",role:"img",...i}))),ji(e,r)}var hl=Vi('<svg><!><path fill="currentColor" d="M9.516 5h1.107C12.103 5 13 4.065 13 2.5S12.103 0 10.623 0H9.516C9.191 0 9 .2 9 .537V4.46c0 .342.191.54.516.54m.516-.854V.852h.468c.91 0 1.5.616 1.5 1.648 0 1.066-.577 1.646-1.5 1.646zM4.516 5c.325 0 .516-.198.516-.536V2.922h1.936v1.542c0 .338.191.536.516.536S8 4.802 8 4.464V.54C8 .198 7.809 0 7.484 0s-.516.198-.516.54v1.531H5.032V.54c0-.342-.191-.54-.516-.54S4 .198 4 .54v3.989c0 .338.191.471.516.471m-4 0c.325 0 .516-.198.516-.537V3h1.332c.27 0 .441-.154.441-.41 0-.253-.174-.407-.44-.407H1.031V.854h1.5c.28 0 .468-.16.468-.427C3 .161 2.815 0 2.532 0H.516C.191 0 0 .198 0 .537v3.926C0 4.802.191 5 .516 5"></path></svg>');function pl(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=hl();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"13",height:"5",fill:"none",role:"img",...i}))),ji(e,r)}var fl=Vi('<svg><!><path fill="currentColor" d="M11.516 5.75h1.107c1.48 0 2.377-.935 2.377-2.5s-.897-2.5-2.377-2.5h-1.107c-.325 0-.516.199-.516.537V5.21c0 .342.191.54.516.54m.516-.854V1.602h.468c.91 0 1.5.616 1.5 1.648 0 1.066-.577 1.646-1.5 1.646zm-5.516.854c.325 0 .516-.198.516-.536V3.672h1.936v1.542c0 .338.191.536.516.536S10 5.552 10 5.214V1.29c0-.342-.191-.54-.516-.54s-.516.198-.516.54v1.531H7.032V1.29c0-.342-.191-.54-.516-.54S6 .948 6 1.29v3.989c0 .338.191.471.516.471"></path><path fill="currentColor" fill-rule="evenodd" d="M3.338 5.659a4 4 0 0 1-.838.091C1.037 5.75 0 4.885 0 3.303 0 1.733 1.037.75 2.5.75 3.96.75 5 1.734 5 3.303c0 .863-.274 1.46-.778 1.88l.194.29a.5.5 0 0 1-.832.554zm-.52-.78-.234-.352a.5.5 0 1 1 .832-.554l.245.367c.184-.26.286-.615.286-1.037 0-1.036-.64-1.653-1.447-1.653-.81 0-1.447.617-1.447 1.653 0 1.032.637 1.596 1.447 1.596.08 0 .208-.007.318-.02" clip-rule="evenodd"></path></svg>');function ml(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=fl();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"15",height:"7",fill:"none",role:"img",...i}))),ji(e,r)}var gl=e=>{switch(e){case m.VideoQuality.Q_720P:return cl;case m.VideoQuality.Q_1080P:return pl;case m.VideoQuality.Q_1440P:return ml;case m.VideoQuality.Q_2160P:return ol;case m.VideoQuality.Q_4320P:return ul}},vl=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M12.722 2.213c1.208.037 1.994.702 2.408 1.954l.065.215.051.191q.027.111.068.235l.058.159.034.017.069-.023.133-.051.156-.068c1.414-.658 2.502-.536 3.387.437l.125.145.82 1.017c.732.962.71 1.99-.004 3.1l-.125.187-.117.16a3 3 0 0 0-.142.205l-.07.115-.034.057.004.02.091.06.127.077.153.083c1.39.71 1.963 1.641 1.742 2.936l-.038.188-.244 1.058c-.158.685-.282 1.01-.77 1.454-.475.432-1.016.61-1.732.67l-.22.014-.198.006q-.116.002-.246.015l-.181.021.013.142.013.096.033.179c.323 1.526-.04 2.558-1.188 3.202l-.17.09-1.175.57c-1.102.495-2.099.242-3.02-.702l-.153-.164-.13-.15a3 3 0 0 0-.17-.186l-.097-.096-.05-.046-.09.087-.106.108-.118.133c-.952 1.134-1.957 1.54-3.176 1.067l-.175-.074-1.052-.51-.312-.16c-.476-.26-.743-.51-1.004-1.061-.275-.58-.294-1.15-.16-1.883l.044-.225q.024-.114.041-.242l.019-.172-.004-.004-.104-.014-.146-.013-.174-.008c-1.56-.028-2.484-.614-2.853-1.877l-.049-.185-.292-1.274c-.235-1.185.236-2.1 1.364-2.785l.194-.112.175-.093a3 3 0 0 0 .216-.12l.155-.102.004-.019-.063-.108-.08-.125-.103-.143c-.937-1.246-1.044-2.335-.276-3.404l.115-.153.824-1.013c.79-.915 1.8-1.107 3.034-.64l.208.083.181.081q.103.048.222.093l.136.048.036-.017.033-.089.045-.138.046-.166c.36-1.436 1.085-2.242 2.39-2.35l.19-.011h1.39Zm-.056 1.799h-1.333l-.14.01c-.285.037-.472.191-.652.832l-.041.156-.057.206a6.3 6.3 0 0 1-.468 1.134 6 6 0 0 0-1.147.558 6.5 6.5 0 0 1-1.16-.35l-.35-.154c-.248-.107-.435-.161-.583-.175l-.084-.003a.55.55 0 0 0-.408.193l-.068.074-.789.973-.095.125c-.183.264-.21.5.195 1.075l.228.316c.212.31.425.692.598 1.102q-.195.577-.27 1.201c-.334.29-.69.537-1.013.72l-.343.184c-.617.34-.695.563-.646.881l.013.075.28 1.22.04.152c.096.308.265.475.968.509l.388.014c.37.024.798.09 1.223.204q.337.526.776.968a6.3 6.3 0 0 1-.118 1.445c-.201.95-.014 1.102.383 1.3l1.126.547a.8.8 0 0 0 .337.089l.067-.006c.181-.028.382-.162.67-.485l.258-.295a6.5 6.5 0 0 1 .949-.837l.298.023L12 18l.302-.008.298-.022c.363.263.691.559.948.837l.258.295c.325.364.538.488.737.49l.066-.003a.8.8 0 0 0 .178-.046l.093-.039 1.126-.548.139-.073c.3-.175.42-.395.245-1.226a6.2 6.2 0 0 1-.117-1.445q.436-.442.775-.97a6.5 6.5 0 0 1 1.223-.202l.387-.014c.812-.04.912-.256 1.008-.66l.264-1.142c.09-.406.095-.643-.617-1.035l-.342-.183a6.4 6.4 0 0 1-1.014-.722 6 6 0 0 0-.27-1.201c.174-.41.386-.791.598-1.1l.228-.317c.406-.575.378-.81.195-1.075l-.045-.062-.787-.974c-.14-.171-.259-.294-.452-.322l-.076-.007c-.16-.003-.368.05-.667.178l-.35.155a6.4 6.4 0 0 1-1.158.348 6 6 0 0 0-1.15-.556 6.5 6.5 0 0 1-.454-1.093l-.113-.414c-.192-.678-.393-.805-.714-.828zM12 8.2a3.8 3.8 0 1 1 0 7.6 3.8 3.8 0 0 1 0-7.6m0 1.8a2 2 0 1 0 0 4 2 2 0 0 0 0-4"></path></svg>');var bl=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M13.933 4.875a.6.6 0 0 0-.07-.658c-.327-.413-.45-.833-.574-1.253l-.039-.13C13 2 12.833 2 12.417 2h-.91c-.371.003-.6.052-.757.833-.148.738-.36 1.476-1.566 2.186a.5.5 0 0 1-.12.05c-1.27.324-1.905-.023-2.542-.37l-.12-.065c-.766-.412-.884-.294-1.178 0l-.643.644c-.26.264-.389.461.053 1.124.418.626.789 1.299.438 2.654a.5.5 0 0 1-.05.12c-.668 1.126-1.362 1.33-2.058 1.535l-.13.039C2 11 2 11.167 2 11.583v.91c.003.371.052.6.833.757.738.148 1.476.36 2.186 1.566a.5.5 0 0 1 .05.12c.324 1.27-.023 1.905-.37 2.542l-.065.12c-.412.766-.294.884 0 1.178l.644.643c.264.26.461.389 1.124-.053.626-.418 1.299-.789 2.654-.438q.063.016.12.05c1.126.668 1.33 1.362 1.535 2.058l.039.13c.25.834.417.834.833.834h.91c.371-.003.6-.052.757-.833.148-.738.36-1.476 1.566-2.186a.5.5 0 0 1 .12-.05c1.27-.324 1.905.023 2.542.37l.12.065c.766.412.884.294 1.178 0l.643-.644c.26-.264.389-.461-.053-1.124-.26-.39-.503-.799-.563-1.38a.6.6 0 0 0-.413-.519 7.5 7.5 0 0 1-1.918-.871.58.58 0 0 0-.758.134 4.75 4.75 0 1 1-3.163-7.68.58.58 0 0 0 .633-.44 7.5 7.5 0 0 1 .749-1.967" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M13.25 2.833c.225.751.383 1.502 1.63 2.222 1.399.38 2.082.003 2.718-.42.663-.443.86-.315 1.124-.054l.644.643c.294.294.412.412 0 1.178-.372.69-.792 1.333-.418 2.726.72 1.255 1.47 1.472 2.219 1.622.78.156.83.386.833.757v.91c0 .416 0 .583-.833.833-.751.225-1.502.383-2.222 1.63-.38 1.399-.003 2.082.42 2.718.443.663.315.86.054 1.124l-.643.644c-.294.294-.412.412-1.178 0-.69-.372-1.333-.792-2.726-.418-1.255.72-1.472 1.47-1.622 2.219-.156.78-.386.83-.757.833h-.91c-.416 0-.583 0-.833-.833-.225-.751-.383-1.502-1.63-2.222-1.399-.38-2.082-.003-2.718.42-.663.443-.86.315-1.124.054l-.644-.643c-.294-.294-.412-.412 0-1.178.372-.69.792-1.333.418-2.726-.72-1.255-1.47-1.472-2.219-1.622-.78-.156-.83-.386-.833-.757v-.91c0-.416 0-.583.833-.833.751-.225 1.502-.383 2.222-1.63.38-1.399.003-2.082-.42-2.718-.443-.663-.315-.86-.054-1.124l.643-.644c.294-.294.412-.412 1.178 0 .69.372 1.333.792 2.726.418 1.255-.72 1.472-1.47 1.622-2.219.156-.78.386-.83.757-.833h.91c.416 0 .583 0 .833.833M12 7.25a4.75 4.75 0 1 0 0 9.5 4.75 4.75 0 0 0 0-9.5" class="_full"></path></svg>');var _l=Ni('<div aria-hidden="true"><!> <!></div>'),yl={hash:"svelte-8t5w85",code:'.icon.svelte-8t5w85 {display:flex;position:relative;width:24px;height:24px;}.icon.svelte-8t5w85 .pillow {position:absolute;top:1px;right:-9px;}.icon.triple.svelte-8t5w85 .pillow {right:-13px;}.icon.svelte-8t5w85 svg[data-testid="settings-icon--labeled"] ._full {visibility:hidden;opacity:0;}'};function wl(e,t){pi(t,!0),mr(e,yl);let i=fa(t,"isMobile",3,!1),r=fa(t,"currentQuality",3,void 0),a=ne((()=>gl(r()))),s=ne((()=>!!xt(a)&&[pl,ml].includes(xt(a))));var n=Fi(),o=Be(n),l=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=vl();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"settings-mobile-icon",role:"img",...i}))),ji(e,r)}(e,{})},u=e=>{var t=_l();let i;var r=Oe(t),n=e=>{!function(e,t){mr(e,sl);var i=al();cr(Oe(i),(()=>t.children??N)),xe(i),ji(e,i)}(e,{children:(e,t)=>{var i=Fi();hr(Be(i),(()=>xt(a)),((e,t)=>{t(e,{})})),ji(e,i)},$$slots:{default:!0}})};Zi(r,(e=>{xt(a)&&e(n)}));var o=Ne(r,2);let l=ne((()=>xt(a)?"settings-icon--labeled":"settings-icon"));(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=bl();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","data-testid":"settings-icon",role:"img",...i}))),ji(e,r)})(o,{get"data-testid"(){return xt(l)},fill:"var(--btn-color, #fff)"}),xe(t),Bt((e=>i=wr(t,1,"icon svelte-8t5w85",null,i,e)),[()=>({triple:xt(s)})]),ji(e,t)};Zi(o,(e=>{i()?e(l):e(u,!1)})),ji(e,n),fi()}var Sl=Ni('<span class="settings-icon-wrapper svelte-d9t49t"><!></span>'),kl={hash:"svelte-d9t49t",code:".settings-icon-wrapper.svelte-d9t49t {position:relative;width:24px;}"};function Tl(e,t){pi(t,!0),mr(e,kl);let[i,r]=la(),a=()=>oa(o,"$settingsMenuVisible",i),s=Na(),n=s.state.currentQuality$,o=s.ui.settingsMenu.visible$,l=s.actions.internal.openSettingsMenu,u=s.actions.internal.closeSettingsMenu,d=s.ui.isMobile,c=s.ui.t,h=te(void 0);Rt((()=>{oa(t.ref$,"$ref$",i)&&$t((()=>{t.ref$.set(xt(h))}))}));let p=ne((()=>a()?c("tooltip_settings_on"):c("tooltip_settings_off")));let f=ne((()=>a()?"opened":""));Ko(e,{get className(){return xt(f)},testId:"btn-settings",click:async function(e){let t=En(e);a()?u():l(t,Et)},get ariaLabel(){return xt(p)},get ariaExpanded(){return a()},get ref(){return xt(h)},set ref(e){re(h,Ae(e))},children:(e,t)=>{var r=Sl();wl(Oe(r),{get isMobile(){return oa(d,"$isMobile",i)},get currentQuality(){return oa(n,"$currentQuality",i)}}),xe(r),ji(e,r)},$$slots:{default:!0}}),fi(),r()}var El=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M3 0h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V3a3 3 0 0 1 3-3m1 9h2a1 1 0 0 0 0-2H4a1 1 0 0 0 0 2m5 0h7a1 1 0 1 0 0-2H9a1 1 0 0 0 0 2m-5 4h7a1 1 0 1 0 0-2H4a1 1 0 1 0 0 2m10 0h2a1 1 0 1 0 0-2h-2a1 1 0 1 0 0 2"></path></svg>');var xl=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M14.692.428c2.293 0 3.124.24 3.962.687a4.67 4.67 0 0 1 1.944 1.944c.449.839.687 1.67.687 3.962v3.958c0 2.292-.238 3.123-.687 3.961a4.67 4.67 0 0 1-1.944 1.944c-.838.449-1.67.687-3.962.687H7.307c-2.293 0-3.124-.238-3.962-.687A4.67 4.67 0 0 1 1.4 14.94c-.448-.838-.687-1.669-.687-3.961V7.02c0-2.292.239-3.123.687-3.962a4.67 4.67 0 0 1 1.944-1.944C4.183.667 5.015.428 7.307.428zm.243 1.716-7.628-.001c-1.832 0-2.484.126-3.154.484a2.96 2.96 0 0 0-1.24 1.24c-.343.64-.473 1.264-.484 2.912v4.2c0 1.83.125 2.483.483 3.153q.433.809 1.241 1.24c.67.36 1.322.485 3.154.485h7.385c1.832 0 2.484-.126 3.154-.484a2.96 2.96 0 0 0 1.24-1.241c.36-.67.485-1.322.485-3.153V7.02c0-1.831-.126-2.483-.484-3.153a2.96 2.96 0 0 0-1.241-1.24c-.64-.343-1.263-.473-2.911-.484ZM11 10.714a.857.857 0 1 1 0 1.714H5.857a.857.857 0 0 1 0-1.714zm5.142 0a.857.857 0 1 1 0 1.714h-1.714a.857.857 0 0 1 0-1.714zm0-3.428a.857.857 0 1 1 0 1.714H11a.857.857 0 1 1 0-1.714zm-8.571 0a.857.857 0 0 1 0 1.714H5.857a.857.857 0 0 1 0-1.714z"></path></svg>');function $l(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=xl();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"18",fill:"none","aria-hidden":"true","data-testid":"subtitle-empty-icon",role:"img",...i}))),ji(e,r)}function Cl(e,t){pi(t,!0);let i=fa(t,"isSubtitlesEnabled",3,!1),r=Na().ui.t,a=ne((()=>i()?r("tooltip_subtitles_on"):r("tooltip_subtitles_off")));Ko(e,{testId:"btn-Subtitles",get ariaLabel(){return xt(a)},get click(){return t.click},get ariaKeyShortCut(){return Sa},children:(e,t)=>{var r=Fi(),a=Be(r),s=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=El();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"16",fill:"none","aria-hidden":"true","data-testid":"subtitle-pained-icon",role:"img",...i}))),ji(e,r)}(e,{})},n=e=>{$l(e,{})};Zi(a,(e=>{i()?e(s):e(n,!1)})),ji(e,r)},$$slots:{default:!0}}),fi()}var Al=Ni('<span class="duration svelte-sz9er7"> </span>'),Pl=Ni('<div><span class="current svelte-sz9er7"> </span> <!></div>'),Ll={hash:"svelte-sz9er7",code:".time.svelte-sz9er7 {display:flex;align-items:center;font-weight:500;font-variant-numeric:tabular-nums;padding:12px 6px;color:var(--controls-time);}.time.mobile.svelte-sz9er7 {padding:0 0 0 8px;}.current.svelte-sz9er7 {position:relative;}.duration.svelte-sz9er7 {opacity:0.7;}.duration.svelte-sz9er7:before {content:' / ';white-space:pre;}"};function Ml(e,t){pi(t,!0),mr(e,Ll);let i=fa(t,"isMobile",3,!1),r=fa(t,"showDuration",3,!0),a=fa(t,"ref",15),s=ne((()=>on(t.duration))),n=ne((()=>on(t.position)));var o=Pl();let l;var u=Oe(o),d=Oe(u,!0);xe(u);var c=Ne(u,2),h=e=>{var t=Al(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,xt(s)))),ji(e,t)};Zi(c,(e=>{r()&&e(h)})),xe(o),Qr(o,(e=>a(e)),(()=>a())),Bt((e=>{l=wr(o,1,"time svelte-sz9er7",null,l,e),qi(d,xt(n))}),[()=>({mobile:i()})]),ji(e,o),fi()}var Il=Vi('<svg xmlns="http://www.w3.org/2000/svg" class="icon svelte-1n5yyua" aria-hidden="true"><g fill="var(--btn-color, #fff)" fill-rule="evenodd"><path class="wave2 svelte-1n5yyua" d="M12.98 18.823c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963zm2.901-8.704A.875.875 0 1 1 17.12 8.88c.176.177.41.47.64.872.384.671.616 1.425.616 2.247s-.232 1.576-.615 2.247a4.23 4.23 0 0 1-.641.872.875.875 0 1 1-1.238-1.238c.074-.073.214-.249.36-.503.241-.423.384-.887.384-1.378s-.143-.955-.385-1.378a2.597 2.597 0 0 0-.359-.503zm3-2A.875.875 0 1 1 20.12 6.88c.263.264.62.74.966 1.432.517 1.033.843 2.255.89 3.716-.047 1.403-.373 2.625-.89 3.658-.346.692-.703 1.168-.966 1.432a.875.875 0 1 1-1.238-1.238c.138-.137.383-.464.639-.976.407-.814.667-1.79.705-2.876-.038-1.144-.298-2.12-.705-2.934-.256-.512-.501-.839-.639-.976z"></path><path class="wave1 svelte-1n5yyua" d="M12.98 18.823c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963zm2.901-8.704A.875.875 0 1 1 17.12 8.88c.176.177.41.47.64.872.384.671.616 1.425.616 2.247s-.232 1.576-.615 2.247a4.23 4.23 0 0 1-.641.872.875.875 0 1 1-1.238-1.238c.074-.073.214-.249.36-.503.241-.423.384-.887.384-1.378s-.143-.955-.385-1.378a2.597 2.597 0 0 0-.359-.503z"></path><path class="cross svelte-1n5yyua" d="m20 10.763 2.381-2.382A.875.875 0 1 1 23.62 9.62L21.237 12l2.382 2.381a.875.875 0 1 1-1.238 1.238L20 13.237l-2.381 2.382a.875.875 0 1 1-1.238-1.238L18.763 12 16.38 9.619A.875.875 0 1 1 17.62 8.38zm-7.02 8.06c-.031 1.207-.67 1.609-1.828.62-1.719-1.469-3.609-3.194-4.242-3.721-.632-.529-1.645-.62-3.073-.62-1.427 0-1.815-.621-1.815-1.241s-.014-1.83-.014-2.001c0-.055.005-.086.014-.13.02-.095-.058-.973 0-1.59.085-.906.388-1.241 1.815-1.241 1.428 0 2.44-.092 3.073-.62.633-.529 2.523-2.253 4.242-3.722 1.158-.989 1.797-.587 1.829.62.043 1.607 0 3.85 0 6.683 0 2.83.043 5.356 0 6.963z"></path></g></svg>'),Rl={hash:"svelte-1n5yyua",code:".icon.svelte-1n5yyua {display:block;width:24px;height:24px;}.icon.svelte-1n5yyua .cross:where(.svelte-1n5yyua) {visibility:hidden;}.icon[data-value='off'].svelte-1n5yyua .wave1:where(.svelte-1n5yyua),\n  .icon[data-value='off'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua) {visibility:hidden;}.icon[data-value='off'].svelte-1n5yyua .cross:where(.svelte-1n5yyua) {visibility:visible;}.icon[data-value='mid'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua),\n  .icon[data-value='min'].svelte-1n5yyua .wave2:where(.svelte-1n5yyua) {visibility:hidden;}"};function Dl(e,t){mr(e,Rl);let i=fa(t,"volume",3,1),r=fa(t,"muted",3,!1),a=ne((()=>((e,t)=>t?"off":e>.5?"max":e>.2?"mid":e>0?"min":"off")(i(),r())));var s=Il();Bt((()=>{Ar(s,"data-value",xt(a)),Ar(s,"data-testid",`volume-${xt(a)??""}-icon`)})),ji(e,s)}var Ol=Ni('<div class="overlay"><!></div>');function Bl(e,t){pi(t,!0);let[i,r]=la(),a=()=>oa(s,"$overlayContainer$",i),s=Na().ui.overlayContainer$,n=te(void 0),o=e=>{!e||!xt(n)||e.contains(xt(n))||e.appendChild(xt(n))};Rt((()=>{o(a())})),Xr((()=>(o(a()),()=>{var e;!(e=a())||!xt(n)||!e.contains(xt(n))||e.removeChild(xt(n))})));var l=Ol();cr(Oe(l),(()=>t.children??N)),xe(l),Qr(l,(e=>re(n,e)),(()=>xt(n))),ji(e,l),fi(),r()}var Nl=Ni('<div class="tooltip svelte-hxlyne"><div class="content svelte-hxlyne"> </div> <div class="tooltip-pointer svelte-hxlyne"></div></div>'),Vl=Ni("<div><!></div> <!>",1),Ul={hash:"svelte-hxlyne",code:'.tooltip-wrapper.svelte-hxlyne {display:flex;flex-direction:column;min-width:0;}.full-width.svelte-hxlyne {width:100%;}.tooltip.svelte-hxlyne {position:absolute;opacity:0;visibility:hidden;transition:opacity 200ms, visibility 200ms;bottom:100%;left:0;}.content.svelte-hxlyne {display:inline-block;padding:6px 10px;border-radius:3px;color:var(--white);background-color:rgba(41, 41, 41, .8);}.tooltip-pointer.svelte-hxlyne {position:absolute;bottom:0;width:0;border-top:5px solid rgba(41, 41, 41, .8);border-right:5px solid transparent;border-left:5px solid transparent;content:" ";font-size:0;line-height:0;}'};function Fl(e,t){pi(t,!0),mr(e,Ul);let i,[r,a]=la(),s=()=>oa(E,"$overlayContainer$",r),n=fa(t,"isMobile",3,!1),o=fa(t,"content",3,""),l=fa(t,"active",15,!1),u=fa(t,"translateX",3,0),d=fa(t,"translateY",3,0),c=fa(t,"isFullWidthWrapper",3,!1),h=fa(t,"maxTooltipWidth",3,void 0),p=fa(t,"placement",3,"top"),f=fa(t,"onVisibilityChange",3,m.noop),g=te(void 0),v=te(void 0),b=te(0),_=te(0),y=te(0),w=te(0),S=ba(),k=Na(),T=k.ui.playerSize,E=k.ui.overlayContainer$;Rt((()=>{$t((()=>{f()(l())}))}));let x=k.getLogger().createComponentLog("Tooltip component"),$=()=>{if(!s()||!xt(v)||!xt(g))return;re(_,5);let e=s().getBoundingClientRect(),t=xt(g).getBoundingClientRect(),i=t.width,a=xt(v).clientWidth,n=oa(T,"$containerSize",r).width,o=(i-a)/2,l=t.left+u()-e.left,c=l+o,h=t.top+d()-e.top,p=a/2-5,f=c+a>n-8;c<8&&(c=8,p=l+t.width/2-12.5),f&&(c=n-8-a,p=t.left-e.left+t.width/2-c-5),re(y,Ae(c)),re(w,h),re(b,Ae(p))},C=()=>{switch(p()){case"top":$();break;case"bottom":!s()||!xt(v)||!xt(g)||re(_,-5);break;case"left":(()=>{if(!s()||!xt(v)||!xt(g))return;re(b,5);let e=s().getBoundingClientRect(),t=xt(g).getBoundingClientRect(),i=t.height,r=xt(v).clientHeight,a=(i-r)/2+r,n=t.left+u()-e.left-xt(v).clientWidth-5;n<8&&(n=8);let o=t.top+d()-e.top+a,l=2-a/2;re(y,Ae(n)),re(w,o),re(_,l),re(b,-3)})();break;default:!s()||!xt(v)||!xt(g)||re(b,-5)}},A=()=>{try{if(!s()||!xt(g))return;C(),l(!0)}catch(e){x({message:String(e)})}},P=()=>{xt(v)&&(i||(i=window.setTimeout(A,S.controls.hideTimeoutTooltips)),l()&&A())},L=()=>{l(!1),window.clearTimeout(i),i=void 0},M=ne((()=>((e,t,i)=>{let r="";switch(p()){case"top":default:r=`transform: translate(${e}px, ${t}px);`;break;case"bottom":r=`transform: translate(${e}px, ${t}px); top: auto; bottom: 100%;`;break;case"left":r=`transform: translate(${e}px, ${t}px); left: 0; right: auto;`}return r+=` max-width: ${void 0===h()?"auto":`${h()}px`};`,r+=` opacity: ${i?1:0}; visibility: ${i?"visible":"hidden"}`,r})(xt(y),xt(w),l()))),I=ne((()=>((e,t)=>{let i="";switch(p()){case"top":i=`transform: translate(${e}px, ${t}px) rotate(0); top: auto; bottom: 0;`;break;case"bottom":i=`transform: translate(${e}px, ${t}px) rotate(180deg); top: 0; bottom: auto;`;break;case"left":i=`transform: translate(${e}px, ${t}px) rotate(-90deg); left: 100%; top: auto; bottom: 0;`;break;default:i=`transform: translate(${e}px, ${t}px) rotate(90deg); right: 100%; top: auto; bottom: 0;`}return i})(xt(b),xt(_))));Xr(C),Zr((()=>window.clearTimeout(i)));var R=Vl(),D=Be(R);let O;D.__mousemove=P,D.__mousedown=L,D.__mouseup=P,cr(Oe(D),(()=>t.children??N)),xe(D),Qr(D,(e=>re(g,e)),(()=>xt(g)));var B=Ne(D,2),V=e=>{Bl(e,{children:(e,t)=>{var i=Nl(),r=Oe(i),a=Oe(r,!0);xe(r);var s=Ne(r,2);xe(i),Qr(i,(e=>re(v,e)),(()=>xt(v))),Bt((()=>{kr(i,xt(M)),qi(a,o()),kr(s,xt(I))})),ji(e,i)},$$slots:{default:!0}})};Zi(B,(e=>{o()&&!n()&&e(V)})),Bt((e=>O=wr(D,1,"tooltip-wrapper svelte-hxlyne",null,O,e)),[()=>({"full-width":c()})]),Ii("mouseenter",D,P),Ii("mouseleave",D,L),ji(e,R),fi(),a()}Ri(["mousemove","mousedown","mouseup"]);var jl=e=>{e.stopPropagation()},zl=Ni("<div><!></div>"),Wl={hash:"svelte-p9r045",code:".btn-container.svelte-p9r045 {position:relative;display:flex;align-items:center;height:100%;transition:var(--button-hover-transition);will-change:opacity;-webkit-tap-highlight-color:transparent;}.w-max.svelte-p9r045 {width:100%;min-width:0;}"};function ql(e,t){pi(t,!0),mr(e,Wl);let[i,r]=la(),a=Na(),s=Va(),n=a.ui.isMobile,o=s.graphIsOpened$,l=a.ui.t,u=fa(t,"className",3,""),d=fa(t,"disabled",3,!1),c=fa(t,"hasTooltip",3,!0),h=fa(t,"ref",15,void 0),p=fa(t,"width",15,void 0),f=fa(t,"isFullWidthTooltip",3,!0),g=fa(t,"tooltipContent",3,""),v=fa(t,"tooltipActive",3,!1),b=fa(t,"tooltipPlacement",3,"top"),_=fa(t,"disabledTooltipContent",19,(()=>l("tooltip_button_disabled"))),y=fa(t,"isAriaHidden",3,!1),w=fa(t,"onTooltipVisibilityChange",3,m.noop),S=fa(t,"initialTranslateXPx",3,0),k=fa(t,"initialTranslateYPx",19,(()=>-18)),T=fa(t,"mouseEnter",3,m.noop),E=fa(t,"mouseLeave",3,m.noop),x=ne((()=>d()?oa(o,"$isGraphOpened$",i)?l("tooltip_disabled_when_graph_on"):_():g()));var $=zl();$.__pointerdown=[jl],$.__click=[jl];var C=Oe($),A=e=>{Fl(e,{get content(){return xt(x)},get translateX(){return S()},get translateY(){return k()},get isFullWidthWrapper(){return f()},get active(){return v()},get placement(){return b()},get onVisibilityChange(){return w()},children:(e,i)=>{var r=Fi();cr(Be(r),(()=>t.children??N)),ji(e,r)},$$slots:{default:!0}})},P=e=>{var i=Fi();cr(Be(i),(()=>t.children??N)),ji(e,i)};Zi(C,(e=>{c()&&xt(x)&&!oa(n,"$isMobile",i)?e(A):e(P,!1)})),xe($),Qr($,(e=>h(e)),(()=>h())),Bt((()=>{wr($,1,`btn-container ${u()??""}`,"svelte-p9r045"),Ar($,"aria-hidden",y()||null)})),Ii("mouseenter",$,(function(...e){T()?.apply(this,e)})),Ii("mouseleave",$,(function(...e){E()?.apply(this,e)})),Hr($,"clientWidth",p),ji(e,$),fi(),r()}Ri(["pointerdown","click"]);var Hl=Vi('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><rect width="20" height="20" rx="10" fill="var(--btn-color, #fff)"></rect><path d="M12.5259 8.68864L12.587 8.87536L12.3702 8.23648C12.236 7.84095 11.8295 7.60563 11.4192 7.68593C10.9471 7.77831 10.6508 8.24892 10.7718 8.71381L10.8968 9.19361L10.6671 8.33855C10.5566 7.92714 10.1475 7.67011 9.72832 7.74872C9.32282 7.82476 9.04808 8.18606 9.06319 8.57993L8.34064 5.64592C8.21338 5.12912 7.64646 4.85578 7.1621 5.07767C6.79216 5.24715 6.59467 5.65495 6.69131 6.0498L7.98547 11.3373L6.87 10.178C6.52545 9.81987 5.94024 9.86103 5.64933 10.2638C5.44455 10.5474 5.44907 10.9312 5.66048 11.2098L7.89246 14.1518C7.89246 14.1518 9.12075 15.9833 12.1932 15.3769C14.6243 14.8972 15.4434 12.7097 14.7748 10.4997L14.2213 8.20869C14.0975 7.69621 13.5537 7.40646 13.0585 7.58916C12.614 7.75319 12.3788 8.23875 12.5259 8.68864Z"></path></svg>');function Kl(e,t){var i=Hl(),r=Oe(i),a=Ne(r);xe(i),Bt((()=>{Ar(i,"data-testid",(t.completed,"interactive-episode-completed-icon")),Ar(r,"fill-opacity",t.completed?1:.24),Ar(a,"fill",t.completed?"var(--interactive-episode-complete)":"white")})),ji(e,i)}var Ql=Ni("<div><!></div>"),Gl={hash:"svelte-bklhpe",code:".interactive-episode-icon.svelte-bklhpe {width:20px;height:20px;position:absolute;transform:translateX(-50%);cursor:default;}.interactive-episode-icon.disabled.svelte-bklhpe {pointer-events:none;opacity:0.4;}"};var Yl=Ni('<div><div class="video-episode-inner svelte-1u6kv8l"><div class="video-episode-loaded svelte-1u6kv8l"></div> <div></div></div></div>'),Xl=Ni('<div class="video-episodes-wrap svelte-1u6kv8l"></div>'),Zl={hash:"svelte-1u6kv8l",code:".video-episodes-wrap.svelte-1u6kv8l {position:absolute;width:100%;height:100%;}.video-episode.svelte-1u6kv8l {position:absolute;height:calc(3 * var(--slider-height));box-sizing:border-box;margin-top:calc(-1 * var(--slider-height));padding:var(--slider-height) var(--slider-video-episode-gap);transition:transform 0.2s;}.video-episode.svelte-1u6kv8l:not(.disabled):where(:hover, :active) {transform:scaleY(1.5);}.video-episode-inner.svelte-1u6kv8l,\n  .video-episode-loaded.svelte-1u6kv8l,\n  .video-episode-filled.svelte-1u6kv8l {position:absolute;height:var(--slider-height);border-radius:var(--slider-radius);}.video-episode-inner.svelte-1u6kv8l {position:absolute;overflow:hidden;width:calc(100% - 2 * var(--slider-video-episode-gap));background:var(--slider-bg);}.video-episode-loaded.svelte-1u6kv8l {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background:var(--slider-loaded-bg);transition:transform 0.2s;}.video-episode-filled.svelte-1u6kv8l {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background-color:var(--slider-filled-bg);}"};function Jl(e,t,i,r,a,s,n){if(e.preventDefault(),t()&&re(i,Ae(t().getBoundingClientRect())),r()||xt(a)||!t())return;re(a,!0);let o=s(e.clientX,e.clientY);n()(o),t().setPointerCapture(e.pointerId)}function eu(e,t,i,r,a,s,n,o){if(e.preventDefault(),t())return;let l=i(e.clientX,e.clientY),u=r(e.clientX);a()(l,u,xt(s).width),xt(n)&&o()(l)}function tu(e,t,i,r,a){if(e.preventDefault(),t()||!xt(i))return;re(i,!1);let s=r(e.clientX,e.clientY);a()(s)}function iu(e,t,i,r){e.stopPropagation(),e.preventDefault(),t()&&i()(r(e.clientX,e.clientY))}var ru=Ni("<div></div>"),au=Ni('<div class="bars svelte-1tpemng"><div class="loaded svelte-1tpemng"></div> <div></div></div>'),su=Ni('<!> <div role="slider" tabindex="0"><!> <div><div></div></div></div>',1),nu={hash:"svelte-1tpemng",code:".interactive-icons.svelte-1tpemng {position:absolute;width:calc(100% - 20px);top:-28px;}.interactive-icons.mobile.svelte-1tpemng {top:-10px;}.slider.svelte-1tpemng {position:relative;height:var(--slider-height);border-radius:var(--slider-radius);cursor:pointer;transition:visibility 0.2s, opacity 0.2s;will-change:opacity, transform;width:100%;touch-action:none;-webkit-tap-highlight-color:transparent;}.no-handle.svelte-1tpemng {cursor:default;}.slider.svelte-1tpemng:before {\n    /* hit area */content:'';position:absolute;left:0;right:0;top:calc(-1 * (var(--controls-height) / 2 - var(--slider-height)) / 2);height:calc(var(--controls-height) / 2);}.bars.svelte-1tpemng {position:absolute;width:100%;height:100%;border-radius:var(--slider-radius);overflow:hidden;background:var(--slider-bg);}.loaded.svelte-1tpemng {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background:var(--slider-loaded-bg);transition:transform 0.2s;will-change:transform;}.filled.svelte-1tpemng {position:absolute;left:-100%;width:100%;height:100%;border-radius:var(--slider-radius);background-color:var(--slider-filled-bg);}.slider.square.svelte-1tpemng,\n  .slider.square.svelte-1tpemng > .bars:where(.svelte-1tpemng),\n  .slider.square.svelte-1tpemng .loaded:where(.svelte-1tpemng),\n  .slider.square.svelte-1tpemng .filled:where(.svelte-1tpemng) {border-radius:unset;}.filled.active-live.svelte-1tpemng {background-color:var(--timeline-slider-filled-active-live-bg);}.filled.ads.svelte-1tpemng {background-color:var(--slider-filled-ads);}.handleWrap.svelte-1tpemng {position:absolute;left:-100%;width:100%;}.handle.svelte-1tpemng {position:absolute;width:var(--slider-handle-size);height:var(--slider-handle-size);right:calc(-1 * var(--slider-handle-size) / 2);top:calc((var(--slider-height) - var(--slider-handle-size)) / 2);border-radius:50%;background-color:var(--slider-handle-bg);visibility:hidden;opacity:0;transform:scale(0);transition:opacity 0.2s, transform 0.2s, visibility 0.2s;will-change:opacity, transform;}.handle.active-live.svelte-1tpemng {background-color:var(--timeline-slider-handle-active-live-bg);}.slider.svelte-1tpemng:hover .handle:where(.svelte-1tpemng),\n  .slider-dragging.svelte-1tpemng .handle:where(.svelte-1tpemng) {visibility:visible;opacity:1;transform:scale(1);}.slider-dragging.svelte-1tpemng .handle:where(.svelte-1tpemng) {transform:scale(1.3);}.slider-vertical.svelte-1tpemng {position:absolute;left:-8px;top:-18px;transform-origin:0 0;transform:rotate(-90deg);}.slider.disabled.svelte-1tpemng {cursor:default;opacity:0.4;}"};function ou(e,t){pi(t,!0),mr(e,nu);let i=fa(t,"ref",15,void 0),r=fa(t,"className",3,""),a=fa(t,"testId",3,void 0),s=fa(t,"isHidden",3,!1),n=fa(t,"isVertical",3,!1),o=fa(t,"isActiveLive",3,!1),l=fa(t,"isMobile",3,!1),u=fa(t,"squareBorders",3,!1),d=fa(t,"videoEpisodes",19,(()=>[])),c=fa(t,"withWheelHandler",3,!1),h=fa(t,"isInteractive",3,!1),p=fa(t,"disabled",3,!1),f=fa(t,"hideHandel",3,!1),g=fa(t,"onPointerDown",3,m.noop),v=fa(t,"onHandleMove",3,m.noop),b=fa(t,"onPointerUp",3,m.noop),_=fa(t,"onPointerEnter",3,m.noop),y=fa(t,"onPointerMove",3,m.noop),w=fa(t,"onPointerLeave",3,m.noop),S=fa(t,"onMouseEnter",3,m.noop),k=fa(t,"onMouseLeave",3,m.noop),T=fa(t,"onWheelUp",3,m.noop),E=fa(t,"onWheelDown",3,m.noop),x=fa(t,"onWheelLeft",3,m.noop),$=fa(t,"onWheelRight",3,m.noop),C=fa(t,"onDisabledClick",3,m.noop),A=fa(t,"loadedProgress",3,0),P=fa(t,"filledProgress",3,0),L=fa(t,"handleProgress",3,0),M=fa(t,"ariaLabel",3,""),I=fa(t,"ariaValueMin",3,void 0),R=fa(t,"ariaValueMax",3,void 0),D=fa(t,"ariaValueNow",3,void 0),O=fa(t,"ariaValueText",3,""),B=ba(),N=te(void 0),V=te(!1),U=ne((()=>R()??0)),F=ne((()=>(0,m.isNonNullable)(d())&&d()[d().length-1]?.time<xt(U))),j=ne((()=>(0,m.isNonNullable)(d())&&d().length&&xt(F)&&xt(U)?function(e,t){let i=B.features.episodesClustering&&!h()?B.episodeMinWidthPc:0,r=[],a=d()[0].time/xt(U)*100,s=0,n=0;for(let o=1;o<d().length;o++)s=d()[o].time/xt(U)*100,s-a>i&&(r.push({from:a,width:Math.max(0,s-a),loadedWidth:Math.max(0,Math.min(s,e)-a),filledWidth:Math.max(0,Math.min(s,t)-a),interactive:d()[o-1].interactive,completed:d()[o-1].completed}),a=d()[o].time/xt(U)*100,n++);let o={from:a,width:Math.max(0,100-a),loadedWidth:Math.max(0,Math.min(e,100)-a),filledWidth:Math.max(0,Math.min(t,100)-a),interactive:d()[n].interactive,completed:d()[n].completed};100-a<i?(n-=1,r[n].width+=100-a,r[n].loadedWidth+=Math.max(0,Math.min(e,100)-a),r[n].filledWidth+=Math.max(0,Math.min(t,100)-a)):r[n]=o;let l=d()[0].time;if(0!==l){let i=l/xt(U)*100;r.unshift({from:0,width:i,loadedWidth:Math.min(i,e),filledWidth:Math.min(i,t)})}return r}(100*A(),100*P()):[]));function z(e,t){return n()?Math.max(0,Math.min(1,(xt(N).height-(t-xt(N).top))/xt(N).height)):Math.min(Math.max(e-xt(N).x,0),xt(N).width)/xt(N).width}function W(e){return Math.min(Math.max(e-xt(N).x,0),xt(N).width)}var q=su(),H=Be(q),K=e=>{var t=ru();let i;ar(t,21,(()=>xt(j)),(e=>e.from),((e,t)=>{var i=Fi(),r=Be(i),a=e=>{!function(e,t){pi(t,!0),mr(e,Gl);let i=Na().ui.t,r=te(0),a=ne((()=>i(t.videoEpisode.completed?"tooltip_episode_finished":"tooltip_episode_unfinished")));ql(e,{get tooltipContent(){return xt(a)},initialTranslateXPx:-10,initialTranslateYPx:-10,get disabled(){return t.disabled},get width(){return xt(r)},isAriaHidden:!0,isFullWidthTooltip:!1,children:(e,i)=>{var a=Ql();let s;var n=Oe(a);let o=ne((()=>!!t.videoEpisode.completed));Kl(n,{get completed(){return xt(o)}}),xe(a),Bt((e=>{s=wr(a,1,"interactive-episode-icon svelte-bklhpe",null,s,e),kr(a,`left: ${t.videoEpisode.from+t.videoEpisode.width/2}%`)}),[()=>({disabled:t.disabled})]),Hr(a,"clientWidth",(e=>re(r,e))),ji(e,a)},$$slots:{default:!0}}),fi()}(e,{get videoEpisode(){return xt(t)},get disabled(){return p()}})};Zi(r,(e=>{xt(t).interactive&&e(a)})),ji(e,i)})),xe(t),Bt((e=>i=wr(t,1,"interactive-icons svelte-1tpemng",null,i,e)),[()=>({mobile:l(),hidden:l()&&!xt(V)})]),ji(e,t)};Zi(H,(e=>{h()&&e(K)}));var Q=Ne(H,2);let G;Q.__pointerdown=[Jl,i,N,p,V,z,g],Q.__pointermove=[eu,p,z,W,y,N,V,v],Q.__pointerup=[tu,p,V,z,b],Q.__click=[iu,p,C,z];var Y=Oe(Q),X=e=>{!function(e,t){mr(e,Zl);let i=fa(t,"videoEpisodes",19,(()=>[]));var r=Xl();ar(r,21,i,(e=>e.from),((e,i)=>{var r=Yl();let a;var s=Oe(r),n=Oe(s),o=Ne(n,2);let l;xe(s),xe(r),Bt(((e,t)=>{a=wr(r,1,"video-episode svelte-1u6kv8l",null,a,e),kr(r,`left: ${xt(i).from}%; width: ${xt(i).width}%`),kr(n,`transform: translateX(${xt(i).loadedWidth/xt(i).width*100}%)`),l=wr(o,1,"video-episode-filled svelte-1u6kv8l",null,l,t),kr(o,`transform: translateX(${xt(i).filledWidth/xt(i).width*100}%)`)}),[()=>({disabled:t.disabled,mobile:t.isMobile}),()=>({mobile:t.isMobile})]),ji(e,r)})),xe(r),ji(e,r)}(e,{get videoEpisodes(){return xt(j)},get disabled(){return p()},get isMobile(){return l()}})},Z=e=>{var t=au(),i=Oe(t),r=Ne(i,2);let a;xe(t),Bt((e=>{kr(i,`transform: translateX(${100*A()}%);`),a=wr(r,1,"filled svelte-1tpemng",null,a,e),kr(r,`transform: translateX(${100*P()}%);`)}),[()=>({"active-live":o()})]),ji(e,t)};Zi(Y,(e=>{xt(j).length?e(X):e(Z,!1)}));var J=Ne(Y,2);let ee;var ie=Oe(J);let ae;xe(J),xe(Q),Qr(Q,(e=>i(e)),(()=>i())),Bt(((e,t,i)=>{G=wr(Q,1,`slider ${r()??""}`,"svelte-1tpemng",G,e),Ar(Q,"aria-label",M()),Ar(Q,"aria-valuemin",I()),Ar(Q,"aria-valuemax",R()),Ar(Q,"aria-valuenow",D()),Ar(Q,"aria-valuetext",O()),Ar(Q,"data-testid",a()??null),ee=wr(J,1,"handleWrap svelte-1tpemng",null,ee,t),kr(J,`transform: translateX(${100*L()}%);`),ae=wr(ie,1,"handle svelte-1tpemng",null,ae,i)}),[()=>({disabled:p(),"slider-dragging":xt(V),hidden:s(),"slider-vertical":n(),"no-handle":f(),square:u()}),()=>({hidden:f()}),()=>({"active-live":o()})]),Ii("pointerenter",Q,(function(e){if(e.preventDefault(),i()&&re(N,Ae(i().getBoundingClientRect())),p())return;let t=z(e.clientX,e.clientY),r=W(e.clientX);_()(t,r,xt(N).width)})),Ii("pointerleave",Q,(function(e){e.preventDefault(),!p()&&w()()})),Ii("mouseenter",Q,(function(){S()()})),Ii("mouseleave",Q,(function(){k()()})),Ii("wheel",Q,(function(e){p()||c()&&(e.preventDefault(),e.deltaY<0?T()():e.deltaY>0?E()():e.deltaX>0?$()():x()())})),ji(e,q),fi()}Ri(["pointerdown","pointermove","pointerup","click"]);var lu=(e,t)=>Ma[e]>=Ma[t],uu=(e,t)=>Ma[e]<=Ma[t],du=Ni("<div><!></div>"),cu=Ni("<div><!> <!></div>"),hu={hash:"svelte-1auih1j",code:".volumeBar-container.svelte-1auih1j {display:flex;align-items:center;}.volumeBar-container.vertical.svelte-1auih1j, .vertical.svelte-1auih1j .tooltip-wrapper, .vertical.svelte-1auih1j .btn {width:40px;}.volumeBar.svelte-1auih1j {display:flex;align-items:center;margin:0 8px;position:relative;width:70px;--slider-height: var(--slider-volume-height);--slider-radius: var(--slider-volume-radius);--slider-handle-size: var(--slider-volume-handle-size);--slider-bg: var(--volume-slider-bg);--slider-filled-bg: var(--volume-slider-filled-bg);--slider-handle-bg: var(--volume-slider-handle-bg);}.volumeBar-slider-vertical {width:50px !important;}.volumeBar-vertical.svelte-1auih1j {padding:0 8px 0 0;width:0;}"};function pu(e,t){pi(t,!0),mr(e,hu);let i,[r,a]=la(),s=()=>oa(b,"$isAudioAvailable$",r),n=()=>oa(u,"$volume$",r),o=Na(),l=ba(),u=o.state.volume$,d=o.state.muted$,{setVolume:c,startVolumeChanging:h,stopVolumeChanging:p}=o.actions.internal,f=o.ui.currentGridType$,g=o.callbacks?.onAudioDoesNotExistHint,v=o.callbacks?.onAudioDisabledHint,b=o.state.isAudioAvailable$,_=o.state.isAudioDisabled,y=o.ui.t,w=te(!1),S=ne((()=>!s()||oa(d,"$muted$",r)||0===n())),k=ne((()=>uu(oa(f,"$currentGridType$",r),"s"))),T=ne((()=>xt(k)?"":xt(S)?!s()||_?y("tooltip_sound_unavailable"):y("tooltip_volume"):y("tooltip_volume_muted"))),E=ne((()=>xt(S)?y("tooltip_volume"):y("tooltip_volume_muted"))),x=ne((()=>xt(S)?0:n())),$=!1,C=ne((()=>s()?_&&!v:!g));function A(e){h(),c(e)}function P(){Io(o,n(),l.controls.volumeStepWheel)}function L(){Ro(o,n(),l.controls.volumeStepWheel)}function M(e){c(e)}function I(e){c(e),p()}function R(){$=!0}function D(){$=!1,N()}function O(){clearTimeout(i),re(w,!0)}function B(){N()}function N(){i=window.setTimeout((()=>{$||re(w,!1)}),l.controls.volumeBarTimeout)}var V=cu();let U;var F=Oe(V);Fl(F,{get content(){return xt(T)},translateY:-18,children:(e,i)=>{let r=ne((()=>xt(k)?"btn-volume-vertical":"btn-volume-horizontal"));Ko(e,{className:"btn-full-opacity",get disabled(){return xt(C)},get testId(){return xt(r)},get ariaLabel(){return xt(E)},get click(){return t.click},get ariaKeyShortCut(){return ka},children:(e,t)=>{Dl(e,{get volume(){return n()},get muted(){return xt(S)}})},$$slots:{default:!0}})},$$slots:{default:!0}});var j=Ne(F,2),z=e=>{var t=du();let i;var r=Oe(t);let a=ne((()=>xt(k)?"volumeBar-slider-vertical":"")),s=ne((()=>xt(k)&&!xt(w))),n=ne((()=>xt(k)?R:m.noop)),o=ne((()=>xt(k)?D:m.noop)),l=ne((()=>Math.round(100*xt(x)))),u=ne((()=>`${Math.round(100*xt(x))}%`)),d=ne((()=>xt(k)?"volume-slider-vertical":"volume-slider"));ou(r,{get className(){return xt(a)},get isHidden(){return xt(s)},get isVertical(){return xt(k)},withWheelHandler:!0,onWheelUp:P,onWheelDown:L,onPointerDown:A,onHandleMove:M,onPointerUp:I,get onPointerEnter(){return xt(n)},get onPointerLeave(){return xt(o)},ariaLabel:"Ползунок громкости",ariaValueMin:0,ariaValueMax:100,get ariaValueNow(){return xt(l)},get ariaValueText(){return xt(u)},get filledProgress(){return xt(x)},get handleProgress(){return xt(x)},get testId(){return xt(d)}}),xe(t),Bt((e=>i=wr(t,1,"volumeBar svelte-1auih1j",null,i,e)),[()=>({"volumeBar-vertical":xt(k)})]),ji(e,t)};Zi(j,(e=>{s()&&e(z)})),xe(V),Bt((e=>U=wr(V,1,"volumeBar-container svelte-1auih1j",null,U,e)),[()=>({vertical:xt(k)})]),Ii("mouseenter",V,(function(...e){(xt(k)?O:m.noop)?.apply(this,e)})),Ii("mouseleave",V,(function(...e){(xt(k)?B:m.noop)?.apply(this,e)})),Ii("wheel",V,(function(e){e.preventDefault(),e.deltaY<0?P():e.deltaY>0&&L()})),ji(e,V),fi(),a()}var fu=Vi('<svg><!><g fill-rule="evenodd"><path d="M4.58 13.979a.99.99 0 0 1 .99-.99h4.451a.99.99 0 0 1 .99.99v4.452a.99.99 0 0 1-1.98 0v-2.05l-3.319 3.322a1 1 0 0 1-1.414 0v-.001a1 1 0 0 1 0-1.414l3.32-3.32H5.57a.99.99 0 0 1-.99-.99m10.388-6.36 3.32-3.322a1 1 0 0 1 1.414 0v.001a1 1 0 0 1 0 1.414l-3.32 3.32h2.049a.99.99 0 0 1 0 1.979h-4.442a1 1 0 0 1-1-1V5.569a.99.99 0 1 1 1.98 0z" class="_exit"></path><path d="M10.5 19a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-4.5a1 1 0 0 1 2 0v2.072l3.363-3.365a1 1 0 0 1 1.414 0l.016.016a1 1 0 0 1 0 1.414L7.429 18H9.5a1 1 0 0 1 1 1M18 7.429l-3.363 3.364a1 1 0 0 1-1.414 0l-.016-.016a1 1 0 0 1 0-1.414L16.571 6H14.5a1 1 0 0 1 0-2H19a1 1 0 0 1 1 1v4.5a1 1 0 0 1-2 0z" class="_enter"></path></g></svg>');var mu={hash:"svelte-17t966y",code:'svg[data-testid="close-fullscreen-icon"] ._enter,\n  svg[data-testid="open-fullscreen-icon"] ._exit {visibility:hidden;opacity:0;}'};function gu(e,t){mr(e,mu);let i=fa(t,"isFullscreen",8,!1),r=oe((()=>i()?"close-fullscreen-icon":"open-fullscreen-icon"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=fu();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"var(--btn-color, #fff)","aria-hidden":"true",role:"img",...i}))),ji(e,r)}(e,{get"data-testid"(){return xt(r)},fill:"var(--btn-color, #fff)"})}function vu(e,t){pi(t,!0);let i=fa(t,"isFullscreen",3,!1),r=fa(t,"click",3,m.noop),a=Na(),s=a.ui.isFullscreenOpenedByKeyboard,n=a.ui.t,o=ne((()=>i()?n("tooltip_fullscreen_on"):n("tooltip_fullscreen_off")));Ko(e,{testId:"btn-fullscreen",get ariaLabel(){return xt(o)},click:e=>{let t=En(e);s.set(t),r()()},get ariaKeyShortCut(){return ya},children:(e,t)=>{gu(e,{get isFullscreen(){return i()}})},$$slots:{default:!0}}),fi()}var bu=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4.265 4.265C3 5.531 3 7.567 3 11.64v.72c0 4.073 0 6.11 1.265 7.375C5.531 21 7.567 21 11.64 21h.72c4.073 0 6.11 0 7.375-1.265C21 18.469 21 16.433 21 12.36v-.72c0-4.073 0-6.11-1.265-7.375C18.469 3 16.433 3 12.36 3h-.72C7.567 3 5.53 3 4.265 4.265M6 8.5c.096 4.682 2.556 7.5 6.61 7.5h.235v-2.679c1.476.15 2.577 1.254 3.026 2.679H18c-.578-2.132-2.075-3.31-3.005-3.76.93-.558 2.246-1.908 2.556-3.74h-1.937c-.406 1.49-1.615 2.84-2.77 2.968V8.5h-1.968v5.197c-1.197-.3-2.759-1.757-2.823-5.197z" clip-rule="evenodd"></path></svg>');var _u=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M32.55 17.042h2.494L38.707 7h-1.81l-2.936 8.276h-.286L30.84 7H29zM48.075 17.042l-4.619-5.199L47.718 7h-2.11l-3.563 4.088h-.413V7h-1.71v10.042h1.71V12.74h.427l3.764 4.302z"></path><path fill="var(--btn-color, #fff)" d="M57.888 11.886c.883-.342 1.44-1.125 1.44-2.151C59.327 8.14 58.001 7 56.062 7h-3.92v10.042h4.205c1.953 0 3.279-1.14 3.279-2.806 0-1.168-.656-2.037-1.74-2.35m-4.034-3.39h2.21c.911 0 1.539.555 1.539 1.381 0 .812-.628 1.368-1.54 1.368h-2.21zm2.494 7.05h-2.494V12.74h2.494c.898 0 1.525.57 1.525 1.396 0 .84-.627 1.41-1.525 1.41M61.188 17.042h2.323l2.766-5.498h.228v5.498h1.568V9.635h-2.324l-2.765 5.498h-.228V9.635h-1.568zM69.146 19.25h1.64v-2.208h5.33v2.208h1.64v-3.703h-1.283V9.635h-5.431l-.37 3.79c-.13 1.338-.528 2.121-1.34 2.121h-.186zm2.494-3.703c.4-.385.57-1.04.685-2.151l.228-2.265h2.28v4.416zM86.025 13.253c0-2.136-1.597-3.76-3.849-3.76s-3.848 1.61-3.848 3.846 1.596 3.846 3.848 3.846c1.54 0 2.994-.727 3.55-2.137l-1.54-.256c-.356.527-1.04.897-1.91.897-1.254 0-2.081-.77-2.238-1.909h5.958c.015-.156.029-.327.029-.527m-3.849-2.336c1.027 0 1.796.655 2.067 1.581h-4.105c.27-.954 1.04-1.58 2.038-1.58M90.837 17.185c2.324 0 3.963-1.596 3.963-3.846s-1.64-3.846-3.963-3.846-3.962 1.595-3.962 3.846c0 2.25 1.639 3.846 3.962 3.846m0-1.496c-1.34 0-2.252-.954-2.252-2.35s.912-2.35 2.252-2.35 2.252.954 2.252 2.35-.912 2.35-2.252 2.35" class="_ru"></path><path fill="var(--btn-color, #fff)" d="M35.02 17.36h-2.484L29 7.422h1.832l2.826 8.188h.284l2.925-8.188h1.803zM43.43 12.215l4.6 5.144h-2.243l-3.749-4.256h-.426v4.256h-1.704V7.423h1.704v4.045h.412l3.55-4.045h2.101zM56.808 17.36h-2.485l-3.536-9.937h1.832l2.826 8.188h.284l2.925-8.188h1.803zM63.257 17.36h-1.633v-7.33h1.633zm-.809-8.373q-.455 0-.738-.268a.97.97 0 0 1-.284-.718.97.97 0 0 1 .284-.72q.297-.28.738-.281.44 0 .724.282a.97.97 0 0 1 .284.719.97.97 0 0 1-.284.718q-.284.268-.724.268M68.382 17.5q-1.037 0-1.86-.48a3.5 3.5 0 0 1-1.293-1.352q-.454-.874-.454-1.973t.454-1.96a3.37 3.37 0 0 1 1.293-1.352 3.55 3.55 0 0 1 1.86-.494q.894 0 1.59.367.696.352 1.136.888V7.423h1.633v9.936h-1.22l-.342-1.184a4 4 0 0 1-1.164.944q-.71.381-1.633.381m.397-1.452q1.038 0 1.676-.648.654-.663.653-1.705 0-1.044-.653-1.692-.639-.662-1.675-.662-1.023 0-1.662.662-.639.649-.639 1.692t.64 1.705q.638.648 1.66.648M81.929 13.61q0 .211-.029.522h-5.935q.113.86.71 1.38.597.508 1.52.508.624 0 1.121-.24.51-.24.781-.648l1.534.254a3 3 0 0 1-1.378 1.564q-.965.55-2.158.55-1.108 0-1.988-.48a3.6 3.6 0 0 1-1.363-1.352q-.483-.874-.483-1.973t.483-1.96a3.5 3.5 0 0 1 1.363-1.352q.88-.495 1.988-.494 1.107 0 1.974.494.88.478 1.363 1.339.497.845.497 1.888M78.095 11.3q-.738 0-1.292.423-.54.422-.739 1.141h4.09a2.17 2.17 0 0 0-.767-1.127q-.54-.437-1.292-.437M86.751 17.5q-1.136 0-2.044-.48a3.66 3.66 0 0 1-1.406-1.352q-.497-.874-.497-1.973t.497-1.96q.511-.873 1.406-1.352.909-.495 2.044-.494 1.137 0 2.031.494a3.4 3.4 0 0 1 1.406 1.353q.51.86.511 1.959 0 1.098-.511 1.973a3.53 3.53 0 0 1-1.406 1.353q-.894.48-2.03.479m0-1.48q.995 0 1.62-.634.624-.648.624-1.691t-.625-1.678q-.624-.648-1.619-.648-.993 0-1.618.648-.625.634-.625 1.678 0 1.043.625 1.69.625.636 1.618.635" class="_en"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M7 8.6c0-1.96 0-2.94.381-3.689a3.5 3.5 0 0 1 1.53-1.53C9.66 3 10.64 3 12.6 3h1.36c2.464 0 3.696 0 4.638.48a4.4 4.4 0 0 1 1.922 1.922c.48.942.48 2.174.48 4.638v3.92c0 2.464 0 3.696-.48 4.638a4.4 4.4 0 0 1-1.922 1.922c-.942.48-2.174.48-4.638.48H12.6c-1.96 0-2.94 0-3.689-.381a3.5 3.5 0 0 1-1.53-1.53C7 18.34 7 17.36 7 15.4zm9.265 1.744c.901.539 1.352.808 1.505 1.157.133.304.133.65 0 .954-.153.349-.604.618-1.505 1.157l-2.386 1.425c-.943.563-1.414.844-1.802.807a1.2 1.2 0 0 1-.847-.48C11 15.05 11 14.5 11 13.403v-2.85c0-1.098 0-1.647.23-1.96.201-.274.51-.45.847-.481.388-.037.86.244 1.802.807zM5 9.04c0-2.464 0-3.696.48-4.638a4.4 4.4 0 0 1 .955-1.253 3.7 3.7 0 0 0-1.033.33A4.4 4.4 0 0 0 3.48 5.403C3 6.344 3 7.576 3 10.04v3.92c0 2.464 0 3.696.48 4.638a4.4 4.4 0 0 0 1.922 1.922c.304.155.637.26 1.033.33a4.4 4.4 0 0 1-.955-1.252C5 18.656 5 17.424 5 14.96z" clip-rule="evenodd"></path></svg>');var yu={hash:"svelte-1nhjml",code:'svg[data-testid="vk-video-logo-icon--short"] ._ru,\n  svg[data-testid="vk-video-logo-icon--short"] ._en,\n  svg[data-testid="vk-video-logo-icon"] ._en,\n  svg[data-testid="vk-video-logo-icon--en"] ._ru {visibility:hidden;opacity:0;}'};function wu(e,t){mr(e,yu);let i=fa(t,"short",3,!1),r=fa(t,"isCyrillic",3,!0),a=ne((()=>r()||i()?i()?21:95:91)),s=ne((()=>r()||i()?i()?"vk-video-logo-icon--short":"vk-video-logo-icon":"vk-video-logo-icon--en")),n=ne((()=>`0 0 ${xt(a)+1} 24`));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=_u();let a;cr(Oe(r),(()=>t.children??N)),$e(4),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"95",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),ji(e,r)}(e,{get width(){return xt(a)},height:"24",get viewBox(){return xt(n)},get"data-testid"(){return xt(s)}})}function Su(e,t){pi(t,!0);let[i,r]=la(),a=fa(t,"ref",15,void 0),s=fa(t,"logoClickable",3,!1),n=fa(t,"targetUrl",3,""),o=ba(),l=Na(),u=l.ui.currentGridType$,d=l.ui.isMobile,c=l.ui.t,h=l.isCyrillicRelatedInterface$,p=ne((()=>"vk_video"===o.logoType?c("tooltip_vk_video_logo"):c("tooltip_vk_logo"))),f=ne((()=>"vk_video"===o.logoType||"vk_video_mobile"===o.logoType)),m=ne((()=>(oa(d,"$isMobile",i)||uu(oa(u,"$currentGridType$",i),"l"))&&xt(f))),g=ne((()=>!s())),v=ne((()=>xt(f)?"btn-vk-video-logo":"btn-vk-logo"));Ko(e,{className:"btn-full-opacity",get disabled(){return xt(g)},click:()=>{t.click(),l.callbacks?.onLogoClicked?l.callbacks?.onLogoClicked():n()&&window.open(n(),"_blank")},get testId(){return xt(v)},get ariaLabel(){return xt(p)},get ref(){return a()},set ref(e){a(e)},children:(e,t)=>{var r=Fi(),a=Be(r),s=e=>{wu(e,{get short(){return xt(m)},get isCyrillic(){return oa(h,"$isCyrillicRelatedInterface$",i)}})},n=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=bu();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"vk-logo-icon",role:"img",...i}))),ji(e,r)}(e,{})};Zi(a,(e=>{xt(f)?e(s):e(n,!1)})),ji(e,r)},$$slots:{default:!0}}),fi(),r()}var ku=Vi('<svg width="24" height="24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="chromecast-mobile-icon" class="svelte-8z1bf5"><g filter="url(#b)" clip-path="url(#a)" class="svelte-8z1bf5"><mask id="c" maskUnits="userSpaceOnUse" x="1.1" y="3.1" width="22" height="18" fill="#000" class="svelte-8z1bf5"><path d="M1.1 3.1h22v18h-22z" class="svelte-8z1bf5"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 5.9c.855 0 1.442 0 1.897.038.445.036.683.103.856.19a2.1 2.1 0 0 1 .918.919c.088.172.155.411.191.856.037.455.038 1.042.038 1.897v4.4c0 .855 0 1.442-.038 1.897-.036.445-.103.683-.19.856a2.1 2.1 0 0 1-.919.918c-.172.088-.411.155-.856.191-.455.037-1.042.038-1.897.038H15a.9.9 0 0 0 0 1.8h1.238c.808 0 1.469 0 2.006-.044.556-.045 1.058-.142 1.527-.381a3.9 3.9 0 0 0 1.704-1.704c.239-.47.336-.971.381-1.527.044-.537.044-1.198.044-2.006V9.762c0-.808 0-1.469-.044-2.006-.045-.556-.142-1.058-.381-1.527a3.9 3.9 0 0 0-1.704-1.704c-.47-.239-.971-.336-1.527-.381-.537-.044-1.198-.044-2.006-.044H6a3.901 3.901 0 0 0-3.678 2.6.9.9 0 0 0 1.697.6A2.101 2.101 0 0 1 6 5.9h10.2ZM3.069 11.52a6.9 6.9 0 0 1 7.413 7.413.9.9 0 0 0 1.795.137 8.7 8.7 0 0 0-9.344-9.344.9.9 0 0 0 .136 1.794Zm.533 3.58c-.161 0-.32.011-.474.034a.9.9 0 1 1-.256-1.782A5.1 5.1 0 0 1 8.65 19.13a.9.9 0 1 1-1.782-.256A3.3 3.3 0 0 0 3.602 15.1Zm-1.5 3.3a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" class="svelte-8z1bf5"></path></mask><path fill-rule="evenodd" clip-rule="evenodd" d="M16.2 5.9c.855 0 1.442 0 1.897.038.445.036.683.103.856.19a2.1 2.1 0 0 1 .918.919c.088.172.155.411.191.856.037.455.038 1.042.038 1.897v4.4c0 .855 0 1.442-.038 1.897-.036.445-.103.683-.19.856a2.1 2.1 0 0 1-.919.918c-.172.088-.411.155-.856.191-.455.037-1.042.038-1.897.038H15a.9.9 0 0 0 0 1.8h1.238c.808 0 1.469 0 2.006-.044.556-.045 1.058-.142 1.527-.381a3.9 3.9 0 0 0 1.704-1.704c.239-.47.336-.971.381-1.527.044-.537.044-1.198.044-2.006V9.762c0-.808 0-1.469-.044-2.006-.045-.556-.142-1.058-.381-1.527a3.9 3.9 0 0 0-1.704-1.704c-.47-.239-.971-.336-1.527-.381-.537-.044-1.198-.044-2.006-.044H6a3.901 3.901 0 0 0-3.678 2.6.9.9 0 0 0 1.697.6A2.101 2.101 0 0 1 6 5.9h10.2ZM3.069 11.52a6.9 6.9 0 0 1 7.413 7.413.9.9 0 0 0 1.795.137 8.7 8.7 0 0 0-9.344-9.344.9.9 0 0 0 .136 1.794Zm.533 3.58c-.161 0-.32.011-.474.034a.9.9 0 1 1-.256-1.782A5.1 5.1 0 0 1 8.65 19.13a.9.9 0 1 1-1.782-.256A3.3 3.3 0 0 0 3.602 15.1Zm-1.5 3.3a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" class="svelte-8z1bf5"></path><path d="m18.097 5.938-.04.498.04-.498Zm.856.19-.227.446.227-.445Zm.918.919-.445.227.445-.227Zm.191.856-.498.04.498-.04Zm0 8.194-.498-.04.498.04Zm-.19.856-.446-.227.445.227Zm-.919.918-.227-.445.227.445Zm-.856.191.04.498-.04-.498Zm-1.86 1.838v-.5.5Zm2.007-.044.04.498-.04-.498Zm1.527-.381-.227-.446.227.446Zm1.704-1.704.445.227-.445-.227Zm.381-1.527.498.04-.498-.04Zm.044-2.006h-.5.5Zm0-4.476h-.5.5Zm-.044-2.006.498-.04-.498.04Zm-.381-1.527.445-.227-.445.227ZM19.77 4.525l-.227.446.227-.446Zm-1.527-.381.04-.498-.04.498ZM16.238 4.1v.5-.5ZM6 4.1v-.5.5ZM2.322 6.7l-.471-.167.471.167Zm1.697.6-.471-.167.471.167ZM6 5.9v-.5.5Zm-2.931 5.62-.038-.498.038.498Zm7.413 7.413.498.038-.498-.038Zm1.795.137.498.038-.498-.038ZM2.931 9.725l-.038-.498.038.498Zm-.829.966.499-.038-.499.038Zm1.025 4.443-.071-.495.071.495Zm-1.019-.763.495-.071-.495.07Zm.763-1.02.071.496-.07-.495ZM8.65 19.13l.495.072-.495-.072Zm-1.019.764-.07.494.07-.494Zm-.763-1.02.495.072-.495-.071ZM18.138 5.44c-.48-.04-1.091-.04-1.938-.04v1c.863 0 1.426.001 1.856.036l.082-.996Zm1.042.243c-.255-.13-.567-.205-1.042-.243l-.082.996c.414.034.58.092.67.138l.454-.89Zm1.137 1.137a2.6 2.6 0 0 0-1.137-1.137l-.454.891a1.6 1.6 0 0 1 .7.7l.89-.454Zm.244 1.042c-.04-.475-.114-.787-.244-1.042l-.891.454c.046.09.104.256.138.67l.997-.082ZM20.6 9.8c0-.846 0-1.458-.04-1.938l-.996.082c.035.43.036.993.036 1.856h1Zm0 4.4V9.8h-1v4.4h1Zm-.04 1.938c.04-.48.04-1.092.04-1.938h-1c0 .863-.001 1.426-.036 1.856l.997.082Zm-.243 1.042c.13-.255.205-.567.244-1.042l-.997-.082c-.034.414-.092.58-.138.67l.89.454Zm-1.137 1.137a2.6 2.6 0 0 0 1.137-1.137l-.891-.454a1.6 1.6 0 0 1-.7.7l.454.89Zm-1.042.244c.475-.04.787-.114 1.042-.244l-.454-.891c-.09.046-.256.104-.67.138l.082.997ZM16.2 18.6c.847 0 1.458 0 1.938-.04l-.082-.996c-.43.035-.993.036-1.856.036v1Zm-1.2 0h1.2v-1H15v1Zm-.4.4c0-.22.18-.4.4-.4v-1a1.4 1.4 0 0 0-1.4 1.4h1Zm.4.4a.4.4 0 0 1-.4-.4h-1a1.4 1.4 0 0 0 1.4 1.4v-1Zm1.238 0H15v1h1.238v-1Zm1.965-.042c-.512.042-1.15.042-1.965.042v1c.8 0 1.484 0 2.046-.045l-.081-.997Zm1.34-.329c-.386.198-.815.286-1.34.329l.081.997c.587-.049 1.163-.154 1.714-.435l-.454-.89Zm1.486-1.485a3.4 3.4 0 0 1-1.485 1.485l.454.891a4.4 4.4 0 0 0 1.922-1.922l-.89-.454Zm.329-1.341c-.043.525-.131.954-.329 1.34l.891.455c.281-.552.386-1.127.434-1.714l-.996-.081Zm.042-1.965c0 .815 0 1.453-.042 1.965l.997.081c.045-.561.045-1.246.045-2.046h-1Zm0 0h1-1Zm0-4.476v4.476h1V9.762h-1Zm0 0h1-1Zm-.042-1.965c.042.512.042 1.15.042 1.965h1c0-.8 0-1.484-.045-2.046l-.997.081Zm-.329-1.34c.198.386.286.815.329 1.34l.997-.081c-.049-.587-.154-1.162-.435-1.714l-.89.454ZM19.544 4.97a3.4 3.4 0 0 1 1.485 1.485l.891-.454a4.4 4.4 0 0 0-1.922-1.922l-.454.89Zm-1.341-.329c.525.043.954.132 1.34.329l.455-.891c-.552-.281-1.127-.387-1.714-.434l-.081.996ZM16.238 4.6c.815 0 1.453 0 1.965.042l.081-.996c-.562-.046-1.246-.046-2.046-.046v1Zm0 0v-1 1ZM6 4.6h10.238v-1H6v1Zm0-1v1-1Zm0 0a4.401 4.401 0 0 0-4.15 2.933l.944.334A3.401 3.401 0 0 1 6 4.6v-1ZM1.85 6.533a1.4 1.4 0 0 0 .854 1.787l.333-.943a.4.4 0 0 1-.243-.51l-.943-.334Zm.854 1.787a1.4 1.4 0 0 0 1.787-.853l-.943-.334a.4.4 0 0 1-.51.244l-.334.943Zm1.787-.853A1.601 1.601 0 0 1 6 6.4v-1c-1.131 0-2.095.722-2.452 1.733l.943.334ZM16.2 5.4H6v1h10.2v-1ZM3.602 11c-.192 0-.383.007-.571.022l.076.997A6.53 6.53 0 0 1 3.602 12v-1Zm7.4 7.4a7.4 7.4 0 0 0-7.4-7.4v1a6.4 6.4 0 0 1 6.4 6.4h1Zm-.022.571c.015-.188.022-.379.022-.571h-1c0 .167-.006.332-.019.495l.997.076Zm.369.43a.4.4 0 0 1-.369-.43l-.997-.076a1.4 1.4 0 0 0 1.29 1.502l.076-.997Zm.429-.37a.4.4 0 0 1-.43.37l-.075.996a1.4 1.4 0 0 0 1.502-1.29l-.997-.075Zm.024-.631c0 .213-.008.423-.024.632l.997.076c.018-.234.027-.47.027-.708h-1Zm-8.2-8.2a8.2 8.2 0 0 1 8.2 8.2h1a9.2 9.2 0 0 0-9.2-9.2v1Zm-.632.024c.209-.016.42-.024.632-.024v-1c-.238 0-.474.01-.708.027l.076.997Zm-.368.43a.4.4 0 0 1 .368-.43l-.076-.997a1.4 1.4 0 0 0-1.29 1.502l.998-.076Zm.429.368a.4.4 0 0 1-.43-.369l-.996.076a1.4 1.4 0 0 0 1.502 1.29l-.076-.997Zm.168 4.607c.13-.02.265-.029.403-.029v-1c-.185 0-.367.013-.545.039l.142.99Zm-1.585-1.187A1.4 1.4 0 0 0 3.2 15.629l-.142-.99a.4.4 0 0 1-.453-.34l-.99.143Zm1.187-1.585a1.4 1.4 0 0 0-1.187 1.585l.99-.142a.4.4 0 0 1 .34-.453l-.143-.99Zm.801-.057c-.271 0-.538.02-.8.057l.141.99c.216-.031.436-.047.659-.047v-1Zm5.6 5.6a5.6 5.6 0 0 0-5.6-5.6v1a4.6 4.6 0 0 1 4.6 4.6h1Zm-.057.8c.038-.262.057-.529.057-.8h-1c0 .223-.016.443-.047.659l.99.142ZM7.56 20.389A1.4 1.4 0 0 0 9.145 19.2l-.99-.142a.4.4 0 0 1-.453.34l-.142.99Zm-1.187-1.585a1.4 1.4 0 0 0 1.187 1.584l.142-.99a.4.4 0 0 1-.339-.452l-.99-.142Zm.029-.403c0 .138-.01.272-.029.403l.99.142c.026-.178.039-.36.039-.545h-1Zm-2.8-2.8a2.8 2.8 0 0 1 2.8 2.8h1a3.8 3.8 0 0 0-3.8-3.8v1Zm0 .8a2 2 0 0 0-2 2h1a1 1 0 0 1 1-1v-1Zm2 2a2 2 0 0 0-2-2v1a1 1 0 0 1 1 1h1Zm-2 2a2 2 0 0 0 2-2h-1a1 1 0 0 1-1 1v1Zm-2-2a2 2 0 0 0 2 2v-1a1 1 0 0 1-1-1h-1Z" fill="#000" fill-opacity=".12" mask="url(#c)" class="svelte-8z1bf5"></path></g><defs class="svelte-8z1bf5"><clipPath id="a" class="svelte-8z1bf5"><path d="M0 0h24v24H0z" class="svelte-8z1bf5"></path></clipPath><filter id="b" x="-3.4" y="-1.4" width="30.8" height="26.802" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB" class="svelte-8z1bf5"><feFlood flood-opacity="0" result="BackgroundImageFix" class="svelte-8z1bf5"></feFlood><feColorMatrix in="SourceAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha" class="svelte-8z1bf5"></feColorMatrix><feOffset class="svelte-8z1bf5"></feOffset><feGaussianBlur stdDeviation="2.5" class="svelte-8z1bf5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0" class="svelte-8z1bf5"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_4085_178456" class="svelte-8z1bf5"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_4085_178456" result="shape" class="svelte-8z1bf5"></feBlend></filter></defs></svg>'),Tu=Vi('<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="chromecast-icon"><g fill="none" fill-rule="evenodd" class="svelte-8z1bf5"><path class="wave wave1 svelte-8z1bf5" d="M1 18v3h3c0-1.66-1.34-3-3-3z" fill="var(--btn-color, #fff)"></path><path class="wave wave2 svelte-8z1bf5" d="M1 14v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7z" fill="var(--btn-color, #fff)"></path><path class="wave wave3 svelte-8z1bf5" d="M1 10v2a9 9 0 0 1 9 9h2c0-6.08-4.93-11-11-11z" fill="var(--btn-color, #fff)"></path><path d="M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="var(--btn-color, #fff)" class="svelte-8z1bf5"></path><path d="M0 0h24v24H0z" class="svelte-8z1bf5"></path><path d="M5.667 7.44H18.5v9.167h-5.161a11.947 11.947 0 0 0-7.673-7.672V7.44Z" fill="var(--btn-color, #fff)"></path></g></svg>'),Eu={hash:"svelte-8z1bf5",code:".connecting.svelte-8z1bf5 .wave:where(.svelte-8z1bf5) {animation-duration:1s;animation-iteration-count:infinite;}.connecting.svelte-8z1bf5 .wave1:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave1;}.connecting.svelte-8z1bf5 .wave2:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave2;}.connecting.svelte-8z1bf5 .wave3:where(.svelte-8z1bf5) {\n    animation-name: svelte-8z1bf5-wave3;}\n\n  @keyframes svelte-8z1bf5-wave1 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 1;\n    }\n    66% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 1;\n    }\n  }\n\n  @keyframes svelte-8z1bf5-wave2 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 0.3;\n    }\n    66% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 1;\n    }\n  }\n\n  @keyframes svelte-8z1bf5-wave3 {\n    0% {\n      opacity: 0.3;\n    }\n    33% {\n      opacity: 0.3;\n    }\n    66% {\n      opacity: 0.3;\n    }\n    100% {\n      opacity: 1;\n    }\n  }"};function xu(e,t){pi(t,!0);let i=fa(t,"ref",15,void 0),r=fa(t,"isMobile",3,!1),a=fa(t,"click",3,m.noop),s=Na().ui.t,n=ne((()=>t.state===f.ChromecastState.CONNECTED?s("tooltip_chromecast_on"):s("tooltip_chromecast_off")));Ko(e,{get ariaLabel(){return xt(n)},get click(){return a()},testId:"btn-chromecast",get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{!function(e,t){pi(t,!0),mr(e,Eu);let i=fa(t,"isMobile",3,!1),r=ne((()=>t.iconState===f.ChromecastState.CONNECTED)),a=ne((()=>t.iconState===f.ChromecastState.CONNECTING));var s=Fi(),n=Be(s),o=e=>{var t=ku(),i=Oe(t),a=Oe(i),s=Oe(a);$e(),xe(a);var n=Ne(a);$e(),xe(i);var o=Ne(i),l=Oe(o),u=Oe(l);xe(l),$e(),xe(o),xe(t),Bt((()=>{Ar(s,"fill",xt(r)?"#2688EB":"var(--btn-color, #fff)"),Ar(n,"fill",xt(r)?"#2688EB":"var(--btn-color, #fff)"),Ar(u,"fill",xt(r)?"#2688EB":"var(--btn-color, #fff)")})),ji(e,t)},l=e=>{var t=Tu();let i;var s=Oe(t),n=Ne(Oe(s),5);let o;xe(s),xe(t),Bt(((e,r)=>{i=wr(t,0,"svelte-8z1bf5",null,i,e),o=wr(n,0,"svelte-8z1bf5",null,o,r)}),[()=>({connecting:xt(a)}),()=>({hidden:!xt(r)})]),ji(e,t)};Zi(n,(e=>{i()?e(o):e(l,!1)})),ji(e,s),fi()}(e,{get isMobile(){return r()},get iconState(){return t.state}})},$$slots:{default:!0}}),fi()}var $u=Ni('<div class="tooltip-wrapper svelte-5ygsa2"><div><!></div></div>'),Cu={hash:"svelte-5ygsa2",code:'.tooltip-wrapper.svelte-5ygsa2 {position:relative;display:block;}.tooltip.svelte-5ygsa2 {position:absolute;opacity:0;visibility:hidden;transition:opacity 200ms, visibility 200ms;bottom:100%;transform:translateX(-50%);}.pointer.svelte-5ygsa2:after {position:absolute;bottom:0;left:50%;width:0;border-top:5px solid rgba(41, 41, 41, .8);border-right:5px solid transparent;border-left:5px solid transparent;content:" ";font-size:0;line-height:0;transform:translate(-50%, 5px);}.tooltip.active.svelte-5ygsa2 {opacity:1;visibility:visible;}'};function Au(e,t){mr(e,Cu);let i=fa(t,"active",3,!1),r=fa(t,"pointer",3,!1),a=fa(t,"translateXPx",3,0),s=fa(t,"translateYPx",3,0),n=fa(t,"leftOffset",3,0),o=fa(t,"rightOffset",3,0),l=te(void 0),u=te(void 0);let d=ne((()=>function(e){if(!xt(u))return 0;let{width:i}=xt(u).getBoundingClientRect(),r=i/2;return e<r?r+n():e>t.containerWidth-r?t.containerWidth-r-o():e}(a())));var c=$u(),h=Oe(c);let p;cr(Oe(h),(()=>t.children??N)),xe(h),Qr(h,(e=>re(u,e)),(()=>xt(u))),xe(c),Qr(c,(e=>re(l,e)),(()=>xt(l))),Bt((e=>{kr(c,`transform: translate(${xt(d)}px, ${s()}px);`),p=wr(h,1,"tooltip svelte-5ygsa2",null,p,e),kr(h,`opacity: ${i()?1:0}; visibility: ${i()?"visible":"hidden"}`)}),[()=>({active:i(),pointer:r()})]),ji(e,c)}var Pu=(e,t,i)=>i.filter((i=>i.time<=e*t)).pop(),Lu=Ni('<div class="preview svelte-1wqg760"></div>'),Mu=Ni('<div class="time svelte-1wqg760"> </div>'),Iu=Ni('<div><!> <div class="episode svelte-1wqg760"><!></div> <!></div>'),Ru={hash:"svelte-1wqg760",code:".timeline-preview.svelte-1wqg760 {bottom:18px;border-radius:2px;pointer-events:none;}.timeline-preview.mobile.svelte-1wqg760 {bottom:72px;}.preview.svelte-1wqg760 {background-color:var(--timeline-preview-bg);box-shadow:0 0 2px var(--timeline-preview-shadow), 0 8px 24px var(--timeline-preview-shadow);border-radius:8px;border:1px solid var(--white);}.episode.svelte-1wqg760 {margin-top:10px;margin-bottom:4px;font-size:13px;line-height:16px;text-shadow:0 8px 24px var(--timeline-preview-shadow), 0 0 2px var(--timeline-preview-shadow);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:center;font-weight:500;}.time.svelte-1wqg760 {font-size:13px;line-height:16px;text-align:center;color:var(--white);text-shadow:0 8px 24px var(--timeline-preview-shadow), 0 0 2px var(--timeline-preview-shadow);font-weight:500;}"};function Du(e,t){pi(t,!0),mr(e,Ru);let[i,r]=la(),a=()=>oa(f,"$rotateAlpha",i),s=150,n=278,o=fa(t,"time",3,""),l=fa(t,"isMobile",3,!1),u=fa(t,"videoEpisodes",19,(()=>[])),d=fa(t,"progress",3,0),c=fa(t,"duration",3,0),h=fa(t,"isInteractive",3,!1),p=Na(),f=p.ui.rotateAlpha,m=p.ui.playerSize,g=te(0),v=te(0),b=te(""),_=te(0),y=te(0),w=te(0),S=te(0),k=ne((()=>Pu(d(),c(),u()))),T=ne((()=>(e=>!!(Math.round(Math.abs(e)/90)%2))(a()))),E=ne((()=>(e=>Math.abs(e)/90%4==1)(a()))),x=ne((function(){let e=l()?s:n,{isVertical:t}=A(),r=30;return xt(k)?.text&&(r+=16),(t||xt(T))&&(r+=18,r+=50),Math.min(Math.max(oa(m,"$playerSize",i).height-r,0),e)})),$=ne((()=>(xt(E)?1:-1)*(xt(g)/2-xt(v)/2))),C=ne((()=>-1*xt($)));function A(){let e=t.previewThumbsData.frameWidth,i=t.previewThumbsData.frameHeight,r=i>e;return{width:e,height:i,isHorizontal:!r,isVertical:r}}Rt((()=>{var e;e=function(){let{height:e,isHorizontal:t,isVertical:i,width:r}=A();return t&&(e=e/r*xt(x),r=xt(x)),i&&(r=r/e*xt(x),e=xt(x)),{width:r,height:e}}(),re(g,Ae(e.width)),re(v,Ae(e.height))})),Rt((()=>{var e;e=function(e){let i;i=t.previewThumbsData.isUV?Math.floor(c()*e/t.previewThumbsData.frequency):Math.min(t.previewThumbsData.countTotal,Math.max(0,Math.floor(t.previewThumbsData.countTotal*e)));let r=Math.floor(i/t.previewThumbsData.countPerImage),a=Math.floor(i%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),s=i%t.previewThumbsData.countPerRow,n=Math.floor(t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow);!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&(n=Math.floor(t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage/t.previewThumbsData.countPerRow),t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage%t.previewThumbsData.countPerRow>0&&n++);let o=t.previewThumbsData.countPerRow;!t.previewThumbsData.isUV&&r===Math.floor(t.previewThumbsData.countTotal/t.previewThumbsData.countPerImage)&&t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage>0&&(o=Math.min(t.previewThumbsData.countPerRow,t.previewThumbsData.countTotal%t.previewThumbsData.countPerImage));let l=xt(g)*o,u=xt(v)*n,d=-s*xt(g),h=-a*xt(v);return{imgSrc:t.previewThumbsData.links[r],imgWidth:l,imgHeight:u,imgOffsetX:d,imgOffsetY:h}}(d()),re(b,Ae(e.imgSrc)),re(_,Ae(e.imgWidth)),re(y,Ae(e.imgHeight)),re(w,Ae(e.imgOffsetX)),re(S,Ae(e.imgOffsetY))}));var P=Iu();let L;var M=Oe(P),I=e=>{var t=Lu();Bt((()=>kr(t,`width: ${xt(g)}px; height: ${xt(v)}px; background-image: url(${xt(b)}); background-size: ${xt(_)}px ${xt(y)}px; background-position: ${xt(w)}px ${xt(S)}px;\n    transform: rotate(${a()}deg) ${xt(T)?`translate(${xt($)}px, ${xt(C)}px)`:""};\n    `))),ji(e,t)};Zi(M,(e=>{xt(b)&&e(I)}));var R=Ne(M,2),D=Oe(R),O=e=>{var t=Fi(),i=Be(t),r=e=>{var t=Ui();Bt((e=>qi(t,e)),[()=>$s("tooltip_episode_unfinished")]),ji(e,t)},a=e=>{var t=Ui();Bt((()=>qi(t,xt(k).text||""))),ji(e,t)};Zi(i,(e=>{h()&&!1===xt(k).completed?e(r):e(a,!1)})),ji(e,t)};Zi(D,(e=>{xt(k)&&e(O)})),xe(R);var B=Ne(R,2),N=e=>{var t=Mu(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,o()))),ji(e,t)};Zi(B,(e=>{h()||e(N)})),xe(P),Bt((e=>{L=wr(P,1,"timeline-preview svelte-1wqg760",null,L,e),kr(P,`width: ${xt(T)?xt(v):xt(g)}px;`)}),[()=>({mobile:l()})]),ji(e,P),fi(),r()}var Ou=Ni('<span class="time svelte-1jr6obn"> </span>'),Bu=Ni("<!> <!>",1),Nu={hash:"svelte-1jr6obn",code:".time.svelte-1jr6obn {display:inline-block;padding:6px 10px;border-radius:3px;color:var(--white);background-color:rgba(41, 41, 41, .8);}.timeline-slider {--slider-bg: var(--timeline-slider-bg);--slider-filled-bg: var(--timeline-slider-filled-bg);--slider-handle-bg: var(--timeline-slider-handle-bg);--slider-loaded-bg: var(--timeline-slider-loaded-bg);}"};function Vu(e,t){pi(t,!0),mr(e,Nu);let[i,r]=la(),a=()=>oa(g,"$duration$",i),s=()=>oa(m,"$position$",i),n=()=>oa(T,"$isInteractiveTime$",i),o=()=>oa(v,"$isLive$",i),l=()=>oa(_,"$isMobile",i),u=fa(t,"showTimeline",3,!1),d=fa(t,"withEpisodes",3,!0),c=fa(t,"ref",15,void 0),h=Na(),p=ba(),f=h.state.bufferedProgress$,m=h.state.positionWithScrubbing$,g=h.state.duration$,v=h.state.isLive$,b=h.state.isActiveLive$,_=h.ui.isMobile,y=p.features.episodes&&d()?h.actions.internal.getVideoEpisodes():void 0,w=h.actions.internal.getPreviewThumbsData(),S=h.state.interactiveEpisodes$,k=h.state.isInteractive,T=h.state.isInteractiveTime$,E=h.state.isInteractiveExpectation$,x=h.actions.internal.correctSeekTimeToInteractive,$=h.callbacks?.onDisabledTimelineClick,C=h.ui.controls.disabledControls$,A=h.callbacks?.uiInfo?.onTimelineMouseEnter,P=h.callbacks?.uiInfo?.onTimelineMouseLeave,L=h.ui.t,M=p.features.interactiveResponsiveUi,I=ne((()=>k?oa(S,"$interactiveEpisodes$",i):y)),R=ne((()=>on(a()))),D=ne((()=>on(s()))),O=ne((()=>s()/a())),B=ne((()=>oa(E,"$isInteractiveExpectation$",i)||n())),N=te(!1),V=te(""),U=te(0),F=te(0),j=te(0),z=ne((()=>({containerWidth:xt(F),translateXPx:xt(U),translateYPx:k&&w?-36:-16,active:xt(N)&&u()&&!xt(B)&&!M,pointer:!p.features.timelinePreview||!w||o()}))),W=L("aria_timeline"),q=ne((()=>L("aria_timeline_value",{position:xt(D),duration:xt(R)})));function H(e){return x&&k?x(e*a())/a():e}function K(e,t,i){re(j,Ae(H(e))),re(U,Ae(t)),i&&re(F,Ae(i)),re(V,Ae(function(e){let t=on((o()?1-e:e)*a());return o()?`-${t}`:t}(e)))}var Q=Bu(),G=Be(Q);Au(G,ha((()=>xt(z)),{get leftOffset(){return t.tooltipLeftOffset},get rightOffset(){return t.tooltipRightOffset},children:(e,t)=>{var i=Fi(),r=Be(i),s=e=>{Du(e,{get time(){return xt(V)},get isMobile(){return l()},get videoEpisodes(){return xt(I)},previewThumbsData:w,get progress(){return xt(j)},get duration(){return a()},isInteractive:k})},n=e=>{var t=Ou(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,xt(V)))),ji(e,t)};Zi(r,(e=>{p.features.timelinePreview&&w&&!o()?e(s):e(n,!1)})),ji(e,i)},$$slots:{default:!0}}));var Y=Ne(G,2);let X=ne((()=>Math.round(100*xt(O)))),Z=ne((()=>oa(C,"$disabledControls$",i).has("TIMELINE")));ou(Y,{className:"timeline-slider",get isActiveLive(){return oa(b,"$isActiveLive$",i)},get isMobile(){return l()},ariaLabel:W,ariaValueMin:0,get ariaValueMax(){return a()},get ariaValueNow(){return xt(X)},get ariaValueText(){return xt(q)},get loadedProgress(){return oa(f,"$bufferedProgress$",i)},get filledProgress(){return xt(O)},get handleProgress(){return xt(O)},get videoEpisodes(){return xt(I)},onPointerDown:function(e){h.actions.internal.startScrubbing(H(e))},onHandleMove:function(e){n()||h.actions.internal.progressScrubbing(H(e))},onPointerMove:function(e,t,i){K(e,t,i),re(N,!0)},onPointerUp:function(e){h.actions.internal.completeScrubbing(H(e)),re(N,!1)},onPointerEnter:function(e,t,i){K(e,t,i),re(N,!0)},onPointerLeave:function(){re(N,!1)},onMouseEnter:A,onMouseLeave:P,onDisabledClick:$,isInteractive:k,get disabled(){return xt(Z)},get hideHandel(){return n()},get ref(){return c()},set ref(e){c(e)}}),ji(e,Q),fi(),r()}var Uu={hash:"svelte-1yate8h",code:".timeline-ads-slider {--slider-bg: var(--timeline-slider-bg);--slider-filled-bg: var(--timeline-slider-filled-bg);--slider-handle-bg: var(--timeline-slider-handle-bg);--slider-loaded-bg: var(--timeline-slider-loaded-bg);}"};function Fu(e,t){pi(t,!0),mr(e,Uu);let[i,r]=la(),a=fa(t,"position",3,0),s=fa(t,"duration",3,0),n=Na(),o=n.ui.isMobile,l=n.ui.t,u=ne((()=>on(s()))),d=ne((()=>on(a()))),c=ne((()=>a()/s())),h=ne((()=>l("aria_timeline_value",{position:xt(d),duration:xt(u)}))),p=ne((()=>Math.round(100*xt(c))));ou(e,{className:"timeline-ads-slider",ariaValueMin:0,get ariaValueMax(){return s()},get ariaValueNow(){return xt(p)},get ariaValueText(){return xt(h)},get filledProgress(){return xt(c)},hideHandel:!0,get squareBorders(){return oa(o,"$isMobile",i)}}),fi(),r()}var ju=Ni("<div><!></div>"),zu=Ni("<div></div>"),Wu={hash:"svelte-1h5wsmk",code:".timeline.svelte-1h5wsmk {position:relative;pointer-events:all;display:flex;align-items:center;bottom:0;width:100%;min-width:86px;padding:3px 10px 4px;box-sizing:border-box;}.timeline.mobile.svelte-1h5wsmk {height:16px;padding:6px 12px 7px;margin-top:6px;}.withoutPadding.svelte-1h5wsmk {padding:0;}.timeline-stub.svelte-1h5wsmk {width:100%;min-width:20px;}.timeline-stub.mobile.svelte-1h5wsmk {height:8px;}"};function qu(e,t){pi(t,!0),mr(e,Wu);let[i,r]=la(),a=()=>oa(c,"$isLive$",i),s=()=>oa(f,"$isMobile",i),n=fa(t,"isAds",3,!1),o=fa(t,"isHidden",3,!1),l=fa(t,"needPadding",3,!0),u=fa(t,"ref",15,void 0),d=Na(),c=d.state.isLive$,h=d.ads.duration,p=d.ads.position,f=d.ui.isMobile,m=ne((()=>!o()&&(!a()||a()&&t.canRewindLive&&t.isRewindableLive||n())));var g=Fi(),v=Be(g),b=e=>{var r=ju();let a;var o=Oe(r),d=e=>{Fu(e,{get position(){return oa(p,"$adPosition",i)},get duration(){return oa(h,"$adDuration",i)}})},c=e=>{Vu(e,{get tooltipLeftOffset(){return t.tooltipLeftOffset},get tooltipRightOffset(){return t.tooltipRightOffset},get showTimeline(){return xt(m)},get withEpisodes(){return t.withEpisodes},get ref(){return u()},set ref(e){u(e)}})};Zi(o,(e=>{n()?e(d):e(c,!1)})),xe(r),Bt((e=>a=wr(r,1,"timeline svelte-1h5wsmk",null,a,e)),[()=>({withoutPadding:!l(),mobile:s()})]),ji(e,r)},_=e=>{var t=zu();let i;Bt((e=>i=wr(t,1,"timeline-stub svelte-1h5wsmk",null,i,e)),[()=>({mobile:s()})]),ji(e,t)};Zi(v,(e=>{xt(m)?e(b):e(_,!1)})),ji(e,g),fi(),r()}var Hu=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="m21.616 16.495-.012.07c-.156.852-.282 1.541-.427 2.093-.148.569-.333 1.063-.64 1.5a4.4 4.4 0 0 1-2.507 1.732c-.52.133-1.046.131-1.63.069-.568-.06-1.257-.187-2.11-.343l-4.34-.794c-.853-.156-1.542-.282-2.094-.426-.568-.149-1.062-.334-1.5-.642a4.4 4.4 0 0 1-1.731-2.507c-.133-.518-.131-1.045-.069-1.63.06-.567.187-1.257.343-2.11l.012-.068c.156-.853.282-1.542.427-2.095.148-.568.333-1.062.641-1.5a4.4 4.4 0 0 1 2.507-1.731c.518-.133 1.045-.131 1.63-.069.567.06 1.256.187 2.109.343l4.34.794c.853.156 1.542.282 2.094.426.568.149 1.062.334 1.5.642a4.4 4.4 0 0 1 1.731 2.506c.133.52.131 1.046.069 1.63-.06.568-.187 1.258-.343 2.11m-1.446-2.3c.052-.483.035-.769-.022-.993a2.6 2.6 0 0 0-1.023-1.481c-.19-.133-.45-.25-.921-.373-.48-.125-1.102-.24-1.997-.404l-4.272-.781c-.895-.164-1.518-.277-2.01-.33-.483-.051-.769-.035-.993.023-.6.153-1.125.516-1.481 1.023-.133.19-.25.45-.373.92-.125.48-.24 1.103-.403 1.998s-.277 1.518-.33 2.01c-.051.484-.035.77.023.994.153.6.516 1.125 1.023 1.481.189.133.45.25.92.373.48.125 1.102.24 1.997.404l4.272.781c.895.164 1.518.277 2.01.33.483.051.77.035.993-.023a2.6 2.6 0 0 0 1.481-1.023c.133-.19.25-.45.373-.92.125-.48.24-1.103.403-1.998s.278-1.518.33-2.01Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M18.187 7.488a.9.9 0 0 1-1.045-.727c-.145-.807-.199-1.086-.28-1.296A2.6 2.6 0 0 0 14.504 3.8c-.224-.006-.505.036-1.315.169l-5.846.962c-1.366.224-1.834.313-2.174.492A2.6 2.6 0 0 0 3.837 7.18c-.08.376-.039.85.114 2.226l.011.1a.9.9 0 1 1-1.787.198l-.01-.093-.019-.17c-.129-1.147-.217-1.937-.068-2.636A4.4 4.4 0 0 1 4.332 3.83c.633-.333 1.417-.461 2.556-.648l.163-.027 5.846-.961.098-.016c.674-.111 1.138-.188 1.556-.177a4.4 4.4 0 0 1 3.99 2.819c.15.39.234.853.355 1.526l.017.097a.9.9 0 0 1-.726 1.045" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M12.724 12.414a.415.415 0 0 0-.69.231l-.72 4.18a.4.4 0 0 0 .025.221c.085.21.327.311.539.226l3.669-1.467a.406.406 0 0 0 .127-.68z"></path></svg>');var Ku=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4.146 3.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L6.793 6.5 4.146 3.854a.5.5 0 0 1 0-.708" clip-rule="evenodd" opacity=".7"></path></svg>');var Qu=Ni('<span class="text mobile svelte-1yhs2ga"> </span> <div class="chevron-episodes svelte-1yhs2ga"><!></div>',1),Gu=Ni('<span class="text svelte-1yhs2ga"> </span>'),Yu=Ni('<span class="text count svelte-1yhs2ga"> </span>'),Xu=Ni("<!> <!>",1),Zu={hash:"svelte-1yhs2ga",code:".text.svelte-1yhs2ga {padding:0 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.text.count.svelte-1yhs2ga {overflow:visible;}.text.mobile.svelte-1yhs2ga {padding:0 3px 0 4px;}.chevron-episodes.svelte-1yhs2ga {margin-bottom:-4px;}"};function Ju(e,t){pi(t,!0),mr(e,Zu);let[i,r]=la(),a=()=>oa(p,"$currentGridType$",i),s=()=>oa(g,"$panelOpened$",i),n=()=>oa(v,"$isMobile",i),o=fa(t,"position",3,0),l=fa(t,"duration",3,0),u=fa(t,"timeCodes",19,(()=>[])),d=Na(),c=d.callbacks?.onEpisodeChanged??m.noop,h=!!d.callbacks?.onEpisodeClicked,p=d.ui.currentGridType$,f=d.ui.episodes.openedByKeyboard$,g=d.ui.episodes.panelOpened$,v=d.ui.isMobile,b=d.ui.t,_=te(void 0),y=e=>{if(d.callbacks?.onEpisodeClicked){let t=En(e);f.set(t),g.set(!0),d.callbacks?.onEpisodeClicked?.(t)}},w=te(null),S=ne((()=>o()/l()));Rt((()=>{let e=Pu(xt(S),l(),u());e?xt(w)?.time!==e.time&&(c(e),re(w,Ae(e))):re(w,null)}));let k=ne((()=>xt(w)?.text||"")),T=ne((()=>lu(a(),"xl")?"FULL":lu(a(),"m")&&((e,t)=>Ma[e]<Ma[t])(a(),"xl")?"COUNT":"SHORT")),E=ne((()=>`${b("tooltip_episodes")}: ${xt(k)}`));Rt((()=>{(async(e,t,i)=>{await Et(),"false"===e?.getAttribute("aria-expanded")&&t&&!i&&$t((()=>{f.set(!1),e.focus()}))})(xt(_),oa(f,"$openedByKeyboard$",i),s())}));var x=Fi(),$=Be(x),C=e=>{let t=ne((()=>n()?"px-0":""));Ko(e,{get className(){return`w-max btn-full-opacity btn-jc-l ${xt(t)??""}`},testId:"btn-episodes",click:y,disabled:!h,get ariaExpanded(){return s()},get ariaLabel(){return xt(E)},get ref(){return xt(_)},set ref(e){re(_,Ae(e))},children:(e,t)=>{var i=Fi(),r=Be(i),a=e=>{var t=Qu(),i=Be(t),r=Oe(i,!0);xe(i);var a=Ne(i,2);(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Ku();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"13",fill:"none","aria-hidden":"true","data-testid":"chevron-light-icon",role:"img",...i}))),ji(e,r)})(Oe(a),{}),xe(a),Bt((()=>qi(r,xt(k)))),ji(e,t)},s=e=>{var t=Xu(),i=Be(t);!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Hu();let a;cr(Oe(r),(()=>t.children??N)),$e(3),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"episodes-icon",style:"flex-shrink:0",role:"img",...i}))),ji(e,r)}(i,{});var r=Ne(i,2),a=e=>{var t=Gu(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,xt(k)))),ji(e,t)},s=(e,t)=>{var i=e=>{var t=Yu(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,u().length))),ji(e,t)};Zi(e,(e=>{"COUNT"===xt(T)&&e(i)}),t)};Zi(r,(e=>{"FULL"===xt(T)?e(a):e(s,!1)})),ji(e,t)};Zi(r,(e=>{n()?e(a):e(s,!1)})),ji(e,i)},$$slots:{default:!0}})};Zi($,(e=>{xt(w)&&e(C)})),ji(e,x),fi(),r()}var ed,td,id,rd=(e,t)=>e<400||t<225?5:e<640||t<360?0:e<960||t<540?1:e<1280||t<720?2:3,ad=class{init(e,t,i){this.actions=e,this.adsState=t,this.playerState=i}onAdmanLoadingError(){this.onAdError("adman loading error")}initAdman(e){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init","already inited: "+!!this.adman],numbers:[(0,m.now)(),e.slotId]}),this.adman)return;this.events.init$.next(),this.startWatchDog();let t,{width:i,height:r,isFullscreen:a,isAutoplay:s,adsContainer:n,adsVideoElement:o,slotId:l,params:u={},duration:d,previewParam:c}=e,h=this.playerState&&aa(this.playerState.vsid);h&&(t=this.isVsidOriginal?h:parseInt(h,36));let{isEmbed:p,immediateOrigin:f}=(0,m.detectEmbed)(),g=(p?f:window.location.href)??window.location.href,v={...u,dl:encodeURIComponent(g),autoplay:s?1:0,player_width:i,player_height:r,preview:c,...t?{request_id:t}:{},duration:d,puid10:rd(i,r),puid11:a?0:1};c||delete v.preview;let b={slot:l,wrapper:n,videoEl:o,videoQuality:r,params:v,browser:{mobile:!1}};try{let e=new window.AdmanHTML;e.setDebug(!1),e.onReady(this.onAdsReady),e.onStarted(this.onAdStarted),e.onPlayed(this.onAdPlayed),e.onPaused(this.onAdPaused),e.adMidrollPoint(this.onAdMidrollPoint),e.onClosed(this.onAdClosed),e.onSkipped(this.onAdSkipped),e.onClicked(this.onAdClicked),e.onTimeRemained(this.onAdTimeRemained),e.onCompleted(this.onAdCompleted),e.onError(this.onAdError),e.init(b),this.adman=e,this.videoElement=o,this.events.slotRequested$.next(),this.log({message:`adman init, config: ${JSON.stringify(b)}`})}catch(e){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_threw",String(e)],numbers:[(0,m.now)()]}),this.onAdError("could not init adman")}}switchToVideo(e=!1){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_switch_to_video",this.currentAdSection??"","force: "+e],numbers:[(0,m.now)()]}),null===this.currentAdSection&&!e)return void this.log({message:"switch to video, no currentAdSection. can't switch"});let t="postroll"===this.currentAdSection;if(this.actions){if(this.adsState&&this.playerState)this.adsState.playbackState.set("inactive"),this.currentAdSection=null,this.playerState.mobileUnmuteButtonVisible.set(!1),this.log({message:`switch to video, isPostroll: ${t}`}),t&&(this.adsState.postrollPassed.set(!0),this.log({message:"postroll passed"}));else{let e="Switch to video: Adman state was not updated correctly";this.log({message:e}),this.events.error$.next(e)}this.actions.switchFromAdsToVideo?.(!t)}}togglePlay(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_toggle_play",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adsState){this.log({message:"toggle play"});let e=aa(this.adsState.playbackState);"playing"===e?this.pause():"paused"===e&&this.play()}else this.onAdError("Can not toggle play: Adman state is not initialized")}setInitialVolume(e){this.log({message:`set initial volume ${e}`}),this.initialVolume=e}setVolume(e){let t=e*this.volumeMultiplier;if(this.log({message:`set volume ${t}`}),this.adman)try{this.adman.setVolume(t)}catch{this.onAdError("could not set ad volume")}this.videoElement&&(this.videoElement.volume=t)}setFullscreen(e){if(this.log({message:`set fullscreen ${e}`}),this.adman)try{this.adman.setFullscreen(e)}catch{this.onAdError("could not set ad fullscreen")}}startPreroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_preroll"],numbers:[(0,m.now)()]}),this.adman){if(!this.isDestroyed){this.log({message:"start preroll"}),this.setVolume(this.initialVolume),this.currentAdSection="preroll",this.startWatchDog();try{this.adman.start("preroll")}catch{this.onAdError("could not start preroll")}}}else this.onAdError("Can not start preroll: Adman is not initialized")}startPostroll(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_start_postroll",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"start postroll"}),this.actions.switchFromVideoToAds(),this.currentAdSection="postroll",this.startWatchDog();try{this.adman.start("postroll")}catch{this.onAdError("could not start postroll")}}else this.onAdError("Can not start postroll: Adman is not initialized")}startWatchDog(){this.watchDogTimeout&&clearTimeout(this.watchDogTimeout),this.watchDogTimeout=window.setTimeout((()=>this.onAdError("Watchdog timeout")),this.runtimeTimeout)}stopWatchDog(){clearTimeout(this.watchDogTimeout)}play(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pplay",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.log({message:"ad play"}),this.startWatchDog();try{this.adman.resume(),this.events.resumed$.next()}catch{this.onAdError("could not resume ad")}}else this.onAdError("Can not play: Adman is not initialized")}pause(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_pause",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad pause"});try{this.adman.pause(),this.events.paused$.next()}catch{this.onAdError("could not pause ad")}}else this.onAdError("Can not pause: Adman is not initialized")}skip(){if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_skip",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.adman){this.stopWatchDog(),this.log({message:"ad skip"});try{this.adman.skip(),this.events.skipped$.next()}catch{this.onAdError("could not skip ad")}}else this.onAdError("Can not skip: Adman is not initialized")}setPosition(e,t){this.adman?.setPosition(Math.floor(e),Math.floor(t))}destroy(){m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_destroy"],numbers:[(0,m.now)()]}),this.log({message:"destroy"}),this.stopWatchDog(),this.adman?.onReady(void 0),this.adman?.onStarted(void 0),this.adman?.onPlayed(void 0),this.adman?.onPaused(void 0),this.adman?.adMidrollPoint(void 0),this.adman?.onClosed(void 0),this.adman?.onSkipped(void 0),this.adman?.onClicked(void 0),this.adman?.onTimeRemained(void 0),this.adman?.onCompleted(void 0),this.adman?.onError(void 0),this.adman?.destroy(),this.videoElement&&(0,m.clearVideoElement)(this.videoElement),this.isDestroyed=!0}constructor(e,t){this.adman=null,this.initialVolume=1,this.videoElement=null,this.currentAdSection=null,this.actions=null,this.adsState=null,this.playerState=null,this.events={init$:new m.Subject,loadStarted$:new m.Subject,loadEnded$:new m.Subject,loadError$:new m.Subject,ready$:new m.Subject,slotRequested$:new m.Subject,started$:new m.Subject,timeRemained$:new m.Subject,paused$:new m.Subject,resumed$:new m.Subject,ended$:new m.Subject,empty$:new m.Subject,skipped$:new m.Subject,clicked$:new m.Subject,closed$:new m.Subject,error$:new m.Subject},this.loadAdman=e=>(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_start",this.useAdmanFromNPM?"npm":"http"],numbers:[(0,m.now)()]}),this.useAdmanFromNPM?this.loadAdmanNPM(e):this.loadAdmanMailRu(e)),this.loadAdmanMailRu=e=>new Promise(((t,i)=>{let r;this.events.loadStarted$.next();let a=()=>{clearTimeout(r),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_async_init_done","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","http"],numbers:[(0,m.now)()]}),i())};(0,m.addScript)("//ad.mail.ru/static/admanhtml/rbadman-html5.min.js",e,this.loadTimeout).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_loaded","http"],numbers:[(0,m.now)()]}),window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","http"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","http"],numbers:[(0,m.now)()]}),window.admanAsyncInit=a,r=window.setTimeout(a,this.initTimeout))})).catch((e=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_script_load_error","http",String(e)],numbers:[(0,m.now)()]}),i(),clearTimeout(r)}))})),this.loadAdmanNPM=e=>new Promise(((t,r)=>{let a;this.events.loadStarted$.next();let s=()=>{clearTimeout(a),delete window.admanAsyncInit,window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_done","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_init_timed_out","npm"],numbers:[(0,m.now)()]}),r())},n=()=>{o=!0,r()},o=!1,l=window.setTimeout((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_timed_out","npm"],numbers:[(0,m.now)()]}),n()}),this.loadTimeout);e.addEventListener("abort",n),e.aborted&&(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_load_aborted","npm"],numbers:[(0,m.now)()]}),n()),window.AdmanHTML=window.AdmanHTML||null,i.e(5153).then(i.t.bind(i,25153,19)).then((()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_chunk_imorted","npm","failed: "+String(o)],numbers:[(0,m.now)()]}),!o&&(window.AdmanHTML?(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_already_inited","npm"],numbers:[(0,m.now)()]}),t(),this.events.loadEnded$.next()):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_wait_async_init","npm"],numbers:[(0,m.now)()]}),window.admanAsyncInit=s,a=window.setTimeout(s,this.initTimeout)))}),n).finally((()=>{clearTimeout(a),clearTimeout(l),e.removeEventListener("abort",n)}))})),this.onAdsReady=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ads_ready"],numbers:[(0,m.now)()]}),this.log({message:"ads ready"}),this.events.ready$.next(),this.startPreroll()},this.onAdStarted=(e,t)=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_started",e,"muted: "+t.muted],numbers:[(0,m.now)(),t.bannerID]}),this.adsState&&this.playerState&&this.actions?(this.log({message:`ad started, section: ${e}, banner: ${JSON.stringify(t)}`}),this.events.started$.next(e),t.muted&&(this.setVolume(0),this.actions.setMuted(!0),this.log({message:"ad muted start"}),aa(this.playerState.isMobile)&&this.playerState.mobileUnmuteButtonVisible.set(!0)),this.adsState.duration.set(t.duration),this.adsState.playbackState.set("playing"),this.adsState.canSkip.set(t.allowClose),this.adsState.secondsToWatchBeforeSkip.set(t.allowCloseDelay),this.startWatchDog()):this.onAdError("Started callback failed: Adman is not initialized")},this.onAdTimeRemained=e=>{this.adsState?(this.adsState.position.set(e.currentTime),this.events.timeRemained$.next(e),this.startWatchDog()):this.onAdError("TimeRemained callback failed: Adman state is not initialized")},this.onAdPaused=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_pased",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.stopWatchDog(),this.adsState?(this.log({message:"ad paused"}),this.adsState.playbackState.set("paused")):this.onAdError("Paused callback failed: Adman state is not initialized")},this.onAdPlayed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_played",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.startWatchDog(),this.adsState?(this.log({message:"ad played"}),this.adsState.playbackState.set("playing")):this.onAdError("Player callback failed: Adman is not initialized")},this.onAdMidrollPoint=()=>{if(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_midroll_pioint"],numbers:[(0,m.now)()]}),this.adman&&this.actions){this.log({message:"midroll point"}),this.actions.switchFromVideoToAds(),this.currentAdSection="midroll",this.startWatchDog();try{this.adman.start("midroll")}catch{this.onAdError("could not start midroll")}}else this.onAdError("Midroll callback failed: Adman is not initialized")},this.onAdSkipped=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_skipped",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad skipped"}),this.stopWatchDog()},this.onAdClosed=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_closed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad closed"}),this.currentAdSection&&this.events.closed$.next(this.currentAdSection),this.stopWatchDog(),this.switchToVideo()},this.onAdCompleted=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_completed",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad completed"}),this.currentAdSection?this.events.ended$.next(this.currentAdSection):this.events.empty$.next(),this.switchToVideo(),this.stopWatchDog()},this.onAdClicked=()=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_clicked",this.currentAdSection??""],numbers:[(0,m.now)()]}),this.log({message:"ad clicked"}),this.videoElement?.pause(),this.currentAdSection&&this.events.clicked$.next(this.currentAdSection),this.stopWatchDog()},this.onAdError=(e="ad error")=>{m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_ad_error",e],numbers:[(0,m.now)()]}),this.log({message:e}),this.events.error$.next(e),this.switchToVideo(!0),this.stopWatchDog()},this.log=e.createComponentLog("AdmanWrapper"),m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","adman_created"],numbers:[(0,m.now)()]}),this.loadTimeout=t.loadTimeout,this.initTimeout=t.initTimeout,this.runtimeTimeout=t.runtimeTimeout,this.useAdmanFromNPM=t.useAdmanFromNPM,this.volumeMultiplier=Math.max(0,Math.min(t.volumeMultiplier,1)),this.isVsidOriginal=t.isVsidOriginal}},sd=e=>{let t=Math.round(e);return isNaN(t)||t<40?"":t>=40&&t<55?50:t>=55&&t<90?60:t>=90&&t<180?120:t>=180?240:""},nd=class{parse(e){let t={startTime:0,endTime:0},i=this.timingRegExp.exec(e);return i&&(t.startTime=this.calcTime(i[1],i[2],i[3],i[4]),t.endTime=this.calcTime(i[6],i[7],i[8],i[9])),t}parseTime(e){let t=this.timeRegExp.exec(e);return t?this.calcTime(t[1],t[2],t[3],t[4]):0}isTime(e){return this.timeRegExp.test(e)}calcTime(e="0",t="0",i="0",r="0"){return 60*Number(e)*60+60*Number(t)+Number(i)+ +`0.${r}`}constructor(){this.timeRegExp=/(\d{2,})?:?(\d{2}):(\d{2}).(\d{2,3})/,this.timingRegExp=new RegExp(`${this.timeRegExp.source}( ?--\x3e ?)${this.timeRegExp.source}`)}},od=class{parse(e){let t={texts:[]},i=e.replace(new RegExp(this.letterTagRegExp,"g"),"").split({[Symbol.split](e){let t=0,i=[];for(;t<e.length;){let r=["<",">"].reduce(((i,r)=>{let a=e.indexOf(r,t);return-1===i||i>a?a:i}),-1);if(-1===r){i.push(e.substring(t));break}i.push(e.substring(t,r)),t=r+1}return i}}),r=new nd;for(let e of i)r.isTime(e)?t.texts.push({type:"timestamp",value:r.parseTime(e)}):t.texts.push({type:"text",value:e});return t}constructor(){this.letterTagRegExp=/<[a-z]*>|<\/[a-z]*>/}},ld=class{parse(e,t){let i=[],r=e.split(this.twoLinesRegExp);for(let e of r){let r={startTime:0,endTime:0,texts:[],lang:t},a=e.split(this.oneLineRegExp);for(let e of a)if(r.startTime||r.endTime){if(""!==e.trim()){let t=new od,{texts:i}=t.parse(e);r.texts=[...r.texts,...i]}}else{let t=new nd,{startTime:i,endTime:a}=t.parse(e);r.startTime=i,r.endTime=a}(r.startTime||r.endTime)&&r.texts.length>0&&i.push(r)}return i}constructor(){this.oneLineRegExp=/\r\n|\n|\r/,this.twoLinesRegExp=/\r\n\r\n|\n\n|\r\r/}},ud=0,dd=!1,cd="",hd=(e,t=0,i=0)=>e<t&&e<i,pd=(e,t=0,i=0)=>e>=t&&e<=i,fd={ru:"Русский",en:"English",uk:"Українська",be:"Беларуская (тарашкевiца)",es:"Español",fi:"Suomi",de:"Deutsch",it:"Italiano",bg:"Български",hr:"Hrvatski",hu:"Magyar",sr:"Српски",pt:"Português",el:"Ελληνικά",pl:"Polski",fr:"Français",ko:"한국어","zh-CN":"汉语",lt:"Lietuvių",ja:"日本語",cs:"Čeština",et:"Eesti",tt:"Татарча",ba:"Башҡортса",cv:"Чăвашла",sk:"Slovenčina",ro:"Română",no:"Norsk",lv:"Latviešu",az:"Azərbaycan dili",hy:"Հայերեն",sv:"Svenska",nl:"Nederlands",tk:"Türkmen",ka:"ქართული",da:"Dansk",uz:"O‘zbek",th:"ภาษาไทย",id:"Bahasa Indonesia",tg:"Тоҷикӣ",sl:"Slovenščina",bs:"Bosanski","pt-BR":"Português brasileiro",fa:"فارسی",vi:"Tiếng Việt",hi:"हिन्दी",si:"සිංහල",bn:"বাংলা",tl:"Tagalog",mn:"Монгол",my:"ဗမာစာ",tr:"Türkçe",ne:"नेपाली",ur:"اردو",ky:"Кыргыз тили",pa:"پنجابی",os:"Ирон",kn:"ಕನ್ನಡ",sw:"Kiswahili",kk:"Қазақша",ar:"العربية",he:"עברית",ab:"Аҧсшәа",eu:"Euskara",eo:"Esperanto"},md={abk:"as",ara:"ar",aze:"az",bak:"ba",bel:"be",ben:"bn",bos:"bs",bul:"bg",ces:"cs",chv:"cv",dan:"da",deu:"de",ell:"el",eng:"en",epo:"eo",est:"et",eus:"eu",fas:"fa",fin:"fi",fra:"fr",heb:"he",hin:"hi",hrv:"hr",hun:"hu",hye:"hy",ind:"id",ita:"it",jpn:"ja",kan:"kn",kat:"ka",kaz:"kk",kir:"ky",kor:"ko",lav:"lv",lit:"lt",mon:"mn",mya:"my",nep:"ne",nld:"nl",nor:"no",oss:"os",pan:"pa",pol:"pl",por:"pt",ron:"ro",rus:"ru",sin:"si",slk:"sk",slv:"sl",spa:"es",srp:"sr",swa:"sw",swe:"sv",tat:"tt",tgk:"tg",tgl:"tl",tha:"th",tuk:"tk",tur:"tr",ukr:"uk",urd:"ur",uzb:"uz",vie:"vi"},gd=e=>fd[e]??fd[md[e]]??void 0,vd=class{destroy(){this.oneStat.destroy(),this.statSubscription.unsubscribe()}constructor(e,t=new m.Subscription){this.oneStat=e,this.statSubscription=t}},bd=((id=bd||{}).DESKTOP_CONTROL_PANEL_LEFT="desktop-control-panel-left",id.DESKTOP_CONTROL_PANEL_RIGHT="desktop-control-panel-right",id),_d=e=>e??0,yd=(e,t)=>{let i=e?.getBoundingClientRect?.(),r=t?.getBoundingClientRect?.();return{top:Math.round(_d(i?.top)-_d(r?.top)),left:Math.round(_d(i?.left)-_d(r?.left)),bottom:Math.round(_d(i?.bottom)-_d(r?.top)),right:Math.round(_d(i?.right)-_d(r?.left))}},wd=e=>{let t=e?.getBoundingClientRect?.();return{width:_d(t?.width),height:_d(t?.height)}},Sd=({interfaceLanguage:e,isCyrillicRelatedInterface:t,videoId:i,isClip:r,isLiveCatchUpMode:a,statAuthToken:s,isAudioDisabled:n,canDownload:o,callbacks:l,webApi:u,videoEpisodes:d,previewThumbsData:c,uiConfig:h,coreConfig:p,player:v,disabledControls:b,isInteractive:_,interactiveRanges$:y,isInteractiveTime$:w,replayInteractive:S,stopPlayer:k,hasInteractiveBranches:T,playPrevChapterDisabledTooltip:E,additionalButtons:x,additionalSettingsMenuItems:$,additionalContextMenuItems:C,playPrevVideo:A,playNextVideo:P,looped:L=!1,statistics:M,saveRate:I,internalsExposure:R,playerView:D})=>{let O={...p,configName:[...p.configName??[],"ui"],isAudioDisabled:n,live:{...p.live??{},isLiveCatchUpMode:!!a}},B=h,N=m.TracerFactory.createRootTracer(B.features.tracer),V=N.createComponentTracer("Store"),U=v||new f.Player(O,N);R?.expose({corePlayer:U});let F,j,z=new m.Logger,W=new ad(z,{loadTimeout:B.ads.loadTimeout,initTimeout:B.ads.initTimeout,runtimeTimeout:B.ads.runtimeTimeout,useAdmanFromNPM:B.ads.useAdmanFromNPM,volumeMultiplier:B.ads.volumeMultiplier,isVsidOriginal:B.ads.isVsidOriginal}),q=Us.getInstance(),H=u?.pictureInPictureApi,K=u?.annotationsApi,Q=u?.slotsApi,G=z.createComponentLog("Store"),Y={},X=new ja,Z=M?Ua(M.oneStat.vsid$):ta(void 0),J=ia(qs()),ee=ia(!1),te=H?.info.isActive$??new m.ValueSubject(!1),ie=ia(0),re=ia([]),ae=(0,m.merge)(U.events.fatalError$,U.events.managedError$).subscribe((e=>re.update((t=>[...t,e])))),se=ta(!1,(e=>{let t=U.events.fatalError$.subscribe((()=>e(!0)));return()=>t.unsubscribe()})),ne=async e=>{let t=Object.values(m.InterfaceLanguage).includes(e);if(B.downloadVKLanguages&&(t&&B.updateBuiltinLanguages||!Es(e))){let t;try{t=await(0,m.loadVKLangPack)(e,"videoplayer","videoplayer")}catch(e){M?.oneStat?.logError({errorType:"VKLangPack",fatal:!1}),q?.report(e,{errorType:"VKLangPack",fatal:!1})}t&&(Ts({language:e,pack:t,fallback:B.defaultLanguage}),oe.set(e))}Es(e)&&oe.set(e)},oe=ia(e),le=ia(t);ne(e);let ue=(e,t)=>{let i=aa(oe);return xs(i,e,t,B.defaultLanguage)},de=ia("thumb"),ce=(()=>{let e=ra([se,de],(([e,t])=>e?"crashed":t));return{...e,is:t=>aa(e)===t}})(),he=(()=>{let e=ia(new Set(b));return{...e,add:t=>{e.update((e=>new Set([...e].concat(t))))},remove:t=>{e.update((e=>{let i=[...e];return new Set(Array.isArray(t)?i.filter((e=>!t.includes(e))):i.filter((e=>e!==t)))}))},includes:t=>{let i=aa(e);return Array.isArray(t)?t.every((e=>i.has(e))):i.has(t)}}})();V.log("create store"),G({message:"create store"});let pe=new m.Subject,fe=new m.Subject,me=new m.Subject,ge=new m.Subject,ve=null,be={actionRewind$:fe,actionSeek$:me,inPiP$:te,inFullscreen$:new m.Observable((e=>J.subscribe((t=>e.next(t))))),actionSetSubtitle$:ge,nextMovie$:pe};if(M){let{oneStat:e,statSubscription:t}=M;_||t.add(e.attachTo(U)),t.add(e.attachToUi(be)),t.add(e.attachToAds(W.events)),e.authorize(s).catch((e=>{G({message:`onestat auth error ${String(e)}`})}))}if(q){let e=new m.Subscription,t=(t,i)=>e.add(t.subscribe(i));if(t(U.events.managedError$,(e=>{q.logIError(e)})),t(U.events.fatalError$,(e=>{q.logIError(e,!0)})),M){let{oneStat:e}=M;t(e.experimental.error$,(e=>{q.logIError(e)}))}q.sentrySubscription.add(e)}let _e=()=>{f.clientChecker.device.isIOS&&j&&(e=>{let t=e;return t?.webkitExitFullscreen?t?.webkitExitFullscreen():Promise.reject()})(j).catch((e=>{G({message:`exitIosSafariFullscreen failed: ${e}`})}))},ye=(new m.Subscription).add(U.experimental.element$.subscribe((e=>{e&&(j=e,e.classList.add("player-media"),Gs(H)&&(H.updateVideoElement(),H.registryEventHandlers()),_&&e.setAttribute("pip","false"),"preview"===D&&(e.setAttribute("disablePictureInPicture","true"),e.setAttribute("x-yandex-pip","false")))}))).add(U.events.ended$.subscribe((()=>{_e(),l?.onEnded?.()}))).add(U.events.looped$.subscribe((()=>{l?.onLooped?.()}))).add(U.events.started$.subscribe((async()=>{Gs(H)&&await(H?.revealPictureInPicture());let e=U.info.muted$.getValue();l?.onStarted?.(),Y.onStarted?.(e)}))).add(U.events.willSeek$.subscribe((({from:e,to:t})=>{l?.onSeek?.(e,t)}))).add(U.events.autoplaySoundProhibited$.subscribe((()=>{l?.onAutoplaySoundProhibited?.()}))).add(U.info.position$.subscribe((e=>{let t=U.info.duration$.getValue();isFinite(t)&&t>0&&(l?.onTimeupdate?.(t,e),W.setPosition(e,t))}))).add(U.events.fatalError$.subscribe((e=>{l?.onCrashed?.(e?`${e.id}: ${e.message}`:void 0)}))).add(U.events.fetcherRecoverableError$.subscribe((e=>{l?.onRecoverableError?.(e?`${e.id}: ${e.message}`:void 0)}))).add(U.events.loadedMetadata$.subscribe((()=>{Ei.state.loadedMetadata$.set(!0)}))).add(U.info.is3DVideo$.subscribe((e=>{Ei.ui.is3DVideo.set(e)}))).add(U.info.isEnded$.subscribe((e=>{_&&(e?(w?.getValue()&&he.add(Pa),he.add("PLAY_BUTTON")):he.remove("PLAY_BUTTON"))}))).add(U.info.liveTime$.subscribe((e=>{l?.onLiveTime?.(e)}))).add(U.info.isStalled$.subscribe((e=>{l?.onStalledChanged?.(e)}))).add(U.info.isLiveEnded$.subscribe((e=>e&&l?.onLiveEnded?.()))).add(W.events.loadStarted$.subscribe((()=>l?.adsInfo?.onLoadStarted?.()))).add(W.events.loadEnded$.subscribe((()=>l?.adsInfo?.onLoadEnded?.()))).add(W.events.loadError$.subscribe((()=>l?.adsInfo?.onLoadError?.()))).add(W.events.init$.subscribe((()=>l?.adsInfo?.onInit?.()))).add(W.events.ready$.subscribe((()=>l?.adsInfo?.onReady?.()))).add(W.events.started$.subscribe((e=>l?.adsInfo?.onStarted?.(e)))).add(W.events.timeRemained$.subscribe((e=>l?.adsInfo?.onTimeRemained?.(e)))).add(W.events.ended$.subscribe((e=>l?.adsInfo?.onCompleted?.(e)))).add(W.events.empty$.subscribe((()=>l?.adsInfo?.onEmpty?.()))).add(W.events.clicked$.subscribe((e=>l?.adsInfo?.onClicked?.(e)))).add(W.events.closed$.subscribe((e=>l?.adsInfo?.onClosed?.(e)))).add(W.events.error$.subscribe((e=>l?.adsInfo?.onError?.(e)))).add(W.events.paused$.subscribe((()=>l?.adsInfo?.onPaused?.()))).add(W.events.resumed$.subscribe((()=>l?.adsInfo?.onResumed?.()))),we=new m.Subscription,Se=ta(U.info.position$.getValue(),(e=>{let t,i,r=()=>{let a=U.info.playbackState$.getValue(),s=U.info.isLive$.getValue(),n=U.info.duration$.getValue(),o=U.info.position$.getValue();if(a&&[f.PlaybackState.PLAYING,f.PlaybackState.PAUSED].includes(a)){let t=s?o-n:U.getExactTime();t!==i&&e(t),i=t}t=requestAnimationFrame(r)};return r(),()=>cancelAnimationFrame(t)})),ke=Ua(U.info.playbackState$),Te=Ua(U.info.currentBuffer$),Ee=Ua(U.info.isEnded$),xe=Ua(U.info.isLive$),$e=B.features.playbackRate?Ua(U.info.canChangePlaybackSpeed$):ta(!1),Ce=Ua(U.info.liveBufferTime$),Ae=Ua(U.info.volume$),Pe=Ua(U.info.muted$),Le=Fa(U.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.TRAFFIC_SAVING))),U.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.TRAFFIC_SAVING),Me=Fa(U.info.predefinedQualityLimitType$.pipe((0,m.map)((e=>e===f.PredefinedQualityLimits.HIGH_QUALITY))),U.info.predefinedQualityLimitType$.getValue()===f.PredefinedQualityLimits.HIGH_QUALITY),Ie=Ua(U.info.autoQualityLimitingAvailable$),Re=Ua(U.info.availableQualities$),De=Ua(U.info.availableQualitiesFps$),Oe=Ua(U.info.chromecastState$),Be=Ua(U.info.chromecastDeviceName$),Ne=Ua(U.info.currentFormat$),Ve=Ua(U.info.throughputEstimation$),Ue=Ua(U.info.videoBitrate$),Fe=Ua(U.info.intrinsicVideoSize$),je=Ua(U.info.duration$),ze=Ua(U.info.isAudioAvailable$),We=null,qe=U.info.isBuffering$,He=ta(qe.getValue(),(e=>{let t=qe.subscribe((t=>{t&&null===We?We=window.setTimeout((()=>{e(qe.getValue()),We=null}),B.loaderDelay):e(t)}));return()=>{t.unsubscribe(),We&&clearTimeout(We)}})),Ke=ra([je,xe],(([e,t])=>t?-e:e)),Qe=ra([ke],(([e])=>e===f.PlaybackState.PLAYING)),Ge=Ua(U.info.atLiveEdge$),Ye=Ua(U.info.atLiveDurationEdge$),Xe=Ua(U.info.position$),Ze=ra([Xe,je],(([e,t])=>isFinite(e)&&isFinite(t)&&!!t)),Je=ra([Oe],(([e])=>e===f.ChromecastState.CONNECTED)),et=Ua(U.info.availableVideoStreams$),tt=B.features.audioLanguages?Ua(U.info.availableAudioStreams$):ta([]),it=Ua(U.info.currentVideoStream$),rt=Ua(U.info.currentAudioStream$),at=e=>{let t;if(1===e.length&&(t=e.at(0)),t??(t=e.find((e=>"isDefault"in e&&e.isDefault))),t)return t;let i=m.safeStorage.get(Ga);return i&&(t=e.find((({language:e})=>i===e))),t??(t=e.at(0)),t},st=!1;ye.add(U.info.availableAudioStreams$.subscribe((e=>{if(!st&&e.length){let t=at(e);t&&(U.setAudioStream(t),st=!0)}})));let nt=!1;ye.add(U.info.availableVideoStreams$.subscribe((e=>{if(!nt&&e.length){let t=at(e);t&&(U.setVideoStream(t),nt=!0)}})));let ot=ia(void 0),lt=Ua(U.info.isAutoQualityEnabled$,(e=>e&&ot.set(void 0))),ut=Ua(U.info.currentQuality$,(()=>ot.set(void 0))),dt=ra([ot,ut],(([e,t])=>e??t)),ct=ra(Ne,(e=>e!==f.VideoFormat.MPEG)),ht=ra([Re,De,lt,dt,ct],(([e,t,i,r,a])=>{let s=[];a&&s.push({value:"auto",displayValue:ue("auto_quality_option"),selected:i});let n=e.filter((e=>!(0,m.isInvariantQuality)(e)));for(let e of n){let a=t[e];s.push({value:e,displayValue:`${e}${a?sd(a):""}`,selected:!i&&e===r})}return s})),pt=Ua(U.info.currentPlaybackRate$),ft=ra([pt,Ge,Ye],(([e,t,i])=>{let r=i||_?1:B.controls.playbackRateMin,a=t?1:B.controls.playbackRateMax,s=B.controls.playbackRateStep,n=[];for(let t=r;t<=a;t+=s)n.push({value:t,displayValue:1===t?ue("playback_rate_1"):ue("playback_rate",{multiplier:t.toString(10)}),selected:e===t});return n})),mt={displayValue:ue("subtitles_off"),value:"off"},gt=ia({...mt}),vt=B.features.subtitles?Ua(U.info.availableTextTracks$):ta([]),bt=(()=>{let e=[],t=0;return{add:(i,r)=>{e[t]=[i,r],t=(t+1)%10},find:t=>e.find((([e])=>e===t))}})(),_t=ra([vt,gt],(([e,t],i)=>{let r=[],a=e.find((({id:e})=>e===t.value));if(a?.url){let[,e]=bt.find(a.url)??[];if(e)return void i(e);X.download(a.url).then((e=>{if(!e||X.isDestroyed())return;let s=new ld,n=a.language;if(n){let t=!!a.isAuto,i=s.parse(e,n);r.push({lang:n,subtitles:i,isAuto:t,id:a.id})}bt.add(a.url,r),aa(gt).value===t.value&&i(r)})).catch((e=>{M?.oneStat?.logError({errorType:"Subtitles download",fatal:!1}),q?.report(e,{errorType:"Subtitles download",fatal:!1})}))}i(r)})),yt=ra([pt,Qe,gt],(([e,t,i],r)=>{let a;if(U.info.isLive$.getValue()&&t&&i.value!==mt.value){let t=()=>{a=setTimeout(t,1e3/(3*e)),r(Date.now())};return t(),()=>clearTimeout(a)}})),wt=ra([vt,gt],(([e,t])=>{if(!e.length)return[];let i=[];for(let{language:r,isAuto:a,id:s}of e){let e=r&&gd(r);r&&e&&i.push({displayValue:a?ue("subtitles_auto",{language:e}):e,value:s,selected:t?.value===s,isAuto:a})}return i.length?(i.unshift({...mt,selected:t?.value===mt.value}),i):[]})),St={available:[],prev:[]},kt=ra([Se,gt,_t,yt],(([e,t,i,r])=>{let a=U.info.isLive$.getValue();if(a&&St.prev!==i){let e=i.find((({id:e})=>e===t.value)),r=St.prev.find((({id:e})=>e===t.value));if(e){let t={...e,subtitles:[...r?.subtitles??[],...e.subtitles]};St.available=[t],St.prev=i}}if(t&&t.value!==mt.value){let r=a?U.experimental.getCurrentTime$.getValue()?.()??j?.currentTime??0:e,s=a?St.available:i;return((e,t,i,r=!1)=>{let a=i.find((({id:e})=>e===t.value))?.subtitles;if(r)return a?.find((({startTime:t,endTime:i})=>pd(e,t,i)));let s=e>=ud,n=e<ud;return ud=e,n&&(dd=!1),(0,m.isNonNullable)(ed)&&pd(e,ed.startTime,ed.endTime)&&cd===t.value?ed:(0,m.isNonNullable)(td)||!a?.length||dd?pd(e,td?.startTime,td?.endTime)?(ed=td,td=void 0,cd=t.value,ed):void((s&&((e,t=0,i=0)=>e>t&&e>i)(e,td?.startTime,td?.endTime)||n&&hd(e,td?.startTime,td?.endTime))&&(td=void 0)):(td=a.find((({startTime:t,endTime:i})=>pd(e,t,i)||s&&hd(e,t,i))),ed=void 0,void(!(0,m.isNonNullable)(td)&&a[a.length-1].endTime<e&&(dd=!0)))})(r,t,s,a)}})),Tt=ra([kt],(([e])=>e?.texts?e.texts:[]));ye.add(gt.subscribe((e=>{if(e.value===mt.value)l?.onSubtitleOff?.();else{let t=Object.entries(fd).find((([t,i])=>i===e.displayValue));l?.onSubtitleOn?.(t?t[0]:"")}})));let Et=ia(!0),xt=ra([Te,Ke,Xe,Ce],(([e,t,i,r])=>{let a=e?.end??0;return r?(a-(-i+r-t))/t:a/t})),$t=Ua(U.info.availableSources$),Ct=ra([$t],(([e])=>Object.keys(e?.[f.VideoFormat.MPEG]||{}).length>0)),At=()=>{let e=Math.max(B.volumeMinRestore,es()??0);return 0===e?B.volumeDefault:e},Pt=e=>{let t=0===e?At():e,i=U.info.muted$.getValue();G({message:`set volume, volume: ${e}, preferredVolume: ${t}`}),i&&e>0&&!n&&(i=!1,ns(!1)),U.setVolume(e,i),W.setVolume(e),Ja(t)},Lt=e=>{let t=U.info.volume$.getValue();if(G({message:`set muted, currentVolume: ${t}, mute: ${e}`}),U.setMuted(e),W.setVolume(e?0:t),ns(e),!e&&0===t){let e=At();U.setVolume(e),Ja(e),W.setVolume(e)}},Mt=ia(!1),It=e=>{V.log("set looped",{isLooped:e}),Mt.set(e),U.setLooped(e),l?.uiInfo?.onLoopedChanged?.(e)};It(L);let Rt,Dt,Ot=e=>{let{isMobile:t,features:{playbackStatusNextVideoShow:i,playbackStatusShow:r}}=B;return!(!i||!r||t)&&(Ei.ui.aboutToGoNextVideo.set(e),Ei.ui.userActionsDisabled.set(!0),!0)},Bt=(e,{changeReason:t="default",appliesTo:r="to-video"}={})=>{G({message:`set quality, quality: ${e}`}),V.log("set quality",{quality:e}),U.setAutoQuality("auto"===e),"auto"!==e?(B.features.qualityDetailsSubMenuEnabled?(hs({type:"exact_quality",quality:e,videoId:i},r),is(),U.setPredefinedQualityLimits(f.PredefinedQualityLimits.UNKNOWN)):ts(i,e),ot.set(e),U.setQuality(e)):B.features.qualityDetailsSubMenuEnabled?"default"===t&&(Ft("auto_quality",r),aa(Le)&&Nt(!1),aa(Me)&&Vt(!1)):is()},Nt=(e,t="as-default")=>{G({message:`set trafficSavingEnabled, value: ${e}`}),V.log("set traffic saving enabled",{trafficSavingEnabled:e});let i=e?f.PredefinedQualityLimits.TRAFFIC_SAVING:f.PredefinedQualityLimits.UNKNOWN;B.features.qualityDetailsSubMenuEnabled?(Ut(i,t),os(!1)):(U.setPredefinedQualityLimits(i),os(e))},Vt=(e,t="as-default")=>{G({message:`set highQualityEnabled, value: ${e}`}),V.log("set high quality enabled",{highQualityEnabled:e}),Ut(e?f.PredefinedQualityLimits.HIGH_QUALITY:f.PredefinedQualityLimits.UNKNOWN,t)},Ut=(e,t)=>{e!==f.PredefinedQualityLimits.UNKNOWN&&(aa(Ie)&&!aa(lt)&&Bt("auto",{appliesTo:t,changeReason:"limit-changed"}),Ft(e,t)),U.setPredefinedQualityLimits(e)},Ft=(e,t)=>{hs({type:e,videoId:i},t),"as-default"===t&&hs({type:e,videoId:i},"to-video")},jt=e=>{V.log("set playback rate",{playbackRate:e}),U.setPlaybackRate(e),B.features.saveRate&&I&&!U.info.isLive$.getValue()&&(e=>{m.safeStorage.set(Ya,JSON.stringify({rate:e}))})(e)},zt=(e={...mt,selected:!1})=>{V.log("set subtitles",{...e}),e&&e.value!==mt.value&&ge.next(e.isAuto?e.value+"_auto":e.value),gt.set(e)},Wt=()=>{V.log("toggle subtitles");let e=aa(wt),t=aa(gt),i=aa(oe);if(t?.value===mt.value){let t=e.filter((e=>e.value!==mt.value)).find((e=>e.value===i))||e[1];zt(t)}else zt()},qt=ia(!0),Ht=e=>{qt.set(e)},Kt=(e,t,i=!0)=>{if(G({message:`seek to time, time: ${e}`}),V.log("seek to time",{time:e,action:t,forcePrecise:i}),me.next(t),U.info.isLive$.getValue()){let t=U.info.duration$.getValue(),r=Math.min(0,t+e);U.seekTime(r,i)}else{if(w?.getValue())return;U.info.isEnded$.getValue()&&(G({message:"seek after ended, call callbacks.onPlay"}),l?.onPlay?.()),U.seekTime(Ti(e),i)}},Qt=(e,t)=>{G({message:`seek to percent, percent: ${e}`}),V.log("seek to percent",{percent:e,action:t});let i=aa(Ke)*e;Kt(i,t,!1)},Gt=ia(void 0),Yt=ia(!1),Xt=e=>{Gt.set(e)},Zt=()=>{Gt.set(void 0),Yt.set(!1)},Jt=()=>{clearTimeout(Dt),clearTimeout(Rt),Rt=window.setTimeout((()=>{Zt()}),500),j?.removeEventListener("seeked",Jt)},ei=ra([Se,Ke,Gt],(([e,t,i],r)=>{r((0,m.isNonNullable)(i)?i*t:e)})),ti=ia(!1),ii=ia({width:0,height:0}),ri=ra([ii],(([{width:e}],t)=>{let i=(e=>e>699?"xl":e>599?"l":e>509?"m":e>320?"s":"xs")(e);t(i)})),ai=ia(!1),si=x.filter((e=>(e=>!e.type)(e))),ni=ra([ri,ai],(([e,t])=>t?si.filter((e=>!e.hideOnMobile)):si.filter((t=>!t.hideOnDesktopGridTypes?.includes(e))))),oi=ia(x.filter((e=>(e=>!!e.type)(e)))),li=ra([oi,ri],(([e,t])=>e.filter((e=>!e.hideOnDesktopGridTypes?.includes(t))))),ui=ra([li,ni],(([e,t])=>[...B.features.additionalButtonsDesktopControlPanelRight?e.filter((e=>"desktop-control-panel-right"===e.type)):[],...B.features.additionalButtons?t.map(((e,t)=>({id:t,weight:t,type:"desktop-control-panel-right",testId:e.testId,icon:e.iconUrl,onClick:e.onClick,ariaLabel:e.ariaLabel??e.tooltip,tooltipText:e.tooltip}))):[]])),di=ia($),ci=ra([di],(([e])=>B.features.additionalSettingsMenuItems?e.map((e=>"SWITCH"===e.type?{...e,onClick:e.onChangeEnabled}:e)):[])),hi=ia(C),pi=ra([hi],(([e])=>B.features.additionalContextMenuItems?e:[])),fi=ra([ai,se],(([e,t],i)=>{i(e&&t)})),mi=()=>j,gi=e=>{if((0,m.assertNonNullable)(Ei),U.info.isEnded$.getValue())return;let t=!e;if("ads"===aa(Ei.playerPhase))return G({message:`pause ads, internalCall: ${t}`}),V.log("pause ads",{internalCall:t}),void W.pause();G({message:`pause video, internalCall: ${t}`}),V.log("pause video",{internalCall:t}),t&&l?.onPause?.(),U.pause()},vi=e=>{(0,m.assertNonNullable)(Ei);let t=!e;if("ads"===aa(Ei.playerPhase))return G({message:`play ads, internalCall: ${t}`}),V.log("play ads",{internalCall:t}),void W.play();G({message:`play video, internalCall: ${t}`}),V.log("play video",{internalCall:t}),t&&l?.onPlay?.(),U.play()},bi=(e,t)=>{(0,m.assertNonNullable)(Ei),G({message:`first start, show ads: ${e}, internalCall: ${!t}`}),V.log("first start",{showAds:e,external:t}),e?de.set("ads"):(de.set("video"),t?U.play():Ei.actions.internal.togglePlay())},_i=()=>(G({message:"getting time codes"}),d),yi=()=>{let e=_i();if(!e||[0,1].includes(e.length))return;let t=U.info.position$.getValue();return e.find((e=>e.time>t))},wi=()=>{let e=_i();if(!e||[0,1].includes(e.length))return;let t=U.info.position$.getValue(),i=e.findIndex((e=>e.time>t)),r=-1===i?e.length-2:i-2;return r<0?void 0:e[r]},Si=ia([]);y?.subscribe((e=>{let t=[];for(let i=0;i<e.length;i++){let{range:[r,a],subjects:s}=e[i];0===i&&0!==r&&t.push({time:0,text:"",interactive:!1,completed:!0}),t.push({time:r/1e3,text:"",interactive:!0,completed:B.features.interactiveTimeOpenUri?!s.length||s.every((e=>e.isRemoved)):!s.length}),a!==1/0&&t.push({time:a/1e3,text:"",interactive:!1,completed:!0})}Si.set(t)}));let ki=ia(!1);w?.subscribe((e=>{e&&aa(Yt)&&Zt()}));let Ti=e=>{if(!_)return e;let t=aa(Si),i=aa(Ke),r=aa(Xe)/i,a=t.find((e=>e.interactive&&!e.completed&&e.time>r));return"number"==typeof a?.time?Math.min(e,a.time-.05):e},Ei={interfaceLanguage$:oe,isCyrillicRelatedInterface$:le,initVideo:e=>{G({message:`init video, config: ${JSON.stringify(e)}`}),_?(e=>{let t=e.container;t.append(U.experimental.element$.getValue()),ve=new MutationObserver((e=>{let{removedNodes:i}=e[0];i.length&&t.append(U.experimental.element$.getValue())})),ve.observe(t,{childList:!0})})(e):(m.devNull.push("ui",{key:"videoplayer_embed",strings:["new","core_init_video"],numbers:[(0,m.now)()]}),U.initVideo(e)),V.log("init video",{isInteractive:_}),e.subtitles&&U.setExternalTextTracks(e.subtitles),F=e},videoId:i,isClip:r,playerPhase:ce,vsid:Z,state:{positionExact$:Se,positionWithScrubbing$:ei,duration$:Ke,playbackState$:ke,isPlaying$:Qe,isLoaderVisible:He,bufferedProgress$:xt,isLive$:xe,canChangePlaybackSpeed$:$e,isActiveLive$:Ge,isOldestAvailableLive$:Ye,isRewindableLive$:Ze,isEnded$:Ee,muted$:Pe,volume$:Ae,trafficSavingEnabled$:Le,highQualityEnabled$:Me,autoQualityLimitingAvailable$:Ie,availableVideoStreams$:et,availableAudioStreams$:tt,videoStream$:it,audioStream$:rt,currentQuality$:dt,isAutoQualityEnabled$:lt,availableQualities$:ht,currentPlaybackRate$:pt,availablePlaybackRates$:ft,currentSubtitle$:gt,availableTextTracks$:vt,availableSubtitlesList$:wt,currentSubtitleCaptions$:Tt,isAutoSubtitleCaptionVisible$:Et,chromecastState$:Oe,chromecastDeviceName$:Be,chromecastConnected$:Je,currentFormat$:Ne,throughputEstimation$:Ve,videoBitrate$:Ue,videoSize$:Fe,errorLog$:re,crashed$:se,isAudioAvailable$:ze,isAudioDisabled:!!n,canDownload:B.features.download&&!!o,availableSources$:$t,hasMpegSources$:Ct,isInteractive:_,showInteractiveGraph:B.features.interactiveGraph,showSeekToInteractive:B.features.seekToInteractive,showPlayPrevChapter:B.features.interactivePlayPrevChapter,showInteractiveTimeIndicator:B.features.interactiveTimeIndicator&&!!aa(Si).length,interactiveEpisodes$:Si,isInteractiveTime$:w?Ua(w):ia(!1),isInteractiveExpectation$:ki,hasInteractiveBranches:T,playPrevChapterDisabledTooltip:E,looped$:Mt,loadedMetadata$:ia(!1),isAutoQualityAvailable$:ct},ui:{t:ue,controlsVisible:ia(!1),touched:ia(!1),controls:{prevButton:ia(void 0),playButton:ia(void 0),replayButton:ia(void 0),nextButton:ia(void 0),playPrevChapterButton:ia(void 0),seekToInteractiveButton:ia(void 0),interactiveGraphButton:ia(void 0),liveButton:ia(void 0),time:ia(void 0),episodes:ia(void 0),volume:ia(void 0),subtitles:ia(void 0),settings:ia(void 0),context:ia(void 0),chromecast:ia(void 0),pip:ia(void 0),fullscreen:ia(void 0),vkLogo:ia(void 0),interactiveTimeIndicator:ia(void 0),timeline:ia(void 0),autoplayNextToggle:ia(void 0),additionalButtons:x.length?x.reduce((e=>[...e,ia(void 0)]),[]):[],disabledControls$:he},modals:{hotKeyMap:{show:ia(!1),data:ia({title:"",closeBtnText:"",groups:[]})}},isFullscreen:J,isFullscreenOpenedByKeyboard:ee,rotateAlpha:ie,isAutoplay:ia(!1),debugPanelVisible:ia(!1),episodes:{panelOpened$:ia(!1),openedByKeyboard$:ia(!1)},contextMenu:{visible$:ia(!1),btnRef$:ia(void 0),openedByBtnKeyboard$:ia(!1),openedByHotKey$:ia(!1),lastActiveElem$:ia(void 0),showContextMenuBtn$:ia(!1),position$:ia({top:0,left:0})},playerSize:ii,isMobile:ai,mobileNotReportControlHidden$:fi,mobileUnmuteButtonExpanded:ia(!1),mobileUnmuteButtonVisible:ia(!1),icon3DVideoVisible:ia(!1),scrubbingInProgress:Yt,volumeChangingInProgress:ti,is3DVideo:ia(!1),currentGridType$:ri,additionalButtonsDeprecated$:ni,additionalDesktopControlPanelRightButtons$:ui,additionalSettingsMenuItems$:ci,additionalContextMenuItems$:pi,interactiveHideMobileControls:ia(!1),overlayContainer$:ia(void 0),startedByKeyboard$:ia(!1),autoplayNextEnabled$:ia(!1),timerNextVideoRunning$:ia(!0),settingsMenu:{visible$:ia(!1),ref$:ia(void 0),openedByBtnKeyboard$:ia(!1)},settingsSubMenu:{visible$:ia(!1),ref$:ia(void 0),name$:ia(void 0)},aboutToGoNextVideo:ia(void 0),userActionsDisabled:ia(!1),hiddenControls:{volume:ia(!1)},isControlsAvailable:ia(!0)},ads:{position:ia(0),duration:ia(0),playbackState:ia("inactive"),canSkip:ia(!1),secondsToWatchBeforeSkip:ia(0),postrollPassed:ia(!1)},webApi:{pictureInPictureApi:H,annotationsApi:K,slotsApi:Q},actions:{internal:{preload:()=>{U.prepare()},firstStart:e=>bi(e,!1),play:()=>vi(!1),pause:()=>gi(!1),togglePlay:()=>{(0,m.assertNonNullable)(Ei);let e=aa(Ei.ui.controls.disabledControls$),t=aa(Ei.playerPhase),i={playerPhase:t,isInteractive:_,isVideoEnded:!1,action:"none"};if(e.has("PLAY_BUTTON"))return;if(G({message:"toggle play"}),"ads"===t)return i.action="play",V.log("toggle adman play",i),void W.togglePlay();let r=()=>{G({message:"toggle play, call player.play"}),i.action="play",U.play(),l?.onPlay?.()};if(U.info.isEnded$.getValue()){if(G({message:"toggle play, video ended, seek to 0"}),fe.next(),me.next(g.SeekAction.REWIND),_)return void S?.();U.seekTime(0),r()}else U.info.playbackState$.getValue()!==f.PlaybackState.PLAYING?r():(G({message:"toggle play, call player.pause"}),i.action="pause",U.pause(),l?.onPause?.());V.log("toggle play",i)},toggleMuted:()=>{G({message:"toggle muted"});let e=U.info.muted$.getValue();0!==U.info.volume$.getValue()||e?Lt(!e):Pt(At())},openSettingsMenu:async(e,t=()=>Promise.resolve())=>{Ei.ui.settingsMenu.openedByBtnKeyboard$.set(!!e),Ei.ui.settingsMenu.visible$.set(!0),await t();let i=aa(Ei.ui.settingsMenu.ref$),r=mi();if(l?.uiInfo?.onSettingsMenu&&i&&r){let e=wd(i),t=yd(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}V.log("open settings menu",{wasOpenedByKeyboard:e})},closeSettingsMenu:()=>{if(Ei.ui.settingsMenu.visible$.set(!1),!aa(Ei.ui.settingsSubMenu.visible$)){let e=aa(Ei.ui.settingsMenu.ref$);if(l?.uiInfo?.onSettingsMenu&&e){let t=wd(e),i={top:0,left:0,bottom:0,right:0};l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:"settings"})}}V.log("close settings menu")},openSettingsSubMenu:(e,t)=>{Ei.ui.settingsSubMenu.visible$.set(!0),Ei.ui.settingsSubMenu.ref$.set(t),Ei.ui.settingsSubMenu.name$.set(e);let i=mi();if(l?.uiInfo?.onSettingsMenu&&t&&i){let r=wd(t),a=yd(t,i);l.uiInfo.onSettingsMenu({visible:!0,name:e,size:r,position:a})}V.log("open settings sub menu",{name:e})},closeSettingsSubMenu:(e,t=!1)=>{Ei.ui.settingsSubMenu.visible$.set(!1);let i=aa(Ei.ui.settingsMenu.ref$),r=mi(),a=aa(Ei.ui.settingsMenu.visible$);if(l?.uiInfo?.onSettingsMenu&&i&&r)if(a&&!t){let e=wd(i),t=yd(i,r);l.uiInfo.onSettingsMenu({visible:!0,size:e,position:t,name:"settings"})}else{let t=wd(e),i={top:0,left:0,bottom:0,right:0},r=aa(Ei.ui.settingsSubMenu.name$);l.uiInfo.onSettingsMenu({visible:!1,size:t,position:i,name:r})}V.log("close settings sub menu")},setVolume:Pt,startVolumeChanging:()=>{ti.set(!0)},stopVolumeChanging:()=>{ti.set(!1)},setVideoStream:e=>{e.language&&us(e.language),U.setVideoStream(e)},setAudioStream:e=>{e.language&&us(e.language),U.setAudioStream(e)},setQuality:Bt,setTrafficSavingEnabled:Nt,setHighQualityEnabled:Vt,setPlaybackRate:jt,incrementPlaybackRate:()=>{let e=aa(ft),t=e.findIndex((({selected:e})=>e));if(t===e.length-1)return;let i=e[t+1];jt(i.value)},decrementPlaybackRate:()=>{let e=aa(ft),t=e.findIndex((({selected:e})=>e));if(0===t)return;let i=e[t-1];jt(i.value)},setSubtitle:zt,toggleSubtitle:Wt,togglePictureInPicture:async()=>{let e=H?.isActive(),t="none";H?.isActive()?(t="remove",await(H?.remove())):(t="request",await(H?.request())),V.log("toggle picture in picture",{isActive:e,action:t})},startScrubbing:e=>{G({message:`start scrubbing, progress: ${e}`}),V.log("start scrubbing",{progress:e}),Yt.set(!0),Xt(e)},progressScrubbing:Xt,completeScrubbing:e=>{G({message:`complete scrubbing, progress: ${e}`}),V.log("complete scrubbing",{progress:e}),Qt(e,g.SeekAction.SLIDER),aa(Ei.ui.isMobile)&&aa(Ei.state.currentFormat$)===f.VideoFormat.HLS?(j?.addEventListener("seeked",Jt),Dt=window.setTimeout((()=>{Jt()}),300)):Zt()},toggleChromecast:()=>{G({message:"toggle chromecast"}),V.log("toggle chromecast"),U.toggleChromecast()},switchToActiveLive:()=>{me.next(g.SeekAction.LIVE),G({message:"switch to active live"}),V.log("switch to active live"),U.seekTime(0),U.info.playbackState$.getValue()!==f.PlaybackState.PLAYING&&Ei.actions.internal.togglePlay()},switchFromAdsToVideo:(e=!0)=>{(0,m.assertNonNullable)(Ei),G({message:`switch from ads to video, callPlay: ${e}`}),V.log("switch from ads to video",{callPlay:e}),de.set("video"),e&&U.play()},switchFromVideoToAds:()=>{(0,m.assertNonNullable)(Ei),G({message:"switch from video to ads"}),V.log("switch from video to ads"),Ei.actions.internal.pause(),_e(),de.set("ads")},skipAd:()=>{V.log("skip adman"),W.skip()},setLiveWaitingStart:e=>{(0,m.assertNonNullable)(Ei);let t=e?"LiveWaitingStart":"thumb";V.log("set live waiting start",{state:e,playerPhase:t}),de.set(t)},setLiveWaitingRecover:e=>{(0,m.assertNonNullable)(Ei);let t=e?"LiveWaitingRecover":"thumb";V.log("set live waiting recover",{state:e,playerPhase:t}),de.set(t)},setLiveWaitingRecord:e=>{(0,m.assertNonNullable)(Ei);let t=e?"LiveWaitingRecord":"thumb";V.log("set live waiting record",{state:e,playerPhase:t}),de.set(t)},getDebugTextData:()=>((0,m.assertNonNullable)(Ei),V.log("get debug text data"),((e,t,i,r)=>{let a=e.info,{width:s,height:n}=aa(i.ui.playerSize),o=a.throughputEstimation$.getValue()?.toFixed(0)??0,l=a.rttEstimation$.getValue()?.toFixed(0)??0,u=a.isAutoQualityEnabled$.getValue()?"auto":"manual",d=`${Ra} (core: ${f.VERSION}, stat: ${g.VERSION}, shared: ${m.VERSION})`,c=aa(i.state.errorLog$),h=c.length?"\n"+c.map(((e,t)=>`${t}) Type: ${e.id}\nMessage: ${e.message} (${e.thrown})\nTrace: ${e.thrown?.stack}\n`)).join("\n"):void 0,p=i.state.isAudioDisabled?"disabled":aa(i.state.isAudioAvailable$)?void 0:"unavailable",v=e.info.currentVideoStream$.getValue(),b=e.info.currentAudioStream$.getValue(),_=[];v&&_.push(`Video: ${v?.codec??""}`+(v?.hdr?" (HDR)":"")),b&&_.push(`Audio: ${b?.codec??""}`+(b?.language?` (${b.language})`:""));let y={Version:d,Browser:navigator.userAgent,Config:e.experimental.tuningConfigName$.getValue().join(", "),"United video id":String(i.videoId),TraceId:r,VSID:aa(i.vsid),"Content host":a.hostname$.getValue(),"Connection type":a.httpConnectionType$.getValue()+(a.httpConnectionReused$.getValue()?" (reused)":""),Throughput:`${o}Kbps @ ${l}ms RTT`,Format:a.currentFormat$.getValue(),"Available Formats":Object.keys(t.sources).join(", "),Streams:_.join(", "),Quality:`${u} ${a.currentQuality$.getValue()}`,"Available qualities":a.availableQualities$.getValue().join(", "),Audio:p,Position:`${aa(i.state.positionExact$)}s`,State:`${aa(i.playerPhase)} ${a.playbackState$.getValue()}`,"Player size":`${s}x${n}`,URL:window.location.href,Errors:h};return Object.entries(y).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e}: ${t}`)).join("\n")})(U,F,Ei,N.getTraceId())),getTraceTextData:()=>((0,m.assertNonNullable)(Ei),JSON.stringify(N.getFinishedSpans())),getDebugPanelData:()=>((0,m.assertNonNullable)(Ei),((e,t,i)=>{let r=e.info,{width:a,height:s}=aa(i.ui.playerSize),n={version:Ra,viewport:`${a}x${s}`,volume:Math.round(100*aa(i.state.volume$))};n.id=i.videoId,r.currentFormat$.getValue()&&(n.provider=r.currentFormat$.getValue()),r.hostname$.getValue()&&(n.cdn=r.hostname$.getValue());let o=r.intrinsicVideoSize$.getValue();o&&(n.videoSize=`${o.width}x${o.height}`);let l=r.currentBuffer$.getValue(),u=r.isLive$.getValue(),d=r.liveBufferTime$.getValue();l&&(n.buffer=u&&d?l.end-d:Math.max(l.end-aa(i.state.positionExact$),0));let c=r.throughputEstimation$.getValue();c&&(n.speed=c);let h=r.videoBitrate$.getValue();h&&(n.bitrate=h);let p=r.liveLatency$.getValue();p&&(n.liveLatency=p);let f=r.currentVideoSegmentLength$.getValue();f&&(n.currentVideoSegmentLength=f);let m=r.currentAudioSegmentLength$.getValue();m&&(n.currentAudioSegmentLength=m);let g=aa(i.vsid);"string"==typeof g&&(n.vsid=g);let v=e.info.currentVideoStream$.getValue()?.codec;v&&(n.videoCodec=v);let b=e.info.currentAudioStream$.getValue()?.codec;b&&(n.audioCodec=b),e.info.currentVideoStream$.getValue()?.hdr&&(n.hdr=!0);let _=e.info.currentAudioStream$.getValue()?.language;return _&&(n.audioLanguage=_),n})(U,0,Ei)),getVideoElement:mi,seekTime:(e,t,i)=>Kt(e,t,i),clearDelayedBufferingCheckTimeout:()=>{We&&clearTimeout(We),We=null},seekEpisodeStartTime:e=>{G({message:`seek to episode start time: ${e}`}),V.log("seek to episode start time",{time:e}),Kt(e,g.SeekAction.EPISODE,!0)},seekToPercent:Qt,getNextEpisode:yi,seekToNextEpisode:e=>{let t=e;t||(t=yi());let i=U.info.position$.getValue();V.log("seek to next episode",{currentTime:i,...t}),t&&(G({message:"seek to next episode"}),Kt(t.time,g.SeekAction.EPISODE,!0))},getPrevEpisode:wi,seekToPrevEpisode:e=>{let t=e;t||(t=wi());let i=U.info.position$.getValue();V.log("seek to prev episode",{currentTime:i,...t}),t&&(G({message:"seek to prev episode"}),Kt(t.time,g.SeekAction.EPISODE,!0))},startLogging:()=>{let e,{debugLog:t}=B,i="#9df7b7",r="#efd169";if(t&&!0!==t){let{colors:a}=t;e=t.tag,i=a?.[0]??i,r=a?.[1]??a?.[0]??r}let a=e?`: ${e}`:"";we.add(U.events.log$.subscribe((e=>{console.debug(`%c sdk${a} `,`background:${i};`,`sdk component: ${e.component}`,e.message)}))).add(z.log$.subscribe((e=>{console.debug(`%c ui${a} `,`background:${r};`,`ui component: ${e.component}.`,e.message)})))},stopLogging:()=>{we.unsubscribe()},startCameraManualRotation:(e,t)=>{V.log("start camera manual rotation",{mx:e,my:t}),U.startCameraManualRotation(e,t)},stopCameraManualRotation:(e=!1)=>{V.log("stop camera manual rotation",{immediate:e}),U.stopCameraManualRotation(e)},moveCameraFocusPX:(e,t,i)=>{V.log("move camera focus px",{xpx:e,ypx:t,dt:i}),U.moveCameraFocusPX(e,t,i)},holdCamera:()=>{U.holdCamera()},releaseCamera:()=>{U.releaseCamera()},getVideoEpisodes:_i,getPreviewThumbsData:()=>(G({message:"getting preview thumbs data"}),V.log("get preview thumbs data",{...c}),c),downloadVideo:()=>{let e=(()=>{let e=Object.keys(U.info.availableSources$?.getValue()?.[f.VideoFormat.MPEG]||{}),t=(0,m.getHighestQuality)(e)||m.VideoQuality.Q_144P;return F.sources[f.VideoFormat.MPEG]?.[t]})();if(e)V.log("download video",{url:e}),((e,t)=>{Da(e,t,"mp4")})(e,F?.meta?.title||"video");else{let e="There is no URL for download video";V.log("download video",{message:e}),G({message:e})}},addLanguage:Ts,setLanguage:ne,nextMovie:e=>pe.next(e),videoRotate:(e=-90)=>{V.log("rotate video",{alphaDiff:e}),ie.update((t=>t+e))},correctSeekTimeToInteractive:Ti,replayInteractive:S,setLooped:It,reportProblem:()=>{l?.uiInfo?.onReportProblem?.()},setAutoplayNextEnabled:(e,t=!1)=>{G({message:`set autoplayNextEnabled, value: ${e}`}),V.log("set autoplay next enabled",{autoplayNextEnabled:e}),Ei.ui.autoplayNextEnabled$.set(e),(e=>{as(Xa,e)})(e),t&&l?.onSetAutoplayNextEnabled?.(e)},setTimerNextVideoRunning:e=>{G({message:`set timerNextVideoRunning, value: ${e}`}),V.log("set timer next video running",{timerNextVideoRunning:e}),Ei.ui.timerNextVideoRunning$.set(e)},prevVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onPrevVideoClick)try{t=l?.onPrevVideoClick?.()}catch{G({message:"onPrevVideoClick callback failed to execute"})}t&&(e&&Ot("prev")||A())},nextVideoClick:(e=!0)=>{let t=!0;if(e&&l?.onNextVideoClick)try{t=l?.onNextVideoClick?.()}catch{G({message:"onNextVideoClick callback failed to execute"})}t&&(e&&Ot("next")||P())},nextVideoAnnouncementShow:()=>{l?.onNextVideoAnnouncementShow?.()},nextVideoAnnouncementClick:()=>{l?.onNextVideoAnnouncementClick?.()},nextVideoAnnouncementAuto:()=>{l?.onNextVideoAnnouncementAuto?.()},nextVideoAnnouncementCancel:()=>{l?.onNextVideoAnnouncementCancel?.()}},external:{firstStart:e=>bi(e,!0),play:()=>vi(!0),pause:()=>gi(!0),stop:()=>(e=>{(0,m.assertNonNullable)(Ei);let t=!e;"ads"!==aa(Ei.playerPhase)?(G({message:`player will be stopped, internalCall: ${t}`}),k?.()):G({message:"player cannot be stopped during ads via external method"})})(!0),seekTime:e=>(e=>{G({message:`seek external, time: ${e}`}),V.log("seek external",{time:e}),me.next(g.SeekAction.UNKNOWN),U.seekTime(U.info.isLive$.getValue()?-e:e)})(e),seekEpisodeStartTime:e=>(e=>{G({message:`seek external to episode start time: ${e}`}),V.log("seek external to episode start time",{time:e}),Kt(e,g.SeekAction.EPISODE,!0)})(e),setPlaybackRate:e=>(e=>{G({message:`set playback rate to: ${e}`}),V.log("set playback rate external",{playbackRate:e}),U.setPlaybackRate(e)})(e),setAutoQualityLimits:e=>(e=>{let t=e.max??"none",i=e.min??"none";G({message:`set auto quality limitation. Max: ${t}. Min: ${i}`}),V.log("set auto quality limits",{max:t,min:i}),U.setAutoQualityLimits(e)})(e),setMuted:Lt,toggleSubtitle:Wt,setVolume:Pt,returnFocusToEpisodes:()=>{Ei.ui.episodes.panelOpened$.set(!1)},updateAdditionalSettingsItem:(e,t)=>{let i=aa(di).map((i=>i.id!==e?i:{...i,...t}));di.set(i)},addAdditionalSettingsItem:e=>{let t=aa(di);t.some((t=>t.id===e.id))?G({message:`Settings menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),di.set(t))},removeAdditionalSettingsItem:e=>{let t=aa(di);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),di.set(t)):G({message:`Can't find settings menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalContextItem:(e,t)=>{let i=aa(hi).map((i=>i.id!==e?i:{...i,...t}));hi.set(i)},addAdditionalContextItem:e=>{let t=aa(hi);t.some((t=>t.id===e.id))?G({message:`Context menu item with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),hi.set(t))},removeAdditionalContextItem:e=>{let t=aa(hi);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),hi.set(t)):G({message:`Can't find context menu item with id: "${e}"! Can't remove item with this id`})},updateAdditionalButton:(e,t)=>{let i=aa(oi).map((i=>i.id!==e?i:{...i,...t}));oi.set(i)},addAdditionalButton:e=>{let t=aa(oi);t.some((t=>t.id===e.id))?G({message:`Additional button with id: "${e.id}" was exist! Can't add more with the same id`}):(t.push(e),oi.set(t))},removeAdditionalButton:e=>{let t=aa(oi);t.some((t=>t.id===e))?(t=t.filter((t=>t.id!==e)),oi.set(t)):G({message:`Can't find additional button with id: "${e}"! Can't remove item with this id`})},setLiveLowLatency:e=>{me.next(g.SeekAction.LIVE),G({message:"live switch to low latency "+e}),V.log("live switch to low latency "+e),U.setLiveLowLatency(e)},hideControls:()=>Ht(!1),showControls:()=>Ht(!0)}},callbacks:l,setUiCallbacks:e=>{Y={...e}},getAdmanWrapper:()=>W,getLogger:()=>z,getPlayer:()=>U,destroy:()=>{V.log("destroy store"),clearTimeout(Dt),clearTimeout(Rt),ye.unsubscribe(),we.unsubscribe(),U.destroy(),W.destroy(),M?.destroy(),q?.destroy(),ae.unsubscribe(),ve?.disconnect(),ve=null,X.destroy()}};return Ei};function kd(e,t,i,r){let a=t[i]?.getBoundingClientRect(),s=(r||["interactiveTimeIndicator"].includes(i))&&!!a&&!!(a.right-a.left),{top:n,left:o,bottom:l,right:u}=yd(t[i],e||void 0);return{left:s?o:0,right:s?u:0,top:s?n:0,bottom:s?l:0,isDisplayed:s}}var Td=(e,t,i,r)=>{if(e)for(let[a,s]of Object.entries(t))["tooltipPointerOffsetX","disabledControls$","additionalButtons"].includes(a)||s.set(kd(e,i,a,r))},Ed=async(e,t,i)=>{await Et(),t&&i&&(i.focus(),e.set(!1))},xd=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M18 10c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2m-6 4c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m-6 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2"></path></svg>');function $d(e,t){pi(t,!0);let[i,r]=la(),a=()=>oa(l,"$contextMenuVisible$",i),s=fa(t,"disabled",3,!1),n=fa(t,"ariaLabel",3,""),o=Na(),l=o.ui.contextMenu.visible$,u=o.ui.contextMenu.openedByBtnKeyboard$,d=o.ui.contextMenu.showContextMenuBtn$,c=o.ui.contextMenu.position$,h=o.ui.contextMenu.btnRef$,p=te(void 0);Rt((()=>{xt(p)&&$t((()=>{h.set(xt(p))}))}));let f=ne((()=>a()?"opened":""));Ko(e,{get className(){return xt(f)},testId:"btn-context-menu",get disabled(){return s()},get ariaLabel(){return n()},click:e=>{let t=En(e),i=(e=>{let t=e.getBoundingClientRect();return{right:t.left+t.width,bottom:t.top+-14}})(xt(p));c.set(i),u.set(t),l.set(!a())},focus:()=>{d.set(!0)},blur:()=>{d.set(!1)},get ariaExpanded(){return a()},get ref(){return xt(p)},set ref(e){re(p,Ae(e))},children:(e,t)=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=xd();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"dots-icon",role:"img",...i}))),ji(e,r)}(e,{})},$$slots:{default:!0}}),fi(),r()}var Cd=e=>{e.stopPropagation()},Ad=Ni("<div><!> <div></div> <div></div></div>"),Pd={hash:"svelte-od3veb",code:".interactive-episode-icon-animated.svelte-od3veb {position:absolute;top:16px;right:16px;width:32px;height:32px;transition:0.3s;opacity:1;}.interactive-episode-icon-animated.icon-small.svelte-od3veb {width:28px;height:28px;}.invisible.svelte-od3veb {opacity:0;visibility:hidden;}.fullscreen.svelte-od3veb:not(.mobile) {width:40px;top:19px;right:23px;height:40px;}.mobile.svelte-od3veb {width:28px;height:28px;top:12px;right:14px;}.fullscreen.mobile.svelte-od3veb {width:32px;height:32px;}\n\n  @media screen and (orientation: portrait) {.interactive-episode-icon-animated.mobile.fullscreen.svelte-od3veb {top:40px;right:16px;}\n  }\n\n  @keyframes svelte-od3veb-pulse {\n    0% {\n      transform: scale(1);\n      border-width: 1px;\n      opacity: 0;\n    }\n    10% {\n      opacity: 1;\n    }\n    50% {\n      transform: scale(1.5);\n      border-width: 1px;\n      opacity: 0.5;\n    }\n    100% {\n      transform: scale(1.5);\n      border-width: 0.5px;\n      opacity: 0;\n    }\n  }.pulse.svelte-od3veb {display:block;content:'';border:1px solid #fff;position:absolute;top:0;left:0;right:0;bottom:0;border-radius:100%;transform:scale(1.8);\n    animation: 1s svelte-od3veb-pulse infinite;transition:0.3s;pointer-events:none;}.pulse.paused.svelte-od3veb {animation-play-state:paused;}.interactive-episode-icon-animated svg {width:100%;height:100%;}.ref-block.svelte-od3veb {position:absolute;top:0;width:100%;height:100%;visibility:hidden;}.hidden.svelte-od3veb {display:none;}"};function Ld(e,t){pi(t,!0),mr(e,Pd);let[i,r]=la(),a=()=>oa(c,"$isMobile",i),s=()=>oa(f,"$showInteractiveTimeIndicatorTooltip$",i),n=fa(t,"ref",15,void 0),o=te(void 0),l=Na(),u=Va(),{interactiveControlsOpacity$:d}=u,c=l.ui.isMobile,h=l.ui.isFullscreen,p=l.state.isInteractiveTime$,f=u.showInteractiveTimeIndicatorTooltip$,m=l.ui.controlsVisible,g=l.callbacks?.onInteractiveTimeIndicatorClick,v=l.ui.currentGridType$,b=ne((()=>!a()&&oa(m,"$areControlsVisible",i))),_=ne((()=>uu(oa(v,"$currentGridType$",i),"s"))),y=ne((()=>!oa(p,"$isInteractiveTime$",i)||!!oa(d,"$interactiveControlsOpacity$",i)||xt(b))),w=te(!1);Rt((()=>{re(w,Ae(xt(y)))}));let S=()=>{re(w,!0)},k=()=>{re(w,!1),xt(o)?.removeEventListener("animationiteration",S)},T=ne((()=>s()&&!xt(y)));Rt((()=>{s()?(k(),xt(o)?.addEventListener("animationiteration",S,{once:!0})):k()}));Zr((()=>{f.clearTimeout(),k()}));let E=$s("tooltip_interactive_interaction_time_indicator");var x=Ad();let $;x.__mousemove=[Cd],x.__click=()=>{xt(y)||(f.set(!0),g?.())};var C=Oe(x);ql(C,{tooltipContent:E,get tooltipActive(){return xt(T)},initialTranslateYPx:72,tooltipPlacement:"bottom",onTooltipVisibilityChange:e=>{f.set(e)},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{Kl(e,{completed:!0})},$$slots:{default:!0}});var A=Ne(C,2);let P;Qr(A,(e=>n(e)),(()=>n()));var L=Ne(A,2);let M;Qr(L,(e=>re(o,e)),(()=>xt(o))),xe(x),Bt(((e,t,i)=>{$=wr(x,1,"interactive-episode-icon-animated svelte-od3veb",null,$,e),P=wr(A,1,"ref-block svelte-od3veb",null,P,t),M=wr(L,1,"pulse svelte-od3veb",null,M,i)}),[()=>({mobile:a(),fullscreen:oa(h,"$isFullscreen",i),invisible:xt(y),"icon-small":xt(_)}),()=>({hidden:xt(y)}),()=>({paused:xt(w)})]),Ii("mouseleave",x,(()=>{f.set(!1)})),ji(e,x),fi(),r()}function Md(e,t){pi(t,!0);let i=fa(t,"tooltipEnabled",3,!0),r=fa(t,"disabled",3,!1),a=fa(t,"className",3,void 0),s=fa(t,"ref",15);ql(e,{get disabled(){return r()},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},get hasTooltip(){return i()},get mouseEnter(){return t.mouseEnter},get mouseLeave(){return t.mouseLeave},get className(){return a()},get ref(){return s()},set ref(e){s(e)},children:(e,i)=>{var r=Fi();let a=ne((()=>t.buttonComponent));hr(Be(r),(()=>xt(a)),((e,i)=>{i(e,ha((()=>t.buttonComponentProps??{})))})),ji(e,r)},$$slots:{default:!0}}),fi()}Ri(["mousemove","click"]);var Id=100,Rd=200,Dd=300,Od=400,Bd=500,Nd=600,Vd=700,Ud=800,Fd=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M16 10.835V7.5a1 1 0 1 1 2 0v9a1 1 0 0 1-2 0v-3.335l-8.149 4.67C7.03 18.304 6 17.715 6 16.772V7.227c0-.943 1.029-1.533 1.851-1.061L16 10.834z"></path></svg>');function jd(e,t){let i=fa(t,"isPrev",3,!1),r=fa(t,"isMobile",3,!1),a=fa(t,"width",3,"24"),s=fa(t,"height",3,"24"),n=ne((()=>i()&&r()?"transform: scaleX(-1) scale(1.3333);":i()?"transform: scaleX(-1);":r()?"transform: scale(1.3333);":void 0)),o=ne((()=>i()?"prev-icon":"next-icon"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Fd();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"26",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(n)},get width(){return a()},get height(){return s()},get viewBox(){return t.viewBox},get"data-testid"(){return xt(o)}})}var zd=Ni('<div class="icon-background-mobile svelte-xtk2k4"></div>'),Wd=Ni("<!> <!>",1),qd={hash:"svelte-xtk2k4",code:".icon-background-mobile.svelte-xtk2k4 {position:absolute;top:0;left:0;width:100%;height:100%;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);}"};function Hd(e,t){pi(t,!0),mr(e,qd);let i=fa(t,"ref",15,void 0),r=fa(t,"isMobile",3,!1),a=fa(t,"disabled",3,!1),s=Na().ui.t,n=ne((()=>"prev"===t.type?s("tooltip_previous"):s("tooltip_next"))),o=ne((()=>"prev"===t.type?s("hotkey_map_item_prev_video_value"):s("hotkey_map_item_next_video_value"))),l=ne((()=>`btn-${r()?"m":"d"}--${t.type}`));Ko(e,{get className(){return xt(l)},get testId(){return`btn-${t.type??""}`},get disabled(){return a()},get ariaLabel(){return xt(n)},get click(){return t.click},get ariaKeyShortCut(){return xt(o)},get ref(){return i()},set ref(e){i(e)},children:(e,i)=>{var a=Wd(),s=Be(a),n=e=>{ji(e,zd())};Zi(s,(e=>{r()&&e(n)}));var o=Ne(s,2);let l=ne((()=>"prev"===t.type));jd(o,{get isMobile(){return r()},get isPrev(){return xt(l)}}),ji(e,a)},$$slots:{default:!0}}),fi()}var Kd=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M12 10.096a.4.4 0 0 1-.67.296L7.044 6.493a.67.67 0 0 1 0-.986l4.288-3.899a.4.4 0 0 1 .669.296V5a8 8 0 1 1-8 8 1 1 0 1 1 2 0 6 6 0 1 0 6-6z"></path></svg>');function Qd(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Kd();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"replay-icon",role:"img",...i}))),ji(e,r)}var Gd=Ni('<div class="icon-background-mobile svelte-1ot3duq"></div>'),Yd=Ni("<!> <div><!></div>",1),Xd={hash:"svelte-1ot3duq",code:".mobile.svelte-1ot3duq {position:relative;display:flex;align-items:center;justify-content:center;}.mobile.svelte-1ot3duq svg {transform:scale(2);}.icon-background-mobile.svelte-1ot3duq {position:absolute;top:16px;left:16px;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);width:calc(100% - 32px);height:calc(100% - 32px);}"};function Zd(e,t){pi(t,!0),mr(e,Xd);let i=fa(t,"ref",15,void 0),r=fa(t,"isMobile",3,!1),a=fa(t,"disabled",3,!1),s=fa(t,"className",3,""),n=fa(t,"click",3,m.noop),o=$s("tooltip_restart"),l=ne((()=>`${r()?"btn-m--play":""} ${s()}`));Ko(e,{get className(){return xt(l)},testId:"btn-replay",ariaLabel:o,get disabled(){return a()},get click(){return n()},get ariaKeyShortCut(){return wa},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{var i=Yd(),a=Be(i),s=e=>{ji(e,Gd())};Zi(a,(e=>{r()&&e(s)}));var n=Ne(a,2);let o;Qd(Oe(n),{}),xe(n),Bt((e=>o=wr(n,1,"svelte-1ot3duq",null,o,e)),[()=>({mobile:r()})]),ji(e,i)},$$slots:{default:!0}}),fi()}var Jd=Vi('<svg fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="play-icon"><path d="M17.671 10.923c.82.483.82 1.67 0 2.154l-8.787 5.175A1.25 1.25 0 0 1 7 17.174V6.826a1.25 1.25 0 0 1 1.884-1.078l8.787 5.175z"></path></svg>');function ec(e,t){let i=fa(t,"width",3,"24"),r=fa(t,"height",3,"24"),a=fa(t,"viewBox",3,"0 0 24 24"),s=fa(t,"fill",3,"var(--btn-color)");var n=Jd(),o=Oe(n);xe(n),Bt((()=>{Ar(n,"width",i()),Ar(n,"height",r()),Ar(n,"viewBox",a()),Ar(o,"fill",s())})),ji(e,n)}var tc=Vi('<svg fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" data-testid="pause-icon"><path d="M8.712 5c.448 0 .61.047.774.134a.913.913 0 0 1 .38.38c.087.164.134.326.134.774v11.424c0 .448-.047.61-.134.774a.914.914 0 0 1-.38.38c-.164.087-.326.134-.774.134H6.788c-.448 0-.61-.047-.774-.134a.914.914 0 0 1-.38-.38c-.087-.164-.134-.326-.134-.774V6.288c0-.448.047-.61.134-.774a.913.913 0 0 1 .38-.38C6.178 5.047 6.34 5 6.788 5h1.924zm8 0c.448 0 .61.047.774.134a.914.914 0 0 1 .38.38c.087.164.134.326.134.774v11.424c0 .448-.047.61-.134.774a.914.914 0 0 1-.38.38c-.164.087-.326.134-.774.134h-1.924c-.448 0-.61-.047-.774-.134a.914.914 0 0 1-.38-.38c-.087-.164-.134-.326-.134-.774V6.288c0-.448.047-.61.134-.774a.914.914 0 0 1 .38-.38c.164-.087.326-.134.774-.134h1.924z"></path></svg>');function ic(e,t){let i=fa(t,"width",3,"24"),r=fa(t,"height",3,"24"),a=fa(t,"viewBox",3,"0 0 24 24"),s=fa(t,"fill",3,"var(--btn-color)");var n=tc(),o=Oe(n);xe(n),Bt((()=>{Ar(n,"width",i()),Ar(n,"height",r()),Ar(n,"viewBox",a()),Ar(o,"fill",s())})),ji(e,n)}var rc=Ni('<div class="icon-background-mobile svelte-1ot3duq"></div>'),ac=Ni("<!> <div><!></div>",1),sc={hash:"svelte-1ot3duq",code:".mobile.svelte-1ot3duq {position:relative;display:flex;align-items:center;justify-content:center;}.mobile.svelte-1ot3duq svg {transform:scale(2);}.icon-background-mobile.svelte-1ot3duq {position:absolute;top:16px;left:16px;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);width:calc(100% - 32px);height:calc(100% - 32px);}"};function nc(e,t){pi(t,!0),mr(e,sc);let[i,r]=la(),a=()=>oa(s,"$fakeIsPlaying$",i),{fakeIsPlaying$:s}=Va(),n=fa(t,"ref",15,void 0),o=fa(t,"isMobile",3,!1),l=fa(t,"isPlaying",3,!1),u=fa(t,"disabled",3,!1),d=fa(t,"className",3,""),c=fa(t,"click",3,m.noop),h=Na().ui.t,{toggle:p}=s,f=ne((()=>p)),g=ne((()=>null!==a())),v=ne((()=>xt(g)?a():l())),b=ne((()=>xt(v)?h("tooltip_pause"):h("tooltip_play"))),_=ne((()=>xt(v)?ic:ec)),y=ne((()=>`${o()?"btn-m--play":""} ${d()}`)),w=ne((()=>xt(g)?xt(f):c()));Ko(e,{get className(){return xt(y)},testId:"btn-play",get click(){return xt(w)},get disabled(){return u()},get ariaLabel(){return xt(b)},get ariaKeyShortCut(){return wa},get ref(){return n()},set ref(e){n(e)},children:(e,t)=>{var i=ac();let r=ne((()=>xt(_)));var a=Be(i),s=e=>{ji(e,rc())};Zi(a,(e=>{o()&&e(s)}));var n=Ne(a,2);let l;hr(Oe(n),(()=>xt(r)),((e,t)=>{t(e,{})})),xe(n),Bt((e=>l=wr(n,1,"svelte-1ot3duq",null,l,e)),[()=>({mobile:o()})]),ji(e,i)},$$slots:{default:!0}}),fi(),r()}var oc=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M12.583 12.917v2.496a1 1 0 0 1-1.522.853l-5.583-3.413a1 1 0 0 1 0-1.706l5.583-3.413a1 1 0 0 1 1.522.853v2.496l5.478-3.349a1 1 0 0 1 1.522.853v6.826a1 1 0 0 1-1.522.853z"></path></svg>');function lc(e,t){pi(t,!0);let i=fa(t,"ref",15,void 0),r=fa(t,"hidden",3,!1),a=fa(t,"disabled",3,!1),s=$s("tooltip_interactive_go_back"),n=ne((()=>r()?"hidden":""));Ko(e,{get className(){return xt(n)},testId:"btn-play-prev-chapter",ariaLabel:s,get disabled(){return a()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=oc();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","data-testid":"play-prev-chapter-icon",role:"img",...i}))),ji(e,r)}(e,{})},$$slots:{default:!0}}),fi()}var uc=Ni('<span class="gutter svelte-et3q1q"><span><!></span></span>'),dc={hash:"svelte-et3q1q",code:".gutter.svelte-et3q1q {--gutterWidth: 32px;--gutterHeight: 12px;--togglerWidth: 18px;--togglerHeight: 18px;--togglerGap: calc(var(--togglerWidth) / 6);position:relative;width:var(--gutterWidth);height:var(--gutterHeight);background-color:rgba(255, 255, 255, 0.3);border-radius:50px;}.toggler.svelte-et3q1q {position:absolute;top:calc(((var(--togglerHeight) - var(--gutterHeight)) / 2) * -1);left:0;display:flex;align-items:center;justify-content:center;width:var(--togglerWidth);height:var(--togglerHeight);background-color:rgba(98, 99, 100, 1);border-radius:50%;transform:translateX(calc(var(--togglerGap) * -1));transition-property:background-color, transform;transition-duration:0.2s;transition-timing-function:ease;}.toggler.enabled.svelte-et3q1q {background-color:var(--toggle-color-autoplay-on);transform:translateX(calc(var(--gutterWidth) - var(--togglerWidth) + var(--togglerGap)));}"};function cc(e,t){pi(t,!0),mr(e,dc);let[i,r]=la(),a=()=>oa(o,"$autoplayNextEnabled$",i),s=fa(t,"ref",15,void 0),n=Na(),o=n.ui.autoplayNextEnabled$,l=n.actions.internal.setAutoplayNextEnabled;Ko(e,{click:()=>{l(!a(),!0)},get ref(){return s()},set ref(e){s(e)},children:(e,t)=>{var i=uc(),r=Oe(i);let s;var n=Oe(r),o=e=>{ec(e,{width:"14",height:"14",fill:"#000"})},l=e=>{ic(e,{width:"14",height:"14",fill:"#000"})};Zi(n,(e=>{a()?e(o):e(l,!1)})),xe(r),xe(i),Bt((e=>s=wr(r,1,"toggler svelte-et3q1q",null,s,e)),[()=>({enabled:a()})]),ji(e,i)},$$slots:{default:!0}}),fi(),r()}var hc=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M16.726 4.845C16.187 4.8 15.496 4.8 14.5 4.8H7.9a.9.9 0 1 1 0-1.8h6.639c.947 0 1.713 0 2.333.05.64.053 1.204.163 1.726.43a4.4 4.4 0 0 1 1.923 1.922c.266.523.377 1.087.429 1.726.05.62.05 1.386.05 2.334v5.076c0 .948 0 1.714-.05 2.334-.052.64-.163 1.203-.43 1.726a4.4 4.4 0 0 1-1.922 1.922c-.522.267-1.086.377-1.726.43-.62.05-1.386.05-2.333.05H7.9a.9.9 0 1 1 0-1.8h6.6c.995 0 1.687 0 2.226-.045.528-.043.828-.123 1.055-.238a2.6 2.6 0 0 0 1.136-1.137c.115-.226.195-.527.239-1.055.044-.538.044-1.23.044-2.225v-5c0-.995 0-1.687-.044-2.226-.043-.527-.124-.828-.239-1.054a2.6 2.6 0 0 0-1.136-1.137c-.227-.115-.527-.195-1.055-.238" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M7.76 11.169V8.908c0-.708.704-1.143 1.252-.774l4.594 3.093c.525.353.525 1.193 0 1.546l-4.594 3.093c-.548.369-1.252-.066-1.252-.774v-2.261l-4.508 3.035C2.704 16.235 2 15.8 2 15.091V8.908c0-.708.704-1.143 1.252-.774z"></path></svg>');function pc(e,t){pi(t,!0);let i=fa(t,"ref",15,void 0),r=fa(t,"hidden",3,!1),a=fa(t,"disabled",3,!1),s=$s("tooltip_interactive_seek"),n=ne((()=>r()?"hidden":""));Ko(e,{get className(){return xt(n)},testId:"btn-seek-to-interactive",ariaLabel:s,get disabled(){return a()},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=hc();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"seek-to-interactive-icon",role:"img",...i}))),ji(e,r)}(e,{})},$$slots:{default:!0}}),fi()}var fc=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M16.777 3h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.2.72.523.923.918.141.277.19.557.21.814.02.237.02.521.02.83V7.19c0 .31 0 .594-.02.831-.02.256-.069.537-.21.813a2.1 2.1 0 0 1-.923.92c-.278.14-.56.188-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.15 2.15 0 0 1-.817-.21 2.1 2.1 0 0 1-.923-.919 2.1 2.1 0 0 1-.21-.813 8 8 0 0 1-.02-.63l-2.198-.002c-.495-.001-.81 0-1.05.018-.23.019-.309.05-.343.067a.8.8 0 0 0-.352.35c-.017.034-.049.113-.068.341-.02.24-.02.554-.02 1.046v5.57c0 .49 0 .804.02 1.043.019.228.05.306.068.34.077.15.2.273.35.35.035.017.113.049.342.067.24.02.555.021 1.048.022l2.203.003a8 8 0 0 1 .02-.627c.02-.256.069-.537.21-.813.203-.396.526-.718.923-.92.278-.14.56-.189.817-.21.238-.019.524-.019.834-.019h1.419c.31 0 .596 0 .834.02.258.02.539.068.817.21.397.201.72.523.923.919.141.276.19.557.21.813.02.237.02.522.02.831v1.397c0 .31 0 .594-.02.831-.02.256-.069.537-.21.814a2.1 2.1 0 0 1-.923.919c-.278.14-.56.189-.817.21-.238.019-.524.019-.834.019h-1.419c-.31 0-.596 0-.834-.02a2.15 2.15 0 0 1-.817-.21 2.1 2.1 0 0 1-.923-.918 2.1 2.1 0 0 1-.21-.814 8 8 0 0 1-.02-.63l-2.24-.002c-.449 0-.839-.001-1.16-.028-.341-.028-.684-.09-1.016-.259a2.6 2.6 0 0 1-1.14-1.137c-.17-.33-.231-.672-.259-1.011-.026-.321-.026-.71-.026-1.156v-1.921H2.905A.903.903 0 0 1 2 11.992c0-.498.405-.901.905-.901h5.227V9.177c0-.448 0-.837.026-1.159.028-.34.09-.682.26-1.013a2.6 2.6 0 0 1 1.144-1.138c.332-.168.676-.23 1.017-.257.323-.025.714-.025 1.164-.024l2.23.003a8 8 0 0 1 .02-.627c.02-.257.069-.537.21-.814.203-.395.526-.717.923-.919.278-.14.56-.189.817-.21C16.18 3 16.467 3 16.777 3m-.833 1.837a1 1 0 0 1 .146-.02 10 10 0 0 1 .72-.014h1.354c.353 0 .563 0 .719.013a1 1 0 0 1 .146.021.3.3 0 0 1 .126.126 1 1 0 0 1 .021.145c.013.156.014.365.014.716v1.334c0 .352 0 .561-.014.716a1 1 0 0 1-.02.146.3.3 0 0 1-.127.125 1 1 0 0 1-.146.022c-.156.012-.366.013-.719.013H16.81c-.353 0-.563 0-.719-.013a1 1 0 0 1-.146-.022.3.3 0 0 1-.126-.125 1 1 0 0 1-.021-.146 10 10 0 0 1-.014-.716V5.824c0-.351.001-.56.014-.716a1 1 0 0 1 .021-.145.3.3 0 0 1 .126-.126Zm0 11.018a1 1 0 0 1 .146-.022c.156-.012.366-.013.72-.013h1.354c.353 0 .563 0 .719.013a1 1 0 0 1 .146.022.3.3 0 0 1 .126.125 1 1 0 0 1 .021.146c.013.155.014.364.014.716v1.334c0 .351 0 .56-.014.716a1 1 0 0 1-.02.145.3.3 0 0 1-.127.126 1 1 0 0 1-.146.02c-.156.014-.366.014-.719.014H16.81c-.353 0-.563 0-.719-.013a1 1 0 0 1-.146-.021.3.3 0 0 1-.126-.126 1 1 0 0 1-.021-.145 10 10 0 0 1-.014-.716v-1.334c0-.352.001-.561.014-.716a1 1 0 0 1 .021-.146.3.3 0 0 1 .126-.125Z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M15.2 5.899v1.203c0 .594 0 .892.115 1.119.102.2.265.362.464.463.227.116.525.116 1.12.116H18.1c.595 0 .892 0 1.12-.116.199-.101.361-.264.463-.463.116-.227.116-.525.116-1.12V5.9c0-.595 0-.892-.116-1.12a1.06 1.06 0 0 0-.464-.463c-.227-.116-.524-.116-1.119-.116h-1.203c-.594 0-.892 0-1.119.116-.2.102-.362.264-.464.464-.115.227-.115.524-.115 1.119Zm-.051 11.03v1.143c0 .605 0 .908.118 1.139.103.203.268.368.472.472.23.117.533.117 1.138.117H18.1c.605 0 .907 0 1.138-.117a1.08 1.08 0 0 0 .472-.472c.118-.231.118-.534.118-1.139v-1.144c0-.605 0-.907-.118-1.138a1.08 1.08 0 0 0-.472-.472c-.231-.118-.534-.118-1.138-.118h-1.224c-.605 0-.907 0-1.138.118a1.08 1.08 0 0 0-.472.472c-.118.23-.118.533-.118 1.138Z" class="_closed" clip-rule="evenodd"></path></svg>');var mc={hash:"svelte-17ceof5",code:'svg[data-testid="graph-open-icon"] ._closed {visibility:hidden;opacity:0;}'};function gc(e,t){mr(e,mc);let i=fa(t,"isOpened",3,!1),r=ne((()=>i()?"graph-close-icon":"graph-open-icon"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=fc();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true",role:"img",...i}))),ji(e,r)}(e,{get"data-testid"(){return xt(r)}})}function vc(e,t){pi(t,!0);let i=fa(t,"ref",15,void 0),r=fa(t,"hidden",3,!1),a=fa(t,"disabled",3,!1),s=fa(t,"graphIsOpened",3,!1),n=Na().ui.t,o=ne((()=>s()?n("tooltip_interactive_graph_on"):n("tooltip_interactive_graph_off"))),l=ne((()=>r()?"hidden":""));Ko(e,{get className(){return xt(l)},testId:"btn-graph",get disabled(){return a()},get ariaLabel(){return xt(o)},get click(){return t.click},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{let i=ne((()=>!!s()));gc(e,{get isOpened(){return xt(i)}})},$$slots:{default:!0}}),fi()}function bc(e,t){pi(t,!0);let[i,r]=la(),a=()=>oa(u,"$playbackState$",i),s=fa(t,"isMobile",3,!1),n=fa(t,"isLiveActive",3,!1),o=fa(t,"ariaLabel",3,""),l=Na(),u=l.state.playbackState$,d=l.actions.internal.switchToActiveLive,c=l.actions.internal.togglePlay,h=ne((()=>()=>{n()?a()===f.PlaybackState.PAUSED&&c():d()})),p=ne((()=>s()?"":"btn--live btn-full-opacity")),m=ne((()=>n()?"btn-live":"btn-live-offset")),g=ne((()=>n()&&a()===f.PlaybackState.PLAYING));Ko(e,{get className(){return xt(p)},get testId(){return xt(m)},get disabled(){return xt(g)},get ariaLabel(){return o()},get click(){return xt(h)},children:(e,t)=>{dn(e,{get isActive(){return n()}})},$$slots:{default:!0}}),fi(),r()}var _c=Ni('<div class="icon icon-error-stub"><div class="inner"></div></div>'),yc=Ni('<img class="icon" aria-hidden="true">');function wc(e,t){let i=te(!1),r=()=>{re(i,!0)};var a=Fi(),s=Be(a),n=e=>{ji(e,_c())},o=e=>{var i=yc();Bt((()=>Ar(i,"src",t.icon))),Ii("error",i,r),Li(i),ji(e,i)};Zi(s,(e=>{xt(i)?e(n):e(o,!1)})),ji(e,a)}var Sc=100,kc=200,Tc=300,Ec=400,xc=500,$c=600,Cc=700,Ac=800,Pc=Ni('<div><!> <div class="controls svelte-1iedtj3"><div class="controls-left svelte-1iedtj3"><!> <!> <!></div> <div class="controls-right svelte-1iedtj3"></div></div></div> <!>',1),Lc={hash:"svelte-1iedtj3",code:".wrapper-bottom.svelte-1iedtj3 {pointer-events:none;position:absolute;z-index:var(--controls-container-z-index);width:100%;bottom:0;left:0;height:var(--controls-gradient-height);background:var(--controls-gradient);transition:transform var(--controls-transition-duration) var(--controls-transition-fn);display:flex;flex-direction:column;justify-content:flex-end;box-sizing:border-box;}.wrapper-bottom.svelte-1iedtj3 > :where(.svelte-1iedtj3) {pointer-events:auto;}.controls.svelte-1iedtj3 {width:100%;display:flex;align-items:center;justify-content:space-between;height:var(--controls-height);white-space:nowrap;font-size:13px;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);will-change:transform;padding:0 8px 4px;box-sizing:border-box;}.controls-left.svelte-1iedtj3, .controls-right.svelte-1iedtj3 {display:flex;align-content:center;}.controls-left.svelte-1iedtj3 {flex-grow:1;min-width:0;overflow:hidden;}.controls-left.svelte-1iedtj3 > *:not(:first-child), .controls-right.svelte-1iedtj3 > * {margin-left:var(--controls-desktop-item-margin-left);}.controls-hidden.svelte-1iedtj3 {visibility:visible; /* if hidden then slider will lose focus (if was focused) */transform:translateY(100%);}.wrapper-bottom.no-smooth.svelte-1iedtj3 {transition:none;}"};function Mc(e,t){pi(t,!0),mr(e,Lc);let[i,r]=la(),a=()=>oa(Ee,"$disabledControls$",i),s=()=>oa(ue,"$playbackState$",i),n=()=>oa(he,"$isEnded$",i),o=()=>oa(Fe,"$currentGridType$",i),l=()=>oa(pe,"$isLive$",i),u=()=>oa(Se,"$chromecastState$",i),d=()=>oa(ge,"$isPictureInPictureActive",i),c=()=>oa(ve,"$pictureInPictureType$",i),h=()=>oa(Ue,"$playerSize",i),p=()=>oa(me,"$isRewindableLive$",i),g=()=>oa(it,"$graphIsOpened$",i),v=()=>oa(Ve,"$isFullscreen",i),b=()=>oa(xt(Qt),"$prevButton",i),_=()=>oa(xt(Gt),"$replayButton",i),y=()=>oa(xt(Yt),"$playButton",i),w=()=>oa(xt(Xt),"$nextButton",i),S=()=>oa(xt(Zt),"$playPrevChapterButton",i),k=()=>oa(xt(Jt),"$seekToInteractiveButton",i),T=()=>oa(xt(ei),"$interactiveGraphButton",i),E=()=>oa(xt(ti),"$liveButton",i),x=()=>oa(xt(ii),"$time",i),$=()=>oa(xt(ri),"$episodes",i),C=()=>oa(xt(ai),"$vkLogo",i),A=()=>oa(xt(si),"$volume",i),P=()=>oa(xt(ni),"$subtitles",i),L=()=>oa(xt(oi),"$settings",i),M=()=>oa(xt(li),"$context",i),I=()=>oa(xt(ui),"$fullscreen",i),R=()=>oa(xt(di),"$chromecast",i),D=()=>oa(je,"$additionalDesktopControlPanelRightButtons$",i),O=()=>oa(be,"$settingsMenuVisible",i),B=()=>oa(bi,"$settingButtonRef$",i),N=()=>oa(Le,"$startedByKeyboard$",i),V=()=>oa(Q,"$fakeIsPlaying$",i),U=()=>oa(le,"$position$",i),F=()=>oa(oe,"$duration$",i),j=fa(t,"playerControlsWrapperRef",15,void 0),z=fa(t,"playerControlsRef",15,void 0),W=fa(t,"isAds",3,!1),q=fa(t,"logoTargetUrl",3,""),H=fa(t,"isOneVideoPlaylist",3,!1),K=fa(t,"customFullscreenSupported",3,!0),{fakeIsPlaying$:Q}=Va(),G=Na(),Y=Va(),X=ba(),Z=G.actions.internal.toggleMuted,J=G.actions.internal.togglePlay,ee=G.actions.internal.pause,ie=G.actions.internal.toggleSubtitle,ae=G.callbacks?.onAudioDoesNotExistHint,se=G.callbacks?.onAudioDisabledHint,oe=G.state.duration$,le=G.state.positionWithScrubbing$,ue=G.state.playbackState$,de=G.state.isAudioAvailable$,ce=G.state.isAudioDisabled,he=G.state.isEnded$,pe=G.state.isLive$,fe=G.state.isActiveLive$,me=G.state.isRewindableLive$,{isActive$:ge,type$:ve}=Y.pictureInPicture$,be=G.ui.settingsMenu.visible$,_e=G.ui.settingsMenu.openedByBtnKeyboard$,ye=G.ui.controls,we=G.actions.internal.getVideoEpisodes(),Se=G.state.chromecastState$,ke=G.state.availableSubtitlesList$,Te=G.state.currentSubtitle$,Ee=ye.disabledControls$,$e=G.ui.contextMenu.visible$,Ce=G.ui.contextMenu.showContextMenuBtn$,Pe=G.ui.contextMenu.openedByBtnKeyboard$,Le=G.ui.startedByKeyboard$,Me=G.ui.t,Ie=G.ads.duration,Re=G.ads.position,De=G.ads.playbackState,Ve=G.ui.isFullscreen,Ue=G.ui.playerSize,Fe=G.ui.currentGridType$,je=G.ui.additionalDesktopControlPanelRightButtons$,ze=G.ui.autoplayNextEnabled$,We=G.actions.internal.getVideoElement,qe=G.actions.internal.replayInteractive,He=G.actions.internal.prevVideoClick,Ke=G.actions.internal.nextVideoClick,Qe=G.state.isInteractive,Ge=G.state.isInteractiveTime$,Ye=G.state.showInteractiveGraph,Xe=G.state.showSeekToInteractive,Ze=G.state.showPlayPrevChapter,Je=G.state.showInteractiveTimeIndicator,et=G.state.playPrevChapterDisabledTooltip,tt=Y.seekToInteractiveDisabledTooltip$,it=Y.graphIsOpened$,rt=X.features.interactiveResponsiveUi,at=ne((()=>a().has("EPISODE_BUTTON"))),st=ne((()=>a().has("GRAPH_BUTTON"))),nt=ne((()=>a().has("SEEK_TO_INTERACTIVE_BUTTON"))),ot=ne((()=>a().has("PLAY_BUTTON"))),lt=ne((()=>a().has("REPLAY_BUTTON"))),ut=ne((()=>a().has("PLAY_PREV_CHAPTER_BUTTON"))),dt=()=>G.actions.internal.toggleChromecast(),ct=ne((()=>W()?"playing"===oa(De,"$adPlaybackState",i):s()===f.PlaybackState.PLAYING)),ht=ne((()=>"off"!==oa(Te,"$currentSubtitle$",i).value)),pt=ne((()=>n()&&!W()||Qe)),ft=ne((()=>rt?xt(pt)&&lu(o(),"m"):xt(pt))),mt=ne((()=>!n()||Qe||W())),gt=ne((()=>lu(o(),"m"))),vt=ne((()=>t.showNextPrevButtons&&lu(o(),"m")&&!W()&&t.nextButtonActive)),bt=ne((()=>t.showNextPrevButtons&&lu(o(),"m")&&!W()&&t.prevButtonActive)),_t=ne((()=>!W()&&!!l())),yt=ne((()=>u()!==f.ChromecastState.NOT_AVAILABLE&&!(d()&&1===c())&&lu(o(),"m")&&!Qe)),wt=ne((()=>t.showAutoplayNext&&!H()&&lu(o(),"s"))),St=ne((()=>oa(ke,"$availableSubtitlesList$",i).length>0&&lu(o(),"m"))),kt=ne((()=>oa(Pe,"$contextMenuOpenedByKeyboard$",i)||oa(Ce,"$showContextMenuBtn$",i))),Tt=ne((()=>lu(o(),"s")&&!W())),Et=ne((()=>!t.logoHidden&&!W())),Ct=ne((()=>X.features.fullscreen&&(t.logoHidden||lu(o(),rt?"xs":"s"))&&!(d()&&1===c())&&(!Qe||K()))),At=ne((()=>(!l()||W())&&!(X.features.interactiveHideTime&&Qe))),Pt=ne((()=>h().width>100)),Lt=ne((()=>Ye&&lu(o(),"m"))),Mt=ne((()=>rt?Xe&&lu(o(),"s"):Xe)),It=ne((()=>rt?Ze&&lu(o(),"s"):Ze)),Dt=ne((()=>!W()&&!l()&&!!we?.length&&xt(gt)&&!xt(at))),Ot=ne((()=>!p()||!!oa(fe,"$isActiveLive$",i))),Nt=ne((()=>g()?Me("tooltip_interactive_graph_on"):Me("tooltip_interactive_graph_off"))),Vt=ne((()=>oa($e,"$contextMenuVisible$",i)?Me("aria_label_context_menu_close"):Me("aria_label_context_menu_open"))),Ut=ne((()=>{return e=xt(Ot),t=s(),e?t&&t===f.PlaybackState.PAUSED?Me("tooltip_play"):"":Me("tooltip_live");var e,t})),Ft=ne((()=>"vk_video"===X.logoType?Me("tooltip_vk_video_logo"):Me("tooltip_vk_logo"))),jt=ne((()=>xt(ht)?Me("tooltip_subtitles_on"):Me("tooltip_subtitles_off"))),zt=ne((()=>v()?Me("tooltip_fullscreen_on"):Me("tooltip_fullscreen_off"))),Wt=ne((()=>u()===f.ChromecastState.CONNECTED?Me("tooltip_chromecast_on"):Me("tooltip_chromecast_off"))),qt=ne((()=>oa(ze,"$autoplayNextEnabled",i)?Me("tooltip_autoplay_on"):Me("tooltip_autoplay_off"))),Ht=te(0),Kt=Ae({}),Qt=ne((()=>ye.prevButton)),Gt=ne((()=>ye.replayButton)),Yt=ne((()=>ye.playButton)),Xt=ne((()=>ye.nextButton)),Zt=ne((()=>ye.playPrevChapterButton)),Jt=ne((()=>ye.seekToInteractiveButton)),ei=ne((()=>ye.interactiveGraphButton)),ti=ne((()=>ye.liveButton)),ii=ne((()=>ye.time)),ri=ne((()=>ye.episodes)),ai=ne((()=>ye.vkLogo)),si=ne((()=>ye.volume)),ni=ne((()=>ye.subtitles)),oi=ne((()=>ye.settings)),li=ne((()=>ye.context)),ui=ne((()=>ye.fullscreen)),di=ne((()=>ye.chromecast)),ci=ne((()=>({prevButton:b()?b().right-b().left:0,replayButton:_()?_().right-_().left:0,playButton:y()?y().right-y().left:0,nextButton:w()?w().right-w().left:0,playPrevChapterButton:S()?S().right-S().left:0,seekToInteractiveButton:k()?k().right-k().left:0,interactiveGraphButton:T()?T().right-T().left:0,liveButton:E()?E().right-E().left:0,time:x()?x().right-x().left:0,episodes:$()?$().right-$().left:0,vkLogo:C()?C().right-C().left:0,volume:A()?A().right-A().left:0,subtitles:P()?P().right-P().left:0,settings:L()?L().right-L().left:0,context:M()?M().right-M().left:0,fullscreen:I()?I().right-I().left:0,chromecast:R()?R().right-R().left:0,additionalButtons:D().length?D().reduce((e=>[...e,40]),[]):[]}))),hi=te(0);Rt((()=>{(!xt(hi)||xt(hi)<xt(ci).time)&&$t((()=>re(hi,Ae(xt(ci).time))))}));let mi=te(!1);Rt((()=>{let e=0;xt(Dt)&&(e=lu(o(),"xl")?xt(ci).time:60);let t=xt(ci).prevButton+xt(ci).playButton+xt(ci).nextButton+xt(ci).seekToInteractiveButton+xt(ci).interactiveGraphButton+xt(ci).liveButton+xt(hi)+e;re(mi,Ae(xt(At)&&xt(Ht)>=t))}));let gi=ne((()=>xt(mi)&&lu(o(),"m"))),vi=(0,m.debounceFn)(Td,260);Rt((()=>{h(),oa(Ge,"$isInteractiveTime$",i),vi(We(),ye,Kt,t.showControls)}));let bi=ia();function _i(){Do({isAudioDisabled:ce,audioDisabledHintCallback:se,isAudioAvailable:oa(de,"$isAudioAvailable$",i),audioIsNotExistHintCallback:ae})&&Z()}Rt((()=>{O(),B()&&$t((()=>xn(B(),O(),_e)))})),Rt((()=>{N(),$t((()=>Ed(Le,N(),undefined)))}));let yi=Qe?qe:J,wi=ne((()=>null!==V())),Si=ne((()=>xt(wi)?V():xt(ct))),ki=ne((()=>xt(Si)?Me("tooltip_pause"):Me("tooltip_play"))),Ti=Me("tooltip_episodes"),Ei=ne((()=>xt(bt)?{id:"prevButton",type:"desktop-control-panel-left",weight:Id,buttonComponent:Hd,buttonComponentProps:{disabled:!t.prevButtonActive,type:"prev",click:He.bind(null,!0)},tooltipEnabled:!G.callbacks?.uiInfo?.onPrevButtonMouseEnter&&!G.callbacks?.uiInfo?.onPrevButtonMouseLeave,mouseEnter:()=>{G.callbacks?.uiInfo?.onPrevButtonMouseEnter?.(kd(We(),Kt,"prevButton",t.showControls))},mouseLeave:()=>{G.callbacks?.uiInfo?.onPrevButtonMouseLeave?.(kd(We(),Kt,"prevButton",t.showControls))},tooltipText:Me("tooltip_previous"),disabled:!t.prevButtonActive}:void 0)),xi=ne((()=>xt(ft)?{id:"replayButton",type:"desktop-control-panel-left",weight:Rd,buttonComponent:Zd,buttonComponentProps:{disabled:xt(lt),click:yi},tooltipText:Me("tooltip_restart"),disabled:xt(lt)}:void 0)),$i=ne((()=>xt(mt)?{id:"playButton",type:"desktop-control-panel-left",weight:Dd,buttonComponent:nc,buttonComponentProps:{disabled:xt(ot),isPlaying:xt(ct),click:J},tooltipText:xt(ki),disabled:xt(ot)}:void 0)),Ci=ne((()=>xt(vt)?{id:"nextButton",type:"desktop-control-panel-left",weight:Od,buttonComponent:Hd,buttonComponentProps:{disabled:!t.nextButtonActive,type:"next",click:Ke.bind(null,!0)},tooltipEnabled:!G.callbacks?.uiInfo?.onNextButtonMouseEnter&&!G.callbacks?.uiInfo?.onNextButtonMouseLeave,mouseEnter:()=>{G.callbacks?.uiInfo?.onNextButtonMouseEnter?.(kd(We(),Kt,"nextButton",t.showControls))},mouseLeave:()=>{G.callbacks?.uiInfo?.onNextButtonMouseLeave?.(kd(We(),Kt,"nextButton",t.showControls))},tooltipText:Me("tooltip_next"),disabled:!t.nextButtonActive}:void 0)),Ai=ne((()=>Qe&&xt(It)?{id:"playPrevChapterButton",type:"desktop-control-panel-left",weight:Bd,buttonComponent:lc,buttonComponentProps:{disabled:xt(ut),click:t.playPrevChapter},tooltipText:Me("tooltip_interactive_go_back"),disabledTooltipContent:Me(et),disabled:xt(ut)}:void 0)),Pi=ne((()=>Qe&&xt(Mt)?{id:"seekToInteractiveButton",type:"desktop-control-panel-left",weight:Nd,buttonComponent:pc,buttonComponentProps:{disabled:xt(nt),click:t.seekToInteractive},tooltipText:Me("tooltip_interactive_seek"),disabled:xt(nt),disabledTooltipContent:Me(oa(tt,"$seekToInteractiveDisabledTooltip$",i))}:void 0)),Li=ne((()=>Qe&&xt(Lt)?{id:"interactiveGraphButton",type:"desktop-control-panel-left",weight:Vd,buttonComponent:vc,buttonComponentProps:{disabled:xt(st),click:it.toggle,graphIsOpened:g()},tooltipText:xt(Nt)}:void 0)),Mi=ne((()=>xt(_t)?{id:"liveButton",type:"desktop-control-panel-left",weight:Ud,buttonComponent:bc,buttonComponentProps:{isLiveActive:xt(Ot),ariaLabel:xt(Ut)},tooltipText:xt(Ut),disabled:xt(Ot)&&s()===f.PlaybackState.PLAYING}:void 0)),Ii=ne((()=>[xt(Ei),xt(xi),xt($i),xt(Ci),xt(Ai),xt(Pi),xt(Li),xt(Mi)].filter((e=>!!e)).sort(Wn))),Ri=ne((()=>xt(Et)?{id:"vkLogo",type:"desktop-control-panel-right",weight:Sc,buttonComponent:Su,buttonComponentProps:{targetUrl:q(),logoClickable:t.logoClickable,click:ee},tooltipText:xt(Ft),disabledTooltipContent:"",disabled:!t.logoClickable}:void 0)),Di=ne((()=>xt(wt)?{id:"autoplayNext",type:"desktop-control-panel-right",weight:kc,buttonComponent:cc,tooltipText:xt(qt)}:void 0)),Oi=ne((()=>({id:"volume",type:"desktop-control-panel-right",weight:Tc,buttonComponent:pu,buttonComponentProps:{click:_i}}))),Bi=ne((()=>xt(St)?{id:"subtitles",type:"desktop-control-panel-right",weight:Ec,buttonComponent:Cl,buttonComponentProps:{isSubtitlesEnabled:xt(ht),click:ie},tooltipText:xt(jt)}:void 0)),Ni=ne((()=>xt(Tt)?{id:"settings",type:"desktop-control-panel-right",weight:xc,buttonComponent:Tl,buttonComponentProps:{ref$:bi},tooltipText:O()?void 0:Me("tooltip_settings_off")}:void 0)),Vi=ne((()=>X.features.contextMenuButton?{id:"context",type:"desktop-control-panel-right",weight:$c,buttonComponent:$d,buttonComponentProps:{click:t.toggleFullscreen,ariaLabel:xt(Vt)},className:xt(kt)?"":"out-of-view",tooltipText:xt(Vt)}:void 0)),Ui=ne((()=>xt(Ct)?{id:"fullscreen",type:"desktop-control-panel-right",weight:Cc,buttonComponent:vu,buttonComponentProps:{isFullscreen:v(),click:t.toggleFullscreen},tooltipText:xt(zt)}:void 0)),zi=ne((()=>xt(yt)?{id:"chromecast",type:"desktop-control-panel-right",weight:Ac,buttonComponent:xu,buttonComponentProps:{state:u(),click:dt},tooltipText:xt(Wt)}:void 0)),Wi=ne((()=>[xt(Ri),xt(Di),xt(Oi),xt(Bi),xt(Ni),xt(Vi),xt(Ui),xt(zi),...D()].filter((e=>!!e)).sort(Wn)));var qi=Pc(),Hi=Be(qi);let Ki;var Qi=Oe(Hi);let Gi=ne((()=>!xt(Pt)));qu(Qi,{get isHidden(){return xt(Gi)},get isAds(){return W()},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return p()},get ref(){return Kt.timeline},set ref(e){Kt.timeline=e}});var Yi=Ne(Qi,2),Xi=Oe(Yi),Ji=Oe(Xi);ar(Ji,17,(()=>xt(Ii)),(e=>e.id),((e,t)=>{Md(e,{get buttonComponent(){return xt(t).buttonComponent},get buttonComponentProps(){return xt(t).buttonComponentProps},get tooltipText(){return xt(t).tooltipText},get disabledTooltipContent(){return xt(t).disabledTooltipContent},get disabled(){return xt(t).disabled},get className(){return xt(t).className},get tooltipEnabled(){return xt(t).tooltipEnabled},get mouseEnter(){return xt(t).mouseEnter},get mouseLeave(){return xt(t).mouseLeave},get ref(){return Kt[xt(t).id]},set ref(e){Kt[xt(t).id]=e}})}));var er=Ne(Ji,2),tr=e=>{let t=ne((()=>W()?oa(Re,"$adPosition",i):U())),r=ne((()=>W()?oa(Ie,"$adDuration",i):F()));Ml(e,{isMobile:!1,get showDuration(){return xt(gi)},get position(){return xt(t)},get duration(){return xt(r)},get ref(){return Kt.time},set ref(e){Kt.time=e}})};Zi(er,(e=>{xt(At)&&e(tr)}));var ir=Ne(er,2);let rr=ne((()=>!xt(Dt)));ql(ir,{className:"w-max",get disabled(){return xt(rr)},tooltipContent:Ti,get ref(){return Kt.episodes},set ref(e){Kt.episodes=e},children:(e,t)=>{var i=Fi(),r=Be(i),a=e=>{Ju(e,{get position(){return U()},get duration(){return F()},timeCodes:we})};Zi(r,(e=>{xt(Dt)&&e(a)})),ji(e,i)},$$slots:{default:!0}}),xe(Xi);var sr=Ne(Xi,2);ar(sr,21,(()=>xt(Wi)),(e=>e.id),((e,t)=>{var i=Fi(),r=Be(i),a=e=>{Md(e,{get buttonComponent(){return xt(t).buttonComponent},get buttonComponentProps(){return xt(t).buttonComponentProps},get tooltipText(){return xt(t).tooltipText},get disabledTooltipContent(){return xt(t).disabledTooltipContent},get disabled(){return xt(t).disabled},get className(){return xt(t).className},get ref(){return Kt[xt(t).id]},set ref(e){Kt[xt(t).id]=e}})},s=e=>{let i=ne((()=>!!xt(t).disabled));!function(e,t){pi(t,!0);let i=fa(t,"disabled",3,!1),r=fa(t,"onClick",3,m.noop),a=fa(t,"ref",15),s=ne((()=>r()===m.noop)),n=ne((()=>xt(s)||i())),o=ne((()=>xt(s)?"btn-full-opacity":""));ql(e,{get disabled(){return xt(n)},get tooltipContent(){return t.tooltipText},get disabledTooltipContent(){return t.disabledTooltipContent},width:40,get ref(){return a()},set ref(e){a(e)},children:(e,i)=>{let a=ne((()=>t.testId??t.id));Ko(e,{get className(){return xt(o)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return xt(n)},get testId(){return xt(a)},children:(e,i)=>{wc(e,{get icon(){return t.icon}})},$$slots:{default:!0}})},$$slots:{default:!0}}),fi()}(e,{get id(){return xt(t).id},get testId(){return xt(t).testId},get icon(){return xt(t).icon},get ariaLabel(){return xt(t).ariaLabel},get tooltipText(){return xt(t).tooltipText},get disabledTooltipContent(){return xt(t).disabledTooltipContent},get disabled(){return xt(i)},get onClick(){return xt(t).onClick},get ref(){return Kt[xt(t).id]},set ref(e){Kt[xt(t).id]=e}})};Zi(r,(e=>{(e=>!!e.buttonComponent)(xt(t))?e(a):e(s,!1)})),ji(e,i)})),xe(sr),xe(Yi),Qr(Yi,(e=>z(e)),(()=>z())),xe(Hi),Qr(Hi,(e=>j(e)),(()=>j()));var nr=Ne(Hi,2),or=e=>{Ld(e,{get ref(){return Kt.interactiveTimeIndicator},set ref(e){Kt.interactiveTimeIndicator=e}})};Zi(nr,(e=>{Je&&e(or)})),Bt((e=>Ki=wr(Hi,1,"wrapper-bottom svelte-1iedtj3",null,Ki,e)),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth})]),Hr(Xi,"clientWidth",(e=>re(Ht,e))),ji(e,qi),fi(),r()}var Ic=Ni('<div class="icon icon-error-stub svelte-167ouw6"><div class="inner svelte-167ouw6"></div></div>'),Rc=Ni('<img class="icon svelte-167ouw6" aria-hidden="true">'),Dc={hash:"svelte-167ouw6",code:".icon.svelte-167ouw6 {width:24px !important;height:24px !important;}.inner.svelte-167ouw6 {width:16px;height:16px;background-color:var(--white);}"};var Oc=Vi('<svg><!><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"></path><path fill="var(--btn-color, #fff)" d="M8.695 8.105 5.301 4.71a1 1 0 0 1 1.414-1.415L20.7 17.285a1 1 0 0 1-1.414 1.415L16 15.41V20a1 1 0 0 1-1 1c-.641 0-1.258-.25-1.72-.695L7.79 15H5a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2.765zm2.88-2.77 1.704-1.642A2.48 2.48 0 0 1 15 3a1 1 0 0 1 1 1v5.76l-4.426-4.426Z"></path></g></svg>');function Bc(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Oc();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24","aria-hidden":"true","data-testid":"muted-icon",role:"img",...i}))),ji(e,r)}var Nc=Ni('<span class="text svelte-6gmlbk"> </span>'),Vc=Ni('<div aria-hidden="true"><!> <!></div>'),Uc={hash:"svelte-6gmlbk",code:".container.svelte-6gmlbk {display:flex;align-items:center;}.expanded.svelte-6gmlbk {background-color:rgba(0, 0, 0, 0.56);border-radius:6px;}.text.svelte-6gmlbk {font-size:15px;margin-left:8px;}"};function Fc(e,t){pi(t,!0),mr(e,Uc);let i=fa(t,"muted",3,!1),r=fa(t,"expanded",3,!1),a=fa(t,"click",3,m.noop),s=fa(t,"ref",15,void 0),n=Na().ui.t,o=ne((()=>i()?n("tooltip_volume"):n("tooltip_volume_muted"))),l=ne((()=>r()?Dl:Bc)),u=ne((()=>r()?"btn-mobile-unmuted":"btn-mobile-muted"));Ko(e,{get testId(){return xt(u)},get click(){return a()},get ariaLabel(){return xt(o)},get ref(){return s()},set ref(e){s(e)},children:(e,t)=>{var i=Vc();let a,s=ne((()=>xt(l)));var o=Oe(i);hr(o,(()=>xt(s)),((e,t)=>{t(e,{})}));var u=Ne(o,2),d=e=>{var t=Nc(),i=Oe(t,!0);xe(t),Bt((e=>qi(i,e)),[()=>n("mobile_unmute")]),ji(e,t)};Zi(u,(e=>{r()&&e(d)})),xe(i),Bt((e=>a=wr(i,1,"container svelte-6gmlbk",null,a,e)),[()=>({expanded:r()})]),ji(e,i)},$$slots:{default:!0}}),fi()}var jc=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M7.662 4h6.676c.808 0 1.469 0 2.006.044.556.045 1.058.142 1.526.381a3.9 3.9 0 0 1 1.705 1.704c.239.47.336.971.381 1.527C20 8.193 20 8.854 20 9.662V11.1a.9.9 0 0 1-1.8 0V9.7c0-.855 0-1.442-.038-1.897-.036-.445-.103-.684-.19-.856a2.1 2.1 0 0 0-.919-.918c-.172-.088-.411-.155-.856-.191C15.742 5.8 15.155 5.8 14.3 5.8H7.7c-.855 0-1.442 0-1.897.038-.445.036-.684.103-.856.19a2.1 2.1 0 0 0-.918.919c-.088.172-.155.411-.191.856C3.8 8.258 3.8 8.845 3.8 9.7v2.646c0 .855 0 1.442.038 1.897.036.445.103.683.19.856a2.1 2.1 0 0 0 .919.918c.172.088.411.155.856.191.455.037 1.042.038 1.897.038h2.4a.9.9 0 0 1 0 1.8H7.662c-.808 0-1.469 0-2.006-.044-.556-.045-1.058-.142-1.527-.381a3.9 3.9 0 0 1-1.704-1.704c-.239-.47-.336-.972-.381-1.527C2 13.852 2 13.192 2 12.384V9.662c0-.808 0-1.469.044-2.006.045-.556.142-1.058.381-1.527A3.9 3.9 0 0 1 4.13 4.425c.47-.239.971-.336 1.527-.381C6.193 4 6.854 4 7.662 4M13 16.8c0-.98 0-1.47.19-1.845a1.75 1.75 0 0 1 .766-.764C14.33 14 14.82 14 15.8 14h3.4c.98 0 1.47 0 1.845.19.329.168.596.436.764.766.191.374.191.864.191 1.844v.4c0 .98 0 1.47-.19 1.845a1.75 1.75 0 0 1-.765.764C20.67 20 20.18 20 19.2 20h-3.4c-.98 0-1.47 0-1.845-.19a1.75 1.75 0 0 1-.764-.765C13 18.67 13 18.18 13 17.2z" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="m11.643 12.37-.007-.006L9.073 9.8H10.1a.9.9 0 1 0 0-1.8H6.9a.9.9 0 0 0-.9.9v3.2a.9.9 0 0 0 1.8 0v-1.022l2.53 2.524.134.134a.9.9 0 0 0 1.272-1.272z" class="hidden-not-active"></path><path fill="var(--btn-color, #fff)" d="m6.357 9.63.007.006L8.927 12.2H7.9a.9.9 0 1 0 0 1.8h3.2a.9.9 0 0 0 .9-.9V9.9a.9.9 0 0 0-1.8 0v1.022L7.67 8.397l-.134-.133a.9.9 0 0 0-1.272 1.272z" class="hidden-active"></path></svg>');var zc={hash:"svelte-tmam00",code:'svg[data-testid="pip-icon--active"] .hidden-active,\n  svg[data-testid="pip-icon"] .hidden-not-active {visibility:hidden;opacity:0;}'};function Wc(e,t){mr(e,zc);let i=fa(t,"isActive",3,!1),r=ne((()=>i()?"color: #2688EB;":"color: #fff;")),a=ne((()=>i()?"pip-icon--active":"pip-icon"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=jc();let a;cr(Oe(r),(()=>t.children??N)),$e(3),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(r)},get"data-testid"(){return xt(a)}})}var qc=(e,t,i,r)=>{xt(t)&&i.onDisabledPlayPrevChapterClick(xt(r))},Hc=(e,t,i,r)=>{xt(t)&&i.onDisabledSeekToInteractiveClick(xt(r))},Kc=Ni("<div><!></div>"),Qc=Ni("<div><!></div>"),Gc=Ni("<div><!></div>"),Yc=Ni("<!> <!> <!>",1),Xc=Ni("<div></div> <div><!></div> <div><!> <!> <!> <!> <!> <!></div> <div><!> <!> <!> <!></div> <!>",1),Zc=Ni("<div><!></div>"),Jc=Ni('<div class="wrapper-middle svelte-1afsgkw"><!></div>'),eh=Ni("<!>  <!> <div><!></div>",1),th=Ni('<div aria-hidden="true">·</div> <!>',1),ih=Ni("<!> <!> <div><div><div><!> <!> <!> <!> <!> <!></div> <!></div></div> <!>",1),rh={hash:"svelte-1afsgkw",code:".wrapper-bottom.svelte-1afsgkw {pointer-events:none;position:absolute;z-index:var(--controls-container-z-index);width:100%;bottom:0;left:0;height:var(--controls-gradient-height);background:var(--controls-gradient);transition:transform var(--controls-transition-duration) var(--controls-transition-fn);display:flex;flex-direction:column;justify-content:flex-end;box-sizing:border-box;padding:0 4px 8px;}.wrapper-bottom.svelte-1afsgkw > :where(.svelte-1afsgkw) {pointer-events:auto;}.wrapper-bottom.ads-timeline-mobile.svelte-1afsgkw {height:9px;padding:0 4px 4px;}.wrapper-middle.svelte-1afsgkw {position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;z-index:var(--controls-container-z-index);}.wrapper-top-right.svelte-1afsgkw {position:absolute;top:4px;right:8px;transition:opacity var(--controls-transition-duration);display:flex;z-index:var(--controls-container-z-index);}.wrapper-top-left.svelte-1afsgkw {position:absolute;top:4px;left:8px;z-index:var(--controls-container-z-index);}.wrapper-middle-left.svelte-1afsgkw,\n  .wrapper-middle-left-second.svelte-1afsgkw,\n  .wrapper-middle-right.svelte-1afsgkw {position:absolute;top:50%;transform:translateY(-50%);height:44px;width:44px;border-radius:12px;background-color:rgba(0, 0, 0, 0.56);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;justify-content:center;}.wrapper-middle-left.svelte-1afsgkw {left:12px;}.wrapper-middle-left-second.svelte-1afsgkw {left:64px;}.wrapper-middle-right.svelte-1afsgkw {right:12px;}.controls.svelte-1afsgkw {width:100%;display:flex;align-items:center;height:var(--controls-height);white-space:nowrap;font-size:13px;transition:transform var(--controls-transition-duration) var(--controls-transition-fn);will-change:transform;padding:0 4px;box-sizing:border-box;}.controls.svelte-1afsgkw > *:not(:first-child) {margin-left:8px;}.hidden.svelte-1afsgkw {visibility:hidden;opacity:0;}.controls-hidden.svelte-1afsgkw {visibility:visible; /* if hidden then slider will lose focus (if was focused) */transform:translateY(100%);}.wrapper-bottom.no-smooth.svelte-1afsgkw {transition:none;}.overlay-mobile.svelte-1afsgkw {position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, .3);pointer-events:none;transition:opacity var(--controls-transition-duration);}\n\n  @media screen and (orientation: portrait) {.wrapper-top-right.fullscreen.svelte-1afsgkw {top:16px;}.wrapper-top-left.fullscreen.svelte-1afsgkw {top:16px;}.controls-wrapper.fullscreen.svelte-1afsgkw {position:absolute;bottom:30px;width:calc(100% - 8px);}\n  }\n\n  @media screen and (orientation: landscape) {.wrapper-top-left.fullscreen.svelte-1afsgkw {top:12px;left:44px;}.wrapper-top-right.fullscreen.svelte-1afsgkw {top:12px;right:44px;}.wrapper-middle-left.fullscreen.svelte-1afsgkw {left:44px;}.wrapper-middle-left-second.fullscreen.svelte-1afsgkw {left:96px;}.wrapper-middle-right.fullscreen.svelte-1afsgkw {right:44px;}.controls-wrapper.fullscreen.svelte-1afsgkw {position:absolute;left:36px;right:36px;bottom:32px;width:calc(100% - 72px);}\n  }"};function ah(e,t){pi(t,!0),mr(e,rh);let[i,r]=la(),a=()=>oa(we,"$disabledControls$",i),s=()=>oa(Y,"$playbackState$",i),n=()=>oa($e,"$adPlaybackState",i),o=()=>oa(J,"$isEnded$",i),l=()=>oa(Pe,"$playerSize",i),u=()=>oa(oe,"$scrubbingInProgress",i),d=()=>oa(_e,"$chromecastState$",i),c=()=>oa(ue,"$isPictureInPictureActive",i),h=()=>oa(de,"$pictureInPictureType$",i),p=()=>oa(le,"$mobileNotReportControlHidden$",i),g=()=>oa(ke,"$currentGridType$",i),v=()=>oa(ee,"$isLive$",i),b=()=>oa(pe,"$settingsMenuVisible",i),_=()=>oa(se,"$isRewindableLive$",i),y=()=>oa(X,"$isAudioAvailable$",i),w=()=>oa(Et,"$settingButtonRef$",i),S=()=>oa(Ce,"$isFullscreen",i),k=()=>oa(he,"$mobileUnmuteButtonVisible",i),T=()=>oa(ie,"$muted$",i),E=()=>oa(Le,"$additionalButtons$",i),x=()=>oa(We,"$graphIsOpened$",i),$=()=>oa(Ee,"$adPosition",i),C=()=>oa(Te,"$adDuration",i),A=()=>oa(G,"$position$",i),P=()=>oa(Q,"$duration$",i),L=fa(t,"playerControlsWrapperRef",15,void 0),M=fa(t,"playerControlsRef",15,void 0),I=fa(t,"isAds",3,!1),R=fa(t,"logoTargetUrl",3,""),D=fa(t,"isOneVideoPlaylist",3,!1),O=fa(t,"customFullscreenSupported",3,!0),B=Na(),N=Va(),V=ba(),U=B.actions.internal.toggleMuted,F=B.actions.internal.togglePlay,j=B.actions.internal.pause,z=B.actions.internal.prevVideoClick,W=B.actions.internal.nextVideoClick,q=B.callbacks?.onAudioDoesNotExistHint,H=B.callbacks?.onAudioDisabledHint,K=B.playerPhase,Q=B.state.duration$,G=B.state.positionWithScrubbing$,Y=B.state.playbackState$,X=B.state.isAudioAvailable$,Z=B.state.isAudioDisabled,J=B.state.isEnded$,ee=B.state.isLive$,ie=B.state.muted$,ae=B.state.isActiveLive$,se=B.state.isRewindableLive$,oe=B.ui.scrubbingInProgress,le=B.ui.mobileNotReportControlHidden$,{isActive$:ue,type$:de}=N.pictureInPicture$,ce=B.ui.mobileUnmuteButtonExpanded,he=B.ui.mobileUnmuteButtonVisible,pe=B.ui.settingsMenu.visible$,fe=B.ui.settingsMenu.openedByBtnKeyboard$,me=B.ui.controls,{volume:ge}=B.ui.hiddenControls,ve=B.actions.internal.getVideoEpisodes(),be=B.webApi.pictureInPictureApi,_e=B.state.chromecastState$,ye=B.state.crashed$,we=me.disabledControls$,Se=B.ui.startedByKeyboard$,ke=B.ui.currentGridType$,Te=B.ads.duration,Ee=B.ads.position,$e=B.ads.playbackState,Ce=B.ui.isFullscreen,Pe=B.ui.playerSize,Le=B.ui.additionalButtonsDeprecated$,Me=B.actions.internal.getVideoElement,Ie=B.actions.internal.replayInteractive,Re=B.state.isInteractive,De=B.state.isInteractiveTime$,Ve=B.state.showInteractiveGraph,Ue=B.state.showSeekToInteractive,Fe=B.state.showPlayPrevChapter,je=B.state.showInteractiveTimeIndicator,ze=N.seekToInteractiveDisabledTooltip$,We=N.graphIsOpened$,qe=ne((()=>$s(B.state.playPrevChapterDisabledTooltip))),He=ne((()=>$s(oa(ze,"$seekToInteractiveDisabledTooltip$",i)))),Ke=ne((()=>a().has("EPISODE_BUTTON"))),Qe=ne((()=>a().has("GRAPH_BUTTON"))),Ge=ne((()=>a().has("SEEK_TO_INTERACTIVE_BUTTON"))),Ye=ne((()=>a().has("PLAY_BUTTON"))),Xe=ne((()=>a().has("REPLAY_BUTTON"))),Ze=ne((()=>a().has("PLAY_PREV_CHAPTER_BUTTON"))),Je=ne((()=>s()===f.PlaybackState.PLAYING)),et=ne((()=>"paused"===n())),tt=ne((()=>o()&&!I()&&!Re)),it=ne((()=>!o()||I())),rt=ne((()=>t.showNextPrevButtons&&!I()&&t.prevButtonActive)),at=ne((()=>t.showNextPrevButtons&&!I()&&t.nextButtonActive)),st=ne((()=>l().width>300)),nt=ne((()=>l().width>400)),ot=ne(u),lt=ne((()=>!(d()===f.ChromecastState.NOT_AVAILABLE||c()&&1===h()||p()||Re))),ut=ne((()=>"LiveWaitingStart"===oa(K,"$playerPhase",i))),dt=ne((()=>!!be&&d()!==f.ChromecastState.CONNECTED&&!p()&&(1===h()&&xt(ut)||!xt(ut))&&!xt(ot)&&!Re)),ct=ne((()=>!xt(ot)&&lu(g(),"s"))),ht=ne((()=>!t.logoHidden&&l().width>350)),pt=ne((()=>V.features.fullscreen&&!(c()&&1===h())&&(!Re||O())&&!xt(ot))),ft=ne((()=>(!v()||I())&&l().width>260&&!xt(ot)&&!(V.features.interactiveHideTime&&Re))),mt=ne((()=>b()||t.showControls)),gt=ne((()=>!I()&&!v()&&!!ve?.length&&xt(st)&&!xt(Ke)&&!xt(ot))),vt=ne((()=>!_()||!!oa(ae,"$isActiveLive$",i))),bt=ne((()=>Ve&&lu(g(),"m"))),_t=Ae({}),yt=(0,m.debounceFn)(Td,260);Rt((()=>{l(),oa(De,"$isInteractiveTime$",i),yt(Me(),me,_t,t.showControls)}));let wt=()=>B.actions.internal.toggleChromecast();async function St(){be?.isActive()?await(be?.remove()):await(be?.request())}function kt(){!Z&&y()&&he.set(!1),Do({isAudioDisabled:Z,audioDisabledHintCallback:H,isAudioAvailable:y(),audioIsNotExistHintCallback:q})&&U()}let Tt=te("");Rt((()=>{var e,t;e=xt(vt),t=s(),e?t&&t===f.PlaybackState.PAUSED&&re(Tt,Ae($s("tooltip_play"))):re(Tt,Ae($s("tooltip_live")))}));let Et=ia();Rt((()=>{w()&&xn(w(),b(),fe)})),Rt((()=>{Ed(Se,oa(Se,"$startedByKeyboard$",i),_t.playButton)}));var $t=ih(),Ct=Be($t),At=e=>{var r=Xc(),a=Be(r);let s;var n=Ne(a,2);let o;var l=Oe(n),h=e=>{let t=ne((()=>y()&&!Z&&oa(ce,"$mobileUnmuteButtonExpanded",i)));Fc(e,{get muted(){return T()},get expanded(){return xt(t)},click:kt,get ref(){return _t.volume},set ref(e){_t.volume=e}})};Zi(l,(e=>{(!y()||k())&&!oa(ge,"$volumeHidden",i)&&e(h)})),xe(n);var f=Ne(n,2);let g;var v=Oe(f);ar(v,1,E,(({iconUrl:e,ariaLabel:t,testId:i,onClick:r,tooltip:a})=>e),((e,t)=>{let i=ne((()=>xt(t).ariaLabel??xt(t).tooltip));!function(e,t){mr(e,Dc);let i=fa(t,"disabled",3,!1),r=fa(t,"onClick",3,m.noop),a=ne((()=>r()===m.noop)),s=ne((()=>xt(a)||i())),n=te(!1),o=()=>{re(n,!0)},l=ne((()=>xt(a)?"btn-full-opacity":""));Ko(e,{get className(){return xt(l)},get ariaLabel(){return t.ariaLabel},get click(){return r()},get disabled(){return xt(s)},get testId(){return t.testId},children:(e,i)=>{var r=Fi(),a=Be(r),s=e=>{ji(e,Ic())},l=e=>{var i=Rc();Bt((()=>Ar(i,"src",t.iconUrl))),Ii("error",i,o),Li(i),ji(e,i)};Zi(a,(e=>{xt(n)?e(s):e(l,!1)})),ji(e,r)},$$slots:{default:!0}})}(e,{get iconUrl(){return xt(t).iconUrl},get ariaLabel(){return xt(i)},get testId(){return xt(t).testId},get onClick(){return xt(t).onClick}})}));var b=Ne(v,2),_=e=>{cc(e,{get ref(){return _t.autoplayNextToggle},set ref(e){_t.autoplayNextToggle=e}})};Zi(b,(e=>{t.showAutoplayNext&&!D()&&e(_)}));var w=Ne(b,2),$=e=>{xu(e,{isMobile:!0,click:wt,get state(){return d()},get ref(){return _t.chromecast},set ref(e){_t.chromecast=e}})};Zi(w,(e=>{xt(lt)&&e($)}));var C=Ne(w,2),A=e=>{!function(e,t){pi(t,!0);let i=fa(t,"ref",15,void 0),r=fa(t,"isPictureInPictureActive",3,!1),a=fa(t,"click",3,m.noop);Ko(e,{testId:"btn-pip",ariaLabel:$s("menu_pip"),get click(){return a()},get ref(){return i()},set ref(e){i(e)},children:(e,t)=>{Wc(e,{get isActive(){return r()}})},$$slots:{default:!0}}),fi()}(e,{click:St,get isPictureInPictureActive(){return c()},get ref(){return _t.pip},set ref(e){_t.pip=e}})};Zi(C,(e=>{xt(dt)&&e(A)}));var P=Ne(C,2),L=e=>{Tl(e,{ref$:Et})};Zi(P,(e=>{oa(ye,"$crashed$",i)&&e(L)}));var M=Ne(P,2),I=e=>{Su(e,{click:j,get targetUrl(){return R()},get logoClickable(){return t.logoClickable},get ref(){return _t.vkLogo},set ref(e){_t.vkLogo=e}})};Zi(M,(e=>{xt(ht)&&e(I)})),xe(f);var O=Ne(f,2);let B;var N=Oe(O),V=e=>{let t=ne((()=>z.bind(null,!0)));Hd(e,{get click(){return xt(t)},type:"prev",isMobile:!0,get ref(){return _t.prevButton},set ref(e){_t.prevButton=e}})};Zi(N,(e=>{xt(rt)&&e(V)}));var U=Ne(N,2),q=e=>{nc(e,{get disabled(){return xt(Ye)},click:F,isMobile:!0,get isPlaying(){return xt(Je)},get ref(){return _t.playButton},set ref(e){_t.playButton=e}})};Zi(U,(e=>{xt(it)&&e(q)}));var H=Ne(U,2),K=e=>{Zd(e,{get disabled(){return xt(Xe)},click:F,isMobile:!0,get ref(){return _t.replayButton},set ref(e){_t.replayButton=e}})};Zi(H,(e=>{xt(tt)&&e(K)}));var Q=Ne(H,2),G=e=>{let t=ne((()=>W.bind(null,!0)));Hd(e,{get click(){return xt(t)},type:"next",isMobile:!0,get ref(){return _t.nextButton},set ref(e){_t.nextButton=e}})};Zi(Q,(e=>{xt(at)&&e(G)})),xe(O);var Y=Ne(O,2),X=e=>{var i=Yc(),r=Be(i),a=e=>{var i=Kc();let r;i.__click=[qc,Ze,t,qe];var a=Oe(i);let s=ne((()=>!t.showControls));lc(a,{get hidden(){return xt(s)},get disabled(){return xt(Ze)},get click(){return t.playPrevChapter},get ref(){return _t.playPrevChapterButton},set ref(e){_t.playPrevChapterButton=e}}),xe(i),Bt((e=>r=wr(i,1,"wrapper-middle-left svelte-1afsgkw",null,r,e)),[()=>({fullscreen:S(),hidden:!t.showControls})]),ji(e,i)};Zi(r,(e=>{Fe&&e(a)}));var s=Ne(r,2),n=e=>{var i=Qc();let r;var a=Oe(i);let s=ne((()=>!t.showControls&&!x()));vc(a,{get hidden(){return xt(s)},get disabled(){return xt(Qe)},get click(){return We.toggle},get graphIsOpened(){return x()},get ref(){return _t.interactiveGraphButton},set ref(e){_t.interactiveGraphButton=e}}),xe(i),Bt((e=>r=wr(i,1,vr(Fe?"wrapper-middle-left-second":"wrapper-middle-left"),"svelte-1afsgkw",r,e)),[()=>({fullscreen:S(),hidden:!t.showControls&&!x()})]),ji(e,i)};Zi(s,(e=>{xt(bt)&&e(n)}));var o=Ne(s,2),l=e=>{var i=Gc();let r;i.__click=[Hc,Ge,t,He];var a=Oe(i);let s=ne((()=>!t.showControls));pc(a,{get hidden(){return xt(s)},get disabled(){return xt(Ge)},get click(){return t.seekToInteractive},get ref(){return _t.seekToInteractiveButton},set ref(e){_t.seekToInteractiveButton=e}}),xe(i),Bt((e=>r=wr(i,1,"wrapper-middle-right svelte-1afsgkw",null,r,e)),[()=>({fullscreen:S(),hidden:!t.showControls})]),ji(e,i)};Zi(o,(e=>{Ue&&e(l)})),ji(e,i)};Zi(Y,(e=>{Re&&!u()&&e(X)})),Bt(((e,t,i,r)=>{s=wr(a,1,"overlay-mobile svelte-1afsgkw",null,s,e),o=wr(n,1,"wrapper-top-left svelte-1afsgkw",null,o,t),g=wr(f,1,"wrapper-top-right svelte-1afsgkw",null,g,i),B=wr(O,1,"wrapper-middle svelte-1afsgkw",null,B,r)}),[()=>({hidden:!xt(mt)}),()=>({hidden:!t.showControls,fullscreen:S()}),()=>({hidden:!t.showControls&&!p(),fullscreen:S()}),()=>({hidden:!t.showControls||u()||t.endScreenShown&&t.showNextPrevButtons})]),ji(e,r)};Zi(Ct,(e=>{I()||e(At)}));var Pt=Ne(Ct,2),Lt=e=>{var t=eh(),i=Be(t),r=e=>{var t=Zc();let i;Fc(Oe(t),{get muted(){return T()},expanded:!1,click:kt,get ref(){return _t.volume},set ref(e){_t.volume=e}}),xe(t),Bt((e=>i=wr(t,1,"wrapper-top-right svelte-1afsgkw",null,i,e)),[()=>({fullscreen:S()})]),ji(e,t)};Zi(i,(e=>{k()&&e(r)}));var a=Ne(i,2),s=e=>{var t=Jc(),i=Oe(t);let r=ne((()=>!xt(et)));nc(i,{get disabled(){return xt(Ye)},click:F,isMobile:!0,get isPlaying(){return xt(r)},get ref(){return _t.playButton},set ref(e){_t.playButton=e}}),xe(t),ji(e,t)};Zi(a,(e=>{xt(et)&&e(s)}));var n=Ne(a,2);let o;Fu(Oe(n),{get position(){return $()},get duration(){return C()}}),xe(n),Bt((e=>o=wr(n,1,"wrapper-bottom ads-timeline-mobile svelte-1afsgkw",null,o,e)),[()=>({fullscreen:S()})]),ji(e,t)};Zi(Pt,(e=>{I()&&"inactive"!==n()&&e(Lt)}));var Mt=Ne(Pt,2);let It;var Dt=Oe(Mt);let Ot;var Nt=Oe(Dt);wr(Nt,1,"controls svelte-1afsgkw",null,{},{mobile:!0});var Vt=Oe(Nt),Ut=e=>{ql(e,{get disabled(){return xt(Xe)},get ref(){return _t.replayButton},set ref(e){_t.replayButton=e},children:(e,t)=>{Zd(e,{get disabled(){return xt(Xe)},click:Ie})},$$slots:{default:!0}})};Zi(Vt,(e=>{Re&&e(Ut)}));var Ft=Ne(Vt,2),jt=e=>{ql(e,{get ref(){return _t.liveButton},set ref(e){_t.liveButton=e},children:(e,t)=>{bc(e,{get isLiveActive(){return xt(vt)},isMobile:!0,get ariaLabel(){return xt(Tt)}})},$$slots:{default:!0}})};Zi(Ft,(e=>{!I()&&v()&&e(jt)}));var zt=Ne(Ft,2),Wt=e=>{let t=ne((()=>I()?$():A())),i=ne((()=>I()?C():P()));Ml(e,{get showDuration(){return xt(nt)},get position(){return xt(t)},get duration(){return xt(i)},isMobile:!0,get ref(){return _t.time},set ref(e){_t.time=e}})};Zi(zt,(e=>{xt(ft)&&e(Wt)}));var qt=Ne(zt,2);let Ht=ne((()=>!xt(gt)));ql(qt,{className:"w-max",get disabled(){return xt(Ht)},get ref(){return _t.episodes},set ref(e){_t.episodes=e},children:(e,t)=>{var i=Fi(),r=Be(i),a=e=>{var t=th();Ju(Ne(Be(t),2),{get position(){return A()},get duration(){return P()},timeCodes:ve}),ji(e,t)};Zi(r,(e=>{xt(gt)&&e(a)})),ji(e,i)},$$slots:{default:!0}});var Kt=Ne(qt,2),Qt=e=>{ql(e,{get ref(){return _t.settings},set ref(e){_t.settings=e},children:(e,t)=>{Tl(e,{ref$:Et})},$$slots:{default:!0}})};Zi(Kt,(e=>{xt(ct)&&e(Qt)}));var Gt=Ne(Kt,2),Yt=e=>{ql(e,{get ref(){return _t.fullscreen},set ref(e){_t.fullscreen=e},children:(e,i)=>{vu(e,{get click(){return t.toggleFullscreen},get isFullscreen(){return S()}})},$$slots:{default:!0}})};Zi(Gt,(e=>{xt(pt)&&e(Yt)})),xe(Nt),Qr(Nt,(e=>M(e)),(()=>M())),qu(Ne(Nt,2),{get isAds(){return I()},get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return _()},get ref(){return _t.timeline},set ref(e){_t.timeline=e}}),xe(Dt),xe(Mt),Qr(Mt,(e=>L(e)),(()=>L()));var Xt=Ne(Mt,2),Zt=e=>{Ld(e,{get ref(){return _t.interactiveTimeIndicator},set ref(e){_t.interactiveTimeIndicator=e}})};Zi(Xt,(e=>{je&&e(Zt)})),Bt(((e,t)=>{It=wr(Mt,1,"wrapper-bottom svelte-1afsgkw",null,It,e),Ot=wr(Dt,1,"controls-wrapper svelte-1afsgkw",null,Ot,t)}),[()=>({hidden:t.bottomHidden,"controls-hidden":!t.showControls,"no-smooth":t.bottomNoSmooth,mobile:!0}),()=>({fullscreen:S()})]),ji(e,$t),fi(),r()}function sh(e,t){pi(t,!0);let[i,r]=la(),a=fa(t,"bottomNoSmooth",3,!1),s=fa(t,"playerControlsWrapperRef",15,void 0),n=fa(t,"playerControlsRef",15,void 0),o=fa(t,"isAds",3,!1),l=fa(t,"logoTargetUrl",3,""),u=fa(t,"showAutoplayNext",3,!1),d=fa(t,"isOneVideoPlaylist",3,!1),c=fa(t,"customFullscreenSupported",3,!0),h=fa(t,"endScreenShown",3,!1),p=fa(t,"onDisabledPlayPrevChapterClick",3,m.noop),f=fa(t,"onDisabledSeekToInteractiveClick",3,m.noop),g=Na().ui.isMobile,v=te(!1);Xr((()=>{let e=setTimeout((()=>re(v,!0)),0);return()=>clearTimeout(e)}));var b=Fi(),_=Be(b),y=e=>{var r=Fi(),m=Be(r),v=e=>{ah(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return a()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get isOneVideoPlaylist(){return d()},get customFullscreenSupported(){return c()},get endScreenShown(){return h()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get onDisabledPlayPrevChapterClick(){return p()},get onDisabledSeekToInteractiveClick(){return f()},get playerControlsWrapperRef(){return s()},set playerControlsWrapperRef(e){s(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})},b=e=>{Mc(e,{get bottomHidden(){return t.bottomHidden},get bottomNoSmooth(){return a()},get showControls(){return t.showControls},get isAds(){return o()},get canRewindLive(){return t.canRewindLive},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return l()},get isOneVideoPlaylist(){return d()},get showAutoplayNext(){return u()},get showNextPrevButtons(){return t.showNextPrevButtons},get nextButtonActive(){return t.nextButtonActive},get prevButtonActive(){return t.prevButtonActive},get customFullscreenSupported(){return c()},get toggleFullscreen(){return t.toggleFullscreen},get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return s()},set playerControlsWrapperRef(e){s(e)},get playerControlsRef(){return n()},set playerControlsRef(e){n(e)}})};Zi(m,(e=>{oa(g,"$isMobile",i)?e(v):e(b,!1)})),ji(e,r)};Zi(_,(e=>{xt(v)&&e(y)})),ji(e,b),fi(),r()}Ri(["click"]);var nh=Vi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M15.537 10.534a1.157 1.157 0 0 0 .003 1.96l7.658 4.823c.78.491 1.798-.065 1.798-.981v-3.3c7.265.512 13 6.568 13 13.964 0 7.732-6.268 14-14 14-5.98 0-11.088-3.75-13.093-9.032a1.5 1.5 0 0 0-2.805 1.064C10.531 39.441 16.73 44 23.996 44c9.39 0 17-7.611 17-17 0-9.053-7.076-16.453-16-16.971V6.664c0-.918-1.021-1.473-1.8-.98z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M15.404 10.322a1.407 1.407 0 0 0 .003 2.384l7.657 4.823c.944.594 2.182-.076 2.182-1.193v-3.03c7.008.631 12.5 6.522 12.5 13.694 0 7.594-6.156 13.75-13.75 13.75-5.873 0-10.89-3.683-12.86-8.871a1.75 1.75 0 1 0-3.272 1.242c2.469 6.503 8.758 11.129 16.132 11.129 9.527 0 17.25-7.723 17.25-17.25 0-9.107-7.056-16.565-16-17.205V6.664c0-1.118-1.241-1.788-2.184-1.19z"></path></g><defs><filter id="a" width="43.996" height="49.5" x="2.5" y="0" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_100684"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_100684" result="shape"></feBlend></filter></defs></svg>');function oh(e,t){let i=fa(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=nh();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"51",fill:"none","aria-hidden":"true","data-testid":"seek-icon",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(r)}})}var lh=Vi('<svg><!><g clip-path="url(#c)" filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M28.167 7h-8.334c-2.463 0-4.404 0-5.966.128-1.594.13-2.925.4-4.134 1.016a10.5 10.5 0 0 0-4.589 4.59c-.616 1.208-.886 2.54-1.016 4.133C4 18.429 4 20.37 4 22.833v2.334c0 2.463 0 4.404.128 5.966.13 1.594.4 2.925 1.016 4.134a10.5 10.5 0 0 0 4.59 4.589c1.208.616 2.54.886 4.133 1.016 1.562.128 3.502.128 5.966.128h8.334c2.463 0 4.404 0 5.966-.128 1.594-.13 2.925-.4 4.134-1.016a10.5 10.5 0 0 0 4.589-4.59c.616-1.208.886-2.54 1.016-4.133.128-1.562.128-3.502.128-5.966v-2.334c0-2.463 0-4.404-.128-5.966-.13-1.594-.4-2.925-1.016-4.134a10.5 10.5 0 0 0-4.59-4.589c-1.208-.616-2.54-.886-4.133-1.016C32.571 7 30.63 7 28.167 7M13.5 28a1.5 1.5 0 0 0 0 3h11a1.5 1.5 0 0 0 0-3zM12 22a1.5 1.5 0 0 1 1.5-1.5h4a1.5 1.5 0 0 1 0 3h-4A1.5 1.5 0 0 1 12 22m18.5 6a1.5 1.5 0 0 0 0 3h4a1.5 1.5 0 0 0 0-3zM22 22a1.5 1.5 0 0 1 1.5-1.5h11a1.5 1.5 0 0 1 0 3h-11A1.5 1.5 0 0 1 22 22" clip-rule="evenodd"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M28.167 6.75h-8.344c-2.455 0-4.405 0-5.977.128-1.609.132-2.976.407-4.226 1.044a10.75 10.75 0 0 0-4.698 4.698c-.637 1.25-.912 2.617-1.044 4.226-.128 1.572-.128 3.522-.128 5.977v2.354c0 2.455 0 4.405.128 5.977.132 1.609.407 2.976 1.044 4.226a10.75 10.75 0 0 0 4.698 4.698c1.25.637 2.617.912 4.226 1.044 1.572.128 3.522.128 5.977.128h8.354c2.455 0 4.404 0 5.977-.128 1.609-.132 2.976-.407 4.226-1.044a10.75 10.75 0 0 0 4.698-4.698c.637-1.25.912-2.617 1.044-4.226.128-1.573.128-3.522.128-5.977v-2.354c0-2.455 0-4.405-.128-5.977-.132-1.609-.407-2.976-1.044-4.226a10.75 10.75 0 0 0-4.698-4.698c-1.25-.637-2.617-.912-4.226-1.044-1.572-.128-3.522-.128-5.977-.128zM12.25 29.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Zm0-7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Zm17 7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Zm-7-7.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Z"></path></g><defs><clipPath id="c"><path fill="var(--btn-color, #fff)" d="M0 0h48v48H0z"></path></clipPath><filter id="a" width="51" height="45" x="-1.5" y="1.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_104204"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_104204" result="shape"></feBlend></filter></defs></svg>');var uh=Vi('<svg><!><g clip-path="url(#c)" filter="url(#a)"><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M6.56 4.44a1.5 1.5 0 1 0-2.12 2.12l3.088 3.09a10.5 10.5 0 0 0-2.384 3.083c-.616 1.21-.886 2.54-1.016 4.134C4 18.429 4 20.369 4 22.833v2.334c0 2.463 0 4.404.128 5.966.13 1.594.4 2.925 1.016 4.134a10.5 10.5 0 0 0 4.59 4.589c1.208.616 2.54.886 4.133 1.016 1.562.128 3.502.128 5.966.128h8.334c2.463 0 4.404 0 5.966-.128 1.437-.117 2.66-.348 3.773-.844l3.533 3.533a1.5 1.5 0 0 0 2.122-2.122l-37-37ZM13.5 28a1.5 1.5 0 0 0 0 3h11a1.5 1.5 0 0 0 0-3zM12 22a1.5 1.5 0 0 1 1.5-1.5h4a1.5 1.5 0 0 1 0 3h-4A1.5 1.5 0 0 1 12 22" clip-rule="evenodd"></path><path fill="var(--btn-color, #fff)" d="M34.5 23.5h-4.639l12.552 12.551q.237-.381.443-.784c.616-1.21.886-2.54 1.016-4.134.128-1.562.128-3.502.128-5.966v-2.334c0-2.463 0-4.404-.128-5.966-.13-1.594-.4-2.925-1.016-4.134a10.5 10.5 0 0 0-4.59-4.589c-1.208-.616-2.54-.886-4.133-1.016C32.571 7 30.63 7 28.167 7h-8.334c-2.463 0-4.404 0-5.966.128l-.347.03L26.86 20.5h7.64a1.5 1.5 0 0 1 0 3"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M29.861 23.25h-.603l.427.427 12.55 12.551.223.223.167-.268q.243-.39.453-.803c.637-1.25.912-2.617 1.044-4.226.128-1.573.128-3.522.128-5.977v-2.354c0-2.455 0-4.405-.128-5.977-.132-1.609-.407-2.976-1.044-4.226a10.75 10.75 0 0 0-4.698-4.698c-1.25-.637-2.617-.912-4.226-1.044-1.572-.128-3.522-.128-5.977-.128h-8.354c-2.455 0-4.405 0-5.977.128q-.177.014-.35.032l-.527.051.374.374 13.341 13.342.074.073H34.5a1.25 1.25 0 1 1 0 2.5zM6.737 4.263a1.75 1.75 0 0 0-2.474 2.474l2.903 2.904a10.8 10.8 0 0 0-2.244 2.979c-.637 1.25-.912 2.617-1.044 4.226-.128 1.572-.128 3.522-.128 5.977v2.354c0 2.455 0 4.405.128 5.977.132 1.609.407 2.976 1.044 4.226a10.75 10.75 0 0 0 4.698 4.698c1.25.637 2.617.912 4.226 1.044 1.572.128 3.522.128 5.977.128h8.354c2.455 0 4.404 0 5.977-.128 1.384-.114 2.59-.333 3.696-.797l3.413 3.412a1.75 1.75 0 1 0 2.474-2.474zM12.25 29.5c0-.69.56-1.25 1.25-1.25h11a1.25 1.25 0 1 1 0 2.5h-11c-.69 0-1.25-.56-1.25-1.25Zm0-7.5c0-.69.56-1.25 1.25-1.25h4a1.25 1.25 0 1 1 0 2.5h-4c-.69 0-1.25-.56-1.25-1.25Z"></path></g><defs><clipPath id="c"><path fill="var(--btn-color, #fff)" d="M0 0h48v48H0z"></path></clipPath><filter id="a" width="51" height="51" x="-1.5" y="-1.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_104293"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_104293" result="shape"></feBlend></filter></defs></svg>');function dh(e,t){let i=fa(t,"isOff",3,!1);var r=Fi(),a=Be(r),s=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=uh();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"subtitles-off-icon",role:"img",...i}))),ji(e,r)}(e,{})},n=e=>{!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=lh();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"subtitles-on-icon",role:"img",...i}))),ji(e,r)}(e,{})};Zi(a,(e=>{i()?e(s):e(n,!1)})),ji(e,r)}var ch=Vi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M24 22.677v-5.87a1.2 1.2 0 0 0-1.792-1.045L9.51 22.955a1.2 1.2 0 0 0 0 2.088l12.697 7.192a1.2 1.2 0 0 0 1.791-1.044v-5.873l12.21 6.916A1.2 1.2 0 0 0 38 31.19V16.805a1.2 1.2 0 0 0-1.791-1.044z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="M24.25 16.806v5.442l11.835-6.704a1.45 1.45 0 0 1 2.165 1.261V31.19a1.45 1.45 0 0 1-2.165 1.262L24.25 25.747v5.444a1.45 1.45 0 0 1-2.164 1.262L9.388 25.26a1.45 1.45 0 0 1 0-2.523l12.697-7.192a1.45 1.45 0 0 1 2.164 1.261Z"></path></g><defs><filter id="a" width="40.098" height="27.785" x="3.402" y="10.105" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2260_106627"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2260_106627" result="shape"></feBlend></filter></defs></svg>');function hh(e,t){let i=fa(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=ch();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"rate-change-icon",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(r)}})}var ph=Vi('<svg><!><g filter="url(#a)"><path fill="var(--btn-color, #fff)" d="M14 21.817c.631-.505 1.627-1.054 3.084-1.857l13.009-7.172c2.268-1.25 3.402-1.875 4.332-1.778a2.9 2.9 0 0 1 2.026 1.134c.549.73.549 1.991.549 4.511v14.69c0 2.52 0 3.78-.549 4.51a2.9 2.9 0 0 1-2.026 1.135c-.93.097-2.064-.528-4.332-1.778L17.084 28.04c-1.457-.803-2.453-1.352-3.084-1.857V34.5a1.5 1.5 0 0 1-3 0v-21a1.5 1.5 0 0 1 3 0z"></path><path stroke="#000" stroke-opacity=".12" stroke-width=".5" d="m16.964 19.74-.029.016c-1.162.641-2.046 1.129-2.685 1.567V13.5a1.75 1.75 0 1 0-3.5 0v21a1.75 1.75 0 1 0 3.5 0v-7.823c.639.438 1.523.926 2.685 1.567l.029.015 13.008 7.172.012.006c1.124.62 1.983 1.093 2.676 1.398.695.306 1.26.46 1.791.404a3.16 3.16 0 0 0 2.2-1.233c.317-.421.46-.976.53-1.711.069-.733.069-1.688.069-2.936V16.641c0-1.248 0-2.203-.07-2.936-.07-.735-.212-1.29-.529-1.711a3.16 3.16 0 0 0-2.2-1.233c-.53-.055-1.096.098-1.79.404-.694.305-1.553.778-2.677 1.398l-.012.006z"></path></g><defs><filter id="a" width="37" height="37" x="5.5" y="5.5" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="2.5"></feGaussianBlur><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.16 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_2340_106922"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_2340_106922" result="shape"></feBlend></filter></defs></svg>');function fh(e,t){let i=fa(t,"reversed",3,!1),r=ne((()=>i()?"transform: scaleX(-1);":void 0));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=ph();let a;cr(Oe(r),(()=>t.children??N)),$e(2),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",fill:"none","aria-hidden":"true","data-testid":"episodes-seek-icon",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(r)}})}var mh=Ni('<span class="hot-key-helpers-text svelte-1ad3n06"> </span>'),gh=Ni('<div class="svelte-1ad3n06"><!> <!> <!> <!> <!> <!> <!> <!> <!> <!></div> <!>',1),vh=Ni("<div><!></div>"),bh={hash:"svelte-1ad3n06",code:'.hot-key-helpers-container.svelte-1ad3n06 {position:absolute;z-index:var(--hot-key-helpers-container-z-index);top:calc(50% - 40px);left:calc(50% - 100px);width:200px;height:120px;display:flex;align-items:center;flex-direction:column;\n    animation: svelte-1ad3n06-fadeIn ease var(--controls-transition-duration);padding-top:14px;box-sizing:border-box;}.hot-key-helpers-container.svelte-1ad3n06 > div:where(.svelte-1ad3n06) {width:48px;height:48px;display:flex;justify-content:center;align-items:center;}.hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="volume-off-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="volume-max-icon"] {transform:scale(2);}.hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="replay-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="play-icon"],\n  .hot-key-helpers-container.svelte-1ad3n06 svg[data-testid="pause-icon"] {transform:scale(2.5);}.hot-key-helpers-container--left.svelte-1ad3n06 {left:calc(25% - 100px);}.hot-key-helpers-container--right.svelte-1ad3n06 {left:calc(75% - 100px);}.hot-key-helpers-text.svelte-1ad3n06 {text-align:center;font-feature-settings:\'clig\' off, \'liga\' off;text-shadow:0px 0px 5px rgba(0, 0, 0, 0.16);font-size:15px;font-style:normal;font-weight:600;line-height:20px; /* 133.333% */letter-spacing:-0.105px;width:100%;max-height:40px;margin-top:4px;display:-webkit-box;text-overflow:ellipsis;white-space:pre-wrap;overflow:hidden;-webkit-line-clamp:2;-webkit-box-orient:vertical;}.hidden.svelte-1ad3n06 {visibility:hidden;\n    animation: svelte-1ad3n06-fadeOut ease var(--controls-transition-duration);width:0;height:0;}\n\n  @keyframes svelte-1ad3n06-fadeIn {\n    0% {opacity:0;}\n    100% {opacity:1;}\n  }\n\n  @keyframes svelte-1ad3n06-fadeOut {\n    0% {opacity:1;}\n    100% {opacity:0;}\n  }'};var _h=Vi('<svg><!><path fill="currentColor" fill-opacity=".72" fill-rule="evenodd" d="M11.736 6.736a.9.9 0 0 1-1.272 0L6 2.273 1.536 6.736A.9.9 0 1 1 .264 5.464l5.1-5.1a.9.9 0 0 1 1.272 0l5.1 5.1a.9.9 0 0 1 0 1.272" clip-rule="evenodd"></path></svg>');var yh=Vi('<svg><!><path fill="currentColor" d="m5.773 8 3.363 3.364a.9.9 0 1 1-1.272 1.272l-4-4a.9.9 0 0 1 0-1.272l4-4a.9.9 0 0 1 1.272 1.272z"></path></svg>');function wh(e,t){pi(t,!0);let i=fa(t,"direction",3,"left"),r=fa(t,"useBtnColor",3,!1),a=ne((()=>["up","down"].includes(i()))),s=ne((()=>["right","down"].includes(i()))),n=ne((()=>(()=>{let e="";return xt(s)&&(e+="transform: rotate(180deg);"),r()&&(e+="color: var(--btn-color, #fff);"),e.length?e:void 0})()));var o=Fi(),l=Be(o),u=e=>{let t=ne((()=>xt(s)?"chevron-icon--down":"chevron-icon--up"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=_h();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"7",fill:"none","aria-hidden":"true",color:"#fff",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(n)},get"data-testid"(){return xt(t)}})},d=e=>{let t=ne((()=>xt(s)?"chevron-icon--right":"chevron-icon--left"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=yh();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",fill:"none","aria-hidden":"true",color:"#fff",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(n)},get"data-testid"(){return xt(t)}})};Zi(l,(e=>{xt(a)?e(u):e(d,!1)})),ji(e,o),fi()}var Sh=(e,t,i,r,a,s)=>{if(t.has(e.code))switch(e.preventDefault(),e.stopPropagation(),e.code){case"ArrowUp":i();break;case"ArrowDown":r();break;case"ArrowLeft":a();break;case"ArrowRight":s()}},kh=(e,t,i)=>{t.has(e.code)&&(e.preventDefault(),e.stopPropagation(),i())},Th=Ni('<div tabindex="0" role="button"><div class="button-block svelte-1yzc86r" aria-hidden="true"><div class="button-row svelte-1yzc86r"><div class="button button-up svelte-1yzc86r"><!></div> <div class="button button-right svelte-1yzc86r"><!></div></div> <div class="button-row svelte-1yzc86r"><div class="button button-left svelte-1yzc86r"><!></div> <div class="button button-down svelte-1yzc86r"><!></div></div></div></div>'),Eh={hash:"svelte-1yzc86r",code:".immersive-controls.svelte-1yzc86r {position:absolute;display:flex;flex-direction:row;top:10px;left:10px;width:56px;height:56px;background-color:rgba(0, 0, 0, .56);border-radius:8px;transition-property:top, left;transition-duration:var(--controls-transition-duration);transition-timing-function:var(--controls-transition-fn);}.immersive-controls.m-shifted.svelte-1yzc86r {top:50px;left:20px;}.button-block.svelte-1yzc86r {width:40px;height:40px;margin:auto auto;transform:rotate(45deg);}.button-row.svelte-1yzc86r {display:flex;flex-direction:row;position:relative;}.button.svelte-1yzc86r {width:20px;height:20px;text-align:center;cursor:pointer;}.button.svelte-1yzc86r svg {opacity:0.7;transition:opacity linear 0.2s;}.button.button-up.svelte-1yzc86r svg {transform:rotate(-45deg) translate(-1px, -1px);}.button.button-right.svelte-1yzc86r svg {transform:rotate(45deg) translate(1px, -1px);}.button.button-down.svelte-1yzc86r svg {transform:rotate(135deg) translate(1px, -3px);}.button.button-left.svelte-1yzc86r svg {transform:rotate(-135deg) translate(-1px, -3px);}.button.svelte-1yzc86r:hover svg {opacity:1;}"};function xh(e,t){pi(t,!0),mr(e,Eh);let i=fa(t,"isShifted",3,!1),r=Na(),a=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"]),s=()=>{r.actions.internal.startCameraManualRotation(0,1)},n=()=>{r.actions.internal.startCameraManualRotation(0,-1)},o=()=>{r.actions.internal.startCameraManualRotation(1,0)},l=()=>{r.actions.internal.startCameraManualRotation(-1,0)},u=()=>(r.actions.internal.stopCameraManualRotation(),null),d=$s("aria_label_spherical_control");var c=Th();let h;c.__keydown=[Sh,a,s,n,l,o],c.__keyup=[kh,a,u],Ar(c,"aria-label",d);var p=Oe(c),f=Oe(p),m=Oe(f);m.__mousedown=s,m.__mouseup=u,wh(Oe(m),{direction:"up",useBtnColor:!0}),xe(m);var g=Ne(m,2);g.__mousedown=o,g.__mouseup=u,wh(Oe(g),{direction:"up",useBtnColor:!0}),xe(g),xe(f);var v=Ne(f,2),b=Oe(v);b.__mousedown=l,b.__mouseup=u,wh(Oe(b),{direction:"up",useBtnColor:!0}),xe(b);var _=Ne(b,2);_.__mousedown=n,_.__mouseup=u,wh(Oe(_),{direction:"up",useBtnColor:!0}),xe(_),xe(v),xe(p),xe(c),Bt((e=>h=wr(c,1,"immersive-controls svelte-1yzc86r",null,h,e)),[()=>({"m-shifted":i()})]),Ii("mouseleave",m,u),Ii("mouseleave",g,u),Ii("mouseleave",b,u),Ii("mouseleave",_,u),ji(e,c),fi()}Ri(["keydown","keyup","mousedown","mouseup"]);var $h=class{subscribe(){return this.subscriptions.add(this.captions$.pipe((0,m.filter)((()=>this.isEnabled())),(0,m.filterChanged)()).subscribe((e=>{this.processCaptions(e)}))),this}setIsAuto(e){this.isAuto=e}setIsLive(e){this.isLive=e}setCaptions(e){this.captions$.next(e)}destroy(){this.subscriptions.unsubscribe(),this.flickeringTimeout.clear()}isEnabled(){return this.isAuto&&!this.isLive}processCaptions(e){if(!e.length)return void this.flickeringTimeout.add((()=>{this.captionsPrepared$.next([])}));this.flickeringTimeout.clear();let t=[],i=e.length>1&&"timestamp"!==e[0].type&&"timestamp"!==e[1].type;i&&t.push([{value:String(e[0].value),timeAppeared:null}]),t.push(e.reduce(((e,{type:t,value:r},a)=>(i&&!a||("timestamp"===t?e.push({timeAppeared:Number(r),value:""}):0===e.length?e.push({value:String(r)}):e[e.length-1].value=String(r)),e)),[])),this.captionsPrepared$.next(t)}constructor(){this.flickeringTimeout=((e=1e3)=>{let t=null,i=()=>{t&&(clearTimeout(t),t=null)};return{add:r=>{i(),t=setTimeout(r,e)},clear:i}})(1e3),this.subscriptions=new m.Subscription,this.isAuto=!1,this.isLive=!1,this.captions$=new m.ValueSubject([]),this.captionsPrepared$=new m.ValueSubject([])}},Ch=Ni('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"> </span></span>'),Ah=Ni('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"></span></span>'),Ph=Ni('<span class="caption-line svelte-c2x749"><span class="caption-segment svelte-c2x749"> </span></span>'),Lh=Ni('<div><span class="caption svelte-c2x749"><!></span></div>'),Mh=Ni("<div><!></div>"),Ih={hash:"svelte-c2x749",code:".subtitles-container.svelte-c2x749 {position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;transition:transform var(--controls-transition-duration);}.subtitles-container.shifted.svelte-c2x749 {transform:translateY(calc(var(--controls-height) * -1));}.subtitles-caption.svelte-c2x749 {position:absolute;left:4%;right:4%;bottom:4%;display:flex;justify-content:center;}.subtitles-caption.mobile.svelte-c2x749 {bottom:8%;}.subtitles-container.auto.svelte-c2x749 .subtitles-caption:where(.svelte-c2x749) {left:var(--subtitles-caption-margin);right:var(--subtitles-caption-margin);}.caption.svelte-c2x749 {display:block;overflow-wrap:normal;padding:4px 8px;border-radius:4px;background:rgba(0, 0, 0, 0.4);}.subtitles-container.auto.svelte-c2x749 .caption:where(.svelte-c2x749) {width:100%;}.caption-line.svelte-c2x749 {display:block;text-align:center;}.subtitles-container.auto.svelte-c2x749 .caption-line:where(.svelte-c2x749) {text-align:left;}.caption-segment.svelte-c2x749 {display:inline-block;line-height:1.2;font-size:13px;\n    /*font-weight: 500;*/color:var(--white);white-space:pre-wrap;}"};function Rh(e,t){pi(t,!0),mr(e,Ih);let[i,r]=la(),a=()=>oa(u,"$isAutoSubtitleCaptionVisible$",i),s=fa(t,"isMobile",3,!1),n=Na(),o=ba(),l=n.state.currentSubtitle$,u=n.state.isAutoSubtitleCaptionVisible$,d=n.state.isLive$,c=n.ui.isFullscreen,h=ne((()=>!!oa(l,"$currentSubtitle$",i).isAuto)),p=ne((()=>!!oa(d,"$isLive$",i))),f=ne((()=>.02*t.playerSize.width)),m=ne((()=>s()&&!oa(c,"$isFullscreen",i)||xt(f)<=o.minSubtitlesFontSize?o.minSubtitlesFontSize:xt(f))),g=te(null);Rt((()=>{xt(g)?.setIsAuto(xt(h)),xt(g)?.setIsLive(xt(p)),xt(g)?.setCaptions(t.captions)}));let v=te(Ae([[]]));Xr((()=>{re(g,Ae((new $h).subscribe()));let e=xt(g).captionsPrepared$.subscribe((e=>{re(v,Ae(e))}));return()=>{xt(g)?.destroy(),e.unsubscribe()}})),Xr((()=>{if(xt(h)){let e=window.setTimeout((()=>{u.set(!1)}),o.autoSubtitlesTimeout);return()=>{window.clearTimeout(e)}}u.set(!1)}));let b=ne((()=>t.playerSize.width<400?10:t.playerSize.width<550?14:24));var _=Mh();let y;var w=Oe(_),S=e=>{var i=Lh();let r;var n=Oe(i),o=Oe(n),l=e=>{var t=Ch(),i=Oe(t),r=Oe(i,!0);xe(i),xe(t),Bt((e=>{kr(i,`font-size: ${xt(m)??""}px`),qi(r,e)}),[()=>$s("subtitles_auto_caption")]),ji(e,t)},u=(e,i)=>{var r=e=>{var i=Fi();ar(Be(i),17,(()=>xt(v)),rr,((e,i)=>{var r=Ah(),a=Oe(r);ar(a,21,(()=>xt(i)),(({value:e,timeAppeared:t})=>t),((e,i)=>{let r=()=>xt(i).timeAppeared;var a=Fi(),s=Be(a),n=e=>{var t=Ui();Bt((()=>qi(t,xt(i).value))),ji(e,t)};Zi(s,(e=>{(!r()||r()<=t.position)&&e(n)})),ji(e,a)})),xe(a),xe(r),Bt((()=>kr(a,`font-size: ${xt(m)??""}px`))),ji(e,r)})),ji(e,i)},a=e=>{var i=Fi();ar(Be(i),17,(()=>t.captions),(({value:e})=>e),((e,t)=>{var i=Ph(),r=Oe(i),a=Oe(r,!0);xe(r),xe(i),Bt((()=>{kr(r,`font-size: ${xt(m)??""}px`),qi(a,xt(t).value)})),ji(e,i)})),ji(e,i)};Zi(e,(e=>{xt(h)&&xt(v)?.length?e(r):e(a,!1)}),i)};Zi(o,(e=>{xt(h)&&a()?e(l):e(u,!1)})),xe(n),xe(i),Bt((e=>{r=wr(i,1,"subtitles-caption svelte-c2x749",null,r,e),kr(i,`--subtitles-caption-margin: ${xt(b)??""}%`)}),[()=>({mobile:s()})]),ji(e,i)};Zi(w,(e=>{(t.captions.length||xt(v)?.length)&&e(S)})),xe(_),Bt((e=>y=wr(_,1,"subtitles-container svelte-c2x749",null,y,e)),[()=>({shifted:t.shifted,auto:xt(h)&&!xt(p)&&!a()})]),ji(e,_),fi(),r()}var Dh=Ni('<div class="text svelte-raurnb"> </div>'),Oh=Ni('<div><div class="icon_wrapper svelte-raurnb"><svg class="icon svelte-raurnb" width="22" height="22" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2a9 9 0 0 1 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill="var(--btn-color, #fff)"></path><path d="M0 0h24v24H0z"></path></g></svg></div> <!></div>'),Bh={hash:"svelte-raurnb",code:".wrapper.svelte-raurnb {height:100%;background-position:center;background-size:contain;background-repeat:no-repeat;display:flex;align-items:center;justify-content:center;font-size:16px;flex-direction:column;}.wrapper.bgCover.svelte-raurnb {background-size:cover;}.icon_wrapper.svelte-raurnb {display:flex;flex-direction:column;align-items:center;width:400px;}.icon.svelte-raurnb {width:50px;height:50px;}.text.svelte-raurnb {margin-top:20px;}"};function Nh(e,t){pi(t,!0),mr(e,Bh);let i=ba();var r=Oh();let a;var s=Ne(Oe(r),2),n=e=>{var i=Dh(),r=Oe(i);xe(i),Bt((()=>qi(r,`Видео воспроизводится на ${t.chromecastDeviceName??""}`))),ji(e,i)};Zi(s,(e=>{t.chromecastDeviceName&&e(n)})),xe(r),Bt((e=>{a=wr(r,1,"wrapper svelte-raurnb",null,a,e),kr(r,`background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('${t.thumbUrl||""}')`)}),[()=>({bgCover:i.features.previewNoEmptySpace})]),ji(e,r),fi()}var Vh=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M460 193.998a3.997 3.997 0 0 1 3.997-3.998h122.006a4.003 4.003 0 0 1 3.997 3.998v82.004a3.997 3.997 0 0 1-3.997 3.998H463.997a4.003 4.003 0 0 1-3.997-3.998zm6 2.993c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm112-72c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zm0 12c0-.546.45-.99.99-.99h4.02c.546 0 .99.45.99.99v4.02c0 .546-.45.99-.99.99h-4.02a.995.995 0 0 1-.99-.99zM507 232a6 6 0 1 0 0-12 6 6 0 0 0 0 12m36 0a6 6 0 1 0 0-12 6 6 0 0 0 0 12m-18.05 15c6.05 0 11.624 4.446 11.944 4.65 2.106 1.35 3.252.772 3.957.156s1.15-2.806-1.044-4.657c-1.735-1.48-5.806-5.16-14.856-5.15s-12.95 3.5-14.792 5.185c-1.84 1.685-2.288 3.498-.973 4.657s2.315 1.158 4.357-.327c-.007.007 5.357-4.515 11.408-4.515z"></path></svg>');var Uh=Ni('<div class="container svelte-13zpvm8"><!></div>'),Fh={hash:"svelte-13zpvm8",code:".container.svelte-13zpvm8 {position:absolute;top:0;bottom:0;left:0;right:0;background:#000;display:flex;align-items:center;justify-content:center;}"};function jh(e){mr(e,Fh);var t=Uh();(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Vh();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"200",height:"200","aria-hidden":"true","data-testid":"error-icon",viewBox:"460 190 130 90",role:"img",...i}))),ji(e,r)})(Oe(t),{}),xe(t),ji(e,t)}var zh=Ni('<div class="playButton svelte-1ciju45" tabindex="0" role="button"><div class="playButtonBackground svelte-1ciju45"></div> <!></div>'),Wh=Ni("<div><!></div>"),qh={hash:"svelte-1ciju45",code:".container.svelte-1ciju45 {position:absolute;top:0;bottom:0;left:0;right:0;background-position:center;background-size:contain;background-repeat:no-repeat;cursor:pointer;transition:opacity 0.2s,\n      visibility 0.2s;will-change:opacity;}.container.hidden.svelte-1ciju45 {opacity:0;visibility:hidden;}.container.bgCover.svelte-1ciju45 {background-size:cover;}.playButton.svelte-1ciju45 {position:absolute;top:0;bottom:0;left:0;right:0;margin:auto;width:var(--big-play-size);height:var(--big-play-size);display:flex;align-items:center;justify-content:center;}.playButtonBackground.svelte-1ciju45 {position:absolute;top:0;bottom:0;left:0;right:0;border-radius:var(--big-play-radius);background-color:var(--big-play-bg-color);transition:background 0.2s,\n      transform 0.2s;transition-timing-function:ease-out;will-change:background, transform;}.container.svelte-1ciju45:hover .playButtonBackground:where(.svelte-1ciju45) {background-color:var(--big-play-hover-bg-color);transform:scale(1.15);}.playButton.svelte-1ciju45 svg {transform:scale(2);}"};function Hh(e,t){pi(t,!0),mr(e,qh);let i=fa(t,"iconVisible",3,!0),r=Na(),a=ba(),s=r.ui.startedByKeyboard$,n=$s("tooltip_play"),o=e=>{let i=e.code;["Enter","Space"].includes(i)&&(e.stopPropagation(),e.preventDefault(),s.set(!0),t.startVideo?.())},l=e=>{e.stopPropagation(),t.startVideo?.()};var u=Wh();let d;u.__click=l;var c=Oe(u),h=e=>{var t=zh();t.__keydown=o,Ar(t,"aria-label",n),ec(Ne(Oe(t),2),{}),xe(t),ji(e,t)};return Zi(c,(e=>{i()&&e(h)})),xe(u),Bt((e=>{d=wr(u,1,"container svelte-1ciju45",null,d,e),kr(u,`background-color: #222; background-image: url('${t.thumbUrl||""}')`)}),[()=>({hidden:t.hidden,bgCover:a.features.previewNoEmptySpace})]),ji(e,u),fi({handlePressKey:o,handleClick:l})}Ri(["click","keydown"]);var Kh=Ni("<div> </div>"),Qh={hash:"svelte-1bcvcf2",code:".title.svelte-1bcvcf2 {position:absolute;pointer-events:none;left:0;top:0;width:100%;height:var(--controls-gradient-height);font-size:15px;color:var(--white);box-sizing:border-box;padding:18px 20px 10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;transition-property:visibility, transform, opacity;transition-duration:var(--controls-transition-duration);transition-timing-function:var(--controls-transition-fn);will-change:transform, opacity;background:linear-gradient(\n      0deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.02) 19%,\n      rgba(0, 0, 0, 0.10) 34%,\n      rgba(0, 0, 0, 0.40) 60%,\n      rgba(0, 0, 0, 0.60) 100%\n    );}.hidden.svelte-1bcvcf2 {visibility:hidden;transform:translateY(calc(var(--controls-gradient-height) * -1));opacity:0;}"};var Gh=Ni('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),Yh=Ni('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),Xh=Ni('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div> <span class="timer__points svelte-1qpxtfg"> </span>',1),Zh=Ni('<div class="timer__cell cell svelte-1qpxtfg"><span class="cell__value svelte-1qpxtfg"> </span> <span class="cell__unit svelte-1qpxtfg"> </span></div>'),Jh=Ni('<div class="timer__container svelte-1qpxtfg"><!> <!> <!> <!></div>'),ep={hash:"svelte-1qpxtfg",code:".timer__container.svelte-1qpxtfg {display:flex;align-items:flex-start;justify-content:center;}.cell.svelte-1qpxtfg {display:flex;flex-direction:column;align-items:center;width:62px;}.cell__value.svelte-1qpxtfg {font-size:48px;line-height:1.2;font-weight:700;}.cell__unit.svelte-1qpxtfg {font-size:14px;line-height:1.2;font-weight:400;}.timer__points.svelte-1qpxtfg {display:inline-block;margin:0 8px;font-size:42px;line-height:1.2;font-weight:600;}"};function tp(e,t){pi(t,!0),mr(e,ep);let i,r=te(""),a=te(""),s=te(""),n=te(""),o=e=>String(e).padStart(2,"0"),l=()=>{let e=Math.floor(Date.now()/1e3),u=t.startTime-e;(e=>{let t=Math.floor(e/86400);t&&(e-=86400*t,re(r,Ae(o(t))));let i=Math.floor(e/3600);re(a,Ae(o(i)));let l=Math.floor(e/60)%60;re(s,Ae(o(l))),re(n,Ae(o(e%60)))})(u),u>=1?i=requestAnimationFrame(l):t.onTimerOver()};Xr((()=>{i=requestAnimationFrame(l)})),Zr((()=>{cancelAnimationFrame(i)}));var u=Jh(),d=Oe(u),c=e=>{var t=Gh(),i=Be(t),a=Oe(i),s=Oe(a,!0);xe(a);var n=Ne(a,2),o=Oe(n,!0);xe(n),xe(i);var l=Ne(i,2),u=Oe(l,!0);xe(l),Bt(((e,t)=>{qi(s,xt(r)),qi(o,e),qi(u,t)}),[()=>$s("waiting_live_day_value"),()=>$s("waiting_live_colon")]),ji(e,t)};Zi(d,(e=>{xt(r)&&e(c)}));var h=Ne(d,2),p=e=>{var t=Yh(),i=Be(t),r=Oe(i),s=Oe(r,!0);xe(r);var n=Ne(r,2),o=Oe(n,!0);xe(n),xe(i);var l=Ne(i,2),u=Oe(l,!0);xe(l),Bt(((e,t)=>{qi(s,xt(a)),qi(o,e),qi(u,t)}),[()=>$s("waiting_live_hour_value"),()=>$s("waiting_live_colon")]),ji(e,t)};Zi(h,(e=>{xt(a)&&e(p)}));var f=Ne(h,2),m=e=>{var t=Xh(),i=Be(t),r=Oe(i),a=Oe(r,!0);xe(r);var n=Ne(r,2),o=Oe(n,!0);xe(n),xe(i);var l=Ne(i,2),u=Oe(l,!0);xe(l),Bt(((e,t)=>{qi(a,xt(s)),qi(o,e),qi(u,t)}),[()=>$s("waiting_live_minute_value"),()=>$s("waiting_live_colon")]),ji(e,t)};Zi(f,(e=>{xt(s)&&e(m)}));var g=Ne(f,2),v=e=>{var t=Zh(),i=Oe(t),r=Oe(i,!0);xe(i);var a=Ne(i,2),s=Oe(a,!0);xe(a),xe(t),Bt((e=>{qi(r,xt(n)),qi(s,e)}),[()=>$s("waiting_live_second_value")]),ji(e,t)};Zi(g,(e=>{xt(n)&&e(v)})),xe(u),ji(e,u),fi()}var ip=Vi('<svg><!><path fill="#fefffe" d="M179.5-.5h40q127.56 18.67 171.5 140 5.724 19.896 8.5 40v40q-5.549 51.6-35.5 94-9.626-12.614-24.5-18.5-1.526-1.574-.5-3.5 39.742-61.7 23-133Q329.24 50.25 217.5 33 112.126 26.56 55 114.5q-40.395 74.102-9 152a152.3 152.3 0 0 0 14 25q1.026 1.926-.5 3.5-14.874 5.886-24.5 18.5-29.95-42.4-35.5-94v-40Q18.17 51.94 139.5 8q19.896-5.724 40-8.5" style="opacity:.965"></path><path fill="#fefffe" d="M183.5 63.5q86.294-5.475 133.5 66 32.442 60.138 8 124a186.7 186.7 0 0 1-17.5 29.5 633 633 0 0 1-38-7q54.668-57.264 19.5-128.5Q252.733 91.244 185.5 97q-74.25 14.25-88.5 88.5-5.916 53.38 32.5 90.5a1150 1150 0 0 0-36 7.5q-2.294-.044-3.5-2-43.947-63.646-16-136 32.799-70.278 109.5-82" style="opacity:.965"></path><path fill="#fefffe" d="M187.5 127.5q66.786-4.422 83.5 60 5.146 66.825-59.5 83.5-66.825 5.146-83.5-59.5-4.844-66.856 59.5-84" style="opacity:.985"></path><path fill="#fefffe" d="M219.5 399.5h-40q-67.453-7.982-117-54a31.7 31.7 0 0 1 3.5-10q8.539-9.646 20.5-14.5 54.786-19.435 113-17.5 58.214-1.935 113 17.5 11.962 4.854 20.5 14.5a31.7 31.7 0 0 1 3.5 10q-49.547 46.018-117 54" style="opacity:.986"></path></svg>');var rp=Ni('<div class="upcoming svelte-15pewff"><div class="upcoming-icon svelte-15pewff"><!></div> <span class="upcoming__title svelte-15pewff"> </span></div>'),ap=Ni('<div class="waiting-timer timer svelte-15pewff"><span class="timer__title svelte-15pewff"> </span> <!></div>'),sp=Ni('<div class="waiting-container svelte-15pewff"><!></div>'),np={hash:"svelte-15pewff",code:".waiting-container.svelte-15pewff {position:absolute;top:0;left:0;width:100%;height:100%;background-color:var(--black);background-position:center;background-size:cover;background-repeat:no-repeat;}.waiting-container.svelte-15pewff::before {content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.56);z-index:1;}.upcoming.svelte-15pewff {position:absolute;top:50%;left:0;width:100%;transform:translateY(-50%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:0;}.upcoming-icon.svelte-15pewff {width:20%;max-width:200px;margin-bottom:20px;}.upcoming__title.svelte-15pewff {font-size:14px;line-height:1.2;font-weight:400;}.waiting-timer.svelte-15pewff {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);z-index:2;}.timer.svelte-15pewff {display:flex;flex-direction:column;align-items:center;justify-content:center;}.timer__title.svelte-15pewff {display:inline-block;vertical-align:middle;margin-bottom:12px;font-size:14px;line-height:1.2;font-weight:400;}"};function op(e,t){pi(t,!0),mr(e,np);let i=te(!1);Rt((()=>{re(i,Ae(void 0===t.startTime||t.startTime<Math.floor(Date.now()/1e3)))}));var r=sp(),a=Oe(r),s=e=>{var t=rp(),i=Oe(t);(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=ip();let a;cr(Oe(r),(()=>t.children??N)),$e(4),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true","data-testid":"podcast-icon",style:"shape-rendering:geometricPrecision;text-rendering:geometricPrecision;image-rendering:optimizeQuality;fill-rule:evenodd;clip-rule:evenodd;width:100%;height:100%",viewBox:"0 0 400 400",role:"img",...i}))),ji(e,r)})(Oe(i),{}),xe(i);var r=Ne(i,2),a=Oe(r,!0);xe(r),xe(t),Bt((e=>qi(a,e)),[()=>$s("waiting_live_upcoming_title")]),ji(e,t)},n=e=>{var r=ap(),a=Oe(r),s=Oe(a,!0);xe(a);var n=Ne(a,2);let o=ne((()=>t.startTime||0));tp(n,{get startTime(){return xt(o)},onTimerOver:()=>re(i,!0)}),xe(r),Bt((e=>qi(s,e)),[()=>$s("waiting_live_timer_title")]),ji(e,r)};Zi(a,(e=>{xt(i)?e(s):e(n,!1)})),xe(r),Bt((()=>kr(r,`background-image: url(${xt(i)?"":t.thumbUrl})`))),ji(e,r),fi()}var lp=Ni('<div class="waiting-container svelte-xvqwsa"><div class="waiting-caption svelte-xvqwsa"><!> <p class="waiting-title svelte-xvqwsa"> </p></div></div>'),up={hash:"svelte-xvqwsa",code:".waiting-container.svelte-xvqwsa {position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;background-color:var(--black);background-position:center;background-size:cover;background-repeat:no-repeat;}.waiting-container.svelte-xvqwsa::before {content:'';position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.4);backdrop-filter:blur(10px);}.waiting-caption.svelte-xvqwsa {position:relative;display:flex;flex-direction:column;align-items:center;}.waiting-title.svelte-xvqwsa {margin:0;padding:20px;text-align:center;font-size:20px;line-height:1.2;font-weight:400;}"};function dp(e,t){pi(t,!0),mr(e,up);let i=fa(t,"thumbUrl",3,""),r={recover:$s("waiting_live_recover_title"),record:$s("waiting_record_title")},a=ne((()=>r[t.kind]||""));var s=lp(),n=Oe(s),o=Oe(n);jo(o,{style:"position: static; transform: translate(0, 0)"});var l=Ne(o,2),u=Oe(l,!0);xe(l),xe(n),xe(s),Bt((()=>{kr(s,`background-image: url('${i()}')`),qi(u,xt(a))})),ji(e,s),fi()}var cp=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M6 10.2 3.5 7.7a.99.99 0 0 0-1.4 1.4l3.2 3.2a1 1 0 0 0 1.4 0l7.6-7.6a.99.99 0 0 0-1.4-1.4z"></path></svg>');var hp=Ni('<div class="select-icon svelte-124aexk"><!></div>'),pp={hash:"svelte-124aexk",code:".select-icon.svelte-124aexk {margin-right:auto;padding-right:12px;opacity:0.9;position:relative;top:3px;}"};function fp(e){mr(e,pp);var t=hp();(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=cp();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true","data-testid":"check-mark-icon",role:"img",...i}))),ji(e,r)})(Oe(t),{}),xe(t),ji(e,t)}var mp=(e,t)=>{e.stopPropagation(),t.item.selectItem(t.item.value)},gp=(e,t)=>{Pn(e,(()=>t.item.selectItem(t.item.value)))},vp=Ni("<p> </p>"),bp=Ni('<p class="sublabel svelte-1t7rx2m"> </p>'),_p=Ni('<li role="menuitem" tabindex="0"><!> <div><!> <!></div></li>'),yp={hash:"svelte-1t7rx2m",code:".menu-item-value.svelte-1t7rx2m {display:flex;flex-direction:column;align-items:end;min-width:0;}.menu-item-value[data-selected='false'].svelte-1t7rx2m {--select-icon-width: 16px;--icon-padding: 12px;\n\n    /**\n    * Если элемент не выбран(иконка отсутствует), то должны заполнить пустое место\n    * чтобы все лейблы начинались с одного отступа.\n    */margin-left:calc(var(--icon-padding) + var(--select-icon-width));}.label.svelte-1t7rx2m,\n  .sublabel.svelte-1t7rx2m {text-overflow:ellipsis;overflow:hidden;max-width:100%;}.sublabel.svelte-1t7rx2m {opacity:0.5;}"};Ri(["click","keydown"]);var wp=Ni('<li role="menuitem" tabindex="0" aria-haspopup="true"><!> <div><!></div></li>');Ri(["click","keydown"]);var Sp=100,kp=200,Tp=300,Ep=400,xp=500,$p=600,Cp=700,Ap=800,Pp=900,Lp=1e3,Mp=(e,t)=>{(async(e,t,i)=>{if(Tn(e),(e=>"ArrowLeft"===e.code)(e))return wn(e),void t();Sn(e)&&(wn(e),i())})(e,t.returnFromSubMenu,t.closeSettingsMenu)},Ip=(e,t)=>{e.stopPropagation(),t.returnFromSubMenu()},Rp=(e,t)=>{kn(e)&&(wn(e),t.returnFromSubMenu())},Dp=Ni('<div><ul role="menu"><li role="menuitem" tabindex="0" data-testid="return-to-settings-menu"><!> <p class="title svelte-7dfsuh"> </p></li> <!></ul></div>'),Op={hash:"svelte-7dfsuh",code:".sub-menu.svelte-7dfsuh {--item-padding-vertical-mobile: 16px;--item-padding-vertical: 7px;--item-label-line-height: 18px;\n    /*Для первого и последнего элемента списка*/--edge-item-padding-vertical-mobile: calc(6px + var(--item-padding-vertical-mobile));--edge-item-padding-vertical: calc(8px + var(--item-padding-vertical));}.sub-menu.svelte-7dfsuh .item.mobile {padding:var(--item-padding-vertical-mobile) 17px;line-height:var(--item-label-line-height);font-size:14px;}.sub-menu.svelte-7dfsuh {\n    /**\n    * Так как у нас заголовок должен быть стики, нужно добавить паддинг с высоту заголовка.\n    * Предполагаем, что в одну строку он, иначе нужно рассчитывать динамически.\n    * paddingTop + lineHeight + paddingBottom.\n    */padding-top:calc(var(--edge-item-padding-vertical) + var(--item-padding-vertical) + var(--item-label-line-height));}.sub-menu.mobile.svelte-7dfsuh {padding-top:calc(\n      var(--edge-item-padding-vertical-mobile) + var(--item-padding-vertical-mobile) + var(--item-label-line-height) +\n        1px\n    );}.sub-menu.svelte-7dfsuh .items:where(.svelte-7dfsuh) .item.header:where(.svelte-7dfsuh) {position:absolute;top:0;left:0;right:0;min-width:max-content;display:flex;justify-content:space-between;border-bottom:var(--divider-border);}.header.svelte-7dfsuh .title:where(.svelte-7dfsuh) {margin-left:8px;}.sub-menu.svelte-7dfsuh .item {padding:var(--item-padding-vertical) 12px;padding-right:22px;}.items.svelte-7dfsuh .item:first-child:not(.mobile) {padding-top:var(--edge-item-padding-vertical);}.items.svelte-7dfsuh .item:last-child:not(.mobile) {padding-bottom:var(--edge-item-padding-vertical);}.items.svelte-7dfsuh .item.mobile:first-child {padding-top:var(--edge-item-padding-vertical-mobile);}.items.svelte-7dfsuh .item.mobile:last-child {padding-bottom:var(--edge-item-padding-vertical-mobile);}.sub-menu.svelte-7dfsuh .item.bottomBordered {border-bottom:var(--divider-border);}.sub-menu.svelte-7dfsuh .item .sublabel {line-height:14px;font-size:12px;}.sub-menu.svelte-7dfsuh .item:not(.mobile) .label,\n  .item.svelte-7dfsuh:not(.mobile) p:where(.svelte-7dfsuh) {line-height:var(--item-label-line-height);font-size:13px;}"};function Bp(e,t){pi(t,!0),mr(e,Op);let[i,r]=la(),a=()=>oa(c,"$playerSize",i),s=fa(t,"isMobile",3,!1),n=fa(t,"playerControlsHeight",3,0),o=fa(t,"ariaLabelReturnFromSubMenu",19,(()=>$s("aria_label_submenu_back"))),l=fa(t,"listRef",15);Xr((()=>{let e=t.items.findIndex((e=>e.selected));l().children[e+1].focus()}));let u=Na(),d=u.ui.isFullscreen,c=u.ui.playerSize,h=te(void 0),p=te(0),f=te(0),m=ne((()=>s()&&oa(d,"$isFullscreen",i)?`max-height: ${Math.round(.6*a().height)}px`:s()?"":`max-height: ${a().height-32-xt(f)-n()}px; overflow: auto;`)),g=ne((()=>Math.max(t.minWidth,xt(p))));var v=Dp();let b;var _=Oe(v);let y;_.__keydown=[Mp,t];var w=Oe(_);let S;w.__click=[Ip,t],w.__keydown=[Rp,t];var k=Oe(w);wh(k,{direction:"left"});var T=Ne(k,2),E=Oe(T,!0);xe(T),xe(w),Qr(w,(e=>re(h,e)),(()=>xt(h))),ar(Ne(w,2),17,(()=>t.items),rr,((e,i)=>{var r=Fi(),a=Be(r),n=e=>{!function(e,t){pi(t,!0),mr(e,yp);let i=fa(t,"isMobile",3,!1);var r=_p();let a;r.__click=[mp,t],r.__keydown=[gp,t];var s=Oe(r),n=e=>{fp(e)};Zi(s,(e=>{t.item.selected&&e(n)}));var o=Ne(s,2);let l;var u=Oe(o),d=e=>{var i=Fi();hr(Be(i),(()=>t.item.valueComponent),((e,i)=>{i(e,ha((()=>t.item.valueComponentParams??{})))})),ji(e,i)},c=e=>{var r=vp();let a;var s=Oe(r,!0);xe(r),Bt((e=>{a=wr(r,1,"label svelte-1t7rx2m",null,a,e),qi(s,t.item.label??t.item.value)}),[()=>({mobile:i()})]),ji(e,r)};Zi(u,(e=>{t.item.valueComponent?e(d):e(c,!1)}));var h=Ne(u,2),p=e=>{var i=bp(),r=Oe(i,!0);xe(i),Bt((()=>qi(r,t.item.sublabel))),ji(e,i)};Zi(h,(e=>{t.item.sublabel&&e(p)})),xe(o),xe(r),Bt(((e,i,s)=>{a=wr(r,1,"item",null,a,e),Ar(r,"data-value",t.item.value),Ar(r,"aria-label",i),l=wr(o,1,"menu-item-value svelte-1t7rx2m",null,l,s),Ar(o,"data-selected",t.item.selected)}),[()=>({mobile:i()}),()=>t.item.ariaLabel??t.item.label??t.item.value.toString(),()=>({"submenu-value-mobile":i()})]),ji(e,r),fi()}(e,{get item(){return xt(i)},get isMobile(){return s()}})},o=(e,r)=>{var a=e=>{!function(e,t){pi(t,!0);let i=fa(t,"isMobile",3,!1),r=fa(t,"refMenuItems",15),a=ne((()=>()=>t.openSubMenuList(t.item.children))),s=ne((()=>e=>An(e,xt(a))));var n=wp();let o;n.__click=function(...e){xt(a)?.apply(this,e)},n.__keydown=function(...e){xt(s)?.apply(this,e)};var l=Oe(n),u=e=>{fp(e)};Zi(l,(e=>{t.item.selected&&e(u)}));var d=Ne(l,2);let c;var h=Oe(d),p=e=>{var i=Fi();let r=ne((()=>t.item.valueComponent));hr(Be(i),(()=>xt(r)),((e,i)=>{i(e,ha((()=>t.item.valueComponentParams??{})))})),ji(e,i)},f=e=>{var i=Ui();Bt((()=>qi(i,t.item.label))),ji(e,i)};Zi(h,(e=>{t.item.valueComponent?e(p):e(f,!1)})),xe(d),xe(n),Qr(n,(e=>r(r()[t.item.id]=e,!0)),(()=>r()?.[t.item.id])),Bt(((e,i)=>{o=wr(n,1,"item",null,o,e),Ar(n,"aria-label",t.item.ariaLabel??t.item.label),Ar(n,"data-testid",t.item.id),c=wr(d,1,"menu-item-value",null,c,i)}),[()=>({mobile:i(),bottomBordered:t.item.bottomBordered}),()=>({"submenu-value-mobile":i()})]),ji(e,n),fi()}(e,{get isMobile(){return s()},get item(){return xt(i)},get openSubMenuList(){return t.openSubMenuList},get refMenuItems(){return t.refMenuItems}})};Zi(e,(e=>{"OPEN_SUB_MENU"===xt(i).type&&e(a)}),r)};Zi(a,(e=>{"SELECT_VALUE"===xt(i).type?e(n):e(o,!1)})),ji(e,r)})),xe(_),Qr(_,(e=>l(e)),(()=>l())),xe(v),Bt(((e,i,r)=>{b=wr(v,1,"sub-menu menu svelte-7dfsuh",null,b,e),Ar(v,"data-testid",`sub-menu-${t.id}`),kr(v,`min-width: ${xt(g)}px`),y=wr(_,1,"items svelte-7dfsuh",null,y,i),kr(_,xt(m)),S=wr(w,1,"item header back svelte-7dfsuh",null,S,r),Ar(w,"aria-label",o()),qi(E,t.title)}),[()=>({desktop:!s(),mobile:s()}),()=>({mobile:s()}),()=>({mobile:s()})]),Hr(w,"clientWidth",(e=>re(p,e))),Hr(w,"clientHeight",(e=>re(f,e))),ji(e,v),fi(),r()}Ri(["keydown","click"]);var Np=(e,t)=>An(e,t()),Vp=(e,t)=>{e.stopPropagation(),t()()},Up=Ni('<div class="value svelte-1ikfjte"> </div>'),Fp=Ni('<li role="menuitem" tabindex="0" aria-haspopup="true"><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></li>'),jp={hash:"svelte-1ikfjte",code:".value.svelte-1ikfjte {position:relative;opacity:0.7;overflow:hidden;text-overflow:ellipsis;}"};Ri(["click","keydown"]);var zp=(e,t)=>{Pn(e,(()=>t()))},Wp=Ni('<div class="icon icon-error-stub"><div class="inner"></div></div>'),qp=Ni('<img class="icon" aria-hidden="true">'),Hp=Ni('<li role="menuitem" tabindex="0"><div class="icon-wrapper"><!></div> <div class="label svelte-15ifkac"> </div></li>'),Kp={hash:"svelte-15ifkac",code:".label.svelte-15ifkac {overflow:hidden;text-overflow:ellipsis;}"};Ri(["click","keydown"]);var Qp=Ni('<div class="toggle_wrap svelte-17wbjko"><div></div> <div class="toggle-label svelte-17wbjko"></div></div>'),Gp={hash:"svelte-17wbjko",code:'.toggle_wrap.svelte-17wbjko {min-height:15px;padding:0;font-size:12px;line-height:15px;cursor:pointer;user-select:none;}.toggle.svelte-17wbjko {float:right;margin-top:3px;width:28px;height:9px;border-radius:45px;background-color:var(--toggle-color-separator);cursor:pointer;}.toggle.svelte-17wbjko::after {content:"";float:left;position:relative;width:15px;height:15px;border-radius:50%;background-color:var(--toggle-color-off);top:-3px;left:0;transition:left .1s ease;}.toggle.on.svelte-17wbjko::after {background-color:var(--toggle-color-on);left:13px;}.toggle-label.svelte-17wbjko {overflow:hidden;}'};var Yp=(e,t,i)=>{((e,t,i)=>{if(kn(e))wn(e),i(!t);else{let r=e.code;if("ArrowLeft"===r&&t)return i(!1),void wn(e);"ArrowRight"===r&&!t&&(i(!0),wn(e))}})(e,t(),(e=>i()(e)))},Xp=(e,t,i)=>{e.stopPropagation(),t()(!i())},Zp=Ni('<div><div class="icon-wrapper"><!></div> <div class="label"> </div> <!></div>'),Jp=Ni('<li role="menuitem" tabindex="0"><!></li>');function ef(e,t){pi(t,!0);let i=fa(t,"isMobile",3,!1),r=fa(t,"onClick",3,m.noop),a=fa(t,"enabled",3,!1),s=fa(t,"tooltipText",3,void 0),n=fa(t,"maxTooltipWidth",3,void 0);var o=Jp();let l;o.__click=[Xp,r,a],o.__keydown=[Yp,a,r],Fl(Oe(o),{get content(){return s()},get isMobile(){return i()},placement:"left",translateX:10,isFullWidthWrapper:!0,get maxTooltipWidth(){return n()},children:(e,r)=>{var s=Zp();let n;var o=Oe(s),l=Oe(o),u=e=>{wc(e,{get icon(){return t.icon}})},d=e=>{var i=Fi();let r=ne((()=>t.icon));hr(Be(i),(()=>xt(r)),((e,t)=>{t(e,{})})),ji(e,i)};Zi(l,(e=>{"string"==typeof t.icon?e(u):e(d,!1)})),xe(o);var c=Ne(o,2),h=Oe(c,!0);xe(c),function(e,t){mr(e,Gp);let i=fa(t,"enabled",3,!1);var r=Qp(),a=Oe(r);let s;$e(2),xe(r),Bt((e=>s=wr(a,1,"toggle svelte-17wbjko",null,s,e)),[()=>({on:i()})]),ji(e,r)}(Ne(c,2),{get enabled(){return a()}}),xe(s),Bt((e=>{n=wr(s,1,"switch-wrapper",null,n,e),qi(h,t.label)}),[()=>({mobile:i()})]),ji(e,s)},$$slots:{default:!0}}),xe(o),Bt((e=>{l=wr(o,1,"item switch-item",null,l,e),Ar(o,"aria-label",t.ariaLabel??t.label),Ar(o,"data-testid",t.id)}),[()=>({mobile:i()})]),ji(e,o),fi()}Ri(["click","keydown"]);var tf=Ni('<div class="quality-icon svelte-t2qk8t"><!></div>'),rf=Ni('<div class="quality-label svelte-t2qk8t"><span> </span> <!></div>'),af={hash:"svelte-t2qk8t",code:".quality-label.svelte-t2qk8t {position:relative;}.quality.svelte-t2qk8t {font-size:13px;line-height:18px;}.quality.sub.svelte-t2qk8t {opacity:0.7;}.quality-icon.svelte-t2qk8t {position:absolute;padding-left:2px;transform:translateX(100%);display:flex;top:0;right:0;}.quality-icon.svelte-t2qk8t svg {color:var(--blue-light);}"};function sf(e,t){pi(t,!0),mr(e,af);let i=fa(t,"isSubCase",3,!1),r=ne((()=>gl(t.quality)));var a=rf(),s=Oe(a);let n;var o=Oe(s,!0);xe(s);var l=Ne(s,2),u=e=>{var t=tf();let i=ne((()=>xt(r)));hr(Oe(t),(()=>xt(i)),((e,t)=>{t(e,{})})),xe(t),ji(e,t)};Zi(l,(e=>{xt(r)&&!t.isMobile&&e(u)})),xe(a),Bt((e=>{n=wr(s,1,"svelte-t2qk8t",null,n,e),qi(o,t.label)}),[()=>({sub:!i(),quality:!t.isMobile})]),ji(e,a),fi()}var nf=({quality:e,availableQualities:t})=>{let i=t.find((t=>t.value===e));return i?i.displayValue:e},of=Ni('<div class="menu-item-value-wrapper svelte-1j7b2kc"><!></div>'),lf={hash:"svelte-1j7b2kc",code:".menu-item-value-wrapper.svelte-1j7b2kc {line-height:normal;}"};function uf(e,t){pi(t,!0),mr(e,lf);let[i,r]=la(),a=()=>oa(n,"$currentQuality$",i),s=Na(),n=s.state.currentQuality$,o=s.state.availableQualities$,l=s.ui.isMobile,u=ne((()=>t.prefix+(t.selected&&a()!==m.VideoQuality.INVARIANT?" · ":""))),d=ne((()=>(({quality:e,availableQualities:t,prefix:i,onlyPrefix:r})=>e?r||e===f.VideoQuality.INVARIANT?i:`${i}${nf({quality:e,availableQualities:t})}`:"...")({prefix:xt(u),quality:a(),availableQualities:oa(o,"$availableQualities$",i),onlyPrefix:!t.selected})));var c=of(),h=Oe(c);let p=ne((()=>t.selected?a():void 0));sf(h,{get quality(){return xt(p)},get label(){return xt(d)},get isMobile(){return oa(l,"$isMobile$",i)},isSubCase:!0}),xe(c),ji(e,c),fi(),r()}var df={br:!0,span:!0},cf=(e,t={})=>{if(!e)return e;let i={...df,...t},r=Object.keys(i);if(!r.length)return e;let a=(e=>{let t=e.join("|");return new RegExp(`<(?<keyhtml>.*?)(?<propshtml> .*?)?>(?<childrenhtml>.*?)</\\k<keyhtml>>|{(?<keyi18n>${t})}(?<childreni18n>.*?){/\\k<keyi18n>}|<(?<keyhtmlself>.*?)(?<propshtmlself> .*?)?/?>|{(?<keyi18nself>${t})}`,"g")})(r),s=[],n=0;for(let t of e.matchAll(a)){let r=t[0],a=t.groups?.keyhtml||t.groups?.keyi18n||t.groups?.keyhtmlself||t.groups?.keyi18nself||"",{index:o}=t;if(!i[a]){s.push(e.slice(n,o)),n=o+r.length;continue}let l=t.groups?.childrenhtml?cf(t.groups.childrenhtml,i):"",u=t.groups?.childrenhtml?r.replace(new RegExp(t.groups?.childrenhtml),(()=>l||"")):r;s.push(e.slice(n,o),u),n=o+r.length}return 0===n?e:(s.push(e.slice(n)),s.join(""))};function hf(e,t){pi(t,!1);let i=fa(t,"message",8),r=cf(i());Gr();var a=Fi(),s=Be(a),n=e=>{var t=Fi();dr(Be(t),(()=>r),!1,!1),ji(e,t)};Zi(s,(e=>{r&&e(n)})),ji(e,a),fi()}var pf=Ni('<p class="quality-applies sublabel svelte-1qk3zto"><!></p>'),ff={hash:"svelte-1qk3zto",code:".quality-applies.svelte-1qk3zto {display:flex;justify-content:end;padding:3px 0;color:rgba(255, 255, 255, 0.5);}.quality-applies span {color:#70c1ff;}"};function mf(e,t){pi(t,!1),mr(e,ff),Gr();var i=pf(),r=Oe(i);let a=oe((()=>$s("quality_applience",{action:`<span>${$s("quality_applience_action")}</span>`})));hf(r,{get message(){return xt(a)}}),xe(i),ji(e,i),fi()}var gf=({isAutoQualityEnabled:e,trafficSavingEnabled:t,highQualityEnabled:i})=>{let r=!e&&!t&&!i;return{id:"QUALITY_OTHER",type:"OPEN_SUB_MENU",selected:r,valueComponent:uf,valueComponentParams:{prefix:$s("other_quality"),selected:r},children:"QUALITY"}},vf=({appliesTo:e,labelWithQuality:t,selected:i},{selectQuality:r})=>({id:"QUALITY_AUTO",type:"SELECT_VALUE",value:"auto",label:$s("auto_quality_limit"),valueComponent:t?uf:void 0,valueComponentParams:{prefix:$s("auto_quality_limit"),selected:i},selectItem:()=>r("auto",e),selected:i}),bf=({labelWithQuality:e,appliesTo:t,selected:i},{toggleHighQuality:r})=>({id:"QUALITY_HIGH",type:"SELECT_VALUE",value:"high_quality",selectItem:()=>r(!0,t),selected:i,label:$s("high_quality"),valueComponent:e?uf:void 0,valueComponentParams:{prefix:$s("high_quality"),selected:i},sublabel:$s("high_quality_description")}),_f=({labelWithQuality:e,appliesTo:t,selected:i},{toggleTrafficSaving:r})=>({id:"QUALITY_TRAFFIC_SAVING",type:"SELECT_VALUE",value:"save_traffic",selectItem:()=>r(!0,t),selected:i,label:$s("traffic_saving_quality"),valueComponent:e?uf:void 0,valueComponentParams:{prefix:$s("traffic_saving_quality"),selected:i},sublabel:$s("traffic_saving_quality_description")}),yf=(e,t)=>String(t.findIndex((t=>t.id===e.id))+1),wf=(e,t)=>{if(!e)return"";let i,{language:r,label:a}=e;if("und"===r?i=void 0:r&&(i=gd(r)??r),a&&r&&i){let s=t.filter((e=>e.label===a&&e.language===r));if(1===s.length)return $s("audio_stream_display_language_label",{language:i,label:a});{let t=yf(e,s);return $s("audio_stream_display_language_label_index",{language:i,label:a,index:t})}}if(a){let i=t.filter((e=>e.label===a));if(1===i.length)return a;{let t=yf(e,i);return $s("audio_stream_display_label_index",{label:a,index:t})}}if(r&&i){let a=t.filter((e=>e.language===r));if(1===a.length)return i;{let t=yf(e,a);return $s("audio_stream_display_language_index",{language:i,index:t})}}let s=yf(e,t);return $s("audio_stream_display_unknown",{index:s})},Sf={QUALITY_DETAILS:e=>{let{isAutoQualityEnabled:t,isAutoQualityAvailable:i,trafficSavingEnabled:r,highQualityEnabled:a}=e,s=[];return i&&s.push({handler:vf,selected:t&&!r&&!a||!1}),s.push({handler:_f,selected:r},{handler:bf,selected:a}),{title:$s("submenu_quality"),id:"QUALITY_DETAILS",items:[{id:"QUALITY_APPLIENCE",type:"OPEN_SUB_MENU",valueComponent:mf,bottomBordered:!0,children:"QUALITY_APPLIENCE"},...s.map((({handler:t,selected:i})=>t({labelWithQuality:!0,appliesTo:"to-video",selected:i},e))),gf(e)]}},QUALITY:({closeSettingsMenu:e,selectQuality:t,availableQualities:i,isMobile:r})=>({id:"QUALITY",title:$s("submenu_quality"),closeSettingsMenu:e,items:i.map((e=>({type:"SELECT_VALUE",value:e.value,valueComponent:sf,valueComponentParams:{quality:e.value,label:e.displayValue,isMobile:r,isSubCase:!0},selectItem:e=>t(e,"to-video"),selected:e.selected,label:e.displayValue})))}),QUALITY_APPLIENCE:e=>{let{closeSettingsMenu:t}=e;return{id:"QUALITY_APPLIENCE",title:$s("default_quality_for_any_video"),closeSettingsMenu:t,items:[{handler:vf,selected:"auto_quality"===ms()?.type},{handler:_f,selected:"traffic_saving"===ms()?.type},{handler:bf,selected:"high_quality"===ms()?.type}].map((({handler:t,selected:i})=>t({labelWithQuality:!1,appliesTo:"as-default",selected:i},e)))}},AUDIO_LANGUAGES:({closeSettingsMenu:e,availableAudioStreams:t,currentAudioStream:i,selectAudioLanguage:r})=>({id:"AUDIO_LANGUAGES",title:$s("submenu_audio_languages"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e,dataValue:e.id,selectItem:r,selected:e.id===i?.id,label:wf(e,t)})))}),PLAYBACK_RATE_SUB_MENU:({closeSettingsMenu:e,availablePlaybackRates:t,selectPlaybackRate:i})=>({id:"PLAYBACK_RATE_SUB_MENU",title:$s("submenu_playback_rate"),closeSettingsMenu:e,items:t.map((e=>({type:"SELECT_VALUE",value:e.value,selectItem:i,selected:e.selected,label:e.displayValue})))}),SUBTITLES:({availableSubtitlesList:e,selectSubtitle:t})=>({id:"SUBTITLES",minWidth:164,title:$s("subtitles_caption"),items:e.map((e=>({type:"SELECT_VALUE",value:e,selectItem:t,selected:e.selected,label:e.displayValue})))})},kf=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M.1 6.5c0-2.24 0-3.36.436-4.216A4 4 0 0 1 2.284.536C3.139.1 4.259.1 6.5.1h5c2.24 0 3.36 0 4.216.436a4 4 0 0 1 1.748 1.748c.436.856.436 1.976.436 4.216s0 3.36-.436 4.216a4 4 0 0 1-1.748 1.748c-.836.426-1.925.436-4.064.436l.55 2.2H14.1a.9.9 0 0 1 0 1.8H3.9a.9.9 0 1 1 0-1.8h1.897l.55-2.2c-2.139 0-3.227-.01-4.063-.436a4 4 0 0 1-1.748-1.748C.1 9.86.1 8.74.1 6.5m11.4-4.6h-5c-1.15 0-1.904.002-2.481.049-.556.045-.786.124-.918.19a2.2 2.2 0 0 0-.962.962c-.067.132-.145.363-.19.918-.048.577-.05 1.331-.05 2.481s.002 1.904.05 2.48c.045.556.123.787.19.919a2.2 2.2 0 0 0 .962.961c.132.068.362.146.918.192.577.047 1.33.048 2.48.048h5c1.15 0 1.904-.001 2.481-.048.556-.046.787-.124.918-.192a2.2 2.2 0 0 0 .962-.961c.067-.132.146-.363.191-.918.047-.577.049-1.331.049-2.48s-.002-1.905-.049-2.482c-.045-.555-.124-.786-.191-.918a2.2 2.2 0 0 0-.962-.961c-.131-.067-.362-.146-.918-.191-.577-.048-1.33-.049-2.48-.049m-3.298 11-.55 2.2h2.695l-.55-2.2z" clip-rule="evenodd"></path></svg>');function Tf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=kf();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"17",fill:"none","aria-hidden":"true","data-testid":"traffic-saving-icon",role:"img",...i}))),ji(e,r)}var Ef=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M8.295 14.247c1.87 1.896 5.505.02 5.505-3.548V5.645l2.399-.697A2.74 2.74 0 0 0 18 2.364l-.01-1.72a.75.75 0 0 0-.906-.623l-.267.061c-.941.215-1.886.431-2.807.721-1.332.45-2.03 1.614-2.01 3.077V9c-3.887.196-5.639 3.286-3.705 5.247M.9.1a.9.9 0 0 0 0 1.8h8.197a.9.9 0 0 0 0-1.8zM.9 5.1a.9.9 0 1 0 0 1.8h7.196a.9.9 0 0 0 0-1.8zM0 11a.9.9 0 0 1 .9-.9h4.183a.9.9 0 1 1 0 1.8H.9A.9.9 0 0 1 0 11"></path></svg>');function xf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Ef();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"15",fill:"none","aria-hidden":"true","data-testid":"audio-languages-icon",role:"img",...i}))),ji(e,r)}var $f=Vi('<svg><!><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z"></path><path fill="var(--btn-color, #fff)" fill-rule="nonzero" d="M11 4.07V2.05c-2.01.2-3.84 1-5.32 2.21L7.1 5.69A7.94 7.94 0 0 1 11 4.07M5.69 7.1 4.26 5.68A9.95 9.95 0 0 0 2.05 11h2.02c.18-1.46.76-2.79 1.62-3.9M2.05 13c.2 2.01 1 3.84 2.21 5.32l1.43-1.43A7.87 7.87 0 0 1 4.07 13zM11 21.95v-2.02a7.94 7.94 0 0 1-3.9-1.62l-1.42 1.43A10 10 0 0 0 11 21.95M22 12c0 5.16-3.92 9.42-8.95 9.95v-2.02C16.97 19.41 20 16.05 20 12s-3.03-7.41-6.95-7.93V2.05C18.08 2.58 22 6.84 22 12M10.688 8.576l4.746 2.736a.792.792 0 0 1 0 1.372l-4.746 2.737a.792.792 0 0 1-1.188-.686V9.262a.792.792 0 0 1 1.188-.686"></path></g></svg>');function Cf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=$f();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24","aria-hidden":"true","data-testid":"play-speed-icon",role:"img",...i}))),ji(e,r)}var Af=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M8 0a.9.9 0 0 1 .9.9v10.927l4.564-4.563a.9.9 0 0 1 1.272 1.272l-6.1 6.1a.9.9 0 0 1-1.272 0l-6.1-6.1a.9.9 0 1 1 1.272-1.272L7.1 11.827V.9A.9.9 0 0 1 8 0M0 18a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8H.9A.9.9 0 0 1 0 18" clip-rule="evenodd"></path></svg>');function Pf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Af();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"19",fill:"none","aria-hidden":"true","data-testid":"download-icon",role:"img",...i}))),ji(e,r)}var Lf=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M8.863 2.1h6.274c.674-.002 1.2.211 1.683.697l4.383 4.383c.478.476.699.998.697 1.683v6.274c.002.685-.22 1.207-.697 1.683l-4.383 4.383c-.476.478-.998.699-1.683.697H8.863c-.685.002-1.207-.22-1.683-.697L2.797 16.82c-.478-.476-.699-.998-.697-1.683V8.863c-.002-.685.22-1.207.697-1.683L7.18 2.797c.484-.486 1.009-.699 1.683-.697m-.445 2.005L4.105 8.418c-.18.18-.205.242-.205.495v6.174c0 .25.025.316.205.495l4.313 4.313c.179.179.24.205.495.205h6.174c.253 0 .316-.026.495-.205l4.313-4.313c.18-.18.205-.245.205-.495V8.913c0-.254-.026-.316-.205-.495l-4.313-4.313c-.18-.18-.242-.205-.495-.205H8.913c-.254 0-.319.029-.495.205M13 16a1 1 0 1 1-2 0 1 1 0 0 1 2 0m-.1-8.1a.9.9 0 0 0-1.8 0v5.2a.9.9 0 1 0 1.8 0z" clip-rule="evenodd"></path></svg>');function Mf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Lf();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"report-icon",role:"img",...i}))),ji(e,r)}var If=Vi('<svg><!><path fill="var(--btn-color, #fff)" fill-rule="evenodd" d="M4 12.3V12c0-1.47.005-2.547.075-3.403.074-.904.216-1.482.454-1.949a4.85 4.85 0 0 1 2.12-2.12c.466-.237 1.044-.379 1.948-.453C9.51 4.001 10.675 4 12.3 4h4.512a2 2 0 0 0-.174-.49 2.4 2.4 0 0 0-1.048-1.048 2.4 2.4 0 0 0-.931-.239 14 14 0 0 0-1.026-.023H12.26c-1.576 0-2.814 0-3.81.081-1.014.083-1.856.255-2.62.644A6.65 6.65 0 0 0 2.926 5.83c-.389.763-.56 1.605-.644 2.62-.081.995-.081 2.233-.081 3.809v1.373c0 .392 0 .738.023 1.025.025.306.081.623.239.931a2.4 2.4 0 0 0 1.048 1.05c.162.082.326.136.49.173V12.3zM10.08 6h-.035c-.52 0-.964 0-1.329.03-.383.03-.755.097-1.112.276a2.9 2.9 0 0 0-1.298 1.298c-.179.357-.246.73-.277 1.112C6 9.081 6 9.524 6 10.046v7.909c0 .52 0 .964.03 1.329.03.382.097.755.276 1.112a2.9 2.9 0 0 0 1.298 1.298c.357.179.73.246 1.112.277.365.029.808.029 1.329.029h6.91c.52 0 .964 0 1.329-.03.382-.03.755-.097 1.112-.276a2.9 2.9 0 0 0 1.298-1.298c.179-.357.246-.73.277-1.112.029-.365.029-.808.029-1.33v-7.909c0-.52 0-.964-.03-1.329-.03-.382-.097-.755-.276-1.112a2.9 2.9 0 0 0-1.298-1.298c-.357-.179-.73-.246-1.112-.277C17.919 6 17.476 6 16.954 6zM8.408 7.916c.065-.032.179-.07.452-.093a18 18 0 0 1 1.22-.023h6.84c.565 0 .936 0 1.22.023.273.022.387.06.452.093a1.1 1.1 0 0 1 .492.492c.032.065.07.179.093.452.022.284.023.655.023 1.22v7.84c0 .565 0 .936-.023 1.22-.023.273-.06.387-.093.452a1.1 1.1 0 0 1-.492.492c-.065.032-.18.07-.452.093a18 18 0 0 1-1.22.023h-6.84c-.565 0-.936 0-1.22-.023-.273-.023-.387-.06-.452-.093a1.1 1.1 0 0 1-.492-.492c-.032-.065-.07-.18-.093-.452a17 17 0 0 1-.023-1.22v-7.84c0-.565 0-.936.023-1.22.022-.273.06-.387.093-.452a1.1 1.1 0 0 1 .492-.492" clip-rule="evenodd"></path></svg>');function Rf(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=If();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"copy-icon",role:"img",...i}))),ji(e,r)}var Df=Vi('<svg><!><path fill="var(--btn-color, #fff)" d="M12 20.105a8.105 8.105 0 1 0 0-16.21 8.105 8.105 0 0 0 0 16.21M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-12.372a1.316 1.316 0 1 1 0-2.632 1.316 1.316 0 0 1 0 2.632m-.947 2.822c0-.541.424-.98.947-.98s.947.439.947.98v3.83c0 .54-.424.98-.947.98s-.947-.44-.947-.98z"></path></svg>');function Of(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Df();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"none","aria-hidden":"true","data-testid":"info-icon",role:"img",...i}))),ji(e,r)}var Bf=Ni('<div class="menu-item-value-wrapper svelte-1j7b2kc"><!></div>'),Nf={hash:"svelte-1j7b2kc",code:".menu-item-value-wrapper.svelte-1j7b2kc {line-height:normal;}"};function Vf(e,t){pi(t,!0),mr(e,Nf);let[i,r]=la(),a=()=>oa(n,"$currentQuality$",i),s=Na(),n=s.state.currentQuality$,o=s.state.availableQualities$,l=s.state.isAutoQualityEnabled$,u=s.ui.isMobile,d=ne((()=>(({quality:e,availableQualities:t,isAutoQualityEnabled:i})=>{if(!e)return"...";let r=nf({quality:e,availableQualities:t});return i?e===f.VideoQuality.INVARIANT?$s("auto_quality_invariant"):$s("auto_quality",{actual:r}):r})({quality:a(),availableQualities:oa(o,"$availableQualities$",i),isAutoQualityEnabled:oa(l,"$isAutoQualityEnabled$",i)})));var c=Bf();sf(Oe(c),{get quality(){return a()},get label(){return xt(d)},get isMobile(){return oa(u,"$isMobile$",i)}}),xe(c),ji(e,c),fi(),r()}var Uf={QUALITY_SETTINGS:({isAutoQualityEnabled:e,currentQuality:t,qualityDetailsSubMenuEnabled:i})=>{let r=(e?$s("auto_quality_option"):t)||"";return{id:"QUALITY_SETTINGS",type:"OPEN_SUB_MENU",ariaLabel:$s("aria_label_menu_quality",{actual:r}),icon:wl,label:$s("menu_quality"),value:t,valueComponent:Vf,weight:Sp,children:i?"QUALITY_DETAILS":"QUALITY"}},TRAFFIC_SAVING_SWITCH:({trafficSavingEnabled:e,toggleTrafficSaving:t})=>({id:"TRAFFIC_SAVING_SWITCH",weight:xp,type:"SWITCH",onClick:e=>t(e,"to-video"),ariaLabel:e?$s("aria_label_submenu_traffic_saving_off"):`${$s("aria_label_submenu_traffic_saving_on")}. ${$s("traffic_saving_helper_text")}`,icon:Tf,label:$s("menu_traffic_saving"),enabled:e,tooltipText:$s("traffic_saving_helper_text"),maxTooltipWidth:175}),AUDIO_LANGUAGES:({currentAudioStream:e,availableAudioStreams:t})=>{let i=wf(e,t);return{id:"AUDIO_LANGUAGES",weight:kp,type:"OPEN_SUB_MENU",ariaLabel:$s("aria_label_menu_audio_languages",{actual:i}),icon:xf,label:$s("menu_audio_languages"),value:i,children:"AUDIO_LANGUAGES"}},PLAYBACK_RATE:({availablePlaybackRates:e,currentPlaybackRate:t})=>{let i=e.find((e=>e.value===t))?.displayValue||"";return{id:"PLAYBACK_RATE",weight:Tp,type:"OPEN_SUB_MENU",ariaLabel:$s("aria_label_menu_rate",{actual:i}),icon:Cf,label:$s("menu_playback_rate"),value:`${t}x`,children:"PLAYBACK_RATE_SUB_MENU"}},SUBTITLES:({currentSubtitle:e})=>({id:"SUBTITLES",weight:Ep,type:"OPEN_SUB_MENU",ariaLabel:$s("aria_label_menu_subtitle",{actual:e.displayValue}),icon:$l,label:$s("subtitles_caption"),value:e.displayValue,children:"SUBTITLES"}),DOWNLOAD:({onDownloadClick:e})=>({id:"DOWNLOAD",weight:$p,type:"CLICK",onClick:e,label:$s("download_video_caption"),ariaLabel:$s("aria_label_menu_download"),icon:Pf}),SHOW_SUPPORT:({onReportProblemClick:e})=>({id:"SHOW_SUPPORT",weight:Cp,type:"CLICK",onClick:e,label:$s("menu_report"),ariaLabel:`${$s("menu_report")}. ${$s("aria_label_new_tab_alert")}`,icon:Mf,isHiddenFor:["desktop"]}),COPY_DATA:({onCopyDataClick:e})=>({id:"COPY_DATA",weight:Ap,type:"CLICK",onClick:e,label:$s("menu_copy_debug"),ariaLabel:$s("menu_copy_debug"),icon:Rf,isHiddenFor:["desktop"]}),SAVE_TRACE_INFO:({onSaveTraceDataClick:e})=>({id:"SAVE_TRACE_INFO",weight:Pp,type:"CLICK",onClick:e,label:$s("menu_save_debug"),ariaLabel:$s("menu_save_debug"),icon:Rf,isHiddenFor:["desktop"]}),DEBUG_INFO:({toggleShowDebugInfo:e,debugPanelVisible:t})=>({id:"DEBUG_INFO",weight:Lp,type:"CLICK",onClick:e,label:$s(t?"aria_label_menu_debug_overlay_disable":"aria_label_menu_debug_overlay_enable"),ariaLabel:$s("menu_debug_overlay"),icon:Of,isHiddenFor:["desktop"]})},Ff=(e,t)=>{Cn(e,t)},jf=Ni('<div><div> </div> <div class="close svelte-17or3al"></div></div>'),zf=Ni('<div data-testid="settings-menu"><!> <ul role="menu"></ul></div>'),Wf=Ni("<div><!> <!></div>"),qf={hash:"svelte-17or3al",code:".settings-menu-container.mobile.svelte-17or3al {width:100%;}.settings-menu-container.svelte-17or3al ul {margin:0;padding:0;list-style-type:none;}.settings-menu-container.svelte-17or3al .menu {background-color:var(--settings-bg);border-radius:var(--settings-radius);transition:opacity 0.2s, visibility 0.2s;overflow:hidden;}.settings-menu-container.svelte-17or3al .menu .item:first-child:not(.mobile) {border-top-right-radius:var(--settings-radius);border-top-left-radius:var(--settings-radius);}.settings-menu-container.svelte-17or3al .menu .item:last-child {border-bottom-right-radius:var(--settings-radius);border-bottom-left-radius:var(--settings-radius);}.settings-menu-container.svelte-17or3al .settings-menu .item:first-child:not(.mobile) {padding-top:6px;}.settings-menu-container.svelte-17or3al .settings-menu .item:last-child:not(.mobile) {padding-bottom:6px;}.settings-menu-container.svelte-17or3al .menu.desktop {position:absolute;right:0;bottom:0;max-width:100%;}.settings-menu.svelte-17or3al {line-height:40px;}.settings-menu.desktop.svelte-17or3al {\n    /* нужно чтоб меню не скакало в ширине при смене разрешения, особо актуально при авто режиме */min-width:300px;}.settings-menu-container.svelte-17or3al .menu.mobile {width:100%;background:var(--mobile-settings-bg);font-size:15px;line-height:50px;}.settings-menu-container.svelte-17or3al .menu.mobile.hidden {display:none;}.settings-menu-container.svelte-17or3al .menu .item:not(.switch-item),\n  .settings-menu-container.svelte-17or3al .menu .switch-wrapper {align-items:center;color:var(--white);cursor:pointer;display:flex;justify-content:flex-end;white-space:nowrap;position:relative;}.settings-menu-container.svelte-17or3al .menu .item:hover {background-color:var(--settings-item-bg-hover);}.settings-menu-container.svelte-17or3al .menu .item.mobile:hover {background:var(--mobile-settings-bg);}.settings-menu.svelte-17or3al .item:not(.switch-item),\n  .settings-menu.svelte-17or3al .switch-wrapper {padding:0 32px 0 18px;}.settings-menu.svelte-17or3al .item.mobile:not(.switch-item),\n  .settings-menu.svelte-17or3al .switch-wrapper.mobile {padding:0 14px;}.settings-menu.svelte-17or3al .icon-wrapper {width:24px;min-width:24px;height:24px;display:flex;align-items:center;justify-content:center;margin-right:16px;}.settings-menu.svelte-17or3al .label {flex-grow:1;margin-right:24px;overflow:hidden;text-overflow:ellipsis;}.settings-menu.svelte-17or3al .item.header.mobile:where(.svelte-17or3al) {color:var(--white);cursor:pointer;justify-content:space-between;column-gap:12px;display:flex;border-bottom:var(--divider-border);margin-bottom:4px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar {width:8px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-track {box-shadow:none;background-color:#3a3a3a;border-radius:4px;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-thumb {min-height:40px;border-radius:5px;background-color:#666;border:1px solid transparent;background-clip:padding-box;}.settings-menu-container.svelte-17or3al .items::-webkit-scrollbar-thumb:hover {background-color:#777;}.settings-menu-container.svelte-17or3al .items.mobile {overflow-y:auto;overflow-x:hidden;max-height:160px;text-align:left;}.close.svelte-17or3al {position:relative;width:12px;height:12px;padding:12px;margin-right:-12px;}.close.svelte-17or3al:before, .close.svelte-17or3al:after {position:absolute;left:18px;content:' ';height:12px;width:2px;background-color:var(--white);}.close.svelte-17or3al:before {transform:rotate(45deg);}.close.svelte-17or3al:after {transform:rotate(-45deg);}"};function Hf(e,t){pi(t,!0),mr(e,qf);let[i,r]=la(),a=()=>oa(B,"$settingsMenuVisible",i),s=()=>oa(N,"$settingsMenuOpenedByKeyboard",i),n=()=>oa(H,"$debugPanelVisible",i),o=()=>oa(U,"$isMobile",i),l=()=>oa(q,"$playerSize",i),u=()=>oa(F,"$mobileNotReportControlHidden$",i),d=()=>oa(R,"$availableSubtitlesList$",i),c=()=>oa(E,"$availableAudioStreams$",i),h=()=>oa(M,"$availablePlaybackRates$",i),p=()=>oa(T,"$currentAudioStream$",i),f=()=>oa(z,"$trafficSavingEnabled",i),g=()=>oa(x,"$currentQuality$",i),v=()=>oa(A,"$isAutoQualityEnabled$",i),b=fa(t,"ref",15,void 0),_=fa(t,"playerControlsHeight",3,0),y=Ae({}),w=Ae({}),S=Na(),k=ba(),T=S.state.audioStream$,E=S.state.availableAudioStreams$,x=S.state.currentQuality$,$=S.state.availableQualities$,C=S.state.autoQualityLimitingAvailable$,A=S.state.isAutoQualityEnabled$,P=S.state.isAutoQualityAvailable$,L=S.state.currentPlaybackRate$,M=S.state.availablePlaybackRates$,I=S.state.currentSubtitle$,R=S.state.availableSubtitlesList$,D=S.state.canDownload,O=S.state.hasMpegSources$,B=S.ui.settingsMenu.visible$,N=S.ui.settingsMenu.openedByBtnKeyboard$,V=S.ui.settingsMenu.ref$,U=S.ui.isMobile,F=S.ui.mobileNotReportControlHidden$,j=S.state.canChangePlaybackSpeed$,z=S.state.trafficSavingEnabled$,W=S.state.highQualityEnabled$,q=S.ui.playerSize,H=S.ui.debugPanelVisible,K=S.state.isInteractiveTime$,Q=S.ui.additionalSettingsMenuItems$,G=S.ui.t,Y=S.actions.internal.downloadVideo,X=S.actions.internal.closeSettingsMenu,Z=S.actions.internal.openSettingsSubMenu,J=S.actions.internal.closeSettingsSubMenu,ee=te(!1),ie=te(void 0),ae=(()=>{let e=te(Ae([])),t=ne((()=>(xt(e).length?xt(e).at(-1):null)||null));return{get current(){return xt(t)},pushSubMenu:t=>{xt(e).push(t)},popSubMenu:()=>{re(e,Ae(xt(e).slice(0,-1)))},popAllSubMenus:()=>{re(e,Ae([]))}}})();async function se(e){ae.pushSubMenu(e),await Et(),Z(e,w[e])}function oe(e){e?.stopPropagation(),s()||t.returnFocus?.(),X(),re(ee,!1)}function le(e,t){S.actions.internal.setQuality(e,{appliesTo:t}),oe()}function ue(e){S.actions.internal.setAudioStream(e),oe()}function de(e,t){S.actions.internal.setTrafficSavingEnabled(e,t),k.features.qualityDetailsSubMenuEnabled&&oe()}function ce(e,t){S.actions.internal.setHighQualityEnabled(e,t),oe()}function he(e){S.actions.internal.setPlaybackRate(e),oe()}function pe(e){S.actions.internal.setSubtitle(e),oe()}function fe(){Y()}function me(){(0,m.isValidURL)(t.supportLink)&&window.open(t.supportLink,"_blank"),S.actions.internal.reportProblem(),S.actions.internal.pause()}function ge(){yn(S.actions.internal.getDebugTextData())}Rt((()=>{!a()&&ae.current&&(J(w[ae.current]),ae.popAllSubMenus())})),Rt((()=>{a()||re(ie,void 0)})),Rt((()=>{!ae.current&&xt(ie)&&(async(e,t)=>{setTimeout((()=>{let i=e[t];i&&i.focus()}),100)})(y,xt(ie))})),Rt((()=>{b()&&V.set(b())}));let ve=()=>{let e=S.actions.internal.getTraceTextData(),t=new Blob([...e],{type:"application/json"}),i=window.URL.createObjectURL(t);Da(i,"vk_player_trace_info","json")};function be(){H.set(!n())}function _e(){re(ee,!0)}function ye(){re(ee,!1)}function we(){return o()?`max-height: ${Math.round(.6*l().height)}px`:`max-height: ${l().height-32-_()}px; overflow: auto;`}let Se=ne((()=>D&&oa(O,"$hasMpegSources$",i)&&!u())),ke=ne((()=>k.features.trafficSaving&&!u()&&oa(C,"$autoQualityLimitingAvailable$",i)&&!k.features.qualityDetailsSubMenuEnabled)),Te=ne((()=>d().length>0&&!u())),Ee=ne((()=>!!oa(j,"$isLiveWithPlaybackSpeed",i)&&!u())),$e=ne((()=>k.features.audioLanguages&&c().length>=2&&!u())),Ce=ne((()=>!u()));Xr((()=>K.subscribe((e=>{e&&!o()&&!xt(ee)&&!s()&&oe()}))));let Pe=ne((()=>(({items:e,context:t,additionalSettingsMenuItems:i})=>{let{isMobile:r}=t;return[...e.map((e=>Uf[e](t))),...i.map((e=>({...e,isAdditional:!0})))].filter((e=>!e?.isHiddenFor?.length||!e?.isHiddenFor?.includes("desktop")&&!r||!e?.isHiddenFor?.includes("mobile")&&r)).sort(Wn)})({items:[xt(Ce)&&"QUALITY_SETTINGS",xt($e)&&"AUDIO_LANGUAGES",xt(Ee)&&"PLAYBACK_RATE",xt(Te)&&"SUBTITLES",xt(ke)&&"TRAFFIC_SAVING_SWITCH",xt(Se)&&"DOWNLOAD",k.showSupport&&"SHOW_SUPPORT","COPY_DATA",k.features.saveTraceInfoToFile&&"SAVE_TRACE_INFO","DEBUG_INFO"].filter((e=>!!e)),context:{qualityDetailsSubMenuEnabled:k.features.qualityDetailsSubMenuEnabled,availablePlaybackRates:h(),currentAudioStream:p(),availableAudioStreams:c(),currentPlaybackRate:oa(L,"$currentPlaybackRate$",i),selectPlaybackRate:he,trafficSavingEnabled:f(),toggleTrafficSaving:de,currentQuality:g()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:v()||!1,currentSubtitle:oa(I,"$currentSubtitle$",i),isMobile:o(),onDownloadClick:fe,debugPanelVisible:n(),onCopyDataClick:ge,onReportProblemClick:me,onSaveTraceDataClick:ve,toggleShowDebugInfo:be},additionalSettingsMenuItems:oa(Q,"$additionalSettingsMenuItems$",i)}))),Le=ne((()=>(({subMenuId:e,context:t})=>e?[Sf[e](t)]:[])({subMenuId:ae.current,context:{availablePlaybackRates:h(),selectPlaybackRate:he,trafficSavingEnabled:f(),toggleTrafficSaving:de,currentQuality:g()||m.VideoQuality.INVARIANT,isAutoQualityEnabled:v()||!1,isAutoQualityAvailable:oa(P,"$isAutoQualityAvailable$",i)||!1,availableQualities:oa($,"$availableQualities$",i),highQualityEnabled:oa(W,"$highQualityEnabled",i),toggleHighQuality:ce,availableAudioStreams:c(),availableSubtitlesList:d(),closeSettingsMenu:X,currentAudioStream:p(),isMobile:o(),selectAudioLanguage:ue,selectQuality:le,selectSubtitle:pe}})));var Me=Wf();let Ie;var Re=Oe(Me),De=e=>{var t=zf();let i;t.__keydown=[Ff,X];var r=Oe(t),a=e=>{var t=jf();let i;var r=Oe(t),a=Oe(r,!0);xe(r),Ne(r,2).__click=oe,xe(t),Bt(((e,r)=>{i=wr(t,1,"item header svelte-17or3al",null,i,e),qi(a,r)}),[()=>({mobile:o()}),()=>G("submenu_settings")]),ji(e,t)};Zi(r,(e=>{o()&&e(a)}));var s=Ne(r,2);let n;ar(s,21,(()=>xt(Pe)),(e=>e.id),((e,t)=>{var i=Fi(),r=Be(i),a=e=>{!function(e,t){pi(t,!0),mr(e,jp);let i=fa(t,"isMobile",3,!1),r=fa(t,"onClick",3,m.noop),a=fa(t,"valueComponent",3,void 0),s=fa(t,"ref",15);var n=Fp();let o;n.__click=[Vp,r],n.__keydown=[Np,r];var l=Oe(n),u=Oe(l),d=e=>{wc(e,{get icon(){return t.icon}})},c=e=>{var i=Fi();let r=ne((()=>t.icon));hr(Be(i),(()=>xt(r)),((e,t)=>{t(e,{})})),ji(e,i)};Zi(u,(e=>{"string"==typeof t.icon?e(d):e(c,!1)})),xe(l);var h=Ne(l,2),p=Oe(h,!0);xe(h);var f=Ne(h,2),g=e=>{var t=Fi();let i=ne(a);hr(Be(t),(()=>xt(i)),((e,t)=>{t(e,{})})),ji(e,t)},v=e=>{var i=Up(),r=Oe(i,!0);xe(i),Bt((()=>qi(r,t.value))),ji(e,i)};Zi(f,(e=>{a()?e(g):e(v,!1)})),xe(n),Qr(n,(e=>s(e)),(()=>s())),Bt((e=>{o=wr(n,1,"item",null,o,e),Ar(n,"aria-label",t.ariaLabel),Ar(n,"data-testid",t.id),qi(p,t.label)}),[()=>({mobile:i()})]),ji(e,n),fi()}(e,{get isMobile(){return o()},get id(){return xt(t).id},get icon(){return xt(t).icon},get label(){return xt(t).label},get ariaLabel(){return xt(t).ariaLabel},get value(){return xt(t).value},get valueComponent(){return xt(t).valueComponent},onClick:()=>{se(xt(t).children),re(ie,Ae(xt(t).id))},get ref(){return y[xt(t).id]},set ref(e){y[xt(t).id]=e}})},s=(e,i)=>{var r=e=>{!function(e,t){pi(t,!0),mr(e,Kp);let i=fa(t,"isMobile",3,!1),r=fa(t,"onClick",3,m.noop),a=fa(t,"closeSettings",3,m.noop),s=te(!1),n=()=>{re(s,!0)},o=e=>{e?.stopPropagation(),r()(),a()()};var l=Hp();let u;l.__click=o,l.__keydown=[zp,o];var d=Oe(l),c=Oe(d),h=e=>{var i=Fi(),r=Be(i),a=e=>{ji(e,Wp())},o=e=>{var i=qp();Bt((()=>Ar(i,"src",t.icon))),Ii("error",i,n),Li(i),ji(e,i)};Zi(r,(e=>{xt(s)?e(a):e(o,!1)})),ji(e,i)},p=e=>{var i=Fi();let r=ne((()=>t.icon));hr(Be(i),(()=>xt(r)),((e,t)=>{t(e,{})})),ji(e,i)};Zi(c,(e=>{"string"==typeof t.icon?e(h):e(p,!1)})),xe(d);var f=Ne(d,2),g=Oe(f,!0);xe(f),xe(l),Bt((e=>{u=wr(l,1,"item",null,u,e),Ar(l,"aria-label",t.ariaLabel??t.label),Ar(l,"data-testid",t.id),qi(g,t.label)}),[()=>({mobile:i()})]),ji(e,l),fi()}(e,{get isMobile(){return o()},get id(){return xt(t).id},get onClick(){return xt(t).onClick},get icon(){return xt(t).icon},get label(){return xt(t).label},get ariaLabel(){return xt(t).ariaLabel},closeSettings:oe})},a=(e,i)=>{var r=e=>{ef(e,{get isMobile(){return o()},get id(){return xt(t).id},get onClick(){return xt(t).onClick},get icon(){return xt(t).icon},get label(){return xt(t).label},get ariaLabel(){return xt(t).ariaLabel},get enabled(){return xt(t).enabled},get tooltipText(){return xt(t).tooltipText},get maxTooltipWidth(){return xt(t).maxTooltipWidth}})};Zi(e,(e=>{"SWITCH"===xt(t).type&&e(r)}),i)};Zi(e,(e=>{"CLICK"===xt(t).type?e(r):e(a,!1)}),i)};Zi(r,(e=>{"OPEN_SUB_MENU"===xt(t).type?e(a):e(s,!1)})),ji(e,i)})),xe(s),Qr(s,(e=>b(e)),(()=>b())),xe(t),Bt(((e,r,a)=>{i=wr(t,1,"settings-menu menu svelte-17or3al",null,i,e),n=wr(s,1,"items",null,n,r),kr(s,a)}),[()=>({desktop:!o(),mobile:o(),hidden:!!ae.current}),()=>({mobile:o()}),we]),Ii("mouseenter",t,_e),Ii("mouseleave",t,ye),ji(e,t)};Zi(Re,(e=>{a()&&e(De)})),ar(Ne(Re,2),17,(()=>xt(Le)),(e=>e.id),((e,t)=>{let i=ne((()=>xt(t).minWidth??137));Bp(e,{get isMobile(){return o()},get playerControlsHeight(){return _()},get returnFromSubMenu(){return ae.popSubMenu},get id(){return xt(t).id},get title(){return xt(t).title},closeSettingsMenu:X,openSubMenuList:se,get items(){return xt(t).items},get minWidth(){return xt(i)},get refMenuItems(){return y},get listRef(){return w[xt(t).id]},set listRef(e){w[xt(t).id]=e}})})),xe(Me),Bt((e=>Ie=wr(Me,1,"settings-menu-container svelte-17or3al",null,Ie,e)),[()=>({mobile:o(),hidden:!a()})]),ji(e,Me),fi(),r()}Ri(["keydown","click"]);var Kf=e=>e;function Qf(e,{delay:t=0,duration:i=400,easing:r=Kf}={}){let a=+getComputedStyle(e).opacity;return{delay:t,duration:i,easing:r,css:e=>"opacity: "+e*a}}var Gf=Ni('<button class="button svelte-1sbbskl"> </button>'),Yf={hash:"svelte-1sbbskl",code:".button.svelte-1sbbskl {margin-top:12px;font-size:14px;line-height:18px;background:rgba(255, 255, 255, 0.1);padding:6px 12px 7px;border-radius:8px;}"};Ri(["click"]);var Xf=Ni('<div class="container svelte-1es7arp"><div class="notification svelte-1es7arp"><div><p class="description svelte-1es7arp"><!></p> <!></div> <!></div></div>'),Zf={hash:"svelte-1es7arp",code:".container.svelte-1es7arp {position:absolute;left:0;right:0;top:20px;display:flex;justify-content:center;\n    /**\n    *  Если не отключим у контейнера события, то не сможем по этой области вызвать контекстное меню.\n    */pointer-events:none;}.notification.svelte-1es7arp {padding:9px 14px 10px 12px;background:var(--notification-bg);display:inline-flex;border-radius:var(--notification-radius);gap:10px;pointer-events:auto;}.description.svelte-1es7arp {line-height:16px;font-size:13px;margin:0;white-space:pre;}"};function Jf(e,t){pi(t,!0),mr(e,Zf);let{features:{forceAutoQualityWhenSevereStallHappens:i}}=ba(),{ui:{t:r}}=Na(),a=r(i?"slow_video_notification_force_description":"slow_video_notification_suggest_description");var s=Xf(),n=Oe(s),o=Oe(n),l=Oe(o);hf(Oe(l),{message:a}),xe(l);var u=Ne(l,2),d=e=>{let i=ne((()=>r("slow_video_notification_button")));!function(e,t){mr(e,Yf);var i=Gf();i.__click=function(...e){t.onClick?.apply(this,e)};var r=Oe(i,!0);xe(i),Bt((()=>qi(r,t.label))),ji(e,i)}(e,{get label(){return xt(i)},get onClick(){return t.onSelectAutoQuality}})};Zi(u,(e=>{i||e(d)})),xe(o),ko(Ne(o,2),{get onClick(){return t.onClose}}),xe(n),xe(s),function(e,t,i,r){var a,s,n,o,l=!!(1&e),u=!!(2&e),d=!!(4&e),c=l&&u?"both":l?"in":"out",h=t.inert,p=t.style.overflow;function f(){var e=Ge,a=Ze;Xe(null),Je(null);try{return s??(s=i()(t,r?.()??{},{direction:c}))}finally{Xe(e),Je(a)}}var m={is_global:d,in(){if(t.inert=h,!l)return o?.abort(),void o?.reset?.();u||n?.abort(),Vr(t,"introstart"),n=zr(t,f(),o,1,(()=>{Vr(t,"introend"),n?.abort(),n=s=void 0,t.style.overflow=p}))},out(e){if(!u)return e?.(),void(s=void 0);t.inert=!0,Vr(t,"outrostart"),o=zr(t,f(),n,0,(()=>{Vr(t,"outroend"),e?.()}))},stop:()=>{n?.abort(),o?.abort()}},g=Ze;if(((a=g).transitions??(a.transitions=[])).push(m),l&&zi){var v=d;if(!v){for(var b=g.parent;b&&65536&b.f;)for(;(b=b.parent)&&!(16&b.f););v=!b||!!(32768&b.f)}v&&Dt((()=>{$t((()=>m.in()))}))}}(3,n,(()=>Qf),(()=>({duration:340}))),ji(e,s),fi()}var em="annotation",tm=class{init(e,t){this.shadowRootContainer=e,this.store=t}add(e,t){let{overlay:i,id:r,controlsBehaviour:a,hideAllControls:s}=t;e.setAttribute("slot",em),this.setupSlotStyles(e,i),this.shadowRootContainer.append(e),this.slots.set(r,{rootElement:e,options:t}),a&&this.runHidingControlsWhenIntersected(r,a),s&&this.store?.ui.isControlsAvailable.set(!1)}setupSlotStyles(e,t){switch(e.style.position="absolute",t){case"over_video":e.style.zIndex="calc(var(--video-container-z-index) + 1)";break;case"over_controls":e.style.zIndex="calc(var(--controls-container-z-index) + 1)";break;default:e.style.zIndex="0"}}async runHidingControlsWhenIntersected(e,{observedSlotElementId:t,controlsToObserve:i}){let r=this.slots.get(e);if(!r)return;let a=await this.findSlotElement(r.rootElement,t,e),s=(e,t)=>!(e.right<t.left||e.left>t.right||e.bottom<t.top||e.top>t.bottom),{controls:n,hiddenControls:o}=this.store?.ui||{},l=new MutationObserver((e=>e.forEach((()=>{let e=yd(a,this.shadowRootContainer);i.forEach((t=>{let i=n?.[t],r=i?aa(i):null,a=o?.[t];r&&a?.set(s(r,e))}))}))));l.observe(a,{childList:!0,subtree:!0}),r.observer=l;let u=new m.Subscription;i.forEach((e=>{n&&u.add(n[e].subscribe((t=>{let i=o?.[e];t&&i?.set(s(t,yd(a,this.shadowRootContainer)))})))})),r.subs=u}async findSlotElement(e,t,i){return new Promise((r=>{let a=null,s=new MutationObserver((()=>{if(a=e.querySelector(`#${t}`),a){s.disconnect();let e=this.slots.get(i);e&&(e.observerForFindingSlotElement=void 0),r(a)}}));s.observe(e,{childList:!0,subtree:!0});let n=this.slots.get(i);n&&(n.observerForFindingSlotElement=s)}))}remove(e){let t=this.slots.get(e);if(!t)return;let{rootElement:i,observer:r,observerForFindingSlotElement:a,subs:s,options:{controlsBehaviour:n,hideAllControls:o}}=t;i&&i.remove(),[r,a].forEach((e=>e?.disconnect())),s?.unsubscribe(),this.slots.delete(e),o&&this.store?.ui.isControlsAvailable.set(!0),n?.controlsToObserve?.forEach((e=>{this.store?.ui.hiddenControls[e]?.set(!1)}))}destroy(){for(let e in this.slots.keys())this.remove(e);this.slots.clear()}haveSlots(){return this.slots.size>0}constructor(){this.slots=new Map}},im=Ni('<div class="container svelte-f47ws8"><div class="playback_state_icon svelte-f47ws8"><!></div></div>'),rm={hash:"svelte-f47ws8",code:".container.svelte-f47ws8 {position:absolute;display:flex;width:100%;height:100%;align-items:center;justify-content:center;pointer-events:none;}.playback_state_icon.svelte-f47ws8 {display:flex;align-items:center;justify-content:center;width:64px;height:64px;border-radius:100%;background-color:#00000073;will-change:opacity, scale;\n\n    animation-name: svelte-f47ws8-videoPlayerStatusIconPopup;animation-fill-mode:forwards;}\n\n  @keyframes svelte-f47ws8-videoPlayerStatusIconPopup {\n    from {\n      opacity: 0;\n      scale: 0.6;\n    }\n\n    10% {\n      opacity: 1;\n      scale: 1;\n      animation-timing-function: ease-in;\n    }\n\n    75% {\n      opacity: 1;\n      scale: 1;\n    }\n\n    90% {\n      opacity: 0;\n      scale: 0.4;\n      animation-timing-function: ease-out;\n    }\n\n    to {\n      opacity: 0;\n      scale: 0;\n    }\n  }"};var am=Ni('<div><div data-testid="video-container"></div></div>'),sm={hash:"svelte-1czns9r",code:".video-wrapper.svelte-1czns9r,\n  .video-container.svelte-1czns9r {position:absolute;width:100%;height:100%;left:0;top:0;}.video-wrapper.svelte-1czns9r {z-index:var(--video-container-z-index);background:var(--black);}.video-container.svelte-1czns9r {z-index:var(--video-container-z-index);transition:var(--rotate-transition-duration) ease all;}.video-container.fast-rotate.svelte-1czns9r {transition:none;}.nocursor.svelte-1czns9r {cursor:none;}"};function nm(e,t){pi(t,!0),mr(e,sm);let[i,r]=la(),a=()=>oa(l,"$rotateAlpha",i),s=()=>oa(u,"$playerSize",i),n=fa(t,"videoContainer",15),{playerPhase:o,ui:{rotateAlpha:l,playerSize:u},state:{isPlaying$:d}}=Na(),{isSmoothVideoRotate:c}=ba(),h=ne((()=>n()&&a()%180?s().height/s().width:1));var p=am();let f;p.__contextmenu=function(...e){t.onContextMenu?.apply(this,e)},p.__mousedown=function(...e){t.onMouseDown?.apply(this,e)},p.__mouseup=function(...e){t.onMouseUp?.apply(this,e)},p.__click=function(...e){t.onClick?.apply(this,e)},p.__dblclick=function(...e){t.onDblClick?.apply(this,e)};var m=Oe(p);wr(m,1,"video-container svelte-1czns9r",null,{},{"fast-rotate":!c}),Qr(m,(e=>n(e)),(()=>n())),xe(p),Bt((e=>{f=wr(p,1,"video-wrapper svelte-1czns9r",null,f,e),kr(m,`transform: rotate(${a()}deg) scale(${xt(h)})`),Ar(m,"data-is-playing",oa(d,"$isPlaying$",i))}),[()=>({hidden:"video"!==oa(o,"$playerPhase",i),nocursor:t.hideCursor})]),ji(e,p),fi(),r()}Ri(["contextmenu","mousedown","mouseup","click","dblclick"]);var om=(e,t,i,r,a,s)=>{e.stopPropagation(),(t()||r())&&s()},lm=Ni("<div><!></div>"),um=Ni('<div class="spherical-video-icon svelte-jtgjmv"><!></div>'),dm=Ni("<div><!></div>"),cm=Ni('<div class="settings-menu svelte-jtgjmv"><!></div>'),hm=Ni("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),pm=Ni("<!> <!> <!>",1),fm=Ni('<div class="blocked svelte-jtgjmv"></div>'),mm=Ni('<div class="player-wrapper svelte-jtgjmv"><!> <div class="overlay-container"></div></div> <!>',1),gm={hash:"svelte-jtgjmv",code:".player-wrapper.svelte-jtgjmv {position:absolute;width:100%;height:100%;}.blocked.svelte-jtgjmv {position:absolute;width:100%;height:100%;z-index:var(--overlay-container-z-index);}.player-wrapper.svelte-jtgjmv .player-media {position:absolute;left:0;top:0;width:100%;height:100%;background:var(--black);transition:transform 0.2s ease-in-out;}.spherical-video-icon.svelte-jtgjmv {display:inline-block;position:absolute;top:calc(50% - 23px);left:calc(50% - 38px);}.ads-container.svelte-jtgjmv {position:absolute;width:100%;height:100%;left:0;top:0;}.ads-container.svelte-jtgjmv {z-index:var(--ads-container-z-index);background:var(--black);}.settings-menu.svelte-jtgjmv {position:absolute;z-index:var(--settings-menu-z-index);bottom:57px;right:18px;left:0;transition:opacity 0.2s, visibility 0.2s;}"};function vm(e,t){pi(t,!0),mr(e,gm);let i,r,a,[s,n]=la(),o=()=>oa(oe,"$playerPhase",s),l=()=>oa(Ee,"$crashed",s),u=()=>oa(Ve,"$isInteractiveTime$",s),d=()=>oa(ce,"$settingsMenuVisible",s),c=()=>oa(de,"$controlsVisible",s),h=()=>oa(it,"$graphIsOpened$",s),p=()=>oa(le,"$isFullscreen",s),m=()=>oa(Xe,"$autoplayNextEnabled$",s),g=()=>oa(_e,"$isEnded$",s),v=()=>oa(Je,"$isControlsAvailable",s),b=()=>oa(ft,"$bottomNoSmooth",s),_=()=>oa(He,"$interactiveTimeIndicator",s),y=()=>oa(Me,"$playerSize",s),w=()=>oa(Ie,"$is3DVideo",s),S=()=>oa(me,"$contextMenuVisible$",s),k=()=>oa(ee,"$playbackState$",s),T=()=>oa(pe,"$scrubbingInProgress",s),E=()=>oa(ye,"$chromecastConnected$",s),x=()=>oa(he,"$settingsMenuOpenedByKeyboard",s),$=()=>oa(ii,"$contextMenuOpenedByKeyboard$",s),C=()=>oa(si,"$contextMenuOpenedByHotKey$",s),A=()=>oa(J,"$language$",s),P=()=>oa(ae,"$position$",s),L=()=>oa(se,"$duration$",s),M=fa(t,"videoContainer",15),I=fa(t,"adsSlotId",3,void 0),R=fa(t,"adsParams",3,void 0),D=fa(t,"adsPreviewParam",3,void 0),O=fa(t,"adsAutoplayParam",3,void 0),B=fa(t,"duration",3,void 0),N=fa(t,"logoTargetUrl",3,""),V=fa(t,"showNextPrevButtons",3,!1),U=fa(t,"nextButtonActive",3,!1),F=fa(t,"prevButtonActive",3,!1),j=fa(t,"endScreenVideoTitle",3,void 0),z=fa(t,"endScreenVideoThumb",3,void 0),W=fa(t,"isOneVideoPlaylist",3,!1),q=fa(t,"shadowRootContainer",3,void 0),H=fa(t,"outerContainerRef",3,void 0),K=fa(t,"playerStarted",3,!1),Q=fa(t,"fullScreenTarget",3,void 0),G=fa(t,"showMiniTimer",3,!1),Y=fa(t,"showEndScreen",3,!0),X=fa(t,"keyboardControls",15),Z=t.store.getLogger().createComponentLog("Root component"),J=t.store.interfaceLanguage$,ee=t.store.state.playbackState$,ie=t.store.ads.playbackState,ae=t.store.state.positionWithScrubbing$,se=t.store.state.duration$,oe=t.store.playerPhase,le=t.store.ui.isFullscreen,ue=t.store.ui.isFullscreenOpenedByKeyboard,de=t.store.ui.controlsVisible,ce=t.store.ui.settingsMenu.visible$,he=t.store.ui.settingsMenu.openedByBtnKeyboard$,pe=t.store.ui.scrubbingInProgress,fe=t.store.ui.volumeChangingInProgress,me=t.store.ui.contextMenu.visible$,ge=t.store.ui.debugPanelVisible,ve=t.store.state.isLoaderVisible,_e=t.store.state.isEnded$,ye=t.store.state.chromecastConnected$,we=t.store.state.chromecastDeviceName$,Se=t.store.ads.postrollPassed,ke=t.store.state.isLive$,Te=t.store.state.isPlaying$,Ee=t.store.state.crashed$,$e=t.store.webApi.annotationsApi,Ce=t.store.webApi.pictureInPictureApi,Pe=t.store.state.currentSubtitle$,Le=t.store.state.currentSubtitleCaptions$,Me=t.store.ui.playerSize,Ie=t.store.ui.is3DVideo,Re=t.store.ui.icon3DVideoVisible,De=t.store.state.isInteractive,Ve=t.store.state.isInteractiveTime$,Ue=t.store.state.isInteractiveExpectation$,Fe=t.store.state.hasInteractiveBranches,je=t.store.ui.touched,ze=t.store.ui.modals.hotKeyMap.data,We=t.store.ui.modals.hotKeyMap.show,qe=t.store.ui.overlayContainer$,He=t.store.ui.controls.interactiveTimeIndicator,Ke=t.store.state.showInteractiveTimeIndicator,Qe=t.store.ui.contextMenu.position$,Ge=t.store.actions.internal.setQuality,Ye=t.store.actions.internal.closeSettingsMenu,Xe=t.store.ui.autoplayNextEnabled$,Ze=t.store.ui.userActionsDisabled,Je=t.store.ui.isControlsAvailable,{fakeIsPlaying$:et,notifications$:tt,graphIsOpened$:it}=Va(),rt=te(void 0),at=te(void 0),st=te(void 0),nt=te(void 0);ze.set({title:$s("hotkey_map_modal_title"),closeBtnText:$s("hotkey_map_modal_close_btn_text"),groups:[{title:$s("hotkey_map_group_title_common"),items:[{description:$s("hotkey_map_item_mute_description"),value:$s("hotkey_map_item_mute_value")},{description:$s("hotkey_map_item_volume_up_description"),value:$s("hotkey_map_item_volume_up_value")},{description:$s("hotkey_map_item_volume_down_description"),value:$s("hotkey_map_item_volume_down_value")},{description:$s("hotkey_map_item_pip_description"),value:$s("hotkey_map_item_pip_value")},{description:$s("hotkey_map_item_full_screen_description"),value:$s("hotkey_map_item_full_screen_value")},{description:$s("hotkey_map_item_show_context_menu_description"),value:$s("hotkey_map_item_show_context_menu_value")},{description:$s("hotkey_map_item_show_hotkey_map_description"),value:$s("hotkey_map_item_show_hotkey_map_value")}]},{title:$s("hotkey_map_group_title_playback"),items:[{description:$s("hotkey_map_item_play_toggle_description"),value:$s("hotkey_map_item_play_toggle_value")},{description:$s("hotkey_map_item_seek_backward_description"),value:$s("hotkey_map_item_seek_backward_value")},{description:$s("hotkey_map_item_seek_forward_description"),value:$s("hotkey_map_item_seek_forward_value")},{description:$s("hotkey_map_item_fast_seek_backward_description"),value:$s("hotkey_map_item_fast_seek_backward_value")},{description:$s("hotkey_map_item_fast_seek_forward_description"),value:$s("hotkey_map_item_fast_seek_forward_value")},{description:$s("hotkey_map_item_rate_down_description"),value:$s("hotkey_map_item_rate_down_value")},{description:$s("hotkey_map_item_rate_up_description"),value:$s("hotkey_map_item_rate_up_value")},{description:$s("hotkey_map_item_prev_frame_description"),value:$s("hotkey_map_item_prev_frame_value")},{description:$s("hotkey_map_item_next_frame_description"),value:$s("hotkey_map_item_next_frame_value")},{description:$s("hotkey_map_item_jump_seek_description"),value:$s("hotkey_map_item_jump_seek_value")},{description:$s("hotkey_map_item_next_video_description"),value:$s("hotkey_map_item_next_video_value")},{description:$s("hotkey_map_item_prev_video_description"),value:$s("hotkey_map_item_prev_video_value")}]},{title:$s("hotkey_map_group_title_subtitles"),items:[{description:$s("hotkey_map_item_subtitles_toggle_description"),value:$s("hotkey_map_item_subtitles_toggle_value")}]},{title:$s("hotkey_map_group_title_episodes"),items:[{description:$s("hotkey_map_item_prev_episode_description"),value:f.clientChecker.device.isApple?$s("hotkey_map_item_prev_episode_mac_value"):$s("hotkey_map_item_prev_episode_pc_value")},{description:$s("hotkey_map_item_next_episode_description"),value:f.clientChecker.device.isApple?$s("hotkey_map_item_next_episode_mac_value"):$s("hotkey_map_item_next_episode_pc_value")}]}]});let ot,{closeNotification:lt,notificationsToShow$:ut}=tt,dt=ne((()=>!!oa(ut,"$notificationsToShow$",s).slow_video)),ct=()=>lt("slow_video"),ht=ne((()=>("video"===o()&&oa(ve,"$isLoaderVisible",s)||"ads"===o()&&"inactive"===oa(ie,"$adPlaybackState",s))&&!l())),pt=te(void 0),ft=ia(!1),mt=ia(!1),gt=ia(),vt=ia(!1),bt=te(!1),_t=te(!1),yt=te(!1),wt=te(!(t.autoplay&&!t.uiConfig.controls.showOnStartupAtAutoplay)),St=ne((()=>u()&&!d()&&!(xt(bt)||xt(_t))&&!(xt(yt)&&!oa(Ue,"$isInteractiveExpectation$",s)))),kt=!0,Tt=ne((()=>t.uiConfig.features.thumbTimer&&G()&&"video"===o()&&!c()&&!l()&&!De&&(t.uiConfig.hideThumbTimerAfterTouch&&!oa(je,"$touched",s)||!t.uiConfig.hideThumbTimerAfterTouch))),Ct=ne((()=>"video"===o()&&!h()&&p())),At=te(!1),Pt=ne((()=>(Y()||t.showAutoplayNext&&m())&&!!j()&&!!z()&&(t.showAds&&oa(Se,"$postrollPassed",s)||!t.showAds)&&g()&&!l()&&!xt(At))),Lt=ne((()=>oa(vt,"$cursorInside",s)&&!(c()||xt(Pt))&&!u()&&v())),Mt=te(!1),It=ne((()=>null!==oa(et,"$fakeIsPlaying$",s))),{toggle:Dt}=et,Ot=!1,Nt=null;Ce?.setContext(hi());t.store.setUiCallbacks({onStarted:()=>{t.autoplay&&!De&&t.uiConfig.controls.showOnStartupAtAutoplay&&Vt(t.uiConfig.controls.hideTimeout)}});let Vt=e=>{window.clearTimeout(i),mt.set(!1),mt.set(!0),i=window.setTimeout((()=>mt.set(!1)),e);let t=e-100;ot=window.setTimeout((()=>{b()&&ft.set(!1)}),t>0?t:e)},Ut=(e,t)=>{window.clearTimeout(r),gt.set(null),gt.set(t),r=window.setTimeout((()=>gt.set(null)),e)},Ft=Ie.subscribe((e=>{Re.set(e),e&&(window.clearTimeout(a),a=window.setTimeout((()=>Re.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),jt=async()=>{let e=qs();if(e){let t=Ws();e=t===qt()||t===q()}if(e){Vt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(Ce?.remove())}catch(e){Z({message:String(e)})}}le.set(e),t.store.getAdmanWrapper().setFullscreen(e),p()?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},zt=e=>{let{width:t,height:i}=e.target;Me.set({width:t,height:i})},Wt=()=>{let{width:e,height:t}=xt(rt).getBoundingClientRect();Me.set({width:e,height:t})};Xr((()=>(Hs(jt),t.uiConfig.features.annotationsInside&&$e?.init(xt(rt)),Gs(Ce)&&(Ce?.assignPlayerContainer(xt(rt)),Ce?.registryExternalEventHandlers({resize:zt,leavepictureinpicture:Wt})),t.interactiveContainer&&M().parentElement?.insertBefore(t.interactiveContainer,M().nextSibling),()=>{window.clearTimeout(i),window.clearTimeout(ot),window.clearTimeout(r),window.clearTimeout(a),Ft(),Ce?.dispose().catch((e=>{Z({message:String(e)})})),Ks(jt)})));let qt=()=>{let e=t.uiConfig.features.fullscreenInternalTargetPlayerContainer||!H()?xt(rt):H(),i=e.getRootNode(),r=i instanceof ShadowRoot?i.host:i,a=Q()instanceof HTMLElement&&Q().contains(r);return t.uiConfig.allowChangingFullscreenTarget&&Q()&&a?Q():e},Ht=async()=>{qs()?(await zs(document),Z({message:"exit fullscreen"})):(Z({message:"request fullscreen"}),await js(qt()))},Kt=()=>{Ye(),me.set(!1)},Qt=e=>{h()||(e.preventDefault(),me.set(!0),Qe.set({left:e.clientX,top:e.clientY}))};function Gt(e){return e?e.offsetTop+Gt(e.offsetParent):0}function Yt(e){return e?e.offsetLeft+Yt(e.offsetParent):0}function Xt(e){if(_()&&Ke){let t=e.currentTarget,i=Gt(t),r=Yt(t),a=e.pageX-r,s=e.pageY-i,{left:n,bottom:o,right:l}=_(),u=l-n;return a>=n-u&&s<=o+u}}let Zt=e=>{e.preventDefault(),0===e.button&&(Ot=!0,t.store.actions.internal.holdCamera()),Vt(t.uiConfig.controls.hideTimeoutCursor)},Jt=e=>{e.preventDefault(),0===e.button&&(Nt=e,Ot=!1,t.store.actions.internal.releaseCamera()),Vt(t.uiConfig.controls.hideTimeoutCursor)},ei=e=>{e.preventDefault(),Z({message:"double click on video"}),Ht(),Vt(t.uiConfig.controls.hideTimeoutCursor)},ti=e=>{if(e.preventDefault(),S()||d())Kt();else if(!g()||Fe){if(xt(It))return Dt();if(X()?.focus(),!K())return t.firstStart(),void Vt(t.uiConfig.controls.hideTimeoutCursor);(!t.uiConfig.preventPauseOnVideoClick||k()!==f.PlaybackState.PLAYING)&&t.store.actions.internal.togglePlay(),Vt(t.uiConfig.controls.hideTimeoutCursor)}},ii=t.store.ui.contextMenu.openedByBtnKeyboard$,ri=t.store.ui.contextMenu.btnRef$,ai=te(void 0),si=t.store.ui.contextMenu.openedByHotKey$,ni=t.store.ui.contextMenu.lastActiveElem$;Rt((()=>{qe.set(xt(pt))})),Rt((()=>{re(yt,Ae(xt(wt)&&k()!==f.PlaybackState.PLAYING)),xt(wt)||$t((()=>re(wt,!0)))})),Rt((()=>{de.set((xt(yt)||g()||d()||T()||oa(fe,"$volumeChangingInProgress",s)||E()||oa(mt,"$controlsTimeoutActive",s))&&!xt(St)&&("video"===o()||"ads"===o())&&!l()&&v())})),Rt((()=>{!T()&&xt(Mt)&&!u()&&Vt(t.uiConfig.controls.hideTimeoutCursor),$t((()=>re(Mt,Ae(T()))))})),Rt((()=>{xt(nt),d(),x(),$t((()=>$n(xt(nt),d(),x())))})),Rt((()=>{xt(ai),S(),$(),$t((()=>$n(xt(ai),S(),$())))})),Rt((()=>{let e=oa(ri,"$contextMenuButtonRef$",s);e&&(S(),$t((()=>xn(e,S(),ii))))})),Rt((()=>{xt(ai),S(),C(),$t((()=>$n(xt(ai),S(),C())))})),Rt((()=>{let e=oa(ni,"$contextMenuLastActiveElem$",s);e&&(S(),$t((()=>(async(e,t,i)=>{await Et(),e&&!t&&aa(i)&&(i.set(!1),e.focus())})(e,S(),si))))})),Rt((()=>{!oa(ue,"$isFullscreenOpenedByKeyboard",s)&&p()&&($t((()=>ue.set(!1))),X()?.focus())})),Rt((()=>{h()&&Kt()}));let oi=$s("video360");var li=mm();Ii("blur",be,Kt);var ui=Be(li);ui.__mousemove=function(e){(function(e){if(xt(rt)){let t=Gt(e.currentTarget),i=y().height,r=e.pageY-t;if(Xt(e))return void re(_t,!1);r<40?re(_t,!0):r>i-40?re(bt,!0):(re(_t,!1),d()||re(bt,!1))}})(e),xt(St)||Vt(t.uiConfig.controls.hideTimeoutCursor),w()&&Ot&&Nt&&t.store.actions.internal.moveCameraFocusPX(Nt.clientX-e.clientX,Nt.clientY-e.clientY,e.timeStamp-Nt.timeStamp),Nt=e};var di=Oe(ui);let ci=ne((()=>"ads"===o())),mi=ne((()=>xt(It)?Dt:void 0));Qr(Vo(di,{toggleFullscreen:Ht,hideContextMenu:Kt,showHotKeyHelpers:e=>{Kt(),je.set(!0),Vt(t.uiConfig.controls.hideTimeout),e&&Ut(t.uiConfig.controls.hideHotKeyHelpers,e)},showKeyMap:()=>{Kt(),t.store.callbacks?.onOpenHotKeyMap?t.store.callbacks?.onOpenHotKeyMap(oa(ze,"$hotKeyMapData",s)):We.update((e=>!e))},get isAds(){return xt(ci)},get fakePlayButtonHandler(){return xt(mi)},get nextButtonActive(){return U()},get prevButtonActive(){return F()},children:(e,i)=>{var r=pm(),a=Be(r);nm(a,{get hideCursor(){return xt(Lt)},onClick:ti,onContextMenu:Qt,onMouseDown:Zt,onMouseUp:Jt,onDblClick:ei,get videoContainer(){return M()},set videoContainer(e){M(e)}});var n=Ne(a,2);pr(n,(()=>"slot"),!1,((e,t)=>{Pr(e,null,{name:em})})),Ji(Ne(n,2),A,(e=>{var i=hm(),r=Be(i);let a=ne((()=>"thumb"!==o()||l()||De&&t.autoplay));Hh(r,{get hidden(){return xt(a)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart}});var n=Ne(r,2);!function(e,t){pi(t,!0),mr(e,rm);let[i,r]=la(),a=()=>oa(n,"$isPlaying$",i),s=()=>oa(o,"$aboutToGoNextVideo",i),{state:{isPlaying$:n},ui:{aboutToGoNextVideo:o},actions:l}=Na(),{features:{playbackStatusShow:u,playbackStatusAnimationDuration:d,playbackStatusNextVideoAnimationDuration:c}}=ba(),h=0,p=te(null),f=te(!1);Rt((()=>{re(p,Ae(a()?ec:ic))})),Rt((()=>{re(p,Ae(s()?jd:null))})),Rt((()=>{if(u)return h=window.setTimeout((()=>{h=0,s()&&xt(p)===jd&&("next"===s()?l.internal.nextVideoClick(!1):l.internal.prevVideoClick(!1)),re(p,null)}),xt(p)!==jd?d:c),()=>{h&&(window.clearTimeout(h),h=0)}})),Rt((()=>{a()&&!xt(f)&&(re(f,!0),re(p,null))}));var m=Fi(),g=Be(m),v=e=>{var t=Fi();Ji(Be(t),(()=>xt(p)),(e=>{var t=im(),i=Oe(t),r=Oe(i);let a=ne((()=>"prev"===s()));hr(r,(()=>xt(p)),((e,t)=>{t(e,{width:"40",height:"40",viewBox:"0 0 24 24",get isPrev(){return xt(a)}})})),xe(i),xe(t),Bt((()=>kr(i,`animation-duration: ${xt(p)!==jd?d:c}ms`))),ji(e,t)})),ji(e,t)};Zi(g,(e=>{xt(p)&&u&&e(v)})),ji(e,m),fi(),r()}(n,{});var u=Ne(n,2),h=e=>{let i=ne((()=>t.live?.startTime));op(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return xt(i)}})};Zi(u,(e=>{"LiveWaitingStart"===o()&&e(h)}));var p=Ne(u,2),f=e=>{dp(e,{kind:"recover",get thumbUrl(){return t.thumbUrl}})};Zi(p,(e=>{"LiveWaitingRecover"===o()&&e(f)}));var g=Ne(p,2),v=e=>{dp(e,{kind:"record",get thumbUrl(){return t.thumbUrl}})};Zi(g,(e=>{"LiveWaitingRecord"===o()&&e(v)}));var _=Ne(g,2),k=e=>{var t=lm();let i;nn(Oe(t),{get adsSlotId(){return I()},get adsParams(){return R()},get adsPreviewParam(){return D()},get adsAutoplayParam(){return O()},get duration(){return B()}}),xe(t),Bt((e=>i=wr(t,1,"ads-container svelte-jtgjmv",null,i,e)),[()=>({hidden:"ads"!==o()})]),ji(e,t)};Zi(_,(e=>{t.showAds&&K()&&e(k)}));var T=Ne(_,2),x=e=>{let i=ne((()=>!Y()&&t.showAutoplayNext&&m()));Po(e,{get title(){return j()},get thumb(){return z()},get isHide(){return xt(i)},clickCloseIcon:()=>re(At,!0)})};Zi(T,(e=>{xt(Pt)&&j()&&z()&&e(x)}));var $=Ne(T,2),C=e=>{let i=ne((()=>!c()));!function(e,t){mr(e,Qh);let i=fa(t,"title",3,""),r=fa(t,"isHidden",3,!1);var a=Kh();let s;var n=Oe(a,!0);xe(a),Bt((e=>{s=wr(a,1,"title svelte-1bcvcf2",null,s,e),qi(n,i())}),[()=>({hidden:r()})]),ji(e,a)}(e,{get title(){return t.title},get isHidden(){return xt(i)}})};Zi($,(e=>{xt(Ct)&&e(C)}));var A=Ne($,2),M=e=>{let t=ne((()=>"video"===o()&&c()));xh(e,{get isShifted(){return xt(t)}})};Zi(A,(e=>{w()&&e(M)}));var q=Ne(A,2),H=e=>{var t=um();vs(Oe(t),{"aria-label":oi}),xe(t),ji(e,t)};Zi(q,(e=>{oa(Re,"$icon3DVideoVisible",s)&&e(H)}));var Q=Ne(q,2),G=e=>{Nh(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return oa(we,"$chromecastDeviceName$",s)}})};Zi(Q,(e=>{E()&&e(G)}));var Z=Ne(Q,2),J=e=>{Rh(e,{get shifted(){return c()},get captions(){return oa(Le,"$currentSubtitleCaptions$",s)},get position(){return P()},get playerSize(){return y()}})};Zi(Z,(e=>{"off"!==oa(Pe,"$currentSubtitle$",s).value&&e(J)}));var ee=Ne(Z,2),ie=e=>{var t=dm();t.__contextmenu=Qt,t.__click=[om,S,me,d,ce,Kt],jh(Oe(t)),xe(t),ji(e,t)};Zi(ee,(e=>{l()&&e(ie)}));var ae=Ne(ee,2),se=e=>{let i=ne((()=>"thumb"===o()||"LiveWaitingStart"===o()||"LiveWaitingRecover"===o()||"LiveWaitingRecord"===o())),r=ne((()=>"ads"===o())),a=ne((()=>t.canRewindLive&&0!==L()));sh(e,{get bottomHidden(){return xt(i)},get bottomNoSmooth(){return b()},get showControls(){return c()},get isAds(){return xt(r)},get canRewindLive(){return xt(a)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return N()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return V()},get nextButtonActive(){return U()},get prevButtonActive(){return F()},get isOneVideoPlaylist(){return W()},customFullscreenSupported:kt,toggleFullscreen:Ht,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},get playerControlsWrapperRef(){return xt(at)},set playerControlsWrapperRef(e){re(at,Ae(e))},get playerControlsRef(){return xt(st)},set playerControlsRef(e){re(st,Ae(e))}})};Zi(ae,(e=>{K()&&e(se)}));var oe=Ne(ae,2),le=e=>{var i=cm(),r=Oe(i);let a=ne((()=>xt(st)?.clientHeight));Hf(r,{get supportLink(){return t.supportLink},get playerControlsHeight(){return xt(a)},returnFocus:()=>X()?.focus(),get ref(){return xt(nt)},set ref(e){re(nt,Ae(e))}}),xe(i),ji(e,i)};Zi(oe,(e=>{!E()&&"ads"!==o()&&e(le)}));var ue=Ne(oe,2);let de=ne((()=>!xt(Tt)));_n(ue,{get isLive(){return oa(ke,"$isLive$",s)},get isHidden(){return xt(de)},get isPlaying(){return oa(Te,"$isPlaying$",s)},get position(){return P()},get duration(){return L()}});var he=Ne(ue,2);!function(e,t){pi(t,!0),mr(e,bh);let[i,r]=la(),a=()=>oa(t.data,"$data",i),s=Na().ui.t,n=ne((()=>!a())),o=ne((()=>"BACKWARD_SEEK"===a()?.type)),l=ne((()=>"FORWARD_SEEK"===a()?.type)),u=ne((()=>a()?.type)),d=ne((()=>a()?.t?s(a().t.key,{value:a().t.value||""}):a()?.text));var c=vh();let h;var p=Oe(c),f=e=>{var t=gh(),i=Be(t),r=Oe(i),a=e=>{let t=ne((()=>"FORWARD_SEEK"===xt(u)));oh(e,{get reversed(){return xt(t)}})};Zi(r,(e=>{["BACKWARD_SEEK","FORWARD_SEEK"].includes(xt(u))&&e(a)}));var s=Ne(r,2),n=e=>{ic(e,{})};Zi(s,(e=>{"PAUSE"===xt(u)&&e(n)}));var o=Ne(s,2),l=e=>{ec(e,{})};Zi(o,(e=>{"PLAY"===xt(u)&&e(l)}));var c=Ne(o,2),h=e=>{Qd(e,{})};Zi(c,(e=>{"REPLAY"===xt(u)&&e(h)}));var p=Ne(c,2),f=e=>{dh(e,{isOff:!0})};Zi(p,(e=>{"SUBTITLES_OFF"===xt(u)&&e(f)}));var m=Ne(p,2),g=e=>{dh(e,{})};Zi(m,(e=>{"SUBTITLES_ON"===xt(u)&&e(g)}));var v=Ne(m,2),b=e=>{let t=ne((()=>"RATE_UP"===xt(u)));hh(e,{get reversed(){return xt(t)}})};Zi(v,(e=>{["RATE_DOWN","RATE_UP"].includes(xt(u))&&e(b)}));var _=Ne(v,2),y=e=>{let t=ne((()=>"EPISODE_NEXT"===xt(u)));fh(e,{get reversed(){return xt(t)}})};Zi(_,(e=>{["EPISODE_PREV","EPISODE_NEXT"].includes(xt(u))&&e(y)}));var w=Ne(_,2),S=e=>{Dl(e,{volume:0})};Zi(w,(e=>{"MUTE"===xt(u)&&e(S)}));var k=Ne(w,2),T=e=>{Dl(e,{volume:1})};Zi(k,(e=>{"VOLUME"===xt(u)&&e(T)})),xe(i);var E=Ne(i,2),x=e=>{var t=mh(),i=Oe(t,!0);xe(t),Bt((()=>qi(i,xt(d)))),ji(e,t)};Zi(E,(e=>{xt(d)&&e(x)})),ji(e,t)};Zi(p,(e=>{!xt(n)&&xt(u)&&e(f)})),xe(c),Bt((e=>h=wr(c,1,"hot-key-helpers-container svelte-1ad3n06",null,h,e)),[()=>({hidden:xt(n),"hot-key-helpers-container--left":xt(o),"hot-key-helpers-container--right":xt(l)})]),ji(e,c),fi(),r()}(he,{data:gt});var pe=Ne(he,2);Yn(pe,{get supportLink(){return t.supportLink},returnFocus:()=>X()?.focus(),get visible(){return S()},get playerContainerRef(){return xt(rt)},get controlsContainerRef(){return xt(at)},get position(){return oa(Qe,"$contextMenuPosition$",s)},get menuElementRef(){return xt(ai)},set menuElementRef(e){re(ai,Ae(e))}});var fe=Ne(pe,2),ve=e=>{Jf(e,{onClose:ct,onSelectAutoQuality:()=>{Ge("auto"),ct()}})};Zi(fe,(e=>{xt(dt)&&e(ve)}));var be=Ne(fe,2),_e=e=>{jo(e,{})};Zi(be,(e=>{xt(ht)&&e(_e)}));var ye=Ne(be,2),Se=e=>{rl(e,{})};Zi(ye,(e=>{oa(We,"$showHotKeyMap",s)&&e(Se)}));var Ee=Ne(ye,2),$e=e=>{_o(e,{})};Zi(Ee,(e=>{oa(ge,"$debugPanelVisible",s)&&e($e)})),ji(e,i)})),ji(e,r)},$$slots:{default:!0}}),(e=>X(e)),(()=>X())),Qr(Ne(di,2),(e=>re(pt,e)),(()=>xt(pt))),xe(ui),Qr(ui,(e=>re(rt,e)),(()=>xt(rt)));var gi=Ne(ui,2),vi=e=>{ji(e,fm())};Zi(gi,(e=>{oa(Ze,"$userActionsDisabled$",s)&&e(vi)})),Ii("mouseenter",ui,(function(){vt.set(!0),De||Vt(t.uiConfig.controls.hideTimeoutCursor)})),Ii("mouseleave",ui,(function(){vt.set(!1),re(_t,!1),re(bt,!1),Ot=!1,t.store.actions.internal.releaseCamera(),Vt(t.uiConfig.controls.hideTimeout)})),Ii("click",ui,(()=>{je.set(!0)}),!0),Ii("focusin",ui,(function(){De||(ft.set(!0),Vt(t.uiConfig.controls.hideTimeoutCursor))}),!0),ji(e,li),fi(),n()}Ri(["mousemove","contextmenu","click"]);var bm=Ni('<div></div> <div class="info svelte-nhq2ld"><div class="triangles-wrapper svelte-nhq2ld"><div></div> <div></div> <div></div></div> <p class="step-caption svelte-nhq2ld"> </p></div>',1),_m=Ni("<div><!></div>"),ym={hash:"svelte-nhq2ld",code:".double-click-area.svelte-nhq2ld {position:absolute;top:0;height:100%;width:25%;overflow:hidden;}.double-click-area.left.svelte-nhq2ld {left:0;}.double-click-area.right.svelte-nhq2ld {right:0;}.semicircle.svelte-nhq2ld {position:absolute;top:0;width:100%;height:100%;background-color:rgba(0, 0, 0, 0.5);}.semicircle.left.svelte-nhq2ld {left:0;border-top-right-radius:50%;border-bottom-right-radius:50%;}.semicircle.right.svelte-nhq2ld {right:0;border-top-left-radius:50%;border-bottom-left-radius:50%;}.info.svelte-nhq2ld {position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);display:flex;flex-direction:column;align-items:center;justify-content:center;}.triangles-wrapper.svelte-nhq2ld {position:relative;display:flex;margin-bottom:10px;justify-content:center;}.triangle.svelte-nhq2ld {width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;\n    animation: svelte-nhq2ld-blink 500ms infinite;opacity:0;}.triangle.right.svelte-nhq2ld:nth-child(1),\n  .triangle.left.svelte-nhq2ld:nth-child(3) {animation-delay:0ms;}.triangle.right.svelte-nhq2ld:nth-child(2),\n  .triangle.left.svelte-nhq2ld:nth-child(2) {animation-delay:100ms;}.triangle.right.svelte-nhq2ld:nth-child(3),\n  .triangle.left.svelte-nhq2ld:nth-child(1) {animation-delay:200ms;}\n\n  @keyframes svelte-nhq2ld-blink {\n    0% {\n      opacity: 0;\n    }\n    50% {\n      opacity: 1;\n    }\n    100% {\n      opacity: 0;\n    }\n  }.triangle.left.svelte-nhq2ld {border-right:8px solid var(--white);}.triangle.right.svelte-nhq2ld {border-left:8px solid var(--white);}.triangle.svelte-nhq2ld:not(:last-child) {margin-right:5px;}.step-caption.svelte-nhq2ld {margin:0;text-align:center;font-size:12px;line-height:1;color:var(--white);}"};function wm(e,t){pi(t,!0),mr(e,ym);let i=fa(t,"seekStep",3,0),r=te(!1),a=0,s=0,n=te(Ae(i()));Zr((()=>{window.clearTimeout(a)}));var o=_m();o.__click=e=>{e.stopPropagation(),s+=1,re(n,i()*(s-1)),1===s?t.handleSingleFirstClick(e):(re(r,!0),t.handleSecondClick()),window.clearTimeout(a),a=window.setTimeout((()=>{s=0,re(r,!1)}),300)};var l=Oe(o),u=e=>{var i=bm(),r=Be(i),a=Ne(r,2),s=Oe(a),o=Oe(s),l=Ne(o,2),u=Ne(l,2);xe(s);var d=Ne(s,2),c=Oe(d,!0);xe(d),xe(a),Bt((e=>{wr(r,1,`semicircle ${t.side??""}`,"svelte-nhq2ld"),wr(o,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),wr(l,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),wr(u,1,`triangle ${t.side??""}`,"svelte-nhq2ld"),qi(c,e)}),[()=>$s("doubletap_seek_step",{seconds:xt(n).toFixed(0)})]),ji(e,i)};Zi(l,(e=>{xt(r)&&e(u)})),xe(o),Bt((()=>wr(o,1,`double-click-area ${t.side??""}`,"svelte-nhq2ld"))),ji(e,o),fi()}Ri(["click"]);var Sm=(e,t,i)=>{t(!1),i()},km=Ni('<div class="overlay svelte-1qdxi6t"></div> <div class="next-video svelte-1qdxi6t"><div class="top svelte-1qdxi6t"><div class="caption svelte-1qdxi6t"> </div> <!></div> <div class="row svelte-1qdxi6t"><div class="column svelte-1qdxi6t"><div class="thumb svelte-1qdxi6t"><div></div> <!></div></div> <div class="column svelte-1qdxi6t"><div class="title svelte-1qdxi6t"> </div></div></div></div>',1),Tm={hash:"svelte-1qdxi6t",code:".overlay.svelte-1qdxi6t {width:100%;height:100%;background:rgba(0, 0, 0, 0.72);position:absolute;}.next-video.svelte-1qdxi6t {position:absolute;top:50%;left:50%;z-index:var(--end-screen-mobile-z-index);transform:translate(-50%, -50%);display:flex;flex-direction:column;max-width:362px;min-width:320px;margin:0 auto;padding-bottom:12px;}.top.svelte-1qdxi6t {display:flex;justify-content:space-between;}.caption.svelte-1qdxi6t {font-size:11px;font-weight:bold;color:var(--white);text-transform:uppercase;opacity:0.8;}.row.svelte-1qdxi6t {height:102px;background:rgba(48, 48, 48, .8);cursor:pointer;margin-top:6px;display:flex;flex-direction:row;width:100%;}.column.svelte-1qdxi6t {display:flex;flex-direction:column;flex-basis:50%;}.thumb.svelte-1qdxi6t {width:100%;height:100%;background:no-repeat center;background-size:cover;display:flex;align-items:center;position:relative;justify-content:space-around;}.thumb-overlay.svelte-1qdxi6t {width:100%;height:100%;position:absolute;}.thumb-overlay.withOpacity.svelte-1qdxi6t {background:var(--black);opacity:0.3;}.title.svelte-1qdxi6t {padding:10px 16px;font-size:12px;font-weight:bold;color:var(--white);line-height:1.6;max-height:52px;overflow:hidden;}"};function Em(e,t){pi(t,!0),mr(e,Tm);let[i,r]=la(),a=()=>oa(n,"$autoplayNextEnabled$",i),s=Na(),n=s.ui.autoplayNextEnabled$,o=s.ui.timerNextVideoRunning$,l=s.actions.internal.nextVideoClick,u=s.actions.internal.nextVideoAnnouncementShow,d=s.actions.internal.nextVideoAnnouncementClick,c=s.actions.internal.nextVideoAnnouncementAuto,h=s.actions.internal.nextVideoAnnouncementCancel,p=()=>{l(!1),c()},f=()=>{t.clickCloseIcon(),h()};Xr((()=>{t.isHide||u(),t.isHide&&a()&&(l(!1),c())}));var m=Fi(),g=Be(m),v=e=>{var r=km(),s=Ne(Be(r),2),n=Oe(s),u=Oe(n),c=Oe(u,!0);xe(u),ko(Ne(u,2),{onClick:f}),xe(n);var h=Ne(n,2);h.__click=[Sm,l,d];var m=Oe(h),g=Oe(m),v=Oe(g);let b;var _=Ne(v,2),y=e=>{xo(e,{get isRunning(){return oa(o,"$timerNextVideoRunning$",i)},onTimerEnded:p})};Zi(_,(e=>{a()&&e(y)})),xe(g),xe(m);var w=Ne(m,2),S=Oe(w),k=Oe(S,!0);xe(S),xe(w),xe(h),xe(s),Bt(((e,i)=>{qi(c,e),kr(g,`background-image: url('${t.thumb}')`),b=wr(v,1,"thumb-overlay svelte-1qdxi6t",null,b,i),qi(k,t.title)}),[()=>a()?$s("end_screen_next_video"):$s("end_screen_recommended_video"),()=>({withOpacity:a()})]),ji(e,r)};Zi(g,(e=>{t.isHide||e(v)})),ji(e,m),fi(),r()}Ri(["click"]);var xm=class{getTracksArray(){return Array.from(this.video.getElementsByTagName("track"))}attach(e,t=!1){let i=document.createElement("track");i.setAttribute("src",e.url),i.setAttribute("id",e.id),e.label&&i.setAttribute("label",e.label),e.language&&i.setAttribute("srclang",e.language),t&&(i.track.mode="showing"),this.video.appendChild(i)}detachAll(){for(let e of this.getTracksArray())this.video.removeChild(e)}updateSrc(e){let t=this.getTracksArray().find((t=>t.id===e.id));t&&(t.src=e.url)}getCurrentShowingId(){return this.getTracksArray().find((e=>"showing"===e.track.mode))?.id??null}constructor(e){this.video=e}},$m=({store:e,getFullscreenTarget:t})=>{let{isFullscreen:i}=e.ui,{setSubtitle:r}=e.actions.internal,{currentSubtitle$:a,availableSubtitlesList$:s,currentFormat$:n,availableTextTracks$:o}=e.state,l=null,u=()=>{l?.(),l=null},d=e=>{if(u(),!f.clientChecker.device.isIOS||aa(n)!==f.VideoFormat.DASH_LIVE_CMAF||!e)return;let i=t().querySelector("video");if(!i)return;let d=new xm(i),c=aa(o),h=aa(s),p=aa(a);for(let e of c)h.some((t=>t.value===e.id))&&d.attach(e,p.value===e.id);let m=o.subscribe((e=>{for(let t of e)d.updateSrc(t)})),g=()=>{let e=d.getCurrentShowingId();r(aa(s).find((t=>t.value===e)))};i.textTracks.addEventListener("change",g),l=()=>{m(),d.detachAll(),i.textTracks.removeEventListener("change",g)}};Xr((()=>i.subscribe(d))),Zr(u)},Cm=(e,t,i,r)=>{e.stopPropagation(),t()&&r()},Am=Ni("<!> <!>",1),Pm=Ni("<div><!></div>"),Lm=Ni('<div class="spherical-video-icon svelte-dtyj47"><!></div>'),Mm=Ni("<div><!></div>"),Im=Ni('<div class="settings-mobile svelte-dtyj47"><!></div>'),Rm=Ni("<!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!> <!>",1),Dm=Ni('<div class="player-wrapper svelte-dtyj47" role="region" tabindex="-1"><!> <!> <!> <div class="overlay-container"></div></div>'),Om={hash:"svelte-dtyj47",code:".player-wrapper.svelte-dtyj47 {position:absolute;width:100%;height:100%;}.player-wrapper.svelte-dtyj47 .player-media {position:absolute;left:0;top:0;width:100%;height:100%;background:var(--black);transition:transform 0.2s ease-in-out;}.spherical-video-icon.svelte-dtyj47 {display:inline-block;position:absolute;top:calc(50% - 23px);left:calc(50% - 38px);}\n  .ads-container.svelte-dtyj47 {position:absolute;width:100%;height:100%;left:0;top:0;}.ads-container.svelte-dtyj47 {z-index:var(--ads-container-z-index);background:var(--black);}.settings-mobile.svelte-dtyj47 {position:absolute;z-index:var(--settings-menu-z-index);top:50%;left:50%;transform:translate(-50%,-50%);transition:opacity var(--controls-transition-duration);display:flex;align-items:center;max-width:320px;width:90%;}"};function Bm(e,t){pi(t,!0),mr(e,Om);let i,r,a,s,[n,o]=la(),l=()=>oa(X,"$playerPhase",n),u=()=>oa(Se,"$crashed",n),d=()=>oa(ie,"$interactiveHideMobileControls",n),c=()=>oa(ce,"$isEnded$",n),h=()=>oa(J,"$controlsVisible",n),p=()=>oa(We,"$autoplayNextEnabled$",n),g=()=>oa(nt,"$bottomNoSmooth",n),v=()=>oa(Ee,"$videoSize",n),b=()=>oa(Le,"$playerSize",n),_=()=>oa(G,"$position$",n),y=()=>oa(Y,"$duration$",n),w=()=>oa(ae,"$settingsMenuVisible",n),S=()=>oa(oe,"$scrubbingInProgress",n),k=()=>oa(he,"$chromecastConnected$",n),T=fa(t,"videoContainer",15),E=fa(t,"adsSlotId",3,void 0),x=fa(t,"adsParams",3,void 0),$=fa(t,"adsPreviewParam",3,void 0),C=fa(t,"adsAutoplayParam",3,void 0),A=fa(t,"duration",3,void 0),P=fa(t,"logoTargetUrl",3,""),L=fa(t,"showNextPrevButtons",3,!1),M=fa(t,"nextButtonActive",3,!1),I=fa(t,"prevButtonActive",3,!1),R=fa(t,"endScreenVideoTitle",3,void 0),D=fa(t,"endScreenVideoThumb",3,void 0),O=fa(t,"isOneVideoPlaylist",3,!1),B=fa(t,"shadowRootContainer",3,void 0),N=fa(t,"outerContainerRef",3,void 0),V=fa(t,"showMiniTimer",3,!1),U=fa(t,"fullScreenTarget",3,void 0),F=fa(t,"playerStarted",3,!1),j=fa(t,"showEndScreen",3,!0),{notifications$:z,graphIsOpened$:W}=Va(),q=t.store.getLogger().createComponentLog("Root component"),H=t.store.interfaceLanguage$,K=t.store.state.playbackState$,Q=t.store.ads.playbackState,G=t.store.state.positionWithScrubbing$,Y=t.store.state.duration$,X=t.store.playerPhase,Z=t.store.ui.isFullscreen,J=t.store.ui.controlsVisible,ee=t.store.ui.isControlsAvailable,ie=t.store.ui.interactiveHideMobileControls,ae=t.store.ui.settingsMenu.visible$,se=t.store.ui.settingsMenu.openedByBtnKeyboard$,oe=t.store.ui.scrubbingInProgress,le=t.store.ui.volumeChangingInProgress,ue=t.store.ui.debugPanelVisible,de=t.store.state.isLoaderVisible,ce=t.store.state.isEnded$,he=t.store.state.chromecastConnected$,pe=t.store.state.chromecastDeviceName$,fe=t.store.ads.postrollPassed,me=t.store.ui.mobileUnmuteButtonExpanded,ge=t.store.ui.mobileUnmuteButtonVisible,ve=t.store.state.isLive$,_e=t.store.state.isPlaying$,ye=t.store.state.isActiveLive$,we=t.store.state.isRewindableLive$,Se=t.store.state.crashed$,ke=t.store.webApi.annotationsApi,Te=t.store.webApi.pictureInPictureApi,Ee=t.store.state.videoSize$,$e=t.store.state.currentSubtitle$,Ce=t.store.state.currentSubtitleCaptions$,Pe=t.store.state.duration$,Le=t.store.ui.playerSize,Me=t.store.ui.is3DVideo,Ie=t.store.ui.icon3DVideoVisible,Re=t.store.state.isInteractive,De=t.store.state.isInteractiveTime$,Ve=t.store.state.isInteractiveExpectation$,Ue=t.store.state.hasInteractiveBranches,Fe=t.store.ui.controls.disabledControls$,je=t.store.ui.touched,ze=t.store.ui.overlayContainer$,We=t.store.ui.autoplayNextEnabled$,qe=t.store.state.loadedMetadata$,He=t.store.actions.internal.closeSettingsMenu,Ke=t.store.callbacks?.onDisabledPlayPrevChapterClick,Qe=t.store.callbacks?.onDisabledSeekToInteractiveClick,Ge=t.store.actions.internal.setQuality,Ye=te(void 0),Xe=te(void 0),Ze=te(void 0),Je=te(void 0),et=ne((()=>("video"===l()&&oa(de,"$isLoaderVisible",n)||"ads"===l()&&"inactive"===oa(Q,"$adPlaybackState",n))&&!u())),tt=te(void 0),{closeNotification:it,notificationsToShow$:rt}=z,at=ne((()=>!!oa(rt,"$notificationsToShow$",n).slow_video)),st=()=>it("slow_video"),nt=ia(!1),ot=te(!1),lt=ne((()=>oa(K,"$playbackState$",n)!==f.PlaybackState.PLAYING)),ut=te(!1),dt=ne((()=>oa(W,"$graphIsOpened$",n)||d()||!xt(ot)&&(c()&&!!Ue||xt(lt)&&oa(Ve,"$isInteractiveExpectation$",n)))),ct=te(!0),ht=ne((()=>t.uiConfig.features.thumbTimer&&V()&&"video"===l()&&!h()&&!u()&&!Re&&(t.uiConfig.hideThumbTimerAfterTouch&&!oa(je,"$touched",n)||!t.uiConfig.hideThumbTimerAfterTouch))),pt=te(!1),ft=ne((()=>(j()||t.showAutoplayNext&&p())&&!!R()&&!!D()&&(t.showAds&&oa(fe,"$postrollPassed",n)||!t.showAds)&&c()&&!u()&&!xt(pt))),mt=te(!1);Te?.setContext(hi());t.store.setUiCallbacks({onStarted:e=>{clearTimeout(r),e&&(ge.set(!0),me.set(!0),r=setTimeout((()=>{me.set(!1)}),t.uiConfig.controls.collapseMobileUnmute),Re||vt(t.uiConfig.controls.hideTimeoutMobile))}});let gt=()=>{clearTimeout(i),re(ot,!1),d()&&ie.set(!1)},vt=e=>{gt(),re(ot,!0),i=setTimeout((()=>re(ot,!1)),e);let t=e-100;s=setTimeout((()=>{g()&&nt.set(!1)}),t>0?t:e)},bt=Me.subscribe((e=>{Ie.set(e),e&&(clearTimeout(a),a=setTimeout((()=>Ie.set(!1)),t.uiConfig.controls.hide360IconTimeout))})),_t=async(e=qs())=>{if(e&&!f.clientChecker.device.isIOS){let t=Ws(),i=Tt(),r=f.clientChecker.browser.isSamsungBrowser&&t===B();e=t===i||r}if(e){vt(t.uiConfig.controls.hideTimeoutFullscreen);try{await(Te?.remove())}catch(e){q({message:String(e)})}try{let e=v()?.width&&v()?.height?v():b();await(e=>{let t=window.screen;return(async e=>t.orientation?t.orientation.lock(e):t.mozLockOrientation?t.mozLockOrientation(e):t.msLockOrientation?t.msLockOrientation(e):Promise.reject())(((e={width:0,height:0})=>e.width<=e.height?"portrait":"landscape")(e))})(e)}catch(e){q({message:String(e)})}}Z.set(e),t.store.getAdmanWrapper().setFullscreen(e),oa(Z,"$isFullscreen",n)?t.store.callbacks?.onFullscreenEnter?.():t.store.callbacks?.onFullscreenExit?.()},yt=e=>{let t=e;Le.set({width:t.target.width,height:t.target.height})};Xr((()=>(Hs(_t),t.uiConfig.features.annotationsInside&&ke?.init(xt(Ye)),Gs(Te)&&(Te?.assignPlayerContainer(xt(Ye)),Te?.registryExternalEventHandlers({resize:yt})),re(ct,!f.clientChecker.device.isIphoneOrOldIpad),t.interactiveContainer&&T().parentElement?.insertBefore(t.interactiveContainer,T().nextSibling),()=>{clearTimeout(i),clearTimeout(s),clearTimeout(r),clearTimeout(a),bt(),Te?.dispose().catch((e=>{q({message:String(e)})})),Ks(_t)})));let wt=te(!0),St=te(!0),kt=e=>{let i=_()+("forward"===e?1:-1)*t.uiConfig.controls.seekStepMobile/1e3;i<0?(re(wt,!1),i=0):i>=y()&&(re(St,!1),i=y()),re(ut,!0),t.seekTime(i)},Tt=()=>{let e=f.clientChecker.device.isIOS||t.uiConfig.features.fullscreenInternalTargetPlayerContainer||!N()?xt(Ye):N(),i=e.getRootNode(),r=i instanceof ShadowRoot?i.host:i,a=U()instanceof HTMLElement&&U().contains(r);return t.uiConfig.allowChangingFullscreenTarget&&U()&&a?U():e},Et=async()=>{try{if(qs())await zs(document),q({message:"exit fullscreen"});else{if(q({message:"request fullscreen"}),f.clientChecker.device.isIOS&&!oa(qe,"$loadedMetadata",n))return;await js(Tt())}}catch(e){q({message:String(e)})}},$t=()=>{He()},Ct=e=>{if(e.preventDefault(),!w())return F()?(re(ut,!1),void(h()?gt():vt(t.uiConfig.controls.hideTimeoutMobile))):(t.firstStart(),void vt(t.uiConfig.controls.hideTimeoutCursor));$t()},At=e=>{Ke&&(Ke(e),vt(t.uiConfig.controls.hideTimeoutMobile))},Pt=e=>{Qe&&(Qe(e),vt(t.uiConfig.controls.hideTimeoutMobile))};Rt((()=>{ze.set(xt(tt))})),Rt((()=>{J.set((xt(lt)||w()||S()||oa(le,"$volumeChangingInProgress",n)||k()||!xt(ft)&&(c()||xt(ot)&&!xt(ut)))&&!xt(dt)&&"video"===l()&&!u()&&oa(ee,"$isControlsAvailable",n))})),Rt((()=>{!S()&&xt(mt)&&!oa(De,"$isInteractiveTime$",n)&&vt(t.uiConfig.controls.hideTimeoutMobile),re(mt,Ae(S()))})),Rt((()=>{re(wt,_()>0),re(St,Ae(!oa(ye,"$isActiveLive",n)&&_()<y()))})),Rt((()=>{$n(xt(Je),w(),oa(se,"$settingsMenuOpenedByKeyboard",n))}));let Lt=$s("aria_label_video_player"),Mt=$s("video360");(({getFullscreenTarget:e,fullScreenChangeHandler:t})=>{let i,r=null;Xr((()=>{f.clientChecker.device.isIOS&&(i=setTimeout((()=>{let i=e().querySelector("video");if(!i)return;let a=()=>t(!0),s=()=>t(!1);i.addEventListener("webkitbeginfullscreen",a),i.addEventListener("webkitendfullscreen",s),r=()=>{i.removeEventListener("webkitbeginfullscreen",a),i.removeEventListener("webkitendfullscreen",s)}}),0))})),Zr((()=>{r?.(),clearTimeout(i)}))})({fullScreenChangeHandler:_t,getFullscreenTarget:Tt}),$m({store:t.store,getFullscreenTarget:Tt});var It=Dm();Ii("blur",be,$t),Ar(It,"aria-label",Lt);var Dt=Oe(It);nm(Dt,{onClick:Ct,get videoContainer(){return T()},set videoContainer(e){T(e)}});var Ot=Ne(Dt,2);pr(Ot,(()=>"slot"),!1,((e,t)=>{Pr(e,null,{name:em})}));var Nt=Ne(Ot,2);Ji(Nt,(()=>oa(H,"$language$",n)),(e=>{var i=Rm(),r=Be(i);let a=ne((()=>"thumb"!==l()||u()||Re&&t.autoplay));Hh(r,{get hidden(){return xt(a)},get thumbUrl(){return t.thumbUrl},get startVideo(){return t.firstStart}});var s=Ne(r,2),o=e=>{var i=Am(),r=Be(i),a=e=>{let i=ne((()=>t.uiConfig.controls.seekStepMobile/1e3));wm(e,{side:"left",get seekStep(){return xt(i)},handleSingleFirstClick:Ct,handleSecondClick:()=>kt("backward")})};Zi(r,(e=>{xt(wt)&&e(a)}));var s=Ne(r,2),n=e=>{let i=ne((()=>t.uiConfig.controls.seekStepMobile/1e3));wm(e,{side:"right",get seekStep(){return xt(i)},handleSingleFirstClick:Ct,handleSecondClick:()=>kt("forward")})};Zi(s,(e=>{xt(St)&&e(n)})),ji(e,i)};Zi(s,(e=>{t.canRewindLive&&we&&!oa(Fe,"$disabledControls$",n).has("TIMELINE")&&e(o)}));var d=Ne(s,2),c=e=>{let i=ne((()=>t.live?.startTime));op(e,{get thumbUrl(){return t.thumbUrl},get startTime(){return xt(i)}})};Zi(d,(e=>{"LiveWaitingStart"===l()&&e(c)}));var f=Ne(d,2),v=e=>{dp(e,{kind:"recover",get thumbUrl(){return t.thumbUrl}})};Zi(f,(e=>{"LiveWaitingRecover"===l()&&e(v)}));var S=Ne(f,2),T=e=>{dp(e,{kind:"record",get thumbUrl(){return t.thumbUrl}})};Zi(S,(e=>{"LiveWaitingRecord"===l()&&e(T)}));var B=Ne(S,2),N=e=>{var t=Pm();let i;nn(Oe(t),{get adsSlotId(){return E()},get adsParams(){return x()},get adsPreviewParam(){return $()},get adsAutoplayParam(){return C()},get duration(){return A()}}),xe(t),Bt((e=>i=wr(t,1,"ads-container svelte-dtyj47",null,i,e)),[()=>({hidden:"ads"!==l()})]),ji(e,t)};Zi(B,(e=>{t.showAds&&F()&&e(N)}));var V=Ne(B,2),U=e=>{let i=ne((()=>!j()&&t.showAutoplayNext&&p()));Em(e,{get title(){return R()},get thumb(){return D()},get isHide(){return xt(i)},clickCloseIcon:()=>re(pt,!0)})};Zi(V,(e=>{xt(ft)&&R()&&D()&&e(U)}));var z=Ne(V,2),W=e=>{xh(e,{})};Zi(z,(e=>{oa(Me,"$is3DVideo",n)&&e(W)}));var q=Ne(z,2),H=e=>{var t=Lm();vs(Oe(t),{"aria-label":Mt}),xe(t),ji(e,t)};Zi(q,(e=>{oa(Ie,"$icon3DVideoVisible",n)&&e(H)}));var K=Ne(q,2),Q=e=>{Nh(e,{get thumbUrl(){return t.thumbUrl},get chromecastDeviceName(){return oa(pe,"$chromecastDeviceName$",n)}})};Zi(K,(e=>{k()&&e(Q)}));var G=Ne(K,2),Y=e=>{Rh(e,{get shifted(){return h()},get captions(){return oa(Ce,"$currentSubtitleCaptions$",n)},get position(){return _()},get playerSize(){return b()},isMobile:!0})};Zi(G,(e=>{"off"!==oa($e,"$currentSubtitle$",n).value&&e(Y)}));var X=Ne(G,2),Z=e=>{var t=Mm();t.__click=[Cm,w,ae,$t],jh(Oe(t)),xe(t),ji(e,t)};Zi(X,(e=>{u()&&e(Z)}));var J=Ne(X,2),ee=e=>{let i=ne((()=>"thumb"===l()||"LiveWaitingStart"===l()||"LiveWaitingRecover"===l()||"LiveWaitingRecord"===l()||"ads"===l())),r=ne((()=>"ads"===l())),a=ne((()=>t.canRewindLive&&0!==oa(Pe,"$realDuration$",n)));sh(e,{get bottomHidden(){return xt(i)},get showControls(){return h()},get bottomNoSmooth(){return g()},get isAds(){return xt(r)},get canRewindLive(){return xt(a)},get logoClickable(){return t.logoClickable},get logoHidden(){return t.logoHidden},get logoTargetUrl(){return P()},get showAutoplayNext(){return t.showAutoplayNext},get showNextPrevButtons(){return L()},get nextButtonActive(){return M()},get prevButtonActive(){return I()},get isOneVideoPlaylist(){return O()},get customFullscreenSupported(){return xt(ct)},get endScreenShown(){return xt(ft)},toggleFullscreen:Et,get seekToInteractive(){return t.seekToInteractive},get playPrevChapter(){return t.playPrevChapter},onDisabledPlayPrevChapterClick:At,onDisabledSeekToInteractiveClick:Pt,get playerControlsWrapperRef(){return xt(Xe)},set playerControlsWrapperRef(e){re(Xe,Ae(e))},get playerControlsRef(){return xt(Ze)},set playerControlsRef(e){re(Ze,Ae(e))}})};Zi(J,(e=>{F()&&e(ee)}));var te=Ne(J,2),ie=e=>{var i=Im();Hf(Oe(i),{get supportLink(){return t.supportLink},returnFocus:m.noop,get ref(){return xt(Je)},set ref(e){re(Je,Ae(e))}}),xe(i),ji(e,i)};Zi(te,(e=>{w()&&e(ie)}));var se=Ne(te,2);let oe=ne((()=>!xt(ht)));_n(se,{get isLive(){return oa(ve,"$isLive$",n)},get isHidden(){return xt(oe)},get isPlaying(){return oa(_e,"$isPlaying$",n)},get position(){return _()},get duration(){return y()}});var le=Ne(se,2),de=e=>{jo(e,{})};Zi(le,(e=>{xt(et)&&e(de)}));var ce=Ne(le,2),he=e=>{_o(e,{})};Zi(ce,(e=>{oa(ue,"$debugPanelVisible",n)&&e(he)}));var fe=Ne(ce,2),me=e=>{Jf(e,{onClose:st,onSelectAutoQuality:()=>{Ge("auto"),st()}})};Zi(fe,(e=>{xt(at)&&e(me)})),ji(e,i)})),Qr(Ne(Nt,2),(e=>re(tt,e)),(()=>xt(tt))),xe(It),Qr(It,(e=>re(Ye,e)),(()=>xt(Ye))),Ii("click",It,(()=>{je.set(!0)}),!0),Ii("focusin",It,(()=>{Re||(nt.set(!0),vt(t.uiConfig.controls.hideTimeoutCursor))}),!0),ji(e,It),fi(),o()}function Nm(e){let t="";return Vm(e.timelineSliderFilledColor)&&(t+=`--timeline-slider-filled-bg:${e.timelineSliderFilledColor};`),Vm(e.timelineSliderHandleColor)&&(t+=`--timeline-slider-handle-bg:${e.timelineSliderHandleColor};`),Vm(e.timelineSliderLoadedColor)&&(t+=`--timeline-slider-loaded-bg:${e.timelineSliderLoadedColor};`),Vm(e.timelineSliderColor)&&(t+=`--timeline-slider-bg:${e.timelineSliderColor};`),Vm(e.volumeSliderColor)&&(t+=`--volume-slider-bg:${e.volumeSliderColor};`),Vm(e.volumeSliderHandleColor)&&(t+=`--volume-slider-handle-bg:${e.volumeSliderHandleColor};`),Vm(e.volumeSliderFilledColor)&&(t+=`--volume-slider-filled-bg:${e.volumeSliderFilledColor};`),Vm(e.controlsTimeColor)&&(t+=`--controls-time:${e.controlsTimeColor};`),Vm(e.timelineSliderFilledActiveLiveColor)&&(t+=`--timeline-slider-filled-active-live-bg:${e.timelineSliderFilledActiveLiveColor};`),Vm(e.timelineSliderHandleActiveLiveColor)&&(t+=`--timeline-slider-handle-active-live-bg:${e.timelineSliderHandleActiveLiveColor};`),Vm(e.buttonColor)&&(t+=`--btn-color:${e.buttonColor};`),Vm(e.buttonToggleOnColor)&&(t+=`--toggle-color-on:${e.buttonToggleOnColor};`,t+=`--toggle-color-autoplay-on:${e.buttonToggleOnColor};`),Vm(e.focusedColor)&&(t+=`--focused:${e.focusedColor};`),t.length&&t||void 0}function Vm(e){return"string"==typeof e&&!e.includes(";")}Ri(["click"]);var Um=Ni('<div class="player-wrapper svelte-1qfjf44" role="region"><!> <!> <!> <!> <div class="time-container svelte-1qfjf44"><!></div> <div><!></div></div>'),Fm={hash:"svelte-1qfjf44",code:".player-wrapper.svelte-1qfjf44 {position:absolute;width:100%;height:100%;}.player-wrapper.svelte-1qfjf44 .player-media {position:absolute;left:0;top:0;width:100%;height:100%;background:var(--black);transition:transform 0.2s ease-in-out;}.timeline.svelte-1qfjf44 {opacity:0;opacity:1;position:absolute;z-index:var(--controls-container-z-index);width:100%;bottom:0;left:0;transition:opacity var(--controls-transition-duration) var(--controls-transition-fn);}.visible.svelte-1qfjf44 {opacity:1;}.time-container.svelte-1qfjf44 {position:absolute;bottom:8px;right:8px;z-index:var(--thumb-timer-z-index);}"};function jm(e,t){pi(t,!0),mr(e,Fm);let[i,r]=la(),a=()=>oa(y,"$playerSize",i),s=()=>oa(p,"$isPlaying$",i),n=()=>oa(c,"$duration$",i),o=fa(t,"outsideDuration",3,0),l=fa(t,"videoContainer",15),{playerPhase:u,state:{crashed$:d,duration$:c,positionExact$:h,isPlaying$:p,currentSubtitle$:f,currentSubtitleCaptions$:g,positionWithScrubbing$:v,isLive$:b,isRewindableLive$:_},ui:{playerSize:y,controls:w},actions:{internal:{getVideoElement:S}}}=Na(),k=te(!1),T=Ae({}),E=(0,m.debounceFn)(Td,260);Rt((()=>{a(),E(S(),w,T,xt(k))}));let x=ne((()=>s()?on(n()-oa(v,"$positionWithScrubbing$",i)):on(isFinite(n())?n():o())));var $=Um(),C=Oe($);nm(C,{hideCursor:!1,get videoContainer(){return l()},set videoContainer(e){l(e)}});var A=Ne(C,2);pr(A,(()=>"slot"),!1,((e,t)=>{Pr(e,null,{name:em})}));var P=Ne(A,2);let L=ne((()=>"thumb"!==oa(u,"$playerPhase",i)||oa(d,"$crashed$",i)));Hh(P,{get hidden(){return xt(L)},get thumbUrl(){return t.thumbUrl},iconVisible:!1});var M=Ne(P,2),I=e=>{Rh(e,{shifted:!1,get captions(){return oa(g,"$currentSubtitleCaptions$",i)},get position(){return oa(h,"$positionExact$",i)},get playerSize(){return a()}})};Zi(M,(e=>{"off"!==oa(f,"$currentSubtitle$",i).value&&e(I)}));var R=Ne(M,2);gn(Oe(R),{get isLive(){return oa(b,"$isLive$",i)},get isPlaying(){return s()},get time(){return xt(x)}}),xe(R);var D=Ne(R,2);let O;qu(Oe(D),{get canRewindLive(){return t.canRewindLive},get isRewindableLive(){return oa(_,"$isRewindableLive$",i)},isAds:!1,needPadding:!1,isHidden:!1,withEpisodes:!1,tooltipLeftOffset:8,tooltipRightOffset:8,get ref(){return T.timeline},set ref(e){T.timeline=e}}),xe(D),xe($),Bt((e=>O=wr(D,1,"timeline svelte-1qfjf44",null,O,e)),[()=>({visible:xt(k)})]),Ii("mouseenter",$,(()=>{re(k,!0)})),Ii("mouseleave",$,(()=>{re(k,!1)})),ji(e,$),fi(),r()}var zm=Ni("<div><!></div>"),Wm={hash:"svelte-7ed4yj",code:".root.svelte-7ed4yj {--white: #fff;--black: #000;--red: #ff3347;--blue-light: #70c1ff;--black-alpha-40: rgba(0, 0, 0, 0.4);--white-alpha-24: rgba(255, 255, 255, 0.24);--white-alpha-72: rgba(255, 255, 255, 0.72);--devider-gray: #dce1e6;--text-gray: #626d7a;--font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;--controls-height: 40px;--controls-gradient-height: 100px;--controls-transition-duration: 0.25s;--controls-transition-fn: cubic-bezier(0.455, 0.03, 0.515, 0.955);--controls-desktop-item-margin-left: 4px;--focused: var(--white);--focused-element-shadow: inset 0 0 0 2px var(--focused);--focused-slider-shadow: 0 0 0 2px var(--focused);--big-play-size: 96px;--big-play-radius: 50%;--big-play-bg-color: rgba(0, 0, 0, 0.5);--big-play-hover-bg-color: rgba(0, 0, 0, 0.6);--big-play-icon-width: 38px;--big-play-icon-height: 33px;--interactive-episode-complete: rgba(92, 156, 230, 1);--slider-bg: rgba(255, 255, 255, 0.4);--slider-filled-bg: var(--white);--slider-handle-bg: var(--white);--slider-loaded-bg: rgba(255, 255, 255, 0.4);--slider-height: 3px;--slider-video-episode-gap: 1.5px;--slider-radius: 0px;--slider-handle-size: 12px;--slider-filled-ads: rgba(103, 165, 235, 1);--slider-disabled-color: rgba(248, 248, 248, 0.31);--slider-volume-height: 5px;--slider-volume-radius: calc(var(--slider-volume-height) / 2);--slider-volume-handle-size: 13px;\n\n    /* USER DEFINED COLORS */\n\n    /* timeline active live */--timeline-slider-filled-active-live-bg: var(--red);--timeline-slider-handle-active-live-bg: var(--red);\n    /* timeline & timeline ads */--timeline-slider-bg: var(--slider-bg);--timeline-slider-filled-bg: var(--slider-filled-bg);--timeline-slider-handle-bg: var(--slider-handle-bg);--timeline-slider-loaded-bg: var(--slider-loaded-bg);\n    /* volume slider colors */--volume-slider-bg: var(--slider-bg);--volume-slider-filled-bg: var(--slider-filled-bg);--volume-slider-handle-bg: var(--slider-handle-bg);\n    /* controls time */--controls-time: var(--white);\n\n    /* /// USER DEFINED COLORS */--controls-gradient: linear-gradient(\n      180deg,\n      rgba(0, 0, 0, 0) 0%,\n      rgba(0, 0, 0, 0.01) 6.67%,\n      rgba(0, 0, 0, 0.04) 13.33%,\n      rgba(0, 0, 0, 0.08) 20%,\n      rgba(0, 0, 0, 0.15) 26.67%,\n      rgba(0, 0, 0, 0.23) 33.33%,\n      rgba(0, 0, 0, 0.33) 40%,\n      rgba(0, 0, 0, 0.44) 46.67%,\n      rgba(0, 0, 0, 0.56) 53.33%,\n      rgba(0, 0, 0, 0.67) 60%,\n      rgba(0, 0, 0, 0.77) 66.67%,\n      rgba(0, 0, 0, 0.85) 73.33%,\n      rgba(0, 0, 0, 0.92) 80%,\n      rgba(0, 0, 0, 0.96) 86.67%,\n      rgba(0, 0, 0, 0.99) 93.33%,\n      #000 100%\n    );--timeline-preview-shadow: rgba(0, 0, 0, 0.08);--timeline-preview-bg: rgba(34, 34, 34, 1);--settings-bg: rgba(0, 0, 0, 0.72);--settings-item-bg-hover: rgba(255, 255, 255, 0.08);--settings-radius: 8px;--mobile-settings-bg: #2c2d2e;--divider-border: 1px solid var(--white-alpha-24);--toggle-color-separator: #363738;--toggle-color-off: #656565;--toggle-color-on: #71aaeb;--toggle-color-autoplay-on: var(--white);--notification-bg: #2C2D2E;--notification-radius: 8px;--button-hover-transition: opacity 0.2s;--video-container-z-index: 0;--controls-container-z-index: 1;--ads-container-z-index: 1;--end-screen-mobile-z-index: 1;--notification-z-index: 1;--thumb-timer-z-index: 2;--debug-panel-z-index: 2;--settings-menu-z-index: 2;--context-menu-z-index: 3;--hot-key-helpers-container-z-index: 3;--overlay-container-z-index: 4;--rotate-transition-duration: 0.25s;--btn-color: var(--white);position:relative;width:100%;height:100%;color:var(--white);font-size:12px;line-height:normal;overflow:hidden;outline:0;user-select:none;\n    /* --vk-vp-custom-font - vk video player custom font */font-family:var(--vk-vp-custom-font, var(--font));background:var(--black);}.root--miui-browser.svelte-7ed4yj {color-scheme:light dark;}.root.visible-outside.svelte-7ed4yj {overflow:visible;}\n\n  /* css reset start */* {-webkit-tap-highlight-color:transparent;}button {border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none;cursor:pointer;}p {margin:0;}svg:not(.interactive-root svg) {pointer-events:none;}.interactive-root {\n    /* --vk-vp-int-custom-font - vk video player interactive custom font */font-family:var(--vk-vp-int-custom-font, inherit);}*:focus, *:focus-visible {outline:none;}*:focus-visible {box-shadow:var(--focused-element-shadow);}\n  /* css reset end */.hidden {visibility:hidden;opacity:0;}.overlay-container {pointer-events:none;top:0;left:0;height:100%;width:100%;position:fixed;z-index:var(--overlay-container-z-index);}\n\n  /* Класс для сокрытие контента визуально но не для обхода по таб и скрин ридера */.out-of-view {position:absolute !important;left:-1000vh !important;}.icon.icon-error-stub {display:flex;justify-content:center;align-items:center;}"};function qm(e,t){pi(t,!0),mr(e,Wm);let[i,r]=la(),a=fa(t,"sources",7),s=fa(t,"store",7),n=fa(t,"microStoresRoot",7),o=fa(t,"videoConfig",7),l=fa(t,"uiConfig",7),u=fa(t,"title",7),d=fa(t,"thumbUrl",7),c=fa(t,"interactiveContainer",7),h=fa(t,"interactiveController",7),p=fa(t,"subtitles",7),v=fa(t,"live",7),b=fa(t,"preload",7),_=fa(t,"autoplay",7),y=fa(t,"volume",7,void 0),w=fa(t,"muted",7,void 0),S=fa(t,"fromTime",7),k=fa(t,"canRewindLive",7),T=fa(t,"showAds",7),E=fa(t,"adsSlotId",7,void 0),x=fa(t,"adsParams",7,void 0),$=fa(t,"adsPreviewParam",7,void 0),C=fa(t,"adsAutoplayParam",7,void 0),A=fa(t,"duration",7,void 0),P=fa(t,"logoClickable",7),L=fa(t,"logoHidden",7),M=fa(t,"isMobile",7),I=fa(t,"showNextPrevButtons",7,!1),R=fa(t,"nextButtonActive",7,!1),D=fa(t,"prevButtonActive",7,!1),O=fa(t,"endScreenVideoTitle",7,void 0),B=fa(t,"endScreenVideoThumb",7,void 0),N=fa(t,"isOneVideoPlaylist",7,!1),V=fa(t,"supportLink",7),U=fa(t,"shadowRootContainer",7,void 0),F=fa(t,"outerContainerRef",7,void 0),j=fa(t,"fullScreenTarget",7,void 0),z=fa(t,"failoverHosts",7,void 0),W=fa(t,"showMiniTimer",7,!1),q=fa(t,"saveRate",7),H=fa(t,"seekToInteractive",7,m.noop),K=fa(t,"playPrevChapter",7,m.noop),Q=fa(t,"volumeMultiplier",7),G=fa(t,"showAutoplayNext",7),Y=fa(t,"showEndScreen",7,!0),X=fa(t,"keyboardControls",15,void 0),{subscribers:Z,stores:J}=n();(e=>{ci("ui-config",e)})(l());let ee=ba(),ie=l().logoLink,ae=s().ui.debugPanelVisible,se=s().ui.playerSize,ne=s().state.isLive$,oe=s().state.isInteractive&&f.clientChecker.device.isAndroid,le=te(void 0),ue=null,de=te(!1);s().getAdmanWrapper().init({switchFromAdsToVideo:s().actions.internal.switchFromAdsToVideo,switchFromVideoToAds:s().actions.internal.switchFromVideoToAds,setMuted:s().actions.external.setMuted},s().ads,{isMobile:s().ui.isMobile,mobileUnmuteButtonVisible:s().ui.mobileUnmuteButtonVisible,vsid:s().vsid}),((e,t)=>{ci(Oa,e),ci(Ba,t)})(s(),J),Rt((()=>{s().ui.isMobile.set(M()),o().callbacks?.onDomReady?.()}));let ce=(e=!1)=>{re(de,!0),e?s().actions.external.firstStart(T()):s().actions.internal.firstStart(T())};function he(e){let t=a()||e;t&&s().initVideo({container:xt(le),sources:t,failoverHosts:z(),subtitles:p(),volumeMultiplier:Q()});let r="true"===m.safeStorage.get(_a);ae.set(r),S()>0&&s().actions.external.seekTime(S());let n=M()?ee.volumeDefault:y()??es()??ee.volumeDefault,o=w()??ss(qa);if(s().actions.external.setVolume(n),s().actions.external.setMuted(o),s().getAdmanWrapper().setInitialVolume(o?0:n),(()=>{if(ee.features.qualityDetailsSubMenuEnabled){let e=ds(s().videoId);if(e)switch(e.type){case"high_quality":s().actions.internal.setHighQualityEnabled(!0,e.appliesTo);break;case"traffic_saving":s().actions.internal.setTrafficSavingEnabled(!0,e.appliesTo);break;case"exact_quality":s().actions.internal.setQuality(e.quality)}}else{cs(s().videoId),ls()&&s().actions.internal.setTrafficSavingEnabled(!0);let e=rs(s().videoId);e&&s().actions.internal.setQuality(e)}})(),ee.features.saveRate&&q()){let e=(()=>{let e=m.safeStorage.get(Ya);if((0,m.isNullable)(e))return;let{rate:t}=JSON.parse(e);return t})();e&&!oa(ne,"$isLive$",i)&&s().actions.internal.setPlaybackRate(e)}if(G()){let e=ss(Xa);e&&s().actions.internal.setAutoplayNextEnabled(e)}s().ui.isAutoplay.set(_()),_()?ce():b()&&ee.features.preload&&s().actions.internal.preload()}let pe=()=>{document.hidden&&s().actions.external.stop()};function fe(e){s().actions.internal.seekTime(e,g.SeekAction.UNKNOWN)}Xr((()=>{oe&&document.addEventListener("visibilitychange",pe),ee.debugLog&&s().actions.internal.startLogging(),(e=>{if(window.ResizeObserver){let t,i;ue=new ResizeObserver((0,m.throttleFn)((e=>{let r=e[0];if(r.contentBoxSize){let e=Array.isArray(r.contentBoxSize)?r.contentBoxSize[0]:r.contentBoxSize;t=e.inlineSize,i=e.blockSize}else r.contentRect&&(t=r.contentRect.width,i=r.contentRect.height);se.set({width:t,height:i})}),300)),ue.observe(e)}se.set({width:e.clientWidth,height:e.clientHeight})})(xt(le));let e=Z.map((e=>e.init({store:s(),microStores:J,config:o(),interactiveController:h(),uiConfig:l()}))),t=()=>{oe&&document.removeEventListener("visibilitychange",pe),ue?.disconnect(),e.forEach((e=>e.unsubscribe())),s().destroy()};return"upcoming"===v()?.status?(s().actions.internal.setLiveWaitingStart(!0),t):"waiting"===v()?.status?(s().actions.internal.setLiveWaitingRecover(!0),t):"finished"!==v()?.status&&"postlive"!==v()?.status||Object.keys(a()||[]).length?(he(),t):(s().actions.internal.setLiveWaitingRecord(!0),t)}));let me=Nm(ee.view),ge="preview"===o().playerView;var ve=zm();let be;kr(ve,me);var _e=Oe(ve),ye=e=>{Bm(e,{get store(){return s()},uiConfig:ee,get thumbUrl(){return d()},get interactiveContainer(){return c()},get live(){return v()},get autoplay(){return _()},get canRewindLive(){return k()},get showAds(){return T()},get adsSlotId(){return E()},get adsParams(){return x()},get adsPreviewParam(){return $()},get adsAutoplayParam(){return C()},get duration(){return A()},get logoClickable(){return P()},get logoHidden(){return L()},logoTargetUrl:ie,get nextButtonActive(){return R()},get prevButtonActive(){return D()},get endScreenVideoTitle(){return O()},get endScreenVideoThumb(){return B()},get isOneVideoPlaylist(){return N()},get supportLink(){return V()},get shadowRootContainer(){return U()},get outerContainerRef(){return F()},get fullScreenTarget(){return j()},get showMiniTimer(){return W()},get playerStarted(){return xt(de)},get seekToInteractive(){return H()},get playPrevChapter(){return K()},firstStart:ce,seekTime:fe,get showEndScreen(){return Y()},get showAutoplayNext(){return G()},get showNextPrevButtons(){return I()},get videoContainer(){return xt(le)},set videoContainer(e){re(le,Ae(e))}})},we=e=>{var t=Fi(),i=Be(t),r=e=>{jm(e,{get thumbUrl(){return d()},get outsideDuration(){return A()},get canRewindLive(){return k()},get videoContainer(){return xt(le)},set videoContainer(e){re(le,Ae(e))}})},a=e=>{vm(e,{get store(){return s()},uiConfig:ee,get title(){return u()},get thumbUrl(){return d()},get interactiveContainer(){return c()},get live(){return v()},get autoplay(){return _()},get canRewindLive(){return k()},get showAds(){return T()},get adsSlotId(){return E()},get adsParams(){return x()},get adsPreviewParam(){return $()},get adsAutoplayParam(){return C()},get duration(){return A()},get logoClickable(){return P()},get logoHidden(){return L()},logoTargetUrl:ie,get nextButtonActive(){return R()},get prevButtonActive(){return D()},get endScreenVideoTitle(){return O()},get endScreenVideoThumb(){return B()},get isOneVideoPlaylist(){return N()},get supportLink(){return V()},get shadowRootContainer(){return U()},get outerContainerRef(){return F()},get fullScreenTarget(){return j()},get showMiniTimer(){return W()},get playerStarted(){return xt(de)},get seekToInteractive(){return H()},get playPrevChapter(){return K()},firstStart:ce,get showEndScreen(){return Y()},get showAutoplayNext(){return G()},get showNextPrevButtons(){return I()},get videoContainer(){return xt(le)},set videoContainer(e){re(le,Ae(e))},get keyboardControls(){return X()},set keyboardControls(e){X(e)}})};Zi(i,(e=>{ge?e(r):e(a,!1)})),ji(e,t)};Zi(_e,(e=>{M()?e(ye):e(we,!1)})),xe(ve),Bt((e=>be=wr(ve,1,"root svelte-7ed4yj",null,be,e)),[()=>({"root--miui-browser":f.clientChecker.device.isMobile&&f.clientChecker.browser.isMiuiBrowser,"visible-outside":ge})]),ji(e,ve);var Se=fi({initVideo:he,play:function(){xt(de)?s().actions.external.play():ce(!0)},pause:function(){s().actions.external.pause()},setMuted:function(e){s().actions.external.setMuted(e)},toggleSubtitle:function(){s().actions.external.toggleSubtitle()},hideControls:function(){s().webApi.slotsApi?.haveSlots()&&s().actions.external.hideControls()},showControls:function(){s().webApi.slotsApi?.haveSlots()&&s().actions.external.showControls()},setVolume:function(e){M()||e>=0&&e<=1&&s().actions.external.setVolume(e)},seekTime:fe,seekEpisodeStartTime:function(e){s().actions.external.seekEpisodeStartTime(e)},returnFocusToEpisodes:function(){s().actions.external.returnFocusToEpisodes()},setPlaybackRate:function(e){s().actions.external.setPlaybackRate(e)},setAutoQualityLimits:function(e){s().actions.external.setAutoQualityLimits(e)},get sources(){return a()},set sources(e){a(e)},get store(){return s()},set store(e){s(e)},get microStoresRoot(){return n()},set microStoresRoot(e){n(e)},get videoConfig(){return o()},set videoConfig(e){o(e)},get uiConfig(){return l()},set uiConfig(e){l(e)},get title(){return u()},set title(e){u(e)},get thumbUrl(){return d()},set thumbUrl(e){d(e)},get interactiveContainer(){return c()},set interactiveContainer(e){c(e)},get interactiveController(){return h()},set interactiveController(e){h(e)},get subtitles(){return p()},set subtitles(e){p(e)},get live(){return v()},set live(e){v(e)},get preload(){return b()},set preload(e){b(e)},get autoplay(){return _()},set autoplay(e){_(e)},get volume(){return y()},set volume(e){y(e)},get muted(){return w()},set muted(e){w(e)},get fromTime(){return S()},set fromTime(e){S(e)},get canRewindLive(){return k()},set canRewindLive(e){k(e)},get showAds(){return T()},set showAds(e){T(e)},get adsSlotId(){return E()},set adsSlotId(e){E(e)},get adsParams(){return x()},set adsParams(e){x(e)},get adsPreviewParam(){return $()},set adsPreviewParam(e){$(e)},get adsAutoplayParam(){return C()},set adsAutoplayParam(e){C(e)},get duration(){return A()},set duration(e){A(e)},get logoClickable(){return P()},set logoClickable(e){P(e)},get logoHidden(){return L()},set logoHidden(e){L(e)},get isMobile(){return M()},set isMobile(e){M(e)},get showNextPrevButtons(){return I()},set showNextPrevButtons(e){I(e)},get nextButtonActive(){return R()},set nextButtonActive(e){R(e)},get prevButtonActive(){return D()},set prevButtonActive(e){D(e)},get endScreenVideoTitle(){return O()},set endScreenVideoTitle(e){O(e)},get endScreenVideoThumb(){return B()},set endScreenVideoThumb(e){B(e)},get isOneVideoPlaylist(){return N()},set isOneVideoPlaylist(e){N(e)},get supportLink(){return V()},set supportLink(e){V(e)},get shadowRootContainer(){return U()},set shadowRootContainer(e){U(e)},get outerContainerRef(){return F()},set outerContainerRef(e){F(e)},get fullScreenTarget(){return j()},set fullScreenTarget(e){j(e)},get failoverHosts(){return z()},set failoverHosts(e){z(e)},get showMiniTimer(){return W()},set showMiniTimer(e){W(e)},get saveRate(){return q()},set saveRate(e){q(e)},get showAutoplayNext(){return G()},set showAutoplayNext(e){G(e)},get seekToInteractive(){return H()},set seekToInteractive(e){H(e)},get playPrevChapter(){return K()},set playPrevChapter(e){K(e)},get volumeMultiplier(){return Q()},set volumeMultiplier(e){Q(e)},get showEndScreen(){return Y()},set showEndScreen(e){Y(e)},get keyboardControls(){return X()},set keyboardControls(e){X(e)}});return r(),Se}var Hm=Vi('<svg><!><path fill="currentColor" d="M38.245 6c3.566 0 4.859.371 6.162 1.069a7.27 7.27 0 0 1 3.025 3.024c.697 1.303 1.068 2.597 1.068 6.163v23.489c0 3.566-.371 4.859-1.069 6.162a7.27 7.27 0 0 1-3.024 3.025C43.104 49.629 41.811 50 38.245 50h-19.49c-3.565 0-4.859-.371-6.162-1.069a7.27 7.27 0 0 1-3.024-3.024C8.87 44.604 8.5 43.311 8.5 39.745v-23.49c0-3.565.371-4.859 1.069-6.162a7.27 7.27 0 0 1 3.024-3.024C13.896 6.37 15.19 6 18.756 6zm.314 3H18.756c-2.799 0-3.761.186-4.749.714a4.27 4.27 0 0 0-1.793 1.793c-.508.95-.7 1.876-.713 4.434L11.5 39.744c0 2.799.186 3.761.714 4.749a4.27 4.27 0 0 0 1.793 1.793c.988.528 1.95.714 4.749.714h19.489c2.798 0 3.76-.186 4.748-.714a4.27 4.27 0 0 0 1.793-1.793c.528-.988.714-1.95.714-4.748v-23.49c0-2.798-.186-3.76-.714-4.748a4.27 4.27 0 0 0-1.793-1.793c-.95-.508-1.876-.7-4.434-.713zM19.22 38c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.163.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.607-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.163-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.608.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134zm-20-8c.445 0 .607.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.162.088-.324.134-.77.134h-1.436c-.446 0-.608-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.162-.088.324-.134.77-.134h1.436zm20 0c.445 0 .606.046.77.134a.9.9 0 0 1 .377.378c.088.162.134.324.134.77v1.436c0 .446-.046.608-.134.77a.9.9 0 0 1-.378.378c-.163.088-.324.134-.77.134h-1.436c-.446 0-.607-.046-.77-.134a.9.9 0 0 1-.378-.378c-.088-.162-.134-.324-.134-.77v-1.436c0-.446.046-.607.134-.77a.9.9 0 0 1 .378-.378c.163-.088.324-.134.77-.134z"></path></svg>');function Km(e,t){let i=fa(t,"isWhite",3,!1),r=ne((()=>i()?"color: #fff;":"color: #909499;"));!function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Hm();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"57",height:"60",fill:"none","aria-hidden":"true","data-testid":"stub-icon",role:"img",...i}))),ji(e,r)}(e,{get style(){return xt(r)}})}var Qm=Ni('<div class="title svelte-1y9fytq"> </div>'),Gm=Ni('<div class="playerStub svelte-1y9fytq"><!> <!></div>'),Ym={hash:"svelte-1y9fytq",code:".playerStub.svelte-1y9fytq {width:100%;height:100%;background-color:#222;display:flex;justify-content:center;align-items:center;position:relative;background-position:center;background-size:cover;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;}.title.svelte-1y9fytq {position:absolute;left:0;top:0;width:100%;font-size:15px;color:#fff;box-sizing:border-box;padding:18px 20px 10px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}"};function Xm(e,t){mr(e,Ym);var i=Gm(),r=Oe(i),a=e=>{var i=Qm(),r=Oe(i,!0);xe(i),Bt((()=>qi(r,t.title))),ji(e,i)};Zi(r,(e=>{t.title&&e(a)}));var s=Ne(r,2),n=e=>{let i=ne((()=>!!t.thumbUrl));Km(e,{get isWhite(){return xt(i)}})};Zi(s,(e=>{(!t.title||!t.thumbUrl)&&e(n)})),xe(i),Bt((()=>kr(i,t.thumbUrl?`background-image: url('${t.thumbUrl}')`:""))),ji(e,i)}var Zm=class{isSupported(){return"mediaSession"in navigator}setMetaData({title:e,artist:t="",thumbUrl:i=""}){this.isSupported()&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:t,artwork:[{src:i,sizes:"96x96",type:"image/png"},{src:i,sizes:"128x128",type:"image/png"},{src:i,sizes:"192x192",type:"image/png"},{src:i,sizes:"256x256",type:"image/png"},{src:i,sizes:"384x384",type:"image/png"},{src:i,sizes:"512x512",type:"image/png"}]}))}updateActionHandlers(e){this.resetActionHandlers(),this.setActionHandlers(e)}resetActionHandlers(){this.setActionHandlers([["play",null],["pause",null],["stop",null],["nexttrack",null],["previoustrack",null],["seekto",null],["seekbackward",null],["seekforward",null]])}setActionHandlers(e){if(this.isSupported())for(let[t,i]of e)try{navigator.mediaSession.setActionHandler?.(t,i)}catch{throw new Error(`The media session action "${t}" is not supported yet.`)}}attachToStore(e){!this.isSupported()||!e||(this.clearSubscriptions(),this.subscription.add(e.state.positionExact$.subscribe((t=>{let i=aa(e.state.currentPlaybackRate$),r=aa(e.state.duration$);if(isFinite(t)&&isFinite(r))try{navigator.mediaSession.setPositionState?.({position:t,playbackRate:i,duration:r})}catch{this.log({message:`MediaSession setPositionState can't call with position: ${t} and duration: ${r}`})}}))))}clearSubscriptions(){this.subscription.unsubscribe()}destroy(){this.resetActionHandlers(),this.clearSubscriptions()}constructor(){this.subscription=new m.Subscription,this.logger=new m.Logger,this.log=this.logger.createComponentLog("MediaSessionApi")}},Jm=Vi('<svg><!><g fill="var(--btn-color, #fff)"><path d="m30.744 4 .744.005c2.981.046 4.526.385 6.127 1.24a8.77 8.77 0 0 1 3.475 3.347l.174.312.15.292c.772 1.553 1.066 3.18 1.085 6.251v9.045a1.5 1.5 0 0 1-3 .016l-.008-9.651c-.04-2.032-.228-3.12-.627-4.035l-.126-.27-.13-.252A5.77 5.77 0 0 0 36.2 7.891c-1.187-.635-2.339-.873-5.115-.89L22.255 7c-2.737 0-4.003.2-5.071.698l-.133.064-.251.13a5.77 5.77 0 0 0-2.409 2.408c-.635 1.187-.873 2.339-.89 5.114l-.001 20.83c0 2.738.2 4.004.698 5.072l.064.133.13.251a5.77 5.77 0 0 0 2.408 2.409c1.1.588 2.134.825 4.438.88l.323.006 3.695.005H26a1.5 1.5 0 0 1 0 3h-.756l-3.718-.005c-2.989-.047-4.526-.377-6.14-1.24a8.77 8.77 0 0 1-3.476-3.347l-.174-.312-.15-.292c-.731-1.472-1.036-3.016-1.08-5.803l-.006-.756v-20.49l.005-.743c.046-2.981.385-4.526 1.24-6.127a8.77 8.77 0 0 1 3.347-3.475l.312-.174.292-.15c1.472-.731 3.016-1.036 5.803-1.08L22.256 4z"></path><path d="M30.5 33.8c0-1.68 0-2.52.327-3.162a3 3 0 0 1 1.311-1.311C32.78 29 33.62 29 35.3 29h6.4c1.68 0 2.52 0 3.162.327a3 3 0 0 1 1.311 1.311c.327.642.327 1.482.327 3.162v13.4c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C44.22 52 43.38 52 41.7 52h-6.4c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C30.5 49.72 30.5 48.88 30.5 47.2z"></path></g></svg>');var eg=Ni('<div><div><!></div> <span class="title svelte-1pbsod4"> </span></div>'),tg={hash:"svelte-1pbsod4",code:".player-pip-dummy.svelte-1pbsod4 {width:100%;height:100%;background-color:#19191A;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;}.player-pip-dummy.is-pip-api.svelte-1pbsod4 {position:relative;}.dummy-image.svelte-1pbsod4 svg {transform:scale(1.07143);}.dummy-image.desktop.svelte-1pbsod4 {transform:scale(1.07143) rotate(-90deg) rotateY(180deg);}.title.svelte-1pbsod4 {font-size:16px;color:#fff;padding:18px 20px 10px;text-align:center;}"};function ig(e,t){pi(t,!0),mr(e,tg);let[i,r]=la(),a=Na(),s=ba(),n=!!a.webApi.pictureInPictureApi,o=a.interfaceLanguage$,l=a.ui.isMobile,u=a.ui.t,d=ne((()=>oa(o,"$interfaceLanguage$",i)&&u("pip_dummy_title"))),c=Nm(s.view);var h=eg();wr(h,1,"player-pip-dummy svelte-1pbsod4",null,{},{"is-pip-api":n}),kr(h,c);var p=Oe(h);let f;(function(e,t){let i=da(t,["$$slots","$$events","$$legacy","children"]);var r=Jm();let a;cr(Oe(r),(()=>t.children??N)),$e(),xe(r),Bt((()=>a=Pr(r,a,{xmlns:"http://www.w3.org/2000/svg",width:"57",height:"56",fill:"none","aria-label":"dummy-image","data-testid":"pip-dummy-icon",role:"img",...i}))),ji(e,r)})(Oe(p),{}),xe(p);var m=Ne(p,2),g=Oe(m,!0);xe(m),xe(h),Bt((e=>{f=wr(p,1,"dummy-image svelte-1pbsod4",null,f,e),qi(g,xt(d))}),[()=>({desktop:!oa(l,"$isMobile$",i)})]),ji(e,h),fi(),r()}var rg=class{isSupported(){let{isEmbed:e}=(0,m.detectEmbed)();return"documentPictureInPicture"in window&&!e}isActive(){return this.isSupported()&&!!documentPictureInPicture.window}setPlayerDomElement(e,t){this.playerDomElement=e,this.playerParentShadowRoot=t}setContext(e){this.svelteContext=e}async request(){if(!this.isSupported()||!this.playerDomElement||!this.playerParentShadowRoot)return;this.pipWindow=await documentPictureInPicture.requestWindow({width:460,height:280,copyStyleSheets:!0}),this.pipWindow.document.body.style.margin="0";let e=[...this.playerParentShadowRoot.styleSheets].map((e=>[...e.cssRules].map((e=>e.cssText)).join(" "))).filter(Boolean).join("\n"),t=document.createElement("style");t.textContent=e;let i=this.createStretchedContainer(),r=i.attachShadow({mode:"open"});r.append(t),r.append(this.playerDomElement);let a={target:this.playerParentShadowRoot,context:this.svelteContext};this.playerDummyElement=Hi(ig,a),this.pipWindow?.document.body.append(i),this.info.isActive$.next(!0),this.pipWindow?.addEventListener("unload",(e=>{!this.playerDomElement||!this.playerParentShadowRoot||!this.playerDummyElement||(Xi(this.playerDummyElement),this.playerParentShadowRoot.append(this.playerDomElement),this.info.isActive$.next(!1))}))}async remove(){return new Promise((e=>{documentPictureInPicture.window?.close(),e()}))}async dispose(){await this.remove()}setEnabled(e){this.info.isEnabled$.next(e)}createStretchedContainer(){let e=document.createElement("div");return e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e}constructor({enabled:e=!0}={enabled:!0}){this.info={isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1),type:1},this.info.isEnabled$=new m.ValueSubject(e)}};var ag=class{static getLatestSupportedVersion(e){let t=new Qs(e),i=new rg(e);return i.isSupported()?i:t.isSupported()?t:void 0}};function sg(e,t){let i=new Set([...Object.keys(e),...Object.keys(t)]),r={};for(let a of i)r[a]=t[a]??e[a]??void 0;return r}var ng=class extends Error{constructor(e){super(e),this.name="AnnotationError"}},og=class{init(e){if(this.rootAnnotationsContainer=e,this.annotationsInside)return;let t=(0,m.throttleFn)((()=>{for(let e of this.annotations.values())this.isElementExceedsBoundaries(e,this.playerSize.width,this.playerSize.height)?e.style.visibility="hidden":e.style.visibility="visible"}),100);this.subscriptions.add((0,m.observeElementSize)(this.rootAnnotationsContainer).subscribe((({width:e,height:i})=>{this.playerSize={width:e,height:i},t()}))),this.mutationObserver=new MutationObserver(t),this.mutationObserver.observe(this.rootAnnotationsContainer,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}add(e,t){if(!this.rootAnnotationsContainer)throw new ng("Inner error. Unexpectedly root annotation container null reference exception");if(this.annotations.has(e))throw new ng("Annotation with such name already exists");t.style.zIndex=t.style.zIndex??"1",t.style.position="absolute",this.rootAnnotationsContainer.append(t),this.annotations.set(e,t)}get(e){let t=this.annotations.get(e);if(!t)throw new ng("Annotation with such name does not exist");return t}remove(e){let t=this.get(e);this.annotations.delete(e)&&t.remove()}clear(){for(let e in this.annotations.keys())this.remove(e)}destroy(){this.annotations.clear(),this.subscriptions.unsubscribe(),this.mutationObserver?.disconnect(),this.rootAnnotationsContainer=null}isElementExceedsBoundaries(e,t,i){let r=e.offsetTop,a=e.offsetLeft,s=e.offsetWidth,n=e.offsetHeight;return r<0||a<0||a+s>t||r+n>i}registryRootContainer(e){}addLayer(e){return document.createElement("div")}getLayer(e){}removeLayer(e){}clearLayer(e){}detach(){}reattach(){}constructor(e){this.annotationsInside=e,this.annotations=new Map,this.subscriptions=new m.Subscription}},lg=class{init({store:e,microStores:t,interactiveController:i,config:r}){return(0,m.assertNonNullable)(e),(0,m.assertNonNullable)(t),(0,m.assertNonNullable)(r),r.interactiveData&&(0,m.assertNonNullable)(i),this.subscription=new m.Subscription,this.subscription}},ug=class extends lg{init(e){let t=super.init(e),{isInteractiveExpectation$:i}=e.store.state;return t.add(i.subscribe((e=>{this.state$.set(!!e||null)}))),t}constructor(){super(...arguments),this.stateName="fakeIsPlaying$",this.state$={...ia(null),toggle:()=>this.state$.update((e=>!e))}}},dg=class extends lg{init(e){let t=super.init(e),{microStores:i,store:r}=e,{fakeIsPlaying$:a}=i,{isInteractiveExpectation$:s,isPlaying$:n}=r.state,{controlsVisible:o,isMobile:l}=r.ui,u=aa(l),d=()=>u&&aa(o);return t.add(o.subscribe((e=>{if(!u)return;let t=aa(a);aa(n)?this.state$.set(e):null!==t&&this.state$.set(!t||e)}))),t.add(n.subscribe((e=>{this.state$.set(!e||d())}))),t.add(a.subscribe((e=>{if(null===e)return;let t=aa(s);d()?this.state$.set(!0):t&&this.state$.set(!e)}))),t}constructor(){super(...arguments),this.stateName="interactiveControlsOpacity$",this.state$={...ia(null),toggle:()=>this.state$.update((e=>!e))}}},cg=class extends lg{init(e){let t=super.init(e),{store:i}=e;return t.add(i.state.interactiveEpisodes$.subscribe((e=>{e.length&&(e.every((e=>e.completed))?this.state$.set("tooltip_interactive_of_chapter_completed"):this.state$.set("tooltip_disabled_when_interactive"))}))),t}constructor(){super(...arguments),this.stateName="seekToInteractiveDisabledTooltip$",this.state$=ia("tooltip_chapter_without_interactive")}},hg=ia(!1),pg=null,fg=class extends lg{init(e){let t=super.init(e),{store:i,config:r}=e,{isInteractiveTime$:a,isPlaying$:s}=i.state,n=i.ui.controlsVisible,{interactiveTimeIndicator:o}=i.ui.controls;t.add(n.subscribe((e=>{aa(a)&&e&&this.state$.set(!1)})));let l=r?.interactiveData||{tooltipHelpHintActive:!1};return t.add((0,m.combine)({isPlaying$:s,isInteractiveTime$:a,interactiveTimeIndicator:o}).subscribe((({isPlaying$:e,isInteractiveTime$:t,interactiveTimeIndicator:r})=>{if(e&&r?.isDisplayed){if(!t)return this.state$.set(!1);l.tooltipHelpHintActive&&null===pg&&(pg=!0,l.tooltipHelpHintActive=!1,this.state$.set(!0),i.callbacks?.onInteractiveTimeIndicatorHintDeactivated?.())}}))),t}clearTimeout(){window.clearTimeout(this.timeout)}constructor(){super(...arguments),this.stateName="showInteractiveTimeIndicatorTooltip$",this.state$={...hg,set:(e,t=!1)=>{e!==aa(hg)&&(this.clearTimeout(),hg.set(e),!e&&pg&&(pg=!1),e&&t&&(this.timeout=setTimeout((()=>{this.state$.set(!1)}),3e3)))},clearTimeout:()=>this.clearTimeout()}}},mg=class extends lg{init(e){let t=super.init(e),{store:i,interactiveController:r}=e,a=i.ui.currentGridType$,s=i.getLogger().createComponentLog("GraphIsOpened microStore");return this.state$.toggle=async()=>{if(this.checkIfShouldHide(aa(a)))return;let e=aa(this.state$),{isEnded$:t,playbackState$:n}=i.state,{disabledControls$:o}=i.ui.controls,l=aa(t),u=aa(n);if(e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1),o.remove(Aa),!l&&this.graphMadePause&&i.actions.internal.play()}catch{s({message:"Cant hide graph"})}else{this.graphMadePause="playing"===u;try{await(r?.toggleGraphView(!0)),this.state$.set(!0),o.add(Aa),!l&&this.graphMadePause&&i.actions.internal.pause()}catch{s({message:"Cant show graph"})}}},t.add((0,m.combine)({graphIsOpened:this.state$,currentGridType:a}).subscribe((async({graphIsOpened:e,currentGridType:t})=>{if(this.checkIfShouldHide(t)&&e)try{await(r?.toggleGraphView(!1)),this.state$.set(!1)}catch{s({message:"Cant hide graph"})}}))),t}constructor(){super(...arguments),this.stateName="graphIsOpened$",this.graphMadePause=!1,this.state$={...ia(null),toggle:m.noop},this.checkIfShouldHide=e=>uu(e,"s")}},gg=class extends lg{init(e){let t=super.init(e),{store:i}=e,{info:{isActive$:r,isEnabled$:a,type:s}}=i.webApi.pictureInPictureApi||{info:{isActive$:new m.ValueSubject(!1),isEnabled$:new m.ValueSubject(!1)}};return t.add(r.subscribe((e=>{this.state$.isActive$.set(e)}))),t.add(a.subscribe((e=>{this.state$.isEnabled$.set(e)}))),this.state$.type$.set(s),t}constructor(){super(...arguments),this.stateName="pictureInPicture$",this.state$={isActive$:ia(!1),isEnabled$:ia(!1),type$:ia(void 0)}}},vg=({maxCount:e})=>{let t={};return{notificationShowed:e=>{t[e]=(t[e]??0)+1,m.safeStorage.set("videoplayer_notifications_manager_count",JSON.stringify(t[e]??0))},canShowNotification:i=>(t[i]??0)<e}},bg=({timeout:e})=>{let t="videoplayer_notifications_manager",i=()=>{try{return JSON.parse(m.safeStorage.get(t)||"{}")}catch{return{}}},r=e=>m.safeStorage.set(t,JSON.stringify(e));return{notificationShowed:t=>{r({...i(),[t]:{timeout:e,launchTime:Date.now()}})},canShowNotification:t=>{let a=i()[t];if(a){let s=Date.now()-a.launchTime>e;return s&&(e=>{let t=i();delete t[e],r(t)})(t),s}return!0}}},_g=class extends lg{init(e){let t=super.init(e),{store:i,uiConfig:{features:{maxCountShowSlowVideoNotification:r,timeoutShowSlowVideoNotification:a,showSlowVideoNotification:s,forceAutoQualityWhenSevereStallHappens:n}}}=e;this.notificationManager=(({maxShowCount:e,timeout:t})=>{let i=[0!==e?vg({maxCount:e}):void 0,0!==t?bg({timeout:t}):void 0].filter((e=>!!e));return{notificationShowed:e=>i.forEach((t=>t.notificationShowed(e))),canShowNotification:e=>i.every((t=>t.canShowNotification(e)))}})({maxShowCount:r,timeout:a});let o=i.getPlayer();return t.add(o.events.severeStallOccured$.pipe((0,m.filterChanged)(),(0,m.filter)((e=>e))).subscribe((()=>{s&&!o.info.isAutoQualityEnabled$.getValue()&&this.notificationManager.canShowNotification("slow_video")&&(n&&i.actions.internal.setQuality("auto"),this.state$.showNotification("slow_video"))}))),t}constructor(){super(...arguments),this.stateName="notifications$",this.state$={notificationsToShow$:ia({}),showNotification:e=>{this.state$.notificationsToShow$.update((t=>(t[e]=!0,t))),this.notificationManager.notificationShowed(e)},closeNotification:e=>{this.state$.notificationsToShow$.update((t=>(delete t[e],t)))}}}},yg={preload:!0,autoplay:!1,repeat:!1,fromTime:0,canRewindLive:!0,showAds:!1,interfaceLanguage:m.InterfaceLanguage.RU,isCyrillicRelatedInterface:!0,logoClickable:!1,logoHidden:!1,isTouch:(0,f.isMobile)(),isMediaSessionEnabled:!0,isPictureInPictureEnabled:!0,isAudioDisabled:!1,callbacks:{uiInfo:{}},tuningConfig:{configName:[]},saveRate:!0,volumeMultiplier:1,showEndScreen:!0,showAutoplayNext:!0,showNextPrevButtons:!0},wg=te(void 0);HTMLElement;function Sg(){return(0,h._)(this,l)[l]??((0,h._)(this,l)[l]=new ResizeObserver((e=>{for(var t of e)for(var i of(c.entries.set(t.target,t),(0,h._)(this,o)[o].get(t.target)||[]))i(t)})))}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,i,r)=>{if(!t){var a=1/0;for(l=0;l<deferred.length;l++){for(var[t,i,r]=deferred[l],s=!0,n=0;n<t.length;n++)(!1&r||a>=r)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[n])))?t.splice(n--,1):(s=!1,r<a&&(a=r));if(s){deferred.splice(l--,1);var o=i();void 0!==o&&(e=o)}}return e}r=r||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>r;l--)deferred[l]=deferred[l-1];deferred[l]=[t,i,r]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var r={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var a=2&t&&e;"object"==typeof a&&!~leafPrototypes.indexOf(a);a=getProto(a))Object.getOwnPropertyNames(a).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,__webpack_require__.d(i,r),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>6827===e?"api/widgets/chunks/podcasts_web.0d151dd3.js":2377===e?"api/widgets/chunks/7c7b6bc8.async.c6216da9.js":4338===e?"api/widgets/chunks/31b94978.async.5bf881ab.js":8651===e?"api/widgets/chunks/bookmarkClipPost.4926c9b2.js":4639===e?"api/widgets/chunks/plugins_maps_mmrgl_script_chunk.62da1bb7.js":685===e?"api/widgets/chunks/plugins_maps_mmrgl_style_chunk.f9b40580.js":5458===e?"api/widgets/chunks/hls.b2b5baec.js":272===e?"api/widgets/chunks/palette.5389ea50.js":42===e?"api/widgets/chunks/0bf91841.async.4f6a1108.js":2150===e?"api/widgets/chunks/98677ffd.async.22e028a4.js":4190===e?"api/widgets/chunks/audio_config_legacy.9da03cb4.js":8586===e?"api/widgets/chunks/audio_config_overrides.3137ae21.js":8271===e?"api/widgets/chunks/audio_web_globalPlayerImpl.acd9d188.js":72===e?"api/widgets/chunks/showCaptchaPopup.40d7b98d.js":7135===e?"api/widgets/chunks/audio_onMediaAttachmentPlayer.971b6522.js":9072===e?"api/widgets/chunks/left_menu_store.24601dfc.js":2255===e?"api/widgets/chunks/wikiModalExampleInitiator.62bccd07.js":1478===e?"api/widgets/chunks/af4eccc8.async.201ee30f.js":6965===e?"api/widgets/chunks/stories_web_lib.69246d04.js":2943===e?"api/widgets/chunks/video_web_lib.cada86fd.js":3927===e?"api/widgets/chunks/questions_boxes_web.49f32c4c.js":8378===e?"api/widgets/chunks/14bee6e1.async.29fcc84f.js":774===e?"api/widgets/chunks/show_attachment_audio_list.c37de391.js":4571===e?"api/widgets/chunks/6aac6fbc.async.5f5fac74.js":5651===e?"api/widgets/chunks/cbf9533c.async.9116e04a.js":7895===e?"api/widgets/chunks/money_transfer_box.93574806.js":905===e?"api/widgets/chunks/money_transfer.2e38ce7e.js":6086===e?"api/widgets/chunks/MiniAppsLifecycle.8b9e800a.js":6192===e?"api/widgets/chunks/da73db53.async.ddfdac71.js":2780===e?"api/widgets/chunks/ec4d4658.async.d0b96112.js":1069===e?"api/widgets/chunks/6fb476fc.async.a0363ab1.js":4835===e?"api/widgets/chunks/unauth_action_box.cfd48ba9.js":1909===e?"api/widgets/chunks/af1c2519.async.1cadc235.js":7678===e?"api/widgets/chunks/03f2270a.async.f21c9118.js":9886===e?"api/widgets/chunks/StoryPublisherV2.0f3afe30.js":8425===e?"api/widgets/chunks/sticker-gift-modal-legacy.5f0ca7e5.js":2007===e?"api/widgets/chunks/gift-modal-legacy.018edf70.js":2166===e?"api/widgets/chunks/showDonutSubscriptionModal.1ef28338.js":6158===e?"api/widgets/chunks/20423f97.async.ebba215f.js":8756===e?"api/widgets/chunks/c4851f31.async.33313f10.js":9311===e?"api/widgets/chunks/feed-client-nav-skeleton.12a4b551.js":6091===e?"api/widgets/chunks/feed-client-nav-async-right-block.413aa896.js":1715===e?"api/widgets/chunks/AudioLongtapModal.4e5c21cb.js":2019===e?"api/widgets/chunks/a8438c1b.async.528748e2.js":3641===e?"api/widgets/chunks/audio_modals_MusicTrackList.7668abdb.js":1713===e?"api/widgets/chunks/voice_message_player.605790ad.js":9925===e?"api/widgets/chunks/speech.736e1075.js":5153===e?"api/widgets/chunks/5153.698373c1.js":264===e?"api/widgets/chunks/videoplayer-interactive.b19f43ce.js":7272===e?"api/widgets/chunks/7a162ebe.async.11bff227.js":874===e?"api/widgets/chunks/874.e3647207.js":5817===e?"api/widgets/chunks/5817.efa85deb.js":8240===e?"api/widgets/chunks/8240.ee7b0309.js":6694===e?"api/widgets/chunks/menu_settings.9acce4b6.js":1095===e?"api/widgets/chunks/PodcastEpisodeModal.58daeb0e.js":9883===e?"api/widgets/chunks/25afeb9f.async.8692c5a4.js":377===e?"api/widgets/chunks/140089f8.async.5163ee2f.js":327===e?"api/widgets/chunks/64168c82.async.126e764d.js":6502===e?"api/widgets/chunks/NewStickerPicker.a2e3dc42.js":2334===e?"api/widgets/chunks/stories-perf-metrics.a2a4bd35.js":3801===e?"api/widgets/chunks/0de7b9e0.async.ff7d87b9.js":191===e?"api/widgets/chunks/stories_viewer.f11e4da0.js":1943===e?"api/widgets/chunks/VideoUpload.ca40ada9.js":4972===e?"api/widgets/chunks/draggable.d942e2d0.js":1547===e?"api/widgets/chunks/33086c52.async.58f6b63d.js":6974===e?"api/widgets/chunks/ee99594e.async.d1845d0c.js":3836===e?"api/widgets/chunks/MessengerClipsModal.0096cf9e.js":5765===e?"api/widgets/chunks/f0128b85.async.b158fed2.js":9933===e?"api/widgets/chunks/ReportMiniApp.a69a6190.js":3214===e?"api/widgets/chunks/SilentModeForms.cb3e8d5b.js":504===e?"api/widgets/chunks/StoriesCreatorVKApp.53e8e822.js":4833===e?"api/widgets/chunks/performance-stats.27afbc92.js":9635===e?"api/widgets/chunks/9635.8d294c28.js":2643===e?"api/widgets/chunks/story_blocks.65579129.js":8459===e?"api/widgets/chunks/MiniApp.31a49841.js":6434===e?"api/widgets/chunks/ReportsProfileModal.c665862f.js":9595===e?"api/widgets/chunks/ReportForm.930c11df.js":7894===e?"api/widgets/chunks/StickersKit-AgeRestrictionModal.1d154f35.js":5700===e?"api/widgets/chunks/narratives_boxes.af1fe353.js":5805===e?"api/widgets/chunks/PublishClipToVideoModal.7ab084ae.js":7347===e?"api/widgets/chunks/9b163902.async.c4d445a9.js":1085===e?"api/widgets/chunks/89b67a05.async.3ead3bbc.js":1906===e?"api/widgets/chunks/VideoUploadModal.1542c5fc.js":4205===e?"api/widgets/chunks/VideoExternalUploadModal.3e24b229.js":6637===e?"api/widgets/chunks/ClipUploadModal.f8f8101a.js":5090===e?"api/widgets/chunks/video_upload_modal.85154b34.js":9370===e?"api/widgets/chunks/VideoEditorModal.9c0ed55d.js":8493===e?"api/widgets/chunks/AddClipToVideoBlock.887dc1ee.js":6099===e?"api/widgets/chunks/OpenNewVideoEditorButton.7ab894cb.js":3162===e?"api/widgets/chunks/framer-motion-entrypoint.e16a8298.js":3666===e?"api/widgets/chunks/rlottie.04ae016f.js":2731===e?"api/widgets/chunks/stickers-layer-view.840a2700.js":6846===e?"api/widgets/chunks/stickers-layer-purchase-details-view.d0053abf.js":4273===e?"api/widgets/chunks/stickers-random-selector-view.53cae69f.js":2318===e?"api/widgets/chunks/stickers-random-selector-packs-view.2986886d.js":1409===e?"api/widgets/chunks/stickers-random-selector-result-view.61f66854.js":3451===e?"api/widgets/chunks/MiniAppService_MiniApp.ec1bc450.js":9994===e?"api/widgets/chunks/HTMLToImage.805b0c09.js":6560===e?"api/widgets/chunks/CreateVideoChannelModal.43e27117.js":953===e?"api/widgets/chunks/AddClipToVideoModal.f9acd8ba.js":274===e?"api/widgets/chunks/ClipPlayerModule.d6829f64.js":2979===e?"chunks/2979.0fd93f09.js":9470===e?"chunks/9470.da1f8c15.js":616===e?"chunks/616.1f8e2658.js":1567===e?"chunks/1567.600647c1.js":void 0,__webpack_require__.miniCssF=e=>685===e?"api/widgets/chunks/d5a750da.css":72===e?"api/widgets/chunks/65e91a02.css":{4835:1,5700:1}[e]?"api/widgets/chunks/90ffc845.css":9886===e?"api/widgets/chunks/59bb9b9f.css":{9311:1,6091:1}[e]?"api/widgets/chunks/4e9f04d5.css":1715===e?"api/widgets/chunks/44cb49f5.css":6694===e?"api/widgets/chunks/b739642a.css":6502===e?"api/widgets/chunks/ad14ac55.css":191===e?"api/widgets/chunks/c2ed37f7.css":1943===e?"api/widgets/chunks/61f93964.css":3836===e?"api/widgets/chunks/a1337562.css":9933===e?"api/widgets/chunks/188dbb7e.css":3214===e?"api/widgets/chunks/06964372.css":504===e?"api/widgets/chunks/28c6e8fd.css":2643===e?"api/widgets/chunks/6cc41633.css":6434===e?"api/widgets/chunks/4c5ec4fd.css":9595===e?"api/widgets/chunks/afd733fc.css":5805===e?"api/widgets/chunks/f4631884.css":3509===e?"api/widgets/chunks/c9f40f81.css":{1906:1,4205:1,5090:1}[e]?"api/widgets/chunks/b7f78169.css":6637===e?"api/widgets/chunks/28a635c6.css":9370===e?"api/widgets/chunks/b8b2f5c5.css":8493===e?"api/widgets/chunks/6278dd5c.css":3666===e?"api/widgets/chunks/ec8e260f.css":2731===e?"api/widgets/chunks/426e108e.css":6846===e?"api/widgets/chunks/643e1b21.css":4273===e?"api/widgets/chunks/4ae9e277.css":2318===e?"api/widgets/chunks/9d5562a4.css":1409===e?"api/widgets/chunks/1c681ea5.css":953===e?"api/widgets/chunks/63cc2c28.css":274===e?"api/widgets/chunks/ff3a19b0.css":void 0,__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,i,r)=>{if(inProgress[e])inProgress[e].push(t);else{var a,s;if(void 0!==i)for(var n=document.getElementsByTagName("script"),o=0;o<n.length;o++){var l=n[o];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+i){a=l;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.setAttribute("data-webpack","vk:"+i),a.src=e),inProgress[e]=[t];var u=(t,i)=>{a.onerror=a.onload=null,clearTimeout(d);var r=inProgress[e];if(delete inProgress[e],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((e=>e(i))),t)return t(i)},d=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),s&&document.head.appendChild(a)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",(()=>{if(void 0!==__webpack_require__){var e=__webpack_require__.u,t=__webpack_require__.e,i={},r={};__webpack_require__.u=function(t){return e(t)+(i.hasOwnProperty(t)?"?"+i[t]:"")},__webpack_require__.e=function(a){return t(a).catch((function(t){var s=r.hasOwnProperty(a)?r[a]:3;if(s<1){var n=e(a);throw t.message="Loading chunk "+a+" failed after 3 retries.\n("+n+")",t.request=n,t}return new Promise((function(e){var t,n=3-s+1;setTimeout((function(){var t="cache-bust=true"+("&retry-attempt="+n);i[a]=t,r[a]=s-1,e(__webpack_require__.e(a))}),(t=n,1e3*Math.pow(3,t)))}))}))}}})(),(()=>{if("undefined"!=typeof document){var e=e=>new Promise(((t,i)=>{var r=__webpack_require__.miniCssF(e),a=__webpack_require__.p+r;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),r=0;r<i.length;r++){var a=(n=i[r]).getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(a===e||a===t))return n}var s=document.getElementsByTagName("style");for(r=0;r<s.length;r++){var n;if((a=(n=s[r]).getAttribute("data-href"))===e||a===t)return n}})(r,a))return t();((e,t,i,r,a)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",__webpack_require__.nc&&(s.nonce=__webpack_require__.nc),s.onerror=s.onload=i=>{if(s.onerror=s.onload=null,"load"===i.type)r();else{var n=i&&i.type,o=i&&i.target&&i.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+o+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=o,s.parentNode&&s.parentNode.removeChild(s),a(l)}},s.href=t,i?i.parentNode.insertBefore(s,i.nextSibling):document.head.appendChild(s)})(e,a,null,t,i)})),t={4592:0};__webpack_require__.f.miniCss=(i,r)=>{t[i]?r.push(t[i]):0!==t[i]&&{72:1,191:1,274:1,504:1,685:1,953:1,1409:1,1715:1,1906:1,1943:1,2318:1,2643:1,2731:1,3214:1,3509:1,3666:1,3836:1,4205:1,4273:1,4835:1,5090:1,5700:1,5805:1,6091:1,6434:1,6502:1,6637:1,6694:1,6846:1,8493:1,9311:1,9370:1,9595:1,9886:1,9933:1}[i]&&r.push(t[i]=e(i).then((()=>{t[i]=0}),(e=>{throw delete t[i],e})))}}})(),(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={4592:0};__webpack_require__.f.j=(t,i)=>{var r=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==r)if(r)i.push(r[2]);else if(3509!=t){var a=new Promise(((i,a)=>r=e[t]=[i,a]));i.push(r[2]=a);var s=__webpack_require__.p+__webpack_require__.u(t),n=new Error;__webpack_require__.l(s,(i=>{if(__webpack_require__.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=i&&("load"===i.type?"missing":i.type),s=i&&i.target&&i.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",n.name="ChunkLoadError",n.type=a,n.request=s,r[1](n)}}),"chunk-"+t,t)}else e[t]=0},__webpack_require__.O.j=t=>0===e[t];var t=(t,i)=>{var r,a,[s,n,o]=i,l=0;if(s.some((t=>0!==e[t]))){for(r in n)__webpack_require__.o(n,r)&&(__webpack_require__.m[r]=n[r]);if(o)var u=o(__webpack_require__)}for(t&&t(i);l<s.length;l++)a=s[l],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(u)},i=self.webpackChunkvkwidgets=self.webpackChunkvkwidgets||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__=__webpack_require__.O(void 0,[8598,7523,6550,7974,9204,2368,6701,4038,8231,7265,9174,5635,7299],(()=>__webpack_require__(43058)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();