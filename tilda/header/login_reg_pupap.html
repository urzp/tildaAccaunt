<!-- Обработка login regisration -->

<script>
    const AJAX_OPTIONS = {
        type: 'POST',
        headers: { 'Content-Type': 'application/json;charset=utf-8' },
    }
    const URL_IS_LOGIN = 'https://lktilda.ru/php/isLogget.php'

    $( document ).ready(function() {
        initPasswordInputs()
        initMenu()
    });

    function initPasswordInputs(){
        $('[name="password"]').attr({'type':'password'})
        $('[name="password_check"]').attr({'type':'password'})
    }

    function initMenu(){
        isLogget().then((result)=>{
            if(result){
                renderLogin()
            }else{
                renderLogOut()
            }
        })
    }

    function renderLogin(){
        hideMenuItem("Войти")
        hideMenuItem("Регистрация")
        showMenuItem("Выйти")
    }

    function renderLogOut(){
        showMenuItem("Войти")
        showMenuItem("Регистрация")
        hideMenuItem("Выйти")
    }

    function hideMenuItem(content){
        $(`.t978__link-inner.t978__link-inner_left:contains(${content})`).parent().parent().fadeOut()
    }
    function showMenuItem(content){
        $(`.t978__link-inner.t978__link-inner_left:contains(${content})`).parent().parent().fadeIn()
    }

    function checkSendForm(name){
        return $(`[data-tooltip-hook="#popup:${name}"] form`).hasClass('js-send-form-success')
    }

    async function isLogget(){
        if(!localStorage.email||!localStorage.token) return false
        let content = {
            email: localStorage.email,
            token: localStorage.token,
        }
        let result = await ajaxReq(URL_IS_LOGIN, AJAX_OPTIONS, content)
        return result
    }

    async function ajaxReq(url, options, content){
        let response = await fetch(url,{
            method: options.type,
            headers: options.heders,
            body: JSON.stringify(content)
        })
        return await response.json();
    }
</script>

