<!-- Исправление проблемы с отправкой поля quntity  -->

<script>
    let card_data
    let URL_UPDATE_PAGES = 'https://smmbakparse.ru/php/getCards.php'

    $(document).ready(function(){
        fixQuntity()
    })

    async function fixQuntity(){
        awaitElement(".t706__orderform form", addFild)
        awaitElement(".t706__product-quantity", bindFilds)
        data = {id_page: $('#allrecords').attr('data-tilda-page-id') }
        card_data = await ajaxReq(URL_UPDATE_PAGES, AJAX_OPTIONS, data)
    }

    function awaitElement(jquery_selctor, callback){
        let id_timer = setInterval(()=>{
            if($(jquery_selctor).length>0){
                clearInterval(id_timer)
                callback()
            }
        },300)      
    }

    function addFild(){
        let html_fild = `<input type="hidden" name="quantity" value="">`
        $(".t706__orderform form").append(html_fild)
        html_fild = `<input type="hidden" name="service" value="">`
        $(".t706__orderform form").append(html_fild)
        html_fild = `<input type="hidden" name="prodavec_id" value="">`
        $(".t706__orderform form").append(html_fild)
        html_fild = `<input type="hidden" name="type" value="">`
        $(".t706__orderform form").append(html_fild)
        //console.log('add fild');
    }

    function bindFilds(){
        //console.log('bind')
        $(`.t706__orderform form [name="quantity"]`).val($('.t706__product-quantity').text())
        $('.t706__product-quantity').on('DOMSubtreeModified', function(){
            $(`.t706__orderform form [name="quantity"]`).val($('.t706__product-quantity').text())
        })
    }
</script>